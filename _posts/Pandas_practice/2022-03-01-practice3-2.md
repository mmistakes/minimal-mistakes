---
title : "ğŸ†ğŸ† 3. ë¯¸êµ­ ì—°ë„ë³„ ì¶œìƒ ë¹ˆë„ë¥¼ ì•Œì•„ë³´ì (2)"

categories:
    - Pandas_practice
tags:
    - [Pandas, Preprocessing, Visualization]

toc : true
toc_sticky : true

date: 2022-03-01
last_modified_at: 2022-03-01
---  
* * *
ğŸ† ì•ìœ¼ë¡œ ì§„í–‰í•  ë°ì´í„° ë¶„ì„ ê³¼ì •ì„ ìœ„í•´ ì´ì „ í¬ìŠ¤íŒ…ì—ì„œì˜ ì „ì²˜ë¦¬ëœ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì.  

```py
import pandas as pd
birth = pd.read_csv("Data/births.csv", encoding = 'utf-8-sig')

birth_til_1988 = birth[:15067]
birth_til_1988_F = birth_til_1988[birth_til_1988['gender'] == 'F'].copy()
birth_til_1988_F = birth_til_1988_F.groupby(by = ['year', 'month']).aggregate({'births' : 'sum'})
birth_til_1988_F = birth_til_1988_F.reset_index()

birth_til_1988_M = birth_til_1988[birth_til_1988['gender'] == 'M'].copy()
birth_til_1988_M = birth_til_1988_M.groupby(by = ['year', 'month']).aggregate({'births' : 'sum'})
birth_til_1988_M = birth_til_1988_M.reset_index()

birth_after_1989 = birth[15067:]
birth_after_1989_F = birth_after_1989[birth_after_1989['gender']=="F"].copy()
birth_after_1989_F = birth_after_1989_F[['year','month','births']].copy()

birth_after_1989_M = birth_after_1989[birth_after_1989['gender']=="M"].copy()
birth_after_1989_M = birth_after_1989_M[['year','month','births']].copy()

birth_F = pd.concat([birth_til_1988_F, birth_after_1989_F])
birth_M = pd.concat([birth_til_1988_M, birth_after_1989_M])
```  

## 1. ì—°ë„ë³„ ë‚¨ì„± / ì—¬ì„± ì¶œìƒ ìˆ˜ ë¹„êµ

ğŸ† ìœ„ì—ì„œ ë§Œë“  birth_F / birth_M ë°ì´í„°í”„ë ˆì„ì„ ê° ì—°ë„ë³„ë¡œ groupby í•´ì„œ ì¶œìƒ ìˆ˜ë¥¼ êµ¬í•œë‹¤.  

```py
birth_F_year = birth_F.groupby('year').aggregate({'births' : 'sum'})
birth_M_year = birth_M.groupby('year').aggregate({'births' : 'sum'})
birth_year = pd.merge(birth_F_year, birth_M_year, on = 'year', how = 'inner')
birth_year.columns = ['births_F', 'births_M']
birth_year.head()
```
```
>>
        births_F	births_M
year		
1969	1753634	    1846572
1970	1819164	    1918636
1971	1736774	    1826774
1972	1592347	    1673888
1973	1533102	    1613023
```  

plotlyë¡œ ì‹œê°í™”í•´ì£¼ì.  

```py
import plotly.graph_objects as go
import plotly.offline as pyo
pyo.init_notebook_mode()

fig = go.Figure()
fig.add_trace(
    go.Scatter(
        x = birth_year.index, y = birth_year['births_F'], name='Female',
        text = birth_year['births_F'], texttemplate = '%{text:,}'
    ))

fig.add_trace(
    go.Scatter(
        x = birth_year.index, y = birth_year['births_M'], name = 'Male',
        text = birth_year['births_M'], texttemplate = '%{text:,}', textfont= dict(color = 'white')
    ))

fig.update_layout(
    {
        'title' : {'text' : '<b>Female/Male births per year</b>', 'font' : {'size' : 25}, 'x' : 0.5, 'y': 0.9},
        'xaxis' : {'showticklabels' : True, 'dtick' : 1, 'title' : {'text' : 'year', 'font' : {'size' : 20}}},
        'yaxis' : {'showticklabels' : True, 'tick0' : '1M', 'title' : {'text' : 'births', 'font' : {'size' : 20}}},
        
        'showlegend' : True

    })
fig.show()
```
<p align="center"><img src="https://user-images.githubusercontent.com/65170165/156113252-5c1655d7-c8fc-4583-8607-9f980958f35f.png" width="1000" /></p>  

ğŸ‘‰ ì „ì²´ì ì¸ ì¶”ì„¸ë¥¼ ë³´ì•˜ì„ ë•Œ ë‚¨ì„±ì˜ ì¶œìƒ ì¶”ì´ê°€ ì—¬ì„±ë³´ë‹¤ ê³„ì† ë†’ì•˜ë˜ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  

ğŸ‘‰ ë˜í•œ 1970ë…„ëŒ€ ì´ˆë°˜ì„ ì œì™¸í•˜ê³ ëŠ” ì ì§„ì ìœ¼ë¡œ ì¦ê°€í•˜ëŠ” ëª¨ìŠµì„ ë³´ì—¬ì£¼ë©°, ì´ëŠ” ì•„ë§ˆë„ 1960ë…„ëŒ€ ë§ê³¼ 1970ë…„ëŒ€ì˜ ì˜¤ì¼ì‡¼í¬ì™€ ë² íŠ¸ë‚¨ì „ìŸì— ê´€ë ¨ë˜ì–´ ìˆì§€ ì•Šì„ê¹Œ ìƒê°í•œë‹¤. ë¬¼ë¡  ë‹¤ë¥¸ ëª‡ê°€ì§€ ì´ìœ ê°€ ìˆì„ ìˆ˜ ìˆê² ì§€ë§Œ, ì¶œìƒ ë°ì´í„°ë§Œì„ ê°€ì§€ê³  ì •í™•íˆ íŒŒì•…í•˜ê¸°ëŠ” ì–´ë ¤ìš¸ ê²ƒ ê°™ë‹¤.

## 2. ìš”ì¼ë³„ ì¶œìƒ ì¶”ì´ í™•ì¸í•˜ê¸°

ğŸ† ì´ë²ˆì—ëŠ” ìš”ì¼ë³„ë¡œ ì „ì²˜ë¦¬ë¥¼ í•´ì¤„ ê²ƒì´ê¸° ë•Œë¬¸ì— ë°ì´í„°í”„ë ˆì„ì˜ year, month, day ì—´ì„ ì‚¬ìš©í•´ì•¼í•œë‹¤. ì´ ì„¸ê°œì˜ ì—´ì„ to_datetime í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ ìš”ì¼ì„ êµ¬í•´ì¤„ ê²ƒì´ë‹¤.  

```py
birth_date = pd.pivot_table(birth_til_1988, index = ['year','month', 'day'], values = ['births'], aggfunc={'births' : 'sum'})
birth_date.head()
```
```
>>
                        births
year	month	day	
1969	1	    1.0	    8486
                2.0	    9002
                3.0 	9542
                4.0	    8960
                5.0	    8390
```  

```py
birth_date = birth_date.reset_index()
birth_date[['day']] = birth_date[['day']].astype('int64')
birth_date.head()
```
```
>>
year	month	day	births
0	1969	1	1	8486
1	1969	1	2	9002
2	1969	1	3	9542
3	1969	1	4	8960
4	1969	1	5	8390
```  

ğŸ† ì‹œê³„ì—´ ì²˜ë¦¬ëŠ” ì–´ì§€ê°„í•˜ë©´ to_datetime í•¨ìˆ˜ë¡œ ë‹¤ í•´ê²°ì´ ë˜ì§€ë§Œ, ê°€ë”ì”© ìœ¤ë…„ì´ ë°œìƒí•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤. ë°ì´í„°ì˜ ì–‘ì´ ì ì€ ê²½ìš°ì—ëŠ” ìœ¤ë…„ì´ ë°œìƒí•˜ëŠ” ê²½ìš°ë¥¼ ì œì™¸ì‹œì¼œì£¼ëŠ” í•¨ìˆ˜ë¥¼ í•˜ë‚˜ ì‘ì„±í•´ë„ ë˜ì§€ë§Œ ì´ ê²½ìš°ì—ëŠ” ì—°ë„ê°€ ì ì§€ ì•Šì€ ë°ì´í„°ì´ê¸° ë•Œë¬¸ì— ìœ¤ë…„ì„ ë”°ë¡œ ì²˜ë¦¬í•´ì£¼ëŠ” ì½”ë“œë¥¼ í•˜ë‚˜ ì‘ì„±í•´ì£¼ê² ë‹¤(ì•„ì§ ì •í™•í•œ ì‘ë™ì›ë¦¬ëŠ” ì˜ ëª¨ë¥´ê² ë‹¤... ì¢€ë” ê³µë¶€í•´ì„œ ë”°ë¡œ ë¸”ë¡œê·¸ì—ì„œ ë‹¤ë¤„ì•¼ê² ë‹¤ğŸ¤¢).  


```py
import numpy as np
quartiles = np.percentile(birth_date['births'], [25,50,75])
mu = quartiles[1]
sig = 0.74 * (quartiles[2] - quartiles[0])
birth_date = birth_date.query('(births > @mu - 5*@sig) & (births < @mu + 5*@sig)')
```  
```py
birth_date = birth_date.astype('str')
birth_date['births'] = birth_date['births'].astype('int64')
birth_date['date'] = pd.to_datetime(birth_date['year'] + '-' + birth_date['month'] + '-' + birth_date['day'], errors = 'raise')
birth_date.head()
```
```
>>
    year	month	day	births	date
0	1969	1	    1	8486	1969-01-01
1	1969	1	    2	9002	1969-01-02
2	1969	1	    3	9542	1969-01-03
3	1969	1	    4	8960	1969-01-04
4	1969	1	    5	8390	1969-01-05
```  

ìš”ì¼ì„ êµ¬í•˜ê¸° ìœ„í•´ì„œ <a>. dt . weekday</a> ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì.  

```py
birth_date['weekday'] = birth_date['date'].dt.weekday
birth_date.head()
```
```
>>
    year	month	day	births	date	    weekday
0	1969	1	    1	8486	1969-01-01	2
1	1969	1	    2	9002	1969-01-02	3
2	1969	1	    3	9542	1969-01-03	4
3	1969	1	    4	8960	1969-01-04	5
4	1969	1	    5	8390	1969-01-05	6
```  

weekday ì—´ì´ ìƒˆë¡œ ìƒê¸´ê²ƒì„ í™•ì¸í• ìˆ˜ ìˆìœ¼ë‚˜, ìˆ«ìë¡œ êµ¬ì„±ë˜ì–´ìˆë‹¤. ì´ëŠ” ìœ„ì—ì„œ ì‚¬ìš©í•œ ë©”ì„œë“œì˜ ê²°ê³¼ê°’ìœ¼ë¡œ 0ë¶€í„° ì¼ìš”ì¼ì„ ì˜ë¯¸í•œë‹¤. ë”°ë¼ì„œ ì´ ê°’ì„ ìš°ë¦¬ì—ê²Œ ìµìˆ™í•œ ì˜ì–´ë¡œ ë°”ê¿”ì¤„ í•„ìš”ê°€ ìˆë‹¤. ğŸ”‘ ì´ ê³¼ì •ì€ ë”°ë¡œ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì„œ apply í•¨ìˆ˜ë¡œ ë°ì´í„°í”„ë ˆì„ì— ì ìš©ì‹œí‚¤ëŠ” ìˆœì„œë¡œ ì§„í–‰í•œë‹¤.  

```py
def weekday_func(row):
    if row['weekday'] == 0:
        row['weekday'] = 'Mon'
    elif row['weekday'] == 1:
        row['weekday'] = 'Tue'
    elif row['weekday'] == 2:
        row['weekday'] = 'Wed'
    elif row['weekday'] == 3:
        row['weekday'] = 'Thu'
    elif row['weekday'] == 4:
        row['weekday'] = 'Fri' 
    elif row['weekday'] == 5:
        row['weekday'] = 'Sat'
    elif row['weekday'] == 6:
        row['weekday'] = 'Sun'
    
    return row

birth_date = birth_date.apply(weekday_func, axis = 1)
birth_date.head()
```
```
>>
	year	month	day	births	date	    weekday
0	1969	1	    1	8486	1969-01-01	Wed
1	1969	1	    2	9002	1969-01-02	Thu
2	1969	1	    3	9542	1969-01-03	Fri
3	1969	1	    4	8960	1969-01-04	Sat
4	1969	1	    5	8390	1969-01-05	Sun
```  

ìœ„ ë°ì´í„°ëŠ” 1969ë…„ë¶€í„° 1988ë…„ê¹Œì§€ì˜ ì •ë³´ë¥¼ ë‹´ê³  ìˆë‹¤. ìš°ë¦¬ëŠ” ì´ ë…„ë„ë“¤ì„ 10ë…„ ë‹¨ìœ„ë¡œ ëŠì–´ì„œ ìš”ì¼ë³„ë¡œ ì •ë¦¬í•  ê²ƒì´ë‹¤. ì´ë¥¼ ìœ„í•´ ë˜ í•˜ë‚˜ì˜ í•¨ìˆ˜ë¥¼ ë§Œë“¤ê³  apply í•´ì£¼ì.  

```py
def decade_func(row):
    if row['year'] // 10 == 196:
        row['decade'] = 1960
    elif row['year'] // 10 == 197:
        row['decade'] = 1970
    elif row['year'] // 10 == 198:
        row['decade'] = 1980
        
    return row

birth_decade_weekday = birth_date.apply(decade_func, axis = 1).copy()

birth_decade_weekday = birth_decade_weekday[['decade', 'weekday', 'births']].copy()

birth_decade_weekday = birth_decade_weekday.groupby(['decade','weekday']).sum().copy()
birth_decade_weekday = birth_decade_weekday.reset_index()
birth_decade_weekday['decade'] = pd.Categorical(birth_decade_weekday['decade'], categories=[1960,1970,1980], ordered = True)
birth_decade_weekday['weekday'] = pd.Categorical(birth_decade_weekday['weekday'], categories=['Mon','Tue','Wed','Thu','Fri','Sat','Sun'], ordered = True)

birth_decade_weekday = birth_decade_weekday.sort_values(['decade','weekday'])
birth_decade_weekday = birth_decade_weekday.set_index('decade')

birth_decade_weekday.head()
```
```
>>
        weekday	births
decade		
1960	Mon	    526638
1960	Tue	    549754
1960	Wed	    537910
1960	Thu	    517742
1960	Fri	    531220
```  

ìš°ë¦¬ê°€ ì›íŒ ëŒ€ë¡œ 10ë…„ ì£¼ê¸°, ìš”ì¼ë³„ë¡œ ê·¸ë£¹í™”ê°€ ì§€ì–´ì§„ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì´ ê³¼ì •ì—ì„œ <a>pd . Categorical ( ) </a> í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ í•´ë‹¹ ì—´ì˜ ìˆœì„œë¥¼ ì§€ì •í–ˆë‹¤. ì´ í•¨ìˆ˜ì˜ ê¸°ëŠ¥ì€ ë‹¤ë¥¸ í¬ìŠ¤íŠ¸ì—ì„œ ë” ìì„¸íˆ ë‹¤ë¤„ë³´ì•„ê² ë‹¤(ì ì  ë‹¤ë£° ê²Œ ë§ì•„ì§„ë‹¤...ğŸ˜…).  

ë§ˆì§€ë§‰ìœ¼ë¡œ ê° 10ë…„ ì£¼ê¸°ë¡œ ë°ì´í„°ë¥¼ ë‚˜ëˆ ì£¼ë©´ ìš°ë¦¬ê°€ ì›í•˜ëŠ” ìµœì¢… ë°ì´í„°ê°€ ë§Œë“¤ì–´ì§„ë‹¤!!  

```py
birth_1960 = birth_decade_weekday[birth_decade_weekday.index == 1960]
birth_1970 = birth_decade_weekday[birth_decade_weekday.index == 1970]
birth_1980 = birth_decade_weekday[birth_decade_weekday.index == 1980]
```
```
>>
        weekday	births
decade		
1980	Mon	    4949739
1980	Tue 	5173612
1980	Wed	    5045584
1980	Thu	    5013476
1980	Fri	    5069502
1980	Sat	    4214867
1980	Sun	    4041017
```  

```py
import plotly.graph_objects as go
import plotly.offline as pyo
pyo.init_notebook_mode()

fig = go.Figure()

fig.add_trace(
    go.Scatter(
        x = birth_1970['weekday'], y = birth_1970['births'], name = '1970'))

fig.add_trace(
    go.Scatter(
        x = birth_1980['weekday'], y = birth_1980['births'], name = '1980'))

fig.update_layout(
{
    'title' : {'text' : '<b>Births by Weekday in 1970 / 1980</b>', 'font' : {'size' : 25}, 'x' : 0.5, 'y' : 0.92},
    'showlegend' : True,
    'xaxis' : {'showticklabels' : True, 'title' : {'text' : 'Weekday', 'font' : {'size' : 15}}},
    'yaxis' : {'showticklabels' : True, 'title' : {'text' : 'Births', 'font' : {'size' : 15}}}
})
fig.show()
```
<p align="center"><img src="https://user-images.githubusercontent.com/65170165/156117681-d7f8b670-fe7a-4422-8dfb-b15e8f105fb1.png" width="1000" /></p>  


ğŸ‘‰ 1970ë…„ëŒ€ ì´ˆë°˜ì˜ ë†’ì§€ ì•Šì€ ì¶œìƒìœ¨ì˜ ì˜í–¥ìœ¼ë¡œ ì „ì²´ì ìœ¼ë¡œ ë´¤ì„ ë•ŒëŠ” 1980ë…„ëŒ€ê°€ 1970ë…„ëŒ€ë³´ë‹¤ ë†’ì€ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ì£¼ë§ì—ëŠ” 1970ë…„ëŒ€ê°€ ë” ë†’ì€ ì¶”ì´ë¥¼ ë³´ì¸ë‹¤.  

ğŸ‘‰ ì™œ 1960ë…„ë„ ë°ì´í„°ë„ ë§Œë“¤ê³  ì•ˆì“°ëƒëŠ” ì§ˆë¬¸ì´ ìƒê¸¸ìˆ˜ë„ ìˆë‹¤. í•˜ì§€ë§Œ ì´ ë°ì´í„°ê°€ ìˆ˜ì§‘ë˜ê¸° ì‹œì‘í•œ ë…„ë„ê°€ 1969ë…„ë„ë¶€í„°ì´ê¸° ë•Œë¬¸ì— 1960ë…„ëŒ€ëŠ” ê·¸ëƒ¥ 1969ë…„ì˜ ë°ì´í„°ì´ë‹¤. ì´ê±¸ ë‹¤ë¥¸ ë…„ë„ì™€ ë‹¤ë£¨ëŠ” ê²ƒì´ ì˜¤íˆë ¤ ê·¸ ë¶„ì„ì˜ ì˜ë¯¸ë¥¼ íë¦¬ê¸° ë•Œë¬¸ì— 1970ë…„ë„ì™€ 1980ë…„ë„ë§Œì„ ë¹„êµí•˜ì.

* * *

ğŸ† ì´ë²ˆ ë°ì´í„°ëŠ” í¬ìŠ¤íŒ… ë‘ë²ˆì´ë©´ ëë‚  ì¤„ ì•Œì•˜ëŠ”ë° ë­”ê°€ ë¶€ê°€ì ìœ¼ë¡œ ë‚´ê°€ ì•Œê³  ì‹¶ì€ ê²ƒë„ ë§ê³  ê¸°ë¡í•˜ê³  ì‹¶ì€ ê²ƒë„ ë§ì•„ì„œì¸ì§€ ì£¼ì €ë¦¬ì£¼ì €ë¦¬ ë§ì´ ê¸¸ì–´ì¡Œë‹¤... ë¸”ë¡œê·¸ë¥¼ ìš´ì˜í•˜ë©´ í• ìˆ˜ë¡ ë”°ë¡œ ë‹¤ë¤„ì•¼í•  ê²ƒë„ ë§ì•„ì§€ê³  ëª¨ë¥´ëŠ” ê²ƒë„ ê³„ì† ìƒê¸°ëŠ” ê¸°ë¶„ì´ë‹¤. ê·¸ë˜ë„ ì´ë ‡ê²Œ ì •ë¦¬í•´ ë‘ë©´ ë‚˜ì¤‘ì— í•œë²ˆì”© ì°¾ì•„ë³¼ ìˆ˜ ìˆì„ í…Œë‹ˆ ë” ì¬ë°Œê²Œ í•´ë´ì•¼ê² ë“œì•„!!  

ğŸ† ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ì„œ ê³„ì†~~
* * *
<div style="text-align: left">ğŸ’¡íŒŒì´ì¬ ë°ì´í„° ì‚¬ì´ì–¸ìŠ¤ í•¸ë“œë¶(ìœ„í‚¤ë¶ìŠ¤,2020)ì˜ ì €ì Jake VanderPlas ë¶„ì˜ ê¹ƒí—ˆë¸Œì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ìŒì„ ë°í™ë‹ˆë‹¤.</div>
