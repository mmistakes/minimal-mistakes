---
title : "ğŸ†ğŸ† 3. ë¯¸êµ­ ì—°ë„ë³„ ì¶œìƒ ë¹ˆë„ë¥¼ ì•Œì•„ë³´ì (3)"

categories:
    - Pandas_practice
tags:
    - [Pandas, Preprocessing, Visualization]

toc : true
toc_sticky : true

date: 2022-03-01
last_modified_at: 2022-03-01
---  
* * *
ğŸ† ì•ìœ¼ë¡œ ì§„í–‰í•  ë°ì´í„° ë¶„ì„ ê³¼ì •ì„ ìœ„í•´ ì´ì „ í¬ìŠ¤íŒ…ì—ì„œì˜ ì „ì²˜ë¦¬ëœ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì.  

```py
import pandas as pd
birth = pd.read_csv("Data/births.csv", encoding = 'utf-8-sig')

birth_til_1988 = birth[:15067]

birth_date = pd.pivot_table(birth_til_1988, index = ['year','month', 'day'], values = ['births'], aggfunc={'births' : 'sum'})
birth_date = birth_date.reset_index()
birth_date[['day']] = birth_date[['day']].astype('int64')

import numpy as np
quartiles = np.percentile(birth_date['births'], [25,50,75])
mu = quartiles[1]
sig = 0.74 * (quartiles[2] - quartiles[0])
birth_date = birth_date.query('(births > @mu - 5*@sig) & (births < @mu + 5*@sig)')

birth_date = birth_date.astype('str')
birth_date['births'] = birth_date['births'].astype('int64')
birth_date['date'] = pd.to_datetime(birth_date['year'] + '-' + birth_date['month'] + '-' + birth_date['day'], errors = 'raise')
birth_date['weekday'] = birth_date['date'].dt.weekday

def weekday_func(row):
    if row['weekday'] == 0:
        row['weekday'] = 'Mon'
    elif row['weekday'] == 1:
        row['weekday'] = 'Tue'
    elif row['weekday'] == 2:
        row['weekday'] = 'Wed'
    elif row['weekday'] == 3:
        row['weekday'] = 'Thu'
    elif row['weekday'] == 4:
        row['weekday'] = 'Fri' 
    elif row['weekday'] == 5:
        row['weekday'] = 'Sat'
    elif row['weekday'] == 6:
        row['weekday'] = 'Sun'
    
    return row

birth_date = birth_date.apply(weekday_func, axis = 1)

birth_date.head()
```
```
>>
    year	month	day	births	date	    weekday
0	1969	1	    1	8486	1969-01-01	Wed
1	1969	1	    2	9002	1969-01-02	Thu
2	1969	1	    3	9542	1969-01-03	Fri
3	1969	1	    4	8960	1969-01-04	Sat
4	1969	1	    5	8390	1969-01-05	Sun
```

## 1. 1969ë…„ ì¼ë³„ë¡œ ì¶œìƒ ì¶”ì´ íŒŒì•…í•˜ê¸°

ğŸ† ì•ì„œ ì‚¬ìš©í•˜ì§€ ì•Šì€ 1969ë…„ë„ì˜ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¼ë³„ ì¶œìƒ ì¶”ì´ë¥¼ íŒŒì•…í•´ë³´ì.  

```py
birth_1969 = birth_date[birth_date['year'] == 1969]
birth_1969
```
```
>>
    year	month	day	births	date	    weekday
0	1969	1	    1	8486	1969-01-01	Wed
1	1969	1	    2	9002	1969-01-02	Thu
2	1969	1	    3	9542	1969-01-03	Fri
3	1969	1	    4	8960	1969-01-04	Sat
4	1969	1	    5	8390	1969-01-05	Sun
...	...	    ...	    ...	...	    ...	        ...
378	1969	12	    27	9304	1969-12-27	Sat
379	1969	12	    28	9004	1969-12-28	Sun
380	1969	12	    29	10980	1969-12-29	Mon
381	1969	12	    30	12232	1969-12-30	Tue
382	1969	12	    31	11122	1969-12-31	Wed

365 rows Ã— 6 columns
```  

ê¸°ê°€ ë§‰íˆê²Œ ë”± 365ê°œì˜ í–‰ì„ ê°€ì§„ë‹¤. ì´ëŸ°ê±¸ ë³´ë©´ ê¸°ë¶„ì´ ì°¸ ì¢‹ë‹¤ğŸ˜‰.  

ì´ ë°ì´í„°í”„ë ˆì„ë„ ìœ¤ë…„ì„ ì²˜ë¦¬í•´ì£¼ê³  datetime í•¨ìˆ˜ë¥¼ ì ìš©í•˜ì.  

```py
import numpy as np
quartiles = np.percentile(birth_1969['births'], [25,50,75])
mu = quartiles[1]
sig = 0.74 * (quartiles[2] - quartiles[0])
birth_1969 = birth_1969.query('(births > @mu - 5*@sig) & (births < @mu + 5*@sig)')

birth_1969['day'] = birth_1969['day'].astype('int64')
birth_1969 = birth_1969.astype('str')
birth_1969['births'] = birth_1969['births'].astype('int64')

birth_1969['date'] = pd.to_datetime(birth_1969['year'] + '-' + birth_1969['month'] + '-' + birth_1969['day'], errors = 'raise')
birth_1969.head()
```
```
>>
	year	month	day	births	date	    weekday
0	1969	1	    1	8486	1969-01-01	Wed
1	1969	1	    2	9002	1969-01-02	Thu
2	1969	1	    3	9542	1969-01-03	Fri
3	1969	1	    4	8960	1969-01-04	Sat
4	1969	1	    5	8390	1969-01-05	Sun
```  

ë§ˆì§€ë§‰ìœ¼ë¡œ plotly ì‹œê°í™”í•´ì£¼ì.  

```py
import plotly.graph_objects as go
import plotly.offline as pyo
pyo.init_notebook_mode()

fig = go.Figure()
fig.add_trace(
    go.Scatter(
        x = birth_1969['date'], y = birth_1969['births'], marker_color = '#025918'))

fig.update_layout(
{
    'title' : {'text':'<b>Births in 1969</b>', 'font':{'size':25}, 'x':0.5, 'y':0.92},
    'xaxis' : {'showticklabels':True, 'dtick' : 'M1', 'tickfont' : {'size':15}, 'title' : {'text':'Date', 'font':{'size':20}}},
    'yaxis' : {'showticklabels':True, 'tickfont' : {'size':15}, 'title' : {'text':'Births', 'font':{'size':20}}},
    'template':'presentation'
})

fig.add_annotation(
    x = '1969-12-30', y = 12250,
    
    arrowcolor='#025918',
    arrowhead=2,
    arrowsize=1,
    arrowwidth=2,
    
    text = 'MAX : 1969-12-30,12232',
    font = dict(size = 13, color = 'white'),
    
    bordercolor='#025918',
    borderpad=4,
    borderwidth=2,
    
    ax = 20, ay = -40,
    align = 'center',
    bgcolor = '#025918',
    opacity = 0.8
    )

fig.add_annotation(
    x = '1969-4-20', y = 7930,
    
    arrowcolor='#025918',
    arrowhead=2,
    arrowsize=1,
    arrowwidth=2,
    
    text = 'MIN : 1969-4-20, 7928',
    font = dict(size = 13, color = 'white'),
    
    bordercolor='#025918',
    borderpad=4,
    borderwidth=2,
    
    ax = 20, ay = 50,
    align = 'center',
    bgcolor = '#025918',
    opacity = 0.8
    )

fig.show()
```
<p align="center"><img src="https://user-images.githubusercontent.com/65170165/156122896-08e26cfb-b4f5-4ce8-98fb-b73657906a79.png" width="1000" /></p>

## 4. Heatmap - ë¶„ê¸°ë³„ ì¶œìƒ ë¹ˆë„ (1969 ~ 2008)

ğŸ† ë§ˆì§€ë§‰ìœ¼ë¡œ ì „ì²´ì ì¸ ì¶œìƒ ë¹ˆë„ë¥¼ ì•Œì•„ë³´ê¸° ìœ„í•´ íˆíŠ¸ë§µì„ ê·¸ë ¤ë³´ì.

```py
birth_quarter = birth.groupby(['year','month']).agg({'births':'sum'}) 
birth_quarter = birth_quarter.reset_index()
birth_quarter = birth_quarter.astype('str')
birth_quarter['Date'] = pd.to_datetime(birth_quarter['year'] + '-' + birth_quarter['month'], errors = 'raise')
birth_quarter.head()
```
```
>>
year	month	births	Date
0	1969	1	293940	1969-01-01
1	1969	2	270786	1969-02-01
2	1969	3	296550	1969-03-01
3	1969	4	282638	1969-04-01
4	1969	5	289124	1969-05-01
```  

í•´ë‹¹ ì›”ì˜ ë¶„ê¸°ë¥¼ êµ¬í•˜ê¸° ìœ„í•´ì„œ <a>dt . quarter</a> ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì.  

```py
birth_quarter['Quarter'] = birth_quarter['Date'].dt.quarter
birth_quarter['births'] = birth_quarter['births'].astype('int64')
birth_quarter = birth_quarter.groupby(['year', 'Quarter']).agg({'births':'sum'})
birth_quarter_plotly = birth_quarter.reset_index()
birth_quarter_plotly.head()
```
```
>>
year	Quarter	births
0	1969	1	861276
1	1969	2	863372
2	1969	3	952010
3	1969	4	923548
4	1970	1	891214
```  

ê¹”ë”í•˜ê²Œ ì •ë¦¬ë˜ì—ˆë‹¤!! ì‹œê°í™”í•˜ìğŸ™Œ.  

```py
fig = go.Figure()
fig.add_trace(
    go.Heatmap(
        x = birth_quarter_plotly['year'], y = birth_quarter_plotly['Quarter'], z = birth_quarter_plotly['births'],
        colorscale = 'blues'))

fig.update_layout(
    {
        'title':{'text':'<b>ë¶„ê¸°ë³„ ì¶œìƒ ì •ë„</b>', 'font':{'size':25}, 'x':0.5, 'y':0.92},
        'xaxis':{'showticklabels':True, 'title':{'text':'ë…„ë„', 'font':{'size':20}}},
        'yaxis':{'showticklabels':True, 'dtick':1, 'title':{'text':'ë¶„ê¸°', 'font':{'size':20}}}
    })

fig.show()
```
<p align="center"><img src="https://user-images.githubusercontent.com/65170165/156124123-17d2a82e-759c-4da9-a5a2-b215afe01aa8.png" width="1000" /></p>  

ğŸ‘‰ ì „ì²´ì ì¸ ë…„ë„ì˜ ë¶„ê¸°ë¥¼ ë³´ë©´ 3ë¶„ê¸°ì˜ ì¶œì‚° ì¶”ì´ê°€ ê°€ì¥ ë†’ì€ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ë˜í•œ ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ì „ì²´ì ì¸ ì¶œì‚°ìœ¨ì´ ë†’ì•„ì§€ê³  ìˆìŒì„ í™•ì¸í•˜ì.  
* * *

ğŸ† ì¶”ê°€ë¡œ ì´ë ‡ê²Œ ë³µì¡í•œ ê³¼ì •ì„ ê±°ì¹˜ì§€ ì•Šê³  pandasì˜ stlye ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì„œ íˆíŠ¸ë§µì„ ê·¸ë¦´ìˆ˜ë„ ìˆë‹¤. ê°„ë‹¨í•˜ê³  ì§ê´€ì ìœ¼ë¡œ ë¶„ì„í•  ë•Œ ì¢‹ì€ ë°©ë²•ì´ë¯€ë¡œ ì•Œì•„ë‘ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤ğŸ˜‰!!  

```py
birth_quarter_df = birth_quarter_plotly[128:160].set_index(['year','Quarter']).unstack()
birth_quarter_df.style.background_gradient(cmap = 'Reds')
```
<p align="center"><img src="https://user-images.githubusercontent.com/65170165/156125444-c61805f3-db6d-4457-9a7c-1aa30e028ce2.png" width="400" /></p>  

ğŸ‘‰ ìµœê·¼ 8ë…„ê°„ì˜ ì¶”ì„¸ë¥¼ ë³´ì•„ë„ ê³„ì†í•´ì„œ ì¶œì‚°ìœ¨ì´ ë†’ì•„ì§€ê³  ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

* * *

ğŸ† ìš”ë ‡ê²Œ í•´ì„œ CDC ë°ì´í„° ë¶„ì„ì„ í•œì°¨ë¡€ ëëƒˆë‹¤. ë””ìŠ¤í¬ ê³µë°±ê¸° ë•Œë¬¸ì— ì˜ˆì „ì— ì‚¬ìš©í–ˆë˜ í•¨ìˆ˜ë“¤ë„ í•œë²ˆì”© ì°¾ì•„ë³´ë©´ì„œ ì‚¬ìš©ë²•ì„ ë‹¤ì‹œ ìµíˆëŠ” ì¤‘ì´ë¼ ìì—°ìŠ¤ëŸ½ê²Œ ì†ì´ ì¡°ê¸ˆ êµ¼ë– ì¡Œë‹¤ğŸ¤¦â€â™‚ï¸. ê¸°ì´ˆë¶€í„° ë‹¤ì‹œ íƒ„íƒ„íˆ ë‹¤ì§„ë‹¤ëŠ” ìƒê°ìœ¼ë¡œ ì—´ì‹¬íˆ ë‹¬ë ¤ë´ì•¼ê² ë‹¤ğŸƒâ€â™‚ï¸ğŸƒâ€â™‚ï¸ğŸƒâ€â™‚ï¸!!  

ğŸ† ë‚´ì¼ì´ë©´ ê°œê°•ì´ë‹¤. 5ì „ê³µ 3í”„ë¡œì íŠ¸ì˜ 2022ë…„ 1í•™ê¸°ê°€ ë  ê²ƒ ê°™ë‹¤. ë­ í•˜ë©´ ë˜ê² ì§€ë¼ëŠ” ë§ˆìŒìœ¼ë¡œ ê·¸ëƒ¥ ì—´ì‹¬íˆ ì‚´ì•„ë´ì•¼ê² ë‹¤. ì•„ììì£!!
* * *
<div style="text-align: left">ğŸ’¡íŒŒì´ì¬ ë°ì´í„° ì‚¬ì´ì–¸ìŠ¤ í•¸ë“œë¶(ìœ„í‚¤ë¶ìŠ¤,2020)ì˜ ì €ì Jake VanderPlas ë¶„ì˜ ê¹ƒí—ˆë¸Œì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ìŒì„ ë°í™ë‹ˆë‹¤.</div>
