---
title: NicolTIP#017: How to automate the build process (of WP7 apps and more:) with powershell
tags: [automate, Build, c#, compile, NicolTIP, powershell, Script, version, Visual Studio, WP7]
---
<p>I developed for fun a couple a WP7 apps and I needed to automate (just a little bit:-) the release process, mainly because:</p>  <ul>   <li>The application version must be entered in various point and should be keep in sync </li>    <li>I’d like to store all released version in a specific directory </li> </ul>  <p>The easiest way I found to do this is via PowerShell. I wrote a super simple script that:</p>  <ul>   <li>store into a variable the version you want to assign to the build </li>    <li>replace the version in all location needed for the project.      <ul>       <li>In my project, that is of just 1 dll, I had to keep in sync the following files:          <ul>           <li>Properties\AssemblyInfo.cs </li>            <li>Properties\WMAppManifest.xml </li>            <li>Model\ApplicationInfo.cs (this is a custom c# class…) </li>         </ul>       </li>     </ul>   </li>    <li>Rebuild the solution as “release” </li>    <li>Copy the .xap file into Releases Folder, renaming it adding the version to the file </li> </ul>  <p>The directory structure I used (in my project – LED) is the following</p>  <ul>   <li>LED (solution folder)      <ul>       <li>Releases          <ul>           <li>NicolD.Phone.App.LED-1.0.0.1.xap </li>            <li>NicolD.Phone.App.LED-1.0.0.2.xap </li>            <li>… </li>         </ul>       </li>        <li>NicolD.Phone.App.LED (project folder)          <ul>           <li>bin              <ul>               <li>… </li>             </ul>           </li>            <li>… </li>         </ul>       </li>        <li>LED.sln </li>        <li>Build.ps1 (the file below) </li>     </ul>   </li> </ul>  <p>I think that this approach can be used/extended in many other scenarios similar to this one.</p>  <p>Good luck<img style="border-bottom-style: none; border-right-style: none; border-top-style: none; border-left-style: none" class="wlEmoticon wlEmoticon-smile" alt="Smile" src="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/49/62/metablogapi/6052.wlEmoticon-smile_73476109.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/CommunityServer-Blogs-Components-WeblogFiles/00-00-00-49-62-metablogapi/6052.wlEmoticon_2D00_smile_5F00_73476109.png" /></p>  <pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">$version = &quot;<span style="color: #8b0000">1.02.00.00</span>&quot;
</pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px"></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">$SolutionPath = &quot;<span style="color: #8b0000">D:\MyProjects2010\WP7\PRO\LED\&quot;
</span></pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">$Solution = $SolutionPath + &quot;<span style="color: #8b0000">LED.sln</span>&quot;
</pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">$SolutionBin = $SolutionPath + &quot;<span style="color: #8b0000">NicolD.Phone.App.LED\Bin\&quot;
</span></pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">$LogFile = $SolutionBin + &quot;<span style="color: #8b0000">Build.log</span>&quot;
</pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">$VStudio2010= &quot;<span style="color: #8b0000">C:\Program Files (x86)\Microsoft Visual Studio 10.0\Common7\IDE\devenv.exe</span>&quot;
</pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">$releases = $SolutionPath + &quot;<span style="color: #8b0000">Releases\&quot;
</span></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">$build        = $SolutionBin + &quot;<span style="color: #8b0000">Release\NicolD.Phone.App.LED.xap</span>&quot;
</pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">$buildArchive = $releases +    &quot;<span style="color: #8b0000">NicolD.Phone.App.LED-</span>&quot; + $version + &quot;<span style="color: #8b0000">.xap</span>&quot;
</pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px"></pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px"><span style="color: #0000ff">function</span> <span style="color: #0000ff">replace</span> 
</pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">{
</pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">    $o = $args[0]
</pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">    $a = $args[1]
</pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">    $b = $args[2]
</pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">    
</pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">    (<span style="color: #0000ff">Get</span>-Content $o) | 
</pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">    <span style="color: #0000ff">Foreach</span>-Object {$_ -<span style="color: #0000ff">replace</span> $a, $b} | 
</pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">    <span style="color: #0000ff">Set</span>-Content $o
</pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px"></pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">}
</pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px"></pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">$AssemblyInfo = $SolutionPath + &quot;<span style="color: #8b0000">NicolD.Phone.App.LED\Properties\AssemblyInfo.cs</span>&quot;
</pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">$<span style="color: #0000ff">filter</span> = 'AssemblyVersion\(&quot;<span style="color: #8b0000">\d+.\d+.\d+.\d+</span>&quot;\)'
</pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">$newstring = 'AssemblyVersion(&quot;<span style="color: #8b0000">' + $version + '</span>&quot;)'
</pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px"><span style="color: #0000ff">replace</span> $AssemblyInfo $<span style="color: #0000ff">filter</span> $newstring
</pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px"></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">$<span style="color: #0000ff">filter</span> = 'AssemblyFileVersion\(&quot;<span style="color: #8b0000">\d+.\d+.\d+.\d+</span>&quot;\)'
</pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">$newstring = 'AssemblyFileVersion(&quot;<span style="color: #8b0000">' + $version + '</span>&quot;)'
</pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px"><span style="color: #0000ff">replace</span> $AssemblyInfo $<span style="color: #0000ff">filter</span> $newstring
</pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px"></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">$manifest = $SolutionPath + &quot;<span style="color: #8b0000">NicolD.Phone.App.LED\Properties\WMAppManifest.xml</span>&quot;
</pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">$<span style="color: #0000ff">filter</span> = 'Version=&quot;<span style="color: #8b0000">\d+.\d+.\d+.\d+</span>&quot;'
</pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">$newstring = 'Version=&quot;<span style="color: #8b0000">' + $version + '</span>&quot;'
</pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px"><span style="color: #0000ff">replace</span> $manifest $<span style="color: #0000ff">filter</span> $newstring
</pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px"></pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">$appinfo = $SolutionPath + &quot;<span style="color: #8b0000">NicolD.Phone.App.LED\Model\ApplicationInfo.cs</span>&quot;
</pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">$<span style="color: #0000ff">filter</span> = 'ApplicationVersion = &quot;<span style="color: #8b0000">\d+.\d+.\d+.\d+</span>&quot;'
</pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">$newstring = 'ApplicationVersion = &quot;<span style="color: #8b0000">' + $version + '</span>&quot;'
</pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px"><span style="color: #0000ff">replace</span> $appinfo $<span style="color: #0000ff">filter</span> $newstring
</pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px"></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">&amp; $VStudio2010 $Solution /clean | Out-Null
</pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">&amp; $VStudio2010 $Solution /rebuild release /out $logfile | Out-Null
</pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px"></pre><pre style="background-color: #ffffff; margin: 0em; width: 100%; font-family: consolas,&#39;Courier New&#39;,courier,monospace; font-size: 12px">copy $build $buildarchive
</pre></pre>
