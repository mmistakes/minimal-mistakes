---
layout: single
title: "[Elasticsearch] Elastic Stack ê²€ìƒ‰ ë¬¸ì œì™€ í•´ì„¤"
date: "2022-02-05 12:25:27"
categories: Elasticsearch
tag: [Elasticsearch, Kibana]
toc: true
author_profile: true
# sidebar:
#   nav: "docs"
---

## ğŸ“Œ ì‹¤ìŠµì— ì•ì„œ ê¸°ë³¸ì ì¸ ë¶€ë¶„ ë³µê¸°

### âœ… Query Context ì™€ Filter Context ì˜ ì°¨ì´

- Query ContextëŠ” Full Text Search(**ì „ë¬¸ê²€ìƒ‰**)ì— ì‚¬ìš©ëœë‹¤.
- Filter ContextëŠ” **YES/NO** ì¡°ê±´ì˜ ë°”ì´ë„ˆë¦¬ êµ¬ë¶„ì— ì‚¬ìš©ëœë‹¤.
- Query ContextëŠ” **ìŠ¤ì½”ì–´ë§ ê³„ì‚°**ì„ ìˆ˜í–‰í•œë‹¤.
- Filter ContextëŠ” **ìŠ¤ì½”ì–´ë§ ê³„ì‚°**ì„ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤.
  - ìºì‹± ì‚¬ìš© ê°€ëŠ¥.
  - ì‘ë‹µ ì†ë„ê°€ ë¹ ë¥´ë‹¤.

### âœ… term

```sql
# termëŠ” SQLì˜ equals ì ˆê³¼ ìœ ì‚¬í•˜ë‹¤
SELECT * FROM TB_USER WHERE ì»¬ëŸ¼ëª… = "ì»¬ëŸ¼ëª…"
```

<u class="custom-border-bottom">termì€ ìƒ‰ì¸ì´ ë‚˜ëˆ ì§€ë©´ì„œ í˜•íƒœì†Œë¡œ ë‚˜ëˆ„ì–´ì§€ëŠ” ì €ì¥ë˜ëŠ” í† í°ë“±ì„ termì´ë¼ê³  í•œë‹¤.</u>  
ë˜í•œ **term ì¿¼ë¦¬**ëŠ” ì£¼ì–´ì§„ ì§ˆì˜ë¬¸ê³¼ ì €ì¥ëœ í…€ê³¼ **ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ë¬¸ì¥**ì„ ì°¾ëŠ”ë‹¤.

termìœ¼ë¡œ "name" : "cjung gglee" ë¼ê³  ì…ë ¥í•˜ê²Œ ë˜ëŠ”ê²½ìš°ì—ëŠ” "cjung gglee"ë¼ëŠ” í•˜ë‚˜ì˜  
termì„ ì°¾ê¸° ë•Œë¬¸ì— ê²°ê³¼ê°€ ë‚˜ì˜¤ì§€ ì•ŠëŠ”ë‹¤. ë§Œì•½ 2ê°œ ì´ìƒì˜ termì„ ê°™ì´ ê²€ìƒ‰í•˜ê³  ì‹¶ì„ ë•ŒëŠ” terms ì¿¼ë¦¬ë¥¼ ì´ìš©í•´ì•¼ í•œë‹¤.

### âœ… match

```sql
# matchëŠ” SQLì˜ LIKE ì ˆê³¼ ìœ ì‚¬í•˜ë‹¤
SELECT ì»¬ëŸ¼ëª… FROM í…Œì´ë¸” WHERE ì»¬ëŸ¼ëª… LIKE '%A%'
```

match ì¿¼ë¦¬ë„ term ì¿¼ë¦¬ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì£¼ì–´ì§„ ì§ˆì˜ë¬¸ì„ ìƒ‰ì¸ëœ termê³¼ ë¹„êµí•´ì„œ ì¼ì¹˜í•˜ëŠ” ë„íë¨¼íŠ¸ë¥¼ ê²€ìƒ‰í•˜ëŠ” ì§ˆì˜ë‹¤. <u class="custom-border-bottom">ë‹¤ë§Œ term ì¿¼ë¦¬ì™€ ë‹¤ë¥´ê²Œ match ì¿¼ë¦¬ì—ì„œëŠ” ì£¼ì–´ì§„ ì§ˆì˜ë¬¸ ë˜í•œ í˜•íƒœì†Œ ë¶„ì„ì„ ê±°ì¹œ ë’¤ ë¶„ì„ëœ ì§ˆì˜ë¬¸ìœ¼ë¡œ ê²€ìƒ‰ì„ ìˆ˜í–‰í•œë‹¤.</u>

<u class="custom-border-bottom">ì˜ˆë¥¼ ë“¤ë©´ The Andë¡œ ê²€ìƒ‰í•˜ë©´ ë§¤ì¹˜ ì¿¼ë¦¬ëŠ” ì´ ì§ˆì˜ë¬¸ì„ í˜•íƒœì†Œ ë¶„ì„ì„ ê±°ì³ì„œ the andë¡œ ì§ˆì˜ë¬¸ì„ ë°”ê¾¸ê³  ì´ ê°’ì„ termê³¼ ë¹„êµí•´ì„œ ê²€ìƒ‰í•œë‹¤.</u>

ê·¸ë¦¬ê³  ê¸°ë³¸ì ìœ¼ë¡œ matchì— ë“¤ì–´ê°€ëŠ” ë°ì´í„°ë“¤ì€ or ê²€ìƒ‰ìœ¼ë¡œ ì§„í–‰ëœë‹¤. ë‹¤ì‹œë§í•˜ë©´ ì•„ë˜ì˜ ì˜ˆì—ì„œëŠ” Diamond ë˜ëŠ” Street ë˜ëŠ” Bartlett ë¼ëŠ” termìœ¼ë¡œ ê²€ìƒ‰í•œë‹¤. ì´ê²ƒì„ andë¡œ ë°”ê¾¸ê³  ì‹¶ì€ ê²½ìš°ì—ëŠ” "operator" : "and" ì˜µì…˜ì„ ë„£ì–´ì£¼ì–´ì•¼ í•œë‹¤.

```json
GET /bank/_search
{
  "query": {
    "match": {
      "address": "Diamond Street Bartlett"
    }
  }
}

// operator ì ìš©
GET /bank/_search
{
  "query": {
    "match": {
      "address": {
        "query" : "Diamond Street Bartlett",
        "operator" : "and" // operatorë¥¼ andë¡œ ìˆ˜í–‰í•˜ë©´ 'Diamond Street Bartlett'ë¥¼ ì°¾ëŠ”ë‹¤
      }
    }
  }
}
```

## ğŸ“Œ ë¬¸ì œ í’€ì´

### âœ… Info

```text
#=====================================================================================
# @since  : 2022-02-05(í† )
# @author : ymkim
# @desc   : í€´ì¦ˆë¥¼ í™œìš©í•œ ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ ìµíˆê¸° 2
#=====================================================================================
```

### âœ… ë¬¸ì œí’€ì´ ì „ ì‹¤ìŠµ ë°ì´í„°ë¥¼ ë“±ë¡

```json
#=====================================================================================
# @ë¬¸ì œí’€ì´   : ë¬¸ì œí’€ì´ ì „ ì‹¤ìŠµ ë°ì´í„°ë¥¼ ë“±ë¡í•œë‹¤.
# @ì£¼ì˜ì‚¬í•­   : _bulk APIë¥¼ ì‚¬ìš©í•˜ëŠ”ê²½ìš° í•œ ì¤„ë¡œ ì…ë ¥ì„í•´ì•¼ í•œë‹¤.
#=====================================================================================
POST tourcompany/customerlist/_bulk
{"index": {"_id": "1"}}
{"name": "Alfred", "phone": "010-1234-5678", "holyday_dest": "Disneyland", "departure_date": "2017/01/20"}
{"index": {"_id": "2"}}
{"name": "Huey", "phone": "010-2222-4444", "holyday_dest": "Disneyland", "departure_date": "2017/01/20"}
{"index": {"_id": "3"}}
{"name": "Naomi", "phone": "010-3333-5555", "holyday_dest": "Hawaii", "departure_date": "2017/01/10"}
{"index": {"_id": "4"}}
{"name": "Andra", "phone": "010-6666-7777", "holyday_dest": "Bora Board", "departure_date": "2017/01/11"}
{"index": {"_id": "5"}}
{"name": "Paul", "phone": "010-9999-8888", "holyday_dest": "Hawaii", "departure_date": "2017/01/10"}
{"index": {"_id": "6"}}
{"name": "Clin", "phone": "010-5555-4444", "holyday_dest": "Venice", "departure_date": "2017/01/16"}

```

### âœ… 1ë²ˆ tourcompany ì¸ë±ìŠ¤ì—ì„œ 010-3333-5555ë¥¼ ê²€ìƒ‰í•˜ì‹œì˜¤

```json
#=====================================================================================
# @ë¬¸ì œë²ˆí˜¸   : 1ë²ˆ
# @ë¬¸ì œí’€ì´   : tourcompany ì¸ë±ìŠ¤ì—ì„œ 010-3333-5555ë¥¼ ê²€ìƒ‰í•˜ì‹œì˜¤.
#=====================================================================================

GET tourcompany/customerlist/_search?q="010-3333-5555"

GET tourcompany/customerlist/_search
{
  "query": {
    "match": {
      "phone": "010-3333-5555"
    }
  }
}

GET tourcompany/customerlist/_search
{
  "query": {
    "match": {
      "phone": {
        "query": "010-3333-5555",
        "operator": "and"
      }
    }
  }
}

GET tourcompany/customerlist/_search
{
  "query": {
    "match_phrase": {
      "phone": "010-3333-5555"
    }
  }
}
```

### âœ… 2ë²ˆ íœ´ì¼ ì—¬í–‰ì„ ë””ì¦ˆë‹ˆëœë“œë¡œ ë– ë‚˜ëŠ” ì‚¬ëŒë“¤ì˜ í•¸ë“œí° ë²ˆí˜¸ë§Œ ê²€ìƒ‰

```json
#=====================================================================================
# @ë¬¸ì œë²ˆí˜¸   : 2ë²ˆ
# @ë¬¸ì œí’€ì´   : íœ´ì¼ ì—¬í–‰ì„ ë””ì¦ˆë‹ˆëœë“œë¡œ ë– ë‚˜ëŠ” ì‚¬ëŒë“¤ì˜ í•¸ë“œí° ë²ˆí˜¸ë§Œ ê²€ìƒ‰í•œë‹¤.
#=====================================================================================

GET tourcompany/_search?q="Disneyland"&_source=phone,holyday_dest
GET tourcompany/_search
{
  "query": {
    "match": {
      "holyday_dest": "Disneyland"
    }
  },
  "_source": "phone"
}
```

### âœ… 3ë²ˆ departure dateê°€ 2017/01/10 ê³¼ 2017/01/11 ì¸ ì‚¬ëŒì„ ì¡°íšŒ

```json
#=====================================================================================
# @ë¬¸ì œë²ˆí˜¸   : 3ë²ˆ
# @ë¬¸ì œí’€ì´   : departure dateê°€ 2017/01/10 ê³¼ 2017/01/11 ì¸ ì‚¬ëŒì„ ì¡°íšŒí•˜ê³  ì´ ë¦„ ìˆœìœ¼ë¡œ ì¶œë ¥í•œë‹¤
#               (nameê³¼ departure date í•„ë“œë§Œ ì¶œë ¥)
#=====================================================================================

GET tourcompany/customerlist/_search?q="2017/01/10" or "2017/01/11"&sort=name.keyword
```

### âœ… 4ë²ˆ BoraBora ì—¬í–‰ì€ ê³µí•­í…ŒëŸ¬ ì‚¬íƒœë¡œ ì·¨ì†Œ, BoraBora ì—¬í–‰ìì˜ ëª…ë‹¨ ì‚­ì œ

```json
#=====================================================================================
# @ë¬¸ì œë²ˆí˜¸   : 4ë²ˆ
# @ë¬¸ì œí’€ì´   : BoraBora ì—¬í–‰ì€ ê³µí•­í…ŒëŸ¬ ì‚¬íƒœë¡œ ì·¨ì†ŒëìŠµë‹ˆë‹¤. BoraBora ì—¬í–‰ìì˜ ëª…ë‹¨ì„ ì‚­ì œí•´ì£¼ì‹­ì‹œì˜¤.
#=====================================================================================

GET tourcompany/customerlist/_search
GET tourcompany/customerlist/_search?q=Bora Bora
POST tourcompany/customerlist/_delete_by_query?q=Bora Bora
```

### âœ… 5ë²ˆ Hawaii ë‹¨ì²´ ê´€ëŒê°ì˜ ìš”ì²­ìœ¼ë¡œ ì¶œë°œì¼ ì¡°ì •

```json
#=====================================================================================
# @ë¬¸ì œë²ˆí˜¸   : 5ë²ˆ
# @ë¬¸ì œí’€ì´   : Hawaii ë‹¨ì²´ ê´€ëŒê°ì˜ ìš”ì²­ìœ¼ë¡œ ì¶œë°œì¼ì´ ì¡°ì •ëìŠµë‹ˆë‹¤. 2017/01/10ì— ì¶œë°œí•˜ëŠ” Hawaiiì˜ ì¶œë°œì¼ì„
#               2017/01/17ì¼ë¡œ ìˆ˜ì •í•´ì£¼ì‹­ì‹œì˜¤.
#=====================================================================================

GET tourcompany/customerlist/_search?q=Hawaii

# UPDATE Query
POST tourcompany/customerlist/_update_by_query
{
  "script": {"inline": "ctx._source.departure_date='2017/01/17'", "lang": "painless"},
  "query": {
    "bool": {
      "must": [
        {"match": {"departure_date": "2017/01/10"}},
        {"match": {"holyday_dest": "Hawaii"}}
      ]
    }
  }
}
```

### ì°¸ê³  ìë£Œ

- [ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ ê²€ìƒ‰ ë¬¸ì œì™€ í•´ì„¤](https://www.inflearn.com/course/ELK-%ED%86%B5%ED%95%A9%EB%A1%9C%EA%B7%B8%EC%8B%9C%EC%8A%A4%ED%85%9C-IT%EB%B3%B4%EC%95%88/lecture/27234?tab=curriculum&volume=1.00)
- [Elasticsearch ì§ˆì˜ DSL ì •ë¦¬](https://wedul.site/493)
