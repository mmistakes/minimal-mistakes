---
layout: single
title: '[Node.js] Prisma ì‹œì‘í•˜ê¸°'
categories: Backend
tag: [Javascript, Node.js]
toc: true 
author_profile: false
sidebar:
    nav: "counts"
published: true

---

Node.jsì™€ TypeScriptë¥¼ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì íŠ¸ì—ì„œ Prismaë¥¼ ORM ë„êµ¬ë¡œ ì„ íƒí•˜ì—¬ ê´€ë ¨ ë‚´ìš©ì„ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.

<div style="display: flex; justify-content: center;">
     <img src="{{site.url}}\images\2024-08-29-prisma\prisma.png" alt="Alt text" style="width: 40%; height: 40%; margin: 20px;">
</div>

ê³µì‹ ë¬¸ì„œì—ì„œ PrismaëŠ” **ì½ê¸° ì‰¬ìš´ ë°ì´í„° ëª¨ë¸ê³¼ ìë™ ë§ˆì´ê·¸ë ˆì´ì…˜, íƒ€ì… ì•ˆì „ì„±, ìë™ ì™„ì„±ì„ ì œê³µí•˜ëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ Node.js ë° TypeScript ORM ë„êµ¬** ë¼ê³  ì„¤ëª…ë˜ì–´ìˆë‹¤. 


## ORM 
 ORM ì´ë€ Object-Relational Mapping ì˜ ì•½ìë¡œ, ê°ì²´ ì§€í–¥ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ í˜¸í™˜ë˜ì§€ ì•ŠëŠ” ìœ í˜•ì˜ ì‹œìŠ¤í…œ ê°„ì— ë°ì´í„°ë¥¼ ë³€í™˜í•˜ëŠ” í”„ë¡œê·¸ë˜ë° ê¸°ìˆ ì´ë‹¤. 

ORMì„ ì‚¬ìš©í•˜ë©´ SQL ì¿¼ë¦¬ ì—†ì´ ë°ì´í„°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤. 

<div style="display: flex; justify-content: center;">
     <img src="{{site.url}}\images\2024-08-29-prisma\prisma_orm.png" alt="Alt text" style="width: 70%; height: 70%; margin: 20px;">
</div>

**ì‰½ê²Œ ë§í•´ ìš°ë¦¬ëŠ” Prismaë¥¼ í†µí•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì™€ í†µì‹ ì„ í•˜ê²Œëœë‹¤.** 
 
## Prisma íŠ¹ì§• 

- **íƒ€ì… ì•ˆì „ì„±**: PrismaëŠ” TypeScriptì™€ ì˜ í†µí•©ë˜ì–´ íƒ€ì… ì•ˆì „ì„±ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ëŠ” ì½”ë“œ ì‘ì„± ì‹œ ì˜¤ë¥˜ë¥¼ ì¤„ì´ëŠ” ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤.
- **ìë™ ìƒì„±ëœ ì¿¼ë¦¬**: PrismaëŠ” ëª¨ë¸ì„ ê¸°ë°˜ìœ¼ë¡œ ìë™ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ìƒì„±í•´ì¤ë‹ˆë‹¤. ì´ëŠ” ê°œë°œ ì‹œê°„ì„ ì¤„ì—¬ì£¼ê³  ì½”ë“œì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.
- **ë§ˆì´ê·¸ë ˆì´ì…˜ ê´€ë¦¬**: PrismaëŠ” ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆì˜ ë³€í™”ë¥¼ ì¶”ì í•˜ê³ , ì´ë¥¼ ìë™ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•  ìˆ˜ ìˆëŠ” ë„êµ¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
- **ì§ê´€ì ì¸ API**: Prismaì˜ APIëŠ” ì§ê´€ì ì´ì–´ì„œ ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒì´ ë” ì‰¬ì›Œì§‘ë‹ˆë‹¤.

TypeORM, Sequelize ë“± ì—¬ëŸ¬ ORM ë„êµ¬ê°€ ìˆì§€ë§Œ íƒ€ì… ì•ˆì „ì„±, ì¿¼ë¦¬ ì‘ì„±ì˜ ì§ê´€ì„±, ê°„í¸í•œ ë§ˆì´ê·¸ë ˆì´ì…˜ ê´€ë¦¬ ë“± ì—¬ëŸ¬ ì¥ì ì„ ê°€ì§„ prismaë¥¼ ORM ë„êµ¬ë¡œ ì„ íƒí–ˆë‹¤. 

## Prisma ì‹œì‘í•˜ê¸°

í”„ë¦¬ì¦ˆë§ˆë¥¼ ì‚¬ìš©í•´ë³´ì

- tool : vscode
- language : typeScript
- SQL : mySQL

**1. TypeScript ë° ê´€ë ¨ íŒ¨í‚¤ì§€ ì„¤ì¹˜**

```yarn add typescript ts-node @types/node --dev```

**2. TypeScript ì„¤ì • íŒŒì¼ ìƒì„±**

```npx tsc --init```

**3. Prisma CLI ë° Prisma Client ì„¤ì¹˜**

```yarn add @prisma/client```

```yarn add prisma --dev```

**4. Prisma ì´ˆê¸°í™”**

```npx prisma init```


## í…Œì´ë¸” ìƒì„±í•˜ê¸°

*vscode ìµìŠ¤í…ì…˜ Prismaë¥¼ ì„¤ì¹˜í•´ì£¼ì

**schema.prisma**

```javascript
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model bad_landlord {
  id                String   @id @default(uuid()) // ê¸°ë³¸ í‚¤, UUIDë¡œ ìë™ ìƒì„±
  name              String   @db.VarChar(50) // ìµœëŒ€ 50ìê¹Œì§€ ì €ì¥ ê°€ëŠ¥í•œ ë¬¸ìì—´ (ì´ë¦„)
  age               Int?     @db.UnsignedTinyInt // ë¶€í˜¸ ì—†ëŠ” ì‘ì€ ì •ìˆ˜ (ë‚˜ì´)
  address           String   @db.VarChar(255) // ìµœëŒ€ 255ìê¹Œì§€ ì €ì¥ ê°€ëŠ¥í•œ ë¬¸ìì—´ (ì£¼ì†Œ)
  depositObligation Decimal  @db.Decimal(15, 2) // ì†Œìˆ˜ì  ì´í•˜ 2ìë¦¬, ìµœëŒ€ 15ìë¦¬ê¹Œì§€ì˜ ì •ìˆ˜ (ë³´ì¦ê¸ˆ ì˜ë¬´)
  dueDate           DateTime @db.Date // ë‚ ì§œ ë°ì´í„° (ì±„ë¬´ ë°œìƒì¼)
  delinquency       Int      @db.UnsignedSmallInt // ë¶€í˜¸ ì—†ëŠ” ì‘ì€ ì •ìˆ˜ (ì±„ë¬´ ë¶ˆì´í–‰ ê¸°ê°„)
  fulfillmentDate   DateTime @db.Date // ë‚ ì§œ ë°ì´í„° (ì´í–‰ì¼)
  reimbursementDebt Decimal  @db.Decimal(15, 2) // ì†Œìˆ˜ì  ì´í•˜ 2ìë¦¬, ìµœëŒ€ 15ìë¦¬ê¹Œì§€ì˜ ì •ìˆ˜ (êµ¬ìƒì±„ë¬´)
  executionCount    Int      @db.UnsignedTinyInt // ë¶€í˜¸ ì—†ëŠ” ì‘ì€ ì •ìˆ˜ (ê°•ì œì§‘í–‰ ë˜ëŠ” ë³´ì „ì²˜ë¶„ ì‹ ì²­ íšŸìˆ˜)
  referenceDate     DateTime @db.Date // ë‚ ì§œ ë°ì´í„° (ê¸°ì¤€ì¼)
}


```

## DB ì—°ê²°

**.env íŒŒì¼ì„ ìƒì„±í•œë‹¤**

```javascript
// í™˜ê²½ë³€ìˆ˜ë¥¼ ì €ì¥í•˜ëŠ” íŒŒì¼ 
NODE_ENV=dev
PORT=8000
// mysql://{USER}:{PASSWORD}@{DB_URL}:{PORT}/{DATABASE_NAME}
DATABASE_URL=mysql://root:0000@loacalhost:3306/database1
```
**DB ì—…ë°ì´íŠ¸ ëª…ë ¹ì–´ ì‹¤í–‰**

```yarn prisma migrate dev```

```
Environment variables loaded from .env
Prisma schema loaded from prisma\schema.prisma
Datasource "db": MySQL database "database1" at "localhost:3306"

âˆš Enter a name for the new migration: ... init table
Applying migration `20240829095031_init_table`
```

## í…Œì´ë¸” ìƒì„±  
DBeaverì—ì„œ bad_landloard í…Œì´ë¸”ì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤. 

**bad_landloard í…Œì´ë¸”**

<div style="display: flex; justify-content: center;">
     <img src="{{site.url}}\images\2024-08-29-prisma\bad_landlord_table.png" alt="Alt text" style="width: 70%; height: 70%; margin: 20px;">
</div>

**_prisma_migrations í…Œì´ë¸”**

DB ì—…ë°ì´íŠ¸ ë‚´ì—­ì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤. 

<div style="display: flex; justify-content: center;">
     <img src="{{site.url}}\images\2024-08-29-prisma\prisma_migrations.png" alt="Alt text" style="width: 100%; height: 100%; margin: 20px;">
</div>

**migrations í´ë”**

prisma í´ë” ì•ˆì— migrations í´ë”ê°€ ìƒì„±ëë‹¤. 

migrations ì´ë ¥ê³¼ SQL ë¬¸ë²•ì„ ë³¼ ìˆ˜ ìˆë‹¤.  

```
ğŸ“¦prisma
 â”£ ğŸ“‚migrations
 â”ƒ â”£ ğŸ“‚20240829095031_init_table
 â”ƒ â”ƒ â”— ğŸ“œmigration.sql
 â”ƒ â”— ğŸ“œmigration_lock.toml
 â”— ğŸ“œschema.prisma
```

## Prisma Client ì—…ë°ì´íŠ¸ 

 ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°ì— ë³€í™”ê°€ ìƒê¸°ë©´, ì´ì— ë§ê²Œ Prisma Clientë„ ì—…ë°ì´íŠ¸ë˜ì–´ì•¼ í•œë‹¤. 

```
yarn prisma generate
``` 

ì´ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´, Prisma Clientê°€ ë‹¤ì‹œ ìƒì„±ë˜ì–´ ìµœì‹  ìŠ¤í‚¤ë§ˆë¥¼ ë°˜ì˜í•˜ê²Œ ëœë‹¤.

----

ì´ì œ Prismaë¥¼ ì‚¬ìš©í•œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ê³¼ í…Œì´ë¸” ìƒì„±ì´ ëª¨ë‘ ì™„ë£Œë˜ì—ˆë‹¤!

ë‹¤ìŒì—ëŠ” Prismaë¥¼ ì´ìš©í•œ API ìƒì„±ì— ëŒ€í•´ ë‹¤ë£° ì˜ˆì •ì´ë‹¤. 

ì•„ë˜ëŠ” ì°¸ê³ ìë£Œë¡œ Prisma Cli ì™€ ìë£Œí˜•ì— ëŒ€í•´ ì •ë¦¬í•´ë´¤ë‹¤.

---
<br>

## ì°¸ê³ ìë£Œ : Prisma CLI ë° ìë£Œí˜•
### Prisma Cli

`yarn prisma init` 
- í”„ë¡œì íŠ¸ì— prismaë¥¼ ì‚¬ìš©í•˜ëŠ”ë° í•„ìš”í•œ íŒŒì¼ ìƒì„±  > prisma/schema.prisma, prisma.env

`yarn prisma generate` 
-  prisma/schema.prismaë¥¼ ê¸°ë°˜ìœ¼ë¡œ Prisma Client ë“±ì˜ ìì› ìƒì„± 
- prisma/schema.prisma ìˆ˜ì • í›„ ë°˜ë“œì‹œ ì‹¤í–‰í•´ì•¼ í•¨ 

`yarn prisma migrate dev`
- schema.prismaë¥¼ ê¸°ë°˜ìœ¼ë¡œ DB ì—…ë°ì´íŠ¸ 
1) migrateë¥¼ ì§„í–‰í•˜ë©´ DBì— _prisma_migrations í…Œì´ë¸”ì´ ìƒì„±/ìˆ˜ì • ë¨ 
2) git ì²˜ëŸ¼ DB ìˆ˜ì • ë‚´ì—­ì„ ê´€ë¦¬ ê°€ëŠ¥ 

`yarn prisma migrate dev --create-only`
- ì‹¤ì œ DBì— ë°˜ì˜í•˜ì§€ ì•Šê³  migration íŒŒì¼ ë³€ê²½ ê°€ëŠ¥ 

`yarn prisma db pull`
- DB ìˆ˜ì • ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ê¸°ëŠ¥ (ì´ë¯¸ ë§Œë“¤ì–´ì§„ DBë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œ ì‚¬ìš©)

`yarn prisma db push`
- migration ì´ë ¥ ì—†ì´ DBì— ìˆ˜ì •ì‚¬í•­ ë°˜ì˜

<br>

### Prisma ìë£Œí˜•

**ë¬¸ìì—´ - String**

<table>
  <thead>
    <tr>
      <th style="font-size: 16px;">MySQL ìë£Œí˜•</th>
      <th style="font-size: 16px;">Prisma ìë£Œí˜•</th>
      <th style="font-size: 16px;">Prisma í‘œí˜„ì‹</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="font-size: 16px;">VARCHAR</td>
      <td style="font-size: 16px;">String</td>
      <td style="font-size: 16px;">@db.VarChar(n)</td>
    </tr>
    <tr>
      <td style="font-size: 16px;">char</td>
      <td style="font-size: 16px;">String</td>
      <td style="font-size: 16px;">@db.Char(n)</td>
    </tr>
    <tr>
      <td style="font-size: 16px;">tinytext</td>
      <td style="font-size: 16px;">String</td>
      <td style="font-size: 16px;">@db.TinyText</td>
    </tr>
    <tr>
      <td style="font-size: 16px;">text</td>
      <td style="font-size: 16px;">String</td>
      <td style="font-size: 16px;">@db.Text</td>
    </tr>
    <tr>
      <td style="font-size: 16px;">mediumtext</td>
      <td style="font-size: 16px;">String</td>
      <td style="font-size: 16px;">@db.MediumText</td>
    </tr>
    <tr>
      <td style="font-size: 16px;">longtext</td>
      <td style="font-size: 16px;">String</td>
      <td style="font-size: 16px;">@db.LongText</td>
    </tr>
  </tbody>
</table>

**ì •ìˆ˜ - Int**

<table>
  <thead>
    <tr>
      <th style="font-size: 16px;">MySQL ìë£Œí˜•</th>
      <th style="font-size: 16px;">Prisma ìë£Œí˜•</th>
      <th style="font-size: 16px;">Prisma í‘œí˜„ì‹</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="font-size: 16px;">smallint</td>
      <td style="font-size: 16px;">Int</td>
      <td style="font-size: 16px;">@db.SmallInt</td>
    </tr>
    <tr>
      <td style="font-size: 16px;">smallint unsigned</td>
      <td style="font-size: 16px;">Int</td>
      <td style="font-size: 16px;">@db.UnsignedSmallInt</td>
    </tr>
    <tr>
      <td style="font-size: 16px;">mediumint</td>
      <td style="font-size: 16px;">Int</td>
      <td style="font-size: 16px;">@db.MediumInt</td>
    </tr>
    <tr>
      <td style="font-size: 16px;">mediumint unsigned</td>
      <td style="font-size: 16px;">String</td>
      <td style="font-size: 16px;">@db.UnsignedMediumInt</td>
    </tr>
    <tr>
      <td style="font-size: 16px;">int</td>
      <td style="font-size: 16px;">Int</td>
      <td style="font-size: 16px;"></td>
    </tr>
    <tr>
      <td style="font-size: 16px;">int unsigned</td>
      <td style="font-size: 16px;">Int</td>
      <td style="font-size: 16px;">@db.UnsignedInt</td>
    </tr>
        <tr>
      <td style="font-size: 16px;">tinyint</td>
      <td style="font-size: 16px;">Int</td>
      <td style="font-size: 16px;">@db.TinyInt(n)</td>
    </tr>
        <tr>
      <td style="font-size: 16px;">tinyint unsigned</td>
      <td style="font-size: 16px;">Int</td>
      <td style="font-size: 16px;">@db.UnsignedTinyInt(n)</td>
    </tr>
  </tbody>
</table>

> `n`ì€ ë¬¸ìì—´ì˜ ìµœëŒ€ ê¸¸ì´ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤ (`@db.VarChar(255)`, `@db.Char(10)`).


**ì‹¤ìˆ˜ - Float, Double, Decimal**

<table>
  <thead>
    <tr>
      <th style="font-size: 16px;">MySQL ìë£Œí˜•</th>
      <th style="font-size: 16px;">Prisma ìë£Œí˜•</th>
      <th style="font-size: 16px;">Prisma í‘œí˜„ì‹</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="font-size: 16px;">decimal(a,b)</td>
      <td style="font-size: 16px;">Decimal</td>
      <td style="font-size: 16px;">@db.Decimal(x,y)</td>
    </tr>
    <tr>
      <td style="font-size: 16px;">float</td>
      <td style="font-size: 16px;">Float</td>
      <td style="font-size: 16px;">@db.Float</td>
    </tr>
    <tr>
      <td style="font-size: 16px;">double</td>
      <td style="font-size: 16px;">Float</td>
      <td style="font-size: 16px;">@db.Double</td>
    </tr>
  </tbody>
</table>

**ë‚ ì§œ - DateTime**

<table>
  <thead>
    <tr>
      <th style="font-size: 16px;">MySQL ìë£Œí˜•</th>
      <th style="font-size: 16px;">Prisma ìë£Œí˜•</th>
      <th style="font-size: 16px;">Prisma í‘œí˜„ì‹</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="font-size: 16px;">date</td>
      <td style="font-size: 16px;">DateTime</td>
      <td style="font-size: 16px;">@db.Date</td>
    </tr>
    <tr>
      <td style="font-size: 16px;">datetime</td>
      <td style="font-size: 16px;">DateTime</td>
      <td style="font-size: 16px;">@db.DateTime</td>
    </tr>
    <tr>
      <td style="font-size: 16px;">timestamp</td>
      <td style="font-size: 16px;">DateTime</td>
      <td style="font-size: 16px;">@db.TimeStamp</td>
    </tr>
        <tr>
      <td style="font-size: 16px;">time</td>
      <td style="font-size: 16px;">DateTime</td>
      <td style="font-size: 16px;">@db.Time</td>
    </tr>
  </tbody>
</table>


**ë…¼ë¦¬í˜• - Boolean**

<table>
  <thead>
    <tr>
      <th style="font-size: 16px;">MySQL ìë£Œí˜•</th>
      <th style="font-size: 16px;">Prisma ìë£Œí˜•</th>
      <th style="font-size: 16px;">Prisma í‘œí˜„ì‹</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="font-size: 16px;">boolean | tinyint(1)</td>
      <td style="font-size: 16px;">Boolean</td>
      <td style="font-size: 16px;"></td>
    </tr>
</tbody>
</table>
  
<br>
<br>

----
Reference

- <a href = 'https://f-lab.kr/insight/understanding-orm'>ë°±ì—”ë“œ ê°œë°œìë¥¼ ìœ„í•œ ORM(Object-Relational Mapping) ì´í•´í•˜ê¸°</a>
- <a href = 'https://www.prisma.io/docs/orm/overview/introduction/should-you-use-prisma
'>Should you use Prisma ORM?</a>
- <a href = 'https://f-lab.kr/insight/typescript-prisma-database-access-20240809'>íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì™€ í”„ë¦¬ì¦ˆë§ˆë¥¼ í™œìš©í•œ ì•ˆì „í•œ ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼</a>
- <a href = 'https://www.inflearn.com/course/%EC%8A%B5%EA%B4%80%EB%B6%80%ED%84%B0-%EB%85%B8%EB%93%9C-%EC%9D%B5%EC%8A%A4%ED%94%84%EB%A0%88%EC%8A%A4-%EA%B8%B0%EC%B4%88/dashboard9'>ìŠµê´€ë¶€í„° ë°”ê¿”ì£¼ëŠ” Node.js & Express ê¸°ì´ˆ</a>

