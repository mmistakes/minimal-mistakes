---
layout: single
title: "jupyter notebook 변환하기!"
categories: coding
tag: [python, blog, jekyll]
toc: true
author_profile: false
---

# ✅ 문제
## 1️⃣ 코딩
* (1) 전처리

time을 분 단위 정수(int) 로 변환하라.

예: "09:00" → 0, "09:10" → 10, "09:50" → 50

원본 df는 변경하지 말고, 변환된 결과를 df2에 저장하라.

(2) 파생 컬럼 생성

signal_flag 컬럼을 만들어라.

signal == "on" → 1

signal == "off" → 0

value_change 컬럼을 만들어라.

value_change = 현재 value − 직전 value

첫 행은 NaN이어도 된다.

shift 사용

active_value 컬럼을 만들어라.

signal_flag == 1 인 행에서는 value

signal_flag == 0 인 행에서는 0

where 사용

2️⃣ 분석

active_value의 누적합(cumsum) 을 계산해
active_cumsum 컬럼을 만들어라.

value_change < 0 이면서 signal_flag == 1 인 행의
time 값을 Python list로 만들어
alert_times에 저장하라.

3️⃣ 시각화 (조건 엄수)
Figure 1: value line plot

figure size: (7, 3)

x축: time (정수)

y축: value

선 스타일: 기본

marker: o

title: "Value Over Time"

xlabel: "Time (min)"

ylabel: "Value"

grid: 표시 ✅

legend: 표시 ❌

alert_times에 해당하는 time 위치에

빨간색 점을 덧그려 표시할 것

점 크기: 70

Figure 2: active_cumsum line plot

figure size: (7, 3)

x축: time

y축: active_cumsum

선 스타일: 기본

marker: o

title: "Active Value Cumsum"

xlabel: "Time (min)"

ylabel: "Active Cumsum"

grid: 표시 ✅

legend: 표시 ❌

active_cumsum의 최댓값 위치에

텍스트 "PEAK"을 표시할 것

텍스트는 점의 위쪽에 표시

❗ 조건 요약

pandas + matplotlib만 사용

for-loop ❌

groupby, diff, interpolate, pivot, rolling ❌

문제에 없는 시각 요소 추가 ❌

```python
import pandas as pd

df = pd.DataFrame({
    "time": ["09:00","09:10","09:20","09:30","09:40","09:50"],
    "signal": ["on","on","off","on","off","off"],
    "value":  [10,   12,   11,   13,   12,   11]
})
display(df)
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>signal</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>09:00</td>
      <td>on</td>
      <td>10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>09:10</td>
      <td>on</td>
      <td>12</td>
    </tr>
    <tr>
      <th>2</th>
      <td>09:20</td>
      <td>off</td>
      <td>11</td>
    </tr>
    <tr>
      <th>3</th>
      <td>09:30</td>
      <td>on</td>
      <td>13</td>
    </tr>
    <tr>
      <th>4</th>
      <td>09:40</td>
      <td>off</td>
      <td>12</td>
    </tr>
    <tr>
      <th>5</th>
      <td>09:50</td>
      <td>off</td>
      <td>11</td>
    </tr>
  </tbody>
</table>
</div>

```python
df2 = df.copy()
df2['time'] = pd.to_datetime(df['time']).dt.minute
df2
```

    C:\Users\Admin\AppData\Local\Temp\ipykernel_19480\2933073117.py:2: UserWarning: Could not infer format, so each element will be parsed individually, falling back to `dateutil`. To ensure parsing is consistent and as-expected, please specify a format.
      df2['time'] = pd.to_datetime(df['time']).dt.minute

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>signal</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>on</td>
      <td>10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10</td>
      <td>on</td>
      <td>12</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20</td>
      <td>off</td>
      <td>11</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30</td>
      <td>on</td>
      <td>13</td>
    </tr>
    <tr>
      <th>4</th>
      <td>40</td>
      <td>off</td>
      <td>12</td>
    </tr>
    <tr>
      <th>5</th>
      <td>50</td>
      <td>off</td>
      <td>11</td>
    </tr>
  </tbody>
</table>
</div>

```python
import numpy as np
df2['signal_flag'] = df2['signal'].map({'on':1,'off':0})
display(df2)
df2['value_change'] = df2['value']-df2['value'].shift(1)
display(df2)
df2['active_value'] = np.where(df2['signal_flag'] == 1, df2['value'], 0)
display(df2)
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>signal</th>
      <th>value</th>
      <th>signal_flag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>on</td>
      <td>10</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10</td>
      <td>on</td>
      <td>12</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20</td>
      <td>off</td>
      <td>11</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30</td>
      <td>on</td>
      <td>13</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>40</td>
      <td>off</td>
      <td>12</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>50</td>
      <td>off</td>
      <td>11</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>signal</th>
      <th>value</th>
      <th>signal_flag</th>
      <th>value_change</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>on</td>
      <td>10</td>
      <td>1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10</td>
      <td>on</td>
      <td>12</td>
      <td>1</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20</td>
      <td>off</td>
      <td>11</td>
      <td>0</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30</td>
      <td>on</td>
      <td>13</td>
      <td>1</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>40</td>
      <td>off</td>
      <td>12</td>
      <td>0</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>50</td>
      <td>off</td>
      <td>11</td>
      <td>0</td>
      <td>-1.0</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>signal</th>
      <th>value</th>
      <th>signal_flag</th>
      <th>value_change</th>
      <th>active_value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>on</td>
      <td>10</td>
      <td>1</td>
      <td>NaN</td>
      <td>10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10</td>
      <td>on</td>
      <td>12</td>
      <td>1</td>
      <td>2.0</td>
      <td>12</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20</td>
      <td>off</td>
      <td>11</td>
      <td>0</td>
      <td>-1.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30</td>
      <td>on</td>
      <td>13</td>
      <td>1</td>
      <td>2.0</td>
      <td>13</td>
    </tr>
    <tr>
      <th>4</th>
      <td>40</td>
      <td>off</td>
      <td>12</td>
      <td>0</td>
      <td>-1.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>50</td>
      <td>off</td>
      <td>11</td>
      <td>0</td>
      <td>-1.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

```python
df2['active_cumsum'] = df2['active_value'].cumsum()
display(df2)
alert_times = df2[(df2['value_change'] < 0) & (df2['signal_flag']==1)]['time']
alert_times = df2.loc[(df2["value_change"] < 0) & (df2["signal_flag"] == 1), "time"].tolist()
alert_times
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>signal</th>
      <th>value</th>
      <th>signal_flag</th>
      <th>value_change</th>
      <th>active_value</th>
      <th>active_cumsum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>on</td>
      <td>10</td>
      <td>1</td>
      <td>NaN</td>
      <td>10</td>
      <td>10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10</td>
      <td>on</td>
      <td>12</td>
      <td>1</td>
      <td>2.0</td>
      <td>12</td>
      <td>22</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20</td>
      <td>off</td>
      <td>11</td>
      <td>0</td>
      <td>-1.0</td>
      <td>0</td>
      <td>22</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30</td>
      <td>on</td>
      <td>13</td>
      <td>1</td>
      <td>2.0</td>
      <td>13</td>
      <td>35</td>
    </tr>
    <tr>
      <th>4</th>
      <td>40</td>
      <td>off</td>
      <td>12</td>
      <td>0</td>
      <td>-1.0</td>
      <td>0</td>
      <td>35</td>
    </tr>
    <tr>
      <th>5</th>
      <td>50</td>
      <td>off</td>
      <td>11</td>
      <td>0</td>
      <td>-1.0</td>
      <td>0</td>
      <td>35</td>
    </tr>
  </tbody>
</table>
</div>

    []

```python
import matplotlib.pyplot as plt
plt.figure(figsize=(7,3))
plt.plot(df2['time'], df2['value'], marker = 'o')
plt.xlabel("Time (min)")
plt.ylabel("Value")
plt.grid(True)
plt.title("Value Over Time")
plt.scatter(
    df2.loc[df2["time"].isin(alert_times), "time"],
    df2.loc[df2["time"].isin(alert_times), "value"],
    color="red",
    s=70
)
```

    <matplotlib.collections.PathCollection at 0x1307c8a7a90>

![png](output_5_1.png)

```python
plt.figure(figsize=(7,3))
plt.plot(df2['time'], df2['active_cumsum'], marker = 'o')
imax = df2["active_cumsum"].idxmax()
x_peak = df2.loc[imax, "time"]
y_peak = df2.loc[imax, "active_cumsum"]
plt.text(x_peak, y_peak, "PEAK", va="bottom")  # 위쪽에 표시
plt.xlabel("Time (min)")
plt.ylabel("Active Cumsum")
plt.grid(True)
plt.title("Active Value Cumsum")
```

    Text(0.5, 1.0, 'Active Value Cumsum')

![png](output_6_1.png)

```python
# 정답
```

```python
import pandas as pd
import matplotlib.pyplot as plt

df2 = df.copy()
df2["time"] = pd.to_datetime(df2["time"], format="%H:%M").dt.minute

df2["signal_flag"] = df2["signal"].map({"on": 1, "off": 0})
df2["value_change"] = df2["value"] - df2["value"].shift(1)

# 문제에서 where 사용 요구였으니 Series.where로
df2["active_value"] = df2["value"].where(df2["signal_flag"].eq(1), 0)

df2["active_cumsum"] = df2["active_value"].cumsum()

alert_times = df2.loc[(df2["value_change"] < 0) & (df2["signal_flag"] == 1), "time"].tolist()

# Figure 1
plt.figure(figsize=(7, 3))
plt.plot(df2["time"], df2["value"], marker="o")
plt.scatter(
    df2.loc[df2["time"].isin(alert_times), "time"],
    df2.loc[df2["time"].isin(alert_times), "value"],
    color="red",
    s=70
)
plt.title("Value Over Time")
plt.xlabel("Time (min)")
plt.ylabel("Value")
plt.grid(True)
plt.show()

# Figure 2
plt.figure(figsize=(7, 3))
plt.plot(df2["time"], df2["active_cumsum"], marker="o")

imax = df2["active_cumsum"].idxmax()
x_peak = df2.loc[imax, "time"]
y_peak = df2.loc[imax, "active_cumsum"]
plt.text(x_peak, y_peak, "PEAK", va="bottom")  # 위쪽에 표시

plt.title("Active Value Cumsum")
plt.xlabel("Time (min)")
plt.ylabel("Active Cumsum")
plt.grid(True)
plt.show()

```

![png](output_8_0.png)

![png](output_8_1.png)

```python

```

```python

```

```python

```
