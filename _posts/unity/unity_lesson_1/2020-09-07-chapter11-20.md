---
title:  "Unity Chapter 11-20. ì¢€ë¹„ TPS ê²Œì„ ë§Œë“¤ê¸° : Player Controller" 

categories:
  -  Unity Lesson 1 
tags:
  - [Game Engine, Unity]

toc: true
toc_sticky: true

date: 2020-09-07
last_modified_at: 2020-09-07
---

ì¸í”„ëŸ°ì— ìˆëŠ” ì´ì œë¯¼ë‹˜ì˜ **ë ˆíŠ¸ë¡œì˜ ìœ ë‹ˆí‹° C# ê²Œì„ í”„ë¡œê·¸ë˜ë° ì—ì„¼ìŠ¤** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤. ğŸ˜€  
[ğŸŒœ [ë ˆíŠ¸ë¡œì˜ ìœ ë‹ˆí‹° C# ê²Œì„ í”„ë¡œê·¸ë˜ë° ì—ì„¼ìŠ¤] ê°•ì˜ ë“¤ìœ¼ëŸ¬ ê°€ê¸°!](https://www.inflearn.com/course/%EC%9C%A0%EB%8B%88%ED%8B%B0-%EA%B2%8C%EC%9E%84-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D-%EC%97%90%EC%84%BC%EC%8A%A4)
{: .notice--warning}

<br>

# Chapter 11. ì¢€ë¹„ TPS ê²Œì„ ë§Œë“¤ê¸° 

## ğŸ“œPlayerController.cs

> `Player Character` ì˜¤ë¸Œì íŠ¸ì— ë¶™ì—¬ì¤€ë‹¤.

> ê°ê° ë…ìì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” `Player Character`ì˜ ë§ì€ ì»´í¬ë„ŒíŠ¸ë“¤ì„ ì´ê´„ ê´€ë¦¬í•´ì£¼ëŠ” ì—­í• ì„ í•¨.


1. í”Œë ˆì´ì–´ê°€ ì£½ì—ˆì„ ë•Œ 
  - í”Œë ˆì´ì–´ê°€ ë¦¬ìŠ¤í° ë  ìˆ˜ ìˆë„ë¡ í•¨
  - ë˜í•œ í”Œë ˆì´ì–´ê°€ ì£½ì—ˆì„ ë•Œ í™œì„±í™” ë˜ê±°ë‚˜ ë¹„í™œì„±í™” ë˜ëŠ” `Player Character`ì˜ ì»´í¬ë„ŒíŠ¸ë“¤ì„ í†µì œ
2. ì•„ì´í…œê³¼ ì¶©ëŒ ì²˜ë¦¬ê°€ ì¼ì–´ë‚˜ë©´ í”Œë ˆì´ì–´ê°€ ì•„ì´í…œì„ ë¨¹ì„ ìˆ˜ ìˆë„ë¡ í•¨
  - ì•„ì´í…œ ë¨¹ëŠ” ì• ë‹ˆë©”ì´ì…˜ ì¬ìƒ
  - ì•„ì´í…œ ë¨¹ì„ë•Œ ì˜¤ë””ì˜¤ ì¬ìƒ

```c#
using UnityEngine;
using UnityEngine.AI;

public class PlayerController : MonoBehaviour
{
    private Animator animator;
    public AudioClip itemPickupClip;
    public int lifeRemains = 3;
    private AudioSource playerAudioPlayer;
    private PlayerHealth playerHealth;
    private PlayerMovement playerMovement;
    private PlayerShooter playerShooter;

    // Start is called before the first frame update
    private void Start()
    {
        playerMovement = GetComponent<PlayerMovement>();
        playerShooter = GetComponent<PlayerShooter>();
        playerHealth = GetComponent<PlayerHealth>();
        playerAudioPlayer = GetComponent<AudioSource>();
        playerHealth.OnDeath += HandleDeath;

        UIManager.Instance.UpdateLifeText(lifeRemains);
        Cursor.visible = false;

    }

    private void HandleDeath()
    {
        playerMovement.enabled = false;
        playerShooter.enabled = false;

        if (lifeRemains > 0)
        {
            lifeRemains--;
            UIManager.Instance.UpdateLifeText(lifeRemains);
            Invoke("Respawn", 3f);
        }
        else
        {
            GameManager.Instance.EndGame();
        }

        Cursor.visible = true;
    }

    public void Respawn()
    {
        gameObject.SetActive(false);
        transform.position = Utility.GetRandomPointOnNavMesh(transform.position, 30f, NavMesh.AllAreas);

        gameObject.SetActive(true);
        playerMovement.enabled = true;
        playerShooter.enabled = true;

        playerShooter.gun.ammoRemain = 120;

        Cursor.visible = false;
    }


    private void OnTriggerEnter(Collider other)
    {
        // ì•„ì´í…œê³¼ ì¶©ëŒí•œ ê²½ìš° í•´ë‹¹ ì•„ì´í…œì„ ì‚¬ìš©í•˜ëŠ” ì²˜ë¦¬
        // ì‚¬ë§í•˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ì•„ì´í…œ ì‚¬ìš©ê°€ëŠ¥
        if (!playerHealth.dead)
        {
            // ì¶©ëŒí•œ ìƒëŒ€ë°©ìœ¼ë¡œ ë¶€í„° Item ì»´í¬ë„ŒíŠ¸ë¥¼ ê°€ì ¸ì˜¤ê¸° ì‹œë„
            var item = other.GetComponent<IItem>();

            // ì¶©ëŒí•œ ìƒëŒ€ë°©ìœ¼ë¡œë¶€í„° Item ì»´í¬ë„ŒíŠ¸ê°€ ê°€ì ¸ì˜¤ëŠ”ë° ì„±ê³µí–ˆë‹¤ë©´
            if (item != null)
            {
                // Use ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ì—¬ ì•„ì´í…œ ì‚¬ìš©
                item.Use(gameObject);
                // ì•„ì´í…œ ìŠµë“ ì†Œë¦¬ ì¬ìƒ
                playerAudioPlayer.PlayOneShot(itemPickupClip);
            }
        }
    }
}
```

### ë©¤ë²„ ë³€ìˆ˜

```c#
    private Animator animator;
    public AudioClip itemPickupClip;
    public int lifeRemains = 3;
    private AudioSource playerAudioPlayer;
    private PlayerHealth playerHealth;
    private PlayerMovement playerMovement;
    private PlayerShooter playerShooter;
```

- `animator`
  - ì•„ì´í…œì„ ë¨¹ì„ ë•Œ ì• ë‹ˆë©”ì´ì…˜ ì²˜ë¦¬ë¥¼ í•˜ê¸° ìœ„í•´
- `itemPickupClip`
  - ì•„ì´í…œì„ ë¨¹ì„ ë•Œ ì¬ìƒí•  ì˜¤ë””ì˜¤ í´ë¦½
- `lifeRemains`
  - ë‚¨ì€ ìƒëª… ìˆ˜
  - ì´ˆê¸° ê°’ 3 ì—ì„œ ì‹œì‘
- `playerAudioPlayer`
  - ì•„ì´í…œ ë¨¹ì„ ë•Œ ì˜¤ë””ì˜¤ í´ë¦½ì„ ì¬ìƒí•  ì˜¤ë””ì˜¤ ì¬ìƒê¸°
- `Player Character` ì˜¤ë¸Œì íŠ¸ì— ë¶™ì–´ìˆëŠ” ë‹¤ë¥¸ ìŠ¤í¬ë¦½íŠ¸ë“¤ì„ ì¼ê´„ì ìœ¼ë¡œ ì œì–´í•˜ê¸° ìœ„í•´
  - `playerHealth` ğŸ‘‰ğŸ“œPlayerHealth.cs
  - `playerMovement` ğŸ‘‰ğŸ“œPlayerMovement.cs
  - `playerShooter` ğŸ‘‰ğŸ“œPlayerShooter.cs

<br>

### ë©¤ë²„ í•¨ìˆ˜

#### private void Start()

```c#
    private void Start()
    {
        playerMovement = GetComponent<PlayerMovement>();
        playerShooter = GetComponent<PlayerShooter>();
        playerHealth = GetComponent<PlayerHealth>();
        playerAudioPlayer = GetComponent<AudioSource>();

        playerHealth.OnDeath += HandleDeath;

        UIManager.Instance.UpdateLifeText(lifeRemains);
        Cursor.visible = false;
    }
```

- ì»´í¬ë„ŒíŠ¸ë“¤ ê°€ì ¸ì˜¤ê¸°
- í”Œë ˆì´ì–´ê°€ ì‚¬ë§í•˜ë©´ **HandleDeath()** í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë„ë¡ í•œë‹¤.
  - ğŸ“œPlayerHealth.csê°€ ğŸ“œLivingEntity.csë¡œë¶€í„° ìƒì† ë°›ì•„ ê°€ì§€ê³  ìˆëŠ” **OnDeath ì•„ë°´íŠ¸**ì— **private void HandleDeath()** í•¨ìˆ˜ë¥¼ ì¶”ê°€ë¡œ ë“±ë¡í•´ì¤€ë‹¤.
    - **OnDeath ì•„ë°´íŠ¸** ğŸ‘‰ [ğŸ“œLivingEntity.cs](https://ansohxxn.github.io/unity%20lesson%201/chapter11-13/)ì˜ Action íƒ€ì…ì˜ ì´ë²¤íŠ¸ ë©¤ë²„ë¡œ <u>ìƒëª…ì²´ê°€ ì‚¬ë§í•˜ë©´ ì‹¤í–‰í•  í•¨ìˆ˜ë“¤</u>ì´ ë“±ë¡ëœë‹¤.
- ë‚¨ì€ ëª©ìˆ¨ì˜ ìˆ˜ UI ê°±ì‹ 
  - *UIManager.Instance.UpdateLifeText(lifeRemains);*
- ë§ˆìš°ìŠ¤ ì»¤ì„œ ë¹„í™œì„±í™”
  - í”Œë ˆì´ì–´ê°€ ì‚´ì•„ìˆëŠ” ë™ì•ˆì—ëŠ” ë§ˆìš°ìŠ¤ ì»¤ì„œê°€ ë³´ì´ì§€ ì•Šë„ë¡.
  - *Cursor.visible = false*

<br>

#### private void HandleDeath()

> í”Œë ˆì´ì–´ê°€ ì‚¬ë§í•  ë•Œ ì²˜ë¦¬

```c#
    private void HandleDeath()
    {
        playerMovement.enabled = false;
        playerShooter.enabled = false;

        if (lifeRemains > 0)
        {
            lifeRemains--;
            UIManager.Instance.UpdateLifeText(lifeRemains);
            Invoke("Respawn", 3f);
        }
        else
        {
            GameManager.Instance.EndGame();
        }

        Cursor.visible = true;
    }
```

- í”Œë ˆì´ì–´ê°€ ì‚¬ë§ ìƒíƒœê°€ ë˜ë©´ íŠ¹ì • ì»´í¬ë„ŒíŠ¸ë“¤ ë¹„í™œì„±í™”
  - í”Œë ˆì´ì–´ê°€ ì´ë™í•˜ì§€ ëª»í•˜ë„ë¡ ğŸ“œPlayerMovement.cs ë¥¼ ë¹„í™œì„±í™” í•´ì•¼í•˜ê³ 
    - *playerMovement.enabled = false;*
  - í”Œë ˆì´ì–´ê°€ ì´ì„ ì˜ì§€ ëª»í•˜ë„ë¡ ğŸ“œPlayerShooter.cs ë¥¼ ë¹„í™œì„±í™” í•´ì•¼í•œë‹¤.
    - *playerShooter.enabled = false;*
- ì‚¬ë§ í–ˆì–´ë„ ì•„ì§ ëª©ìˆ¨ì´ ë‚¨ì•„ ìˆë‹¤ë©´ *if (lifeRemains > 0)*
  - `lifeRemains` 1 ê°ì†Œ
  - ë‚¨ì€ ëª©ìˆ¨ì˜ ìˆ˜ UI ê°±ì‹  
  - 3 ì´ˆì˜ ì§€ì—° ì‹œê°„ ë’¤ì— **Respawn** í•¨ìˆ˜ ì‹¤í–‰
    - í”Œë ˆì´ì–´ëŠ” ì£½ì€ í›„ 3 ì´ˆ ë’¤ì— ë¦¬ìŠ¤í° ëœë‹¤.
- ì‚¬ë§ í–ˆëŠ”ë° ë‚¨ì€ ëª©ìˆ¨ë„ ì—†ë‹¤ë©´ ê²Œì„ì„ ì¢…ë£Œí•´ì•¼ í•œë‹¤.
  - *GameManager.Instance.EndGame();*
- ì‚¬ë§í–ˆë‹¤ë©´ ë‹¤ì‹œ ë§ˆìš°ìŠ¤ ì»¤ì„œê°€ ë³´ì´ë„ë¡
  - *Cursor.visible = true;*

<br>

#### public void Respawn()

> í”Œë ˆì´ì–´ê°€ ì£½ì—ˆëŠ”ë° ì•„ì§ ë‚¨ì€ ëª©ìˆ¨ì´ ìˆë‹¤ë©´ í”Œë ˆì´ì–´ê°€ ë‹¤ì‹œ ë¦¬ìŠ¤í° ë˜ë„ë¡ í•˜ëŠ” ì²˜ë¦¬.

```c#
    public void Respawn()
    {
        gameObject.SetActive(false);
        transform.position = Utility.GetRandomPointOnNavMesh(transform.position, 30f, NavMesh.AllAreas);

        gameObject.SetActive(true);
        playerMovement.enabled = true;
        playerShooter.enabled = true;

        playerShooter.gun.ammoRemain = 120;

        Cursor.visible = false;
    }
```

- `Player Character`ë¥¼ ë¹„í™œì„±í™” í•´ì¤€ë‹¤. *SetActive(false);*
  - ë¹„í™œì„±í™” í•˜ëŠ” ì´ìœ  
    - ğŸ‘‰ [ğŸ“œPlayerShooter.cs](https://ansohxxn.github.io/unity%20lesson%201/chapter11-10/#private-void-ondisable)ì˜ **OnDisable()** ì´ë²¤íŠ¸ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ì„œ `Gun` ì´ì„ ë¹„í™œì„±í™” í•˜ê¸° ìœ„í•˜ì—¬.
  - í”Œë ˆì´ì–´ì˜ ìœ„ì¹˜ë¥¼ ìƒˆë¡œìš´ ìœ„ì¹˜ë¡œ ë³€ê²½
    - í”Œë ˆì´ì–´ì˜ ìœ„ì¹˜ë¡œë¶€í„° 30 ë°˜ê²½ ë‚´ì— `NavMesh`ì˜ ëª¨ë“  ì˜ì—­ ì¤‘ ëœë¤í•œ ìœ„ì¹˜ë¡œ
- `Player Character`ë¥¼ í™œì„±í™” í•´ì¤€ë‹¤. *SetActive(true);*
  - í™œì„±í™” í•˜ëŠ” ì´ìœ  
    - ğŸ‘‰ [ğŸ“œPlayerShooter.cs](https://ansohxxn.github.io/unity%20lesson%201/chapter11-10/#private-void-onenable)ì˜ **OnEnable()** ì´ë²¤íŠ¸ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ì„œ `Gun` ì´ì„ í™œì„±í™” í•˜ê³  ğŸ“œGun.csì˜ Setup í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë„ë¡ í•˜ê¸° ìœ„í•˜ì—¬.
    - ğŸ‘‰ [ğŸ“œLivingEntity.csë¥¼ ìƒì† ë°›ëŠ” ğŸ“œPlayerHealth.cs](https://ansohxxn.github.io/unity%20lesson%201/chapter11-13/#protected-virtual-void-onenable)ì˜ **OnEnable** ì´ë²¤íŠ¸ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ì„œ ìƒëª…ì²´ ìƒíƒœê°€ ë¦¬ì…‹ ë˜ë„ë¡ í•˜ê¸° ìœ„í•˜ì—¬.
  - **HandleDeath()** í•¨ìˆ˜ì—ì„œ ë¹„í™œì„±í™” ì‹œì¼°ë˜ ğŸ“œPlayerMovement.cs, ğŸ“œPlayerShooter.cs ë¥¼ ë‹¤ì‹œ í™œì„±í™” í•´ì¤€ë‹¤.
- ì´ì•Œì„ ë‹¤ì‹œ ìƒˆë¡œ ì±„ì›Œì£¼ê¸°
  - *playerShooter.gun.ammoRemain = 120*
- ë§ˆìš°ìŠ¤ ì»¤ì„œ ë‹¤ì‹œ ë³´ì´ì§€ ì•Šê²Œ
  - *Cursor.visible = false;*


<br>

#### private void OnTriggerEnter(Collider other)

> ì•„ì´í…œê³¼ ì¶©ëŒ ëì„ ë•Œ ì‹¤í–‰ë˜ëŠ” ì´ë²¤íŠ¸ í•¨ìˆ˜.

```c#
    private void OnTriggerEnter(Collider other)
    {
        // ì•„ì´í…œê³¼ ì¶©ëŒí•œ ê²½ìš° í•´ë‹¹ ì•„ì´í…œì„ ì‚¬ìš©í•˜ëŠ” ì²˜ë¦¬
        // ì‚¬ë§í•˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ì•„ì´í…œ ì‚¬ìš©ê°€ëŠ¥
        if (!playerHealth.dead)
        {
            // ì¶©ëŒí•œ ìƒëŒ€ë°©ìœ¼ë¡œ ë¶€í„° Item ì»´í¬ë„ŒíŠ¸ë¥¼ ê°€ì ¸ì˜¤ê¸° ì‹œë„
            var item = other.GetComponent<IItem>();

            // ì¶©ëŒí•œ ìƒëŒ€ë°©ìœ¼ë¡œë¶€í„° Item ì»´í¬ë„ŒíŠ¸ê°€ ê°€ì ¸ì˜¤ëŠ”ë° ì„±ê³µí–ˆë‹¤ë©´
            if (item != null)
            {
                // Use ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ì—¬ ì•„ì´í…œ ì‚¬ìš©
                item.Use(gameObject);
                // ì•„ì´í…œ ìŠµë“ ì†Œë¦¬ ì¬ìƒ
                playerAudioPlayer.PlayOneShot(itemPickupClip);
            }
        }
    }
```

- `other` 
  - ì¶©ëŒí•œ Colliderê°€ ë“¤ì–´ ì˜¨ë‹¤.
- í”Œë ˆì´ì–´ê°€ ì£½ì€ ìƒíƒœë©´ ì´ ì´ë²¤íŠ¸ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ì§€ ëª»í•˜ë„ë¡ í•œë‹¤. *if (!playerHealth.dead)* ì¸ ê²½ìš°ì—ë§Œ ì‹¤í–‰í•˜ë„ë¡!
  - `itetm`
    - ì¶©ëŒí•œ Colliderì¸ `other`ë¡œë¶€í„° âœ¨`IItem` ì»´í¬ë„ŒíŠ¸ íƒ€ì…ì´ ê°€ì ¸ì™€ì§„ë‹¤ë©´ `ohter`ëŠ” ì•„ì´í…œì´ë¼ëŠ” ê²ƒì´ë‹¤!âœ¨  *if (item != null)*
      - ì•„ì´í…œ ì‚¬ìš©  *item.Use(gameObject);*
        - <u>ë‹¤í˜•ì„±!</u> ì•„ì´í…œ ì¢…ë¥˜ì— ë§ê²Œ ì˜¤ë²„ë¼ì´ë”© ëœ Use í•¨ìˆ˜ê°€ ì‹¤í–‰ ëœë‹¤.
      - ì•„ì´í…œ ë¨¹ëŠ” ì†Œë¦¬ ì¬ìƒ

<br>

## ğŸ”” ì»´í¬ë„ŒíŠ¸ ì„¤ì •

- "pick up" ì˜¤ë””ì˜¤ í´ë¦½ í• ë‹¹
  - ![image](https://user-images.githubusercontent.com/42318591/92349415-f4612780-f110-11ea-9486-686492ff4422.png){: width="50%" height="50%"}{: .align-center}
- ê²Œì„ì„ ì‹¤í–‰í•˜ë©´ ì´ì œ ì•„ì´í…œë„ ë¨¹ì–´ì§€ê³  ì£½ìœ¼ë©´ ë¦¬ìŠ¤í° ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.


***
<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}

<br>