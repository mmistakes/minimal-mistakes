---
title:  "Unity Chapter 11-14. ì¢€ë¹„ TPS ê²Œì„ ë§Œë“¤ê¸° : Player Health" 

categories:
  -  Unity Lesson 1 
tags:
  - [Game Engine, Unity]

toc: true
toc_sticky: true

date: 2020-08-17
last_modified_at: 2020-08-17
---

ì¸í”„ëŸ°ì— ìˆëŠ” ì´ì œë¯¼ë‹˜ì˜ **ë ˆíŠ¸ë¡œì˜ ìœ ë‹ˆí‹° C# ê²Œì„ í”„ë¡œê·¸ë˜ë° ì—ì„¼ìŠ¤** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤. ğŸ˜€  
[ğŸŒœ [ë ˆíŠ¸ë¡œì˜ ìœ ë‹ˆí‹° C# ê²Œì„ í”„ë¡œê·¸ë˜ë° ì—ì„¼ìŠ¤] ê°•ì˜ ë“¤ìœ¼ëŸ¬ ê°€ê¸°!](https://www.inflearn.com/course/%EC%9C%A0%EB%8B%88%ED%8B%B0-%EA%B2%8C%EC%9E%84-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D-%EC%97%90%EC%84%BC%EC%8A%A4)
{: .notice--warning}

<br>

# Chapter 11. ì¢€ë¹„ TPS ê²Œì„ ë§Œë“¤ê¸° 

## ğŸ“œPlayerHealth.cs

> `Player Character`ì— ë¶™ì—¬ì¤€ë‹¤.

- í”Œë ˆì´ì–´ ìºë¦­í„°ì˜ <u>ìƒëª…ì²´ë¡œì„œì˜ ë™ì‘</u>ì„ ë‹´ë‹¹
  - <u>LivingEntityë¥¼ ìƒì† ë°›ì•„ ìƒì† ë°›ì€ ìƒëª…ì²´ë¡œì„œì˜ ê¸°ë³¸ ë™ì‘ ê·¸ ìœ„ì— í”Œë ˆì´ì–´ ìºë¦­í„°ë§Œì˜ ë™ì‘ì„ êµ¬í˜„í•  ê²ƒì´ë‹¤.</u>
    - LivingEntity ìœ„ì—ì„œ í™•ì¥ë§Œ í•˜ë©´ ë¨

```c#
using UnityEngine;

// UI ê´€ë ¨ ì½”ë“œ

// í”Œë ˆì´ì–´ ìºë¦­í„°ì˜ ìƒëª…ì²´ë¡œì„œì˜ ë™ì‘ì„ ë‹´ë‹¹
public class PlayerHealth : LivingEntity
{
    private Animator animator;  
    private AudioSource playerAudioPlayer; // í”Œë ˆì´ì–´ ì†Œë¦¬ ì¬ìƒê¸°

    public AudioClip deathClip; // ì‚¬ë§ ì†Œë¦¬
    public AudioClip hitClip; // í”¼ê²© ì†Œë¦¬


    private void Awake()
    {
        // ì‚¬ìš©í•  ì»´í¬ë„ŒíŠ¸ë¥¼ ê°€ì ¸ì˜¤ê¸°
        playerAudioPlayer = GetComponent<AudioSource>();
        animator = GetComponent<Animator>();
    }

    protected override void OnEnable()
    {
        // LivingEntityì˜ OnEnable() ì‹¤í–‰ (ìƒíƒœ ì´ˆê¸°í™”)
        base.OnEnable();
        UpdateUI();
    }

    // ì²´ë ¥ íšŒë³µ
    public override void RestoreHealth(float newHealth)
    {
        // LivingEntityì˜ RestoreHealth() ì‹¤í–‰ (ì²´ë ¥ ì¦ê°€)
        base.RestoreHealth(newHealth);
        // ì²´ë ¥ ê°±ì‹ 
        UpdateUI();
    }

    private void UpdateUI()
    {
        UIManager.Instance.UpdateHealthText(dead ? 0f : health);
    }

    // ë°ë¯¸ì§€ ì²˜ë¦¬
    public override bool ApplyDamage(DamageMessage damageMessage)
    {
        if (!base.ApplyDamage(damageMessage)) return false;

        EffectManager.Instance.PlayHitEffect(damageMessage.hitPoint, damageMessage.hitNormal, transform, EffectManager.EffectType.Flesh);
        playerAudioPlayer.PlayOneShot(hitClip);

        // LivingEntityì˜ OnDamage() ì‹¤í–‰(ë°ë¯¸ì§€ ì ìš©)
        // ê°±ì‹ ëœ ì²´ë ¥ì„ ì²´ë ¥ ìŠ¬ë¼ì´ë”ì— ë°˜ì˜
        UpdateUI();
        return true;
    }

    // ì‚¬ë§ ì²˜ë¦¬
    public override void Die()
    {
        // LivingEntityì˜ Die() ì‹¤í–‰(ì‚¬ë§ ì ìš©)
        base.Die();

        // ì²´ë ¥ ìŠ¬ë¼ì´ë” ë¹„í™œì„±í™”
        UpdateUI();
        // ì‚¬ë§ìŒ ì¬ìƒ
        playerAudioPlayer.PlayOneShot(deathClip);
        // ì• ë‹ˆë©”ì´í„°ì˜ Die íŠ¸ë¦¬ê±°ë¥¼ ë°œë™ì‹œì¼œ ì‚¬ë§ ì• ë‹ˆë©”ì´ì…˜ ì¬ìƒ
        animator.SetTrigger("Die");
    }
}
```

<br>

### ë©¤ë²„ ë³€ìˆ˜

```c#
    private Animator animator;  
    private AudioSource playerAudioPlayer; // í”Œë ˆì´ì–´ ì†Œë¦¬ ì¬ìƒê¸°

    public AudioClip deathClip; // ì‚¬ë§ ì†Œë¦¬
    public AudioClip hitClip; // í”¼ê²© ì†Œë¦¬
```

- `animator`
  - `Player Character`ì˜ ì• ë‹ˆë©”ì´í„° ì»´í¬ë„ŒíŠ¸ ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
- `playerAudioPlayer` í”Œë ˆì´ì–´ ì†Œë¦¬ ì¬ìƒê¸°
- `deathClip` ì‚¬ë§ ì†Œë¦¬
- `hitClip` í”¼ê²© ì†Œë¦¬

#### ìƒì† ë°›ì€ ë©¤ë²„ ë³€ìˆ˜

```c#
    public float startingHealth = 100f;
    public float health { get; protected set; }
    public bool dead { get; protected set; }
    
    public event Action OnDeath;
    
    private const float minTimeBetDamaged = 0.1f;
    private float lastDamagedTime;

    protected bool IsInvulnerabe
```

- LivingEntityë¡œë¶€í„° ìƒì†ë°›ì€ ìœ„ ë©¤ë²„ ë³€ìˆ˜ë“¤ë„ ê°€ì§€ê³  ìˆë‹¤ëŠ” ê²ƒì— ìœ ë…í•˜ê¸°

<br>

### ë©¤ë²„ í•¨ìˆ˜

> ë¶€ëª¨ í´ë˜ìŠ¤ `LivingEntity`ì˜ ê°€ìƒ í•¨ìˆ˜ë“¤ì„ ì˜¤ë²„ë¼ì´ë”© í•˜ê³  ìˆë‹¤. 

#### private void Awake()

> ì‚¬ìš©í•  ì»´í¬ë„ŒíŠ¸ë¥¼ ê°€ì ¸ì˜¤ê¸°. `playerAudioPlayer`, `animator`

```c#
    private void Awake()
    {
        // ì‚¬ìš©í•  ì»´í¬ë„ŒíŠ¸ë¥¼ ê°€ì ¸ì˜¤ê¸°
        playerAudioPlayer = GetComponent<AudioSource>();
        animator = GetComponent<Animator>();
    }
```

<br>

#### protected override void OnEnable()

> ìƒíƒœ ì´ˆê¸°í™” + UI ê°±ì‹ (ì´ˆê¸° ì²´ë ¥)

```c#
    protected override void OnEnable()
    {
        // LivingEntityì˜ OnEnable() ì‹¤í–‰ (ìƒíƒœ ì´ˆê¸°í™”)
        base.OnEnable();  
        UpdateUI();
    }
```

- *base.OnEnable();*
  - LivingEntity ì˜ OnEnable() í•¨ìˆ˜ ì‹¤í–‰
  - ëª¨ë“  ìƒëª…ì²´ë“¤ì´ ê³µí†µìœ¼ë¡œ, ì´ ìŠ¤í¬ë¦½íŠ¸ê°€ í™œì„±í™” ë˜ë©´ ì²´ë ¥ì„ ì´ˆê¸°í™” í•˜ëŠ” ë“±ë“± ì´ëŸ° ì²˜ë¦¬ë“¤ì„ ë‹´ë‹¹.
- *UpdateUI();*
  - ê·¸ ë‹¤ìŒ <u>ğŸ“œPlayerHealth ë§Œì˜ í•¨ìˆ˜ì¸ UpdateUI() í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ì—¬ í”Œë ˆì´ì–´ë§Œì˜ UI ë¥¼ ê°±ì‹ </u>
    - ì—¬ê¸°ì„œ ğŸ“œUIManagerì˜ UpdateHealthText í•¨ìˆ˜ì— ì²´ë ¥ì„ ì¸ìˆ˜ë¡œ ë„˜ê²¨ ì²´ë ¥ UI ê°±ì‹ í•˜ëŠ” ì—­í• ì„ í•  ê²ƒ 

<br>

#### public override void RestoreHealth(float newHealth)

> ìƒíƒœ ì´ˆê¸°í™” + UI ê°±ì‹ (íšŒë³µëœ ì²´ë ¥)

```c#
    public override void RestoreHealth(float newHealth)
    {
        // LivingEntityì˜ RestoreHealth() ì‹¤í–‰ (ì²´ë ¥ ì¦ê°€)
        base.RestoreHealth(newHealth);
        // ì²´ë ¥ ê°±ì‹ 
        UpdateUI();
    }
```

- *base.RestoreHealth(newHealth);*
  - LivingEntity ì˜ RestoreHealth(newHealth) í•¨ìˆ˜ ì‹¤í–‰
  - ì²´ë ¥ ê°±ì‹ ì‹œ ëª¨ë“  ìƒëª…ì²´ë“¤ì´ ê³µí†µìœ¼ë¡œ í–‰í•˜ëŠ” ì²˜ë¦¬ë¥¼ ë¨¼ì € ì‹¤í–‰í•œ í›„
- *UpdateUI()*
  - ê·¸ ë‹¤ìŒ <u>ğŸ“œPlayerHealth ë§Œì˜ í•¨ìˆ˜ì¸ UpdateUI() í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ì—¬ í”Œë ˆì´ì–´ë§Œì˜ UI ë¥¼ ê°±ì‹ </u>
    - ì—¬ê¸°ì„œ ğŸ“œUIManagerì˜ UpdateHealthText í•¨ìˆ˜ì— ì²´ë ¥ì„ ì¸ìˆ˜ë¡œ ë„˜ê²¨ ì²´ë ¥ UI ê°±ì‹ í•˜ëŠ” ì—­í• ì„ í•  ê²ƒ 

<br>

#### private void UpdateUI()

> ğŸ“œPlayerHealth ë§Œì˜ í•¨ìˆ˜ë¡œì„œ <u>í”Œë ˆì´ì–´ ì²´ë ¥ì˜ UIë¥¼ ê°±ì‹ </u>

```c#
    private void UpdateUI()
    {
        UIManager.Instance.UpdateHealthText(dead ? 0f : health);
    }
```

- ğŸ“œUIManager ëŠ” ì‹±ê¸€í†¤ì´ì UIì— ê´€í•œ ëª¨ë“  ìš”ì†Œë¥¼ ì–˜ê°€ ë‹´ë‹¹í•˜ê³  ìˆë‹¤.
- ğŸ“œUIManagerì˜ UpdateHealthText í•¨ìˆ˜ì— ì²´ë ¥ì„ ì¸ìˆ˜ë¡œ ë„˜ê²¨ ì²´ë ¥ UI ê°±ì‹ 
  - ì‚¬ë§ ìƒíƒœë©´ 0 ì„ ë„˜ê¸°ê³  ì•„ë‹ˆë©´ í˜„ì¬ ì²´ë ¥ì„ ë„˜ê¹€
    - `dead`ëŠ” LivingEntityì˜ ë©¤ë²„ ë³€ìˆ˜ì´ë¯€ë¡œ ìì‹ìœ¼ë¡œì„œ ë¬¼ë ¤ë°›ì•„ ì‚¬ìš©ì´ ê°€ëŠ¥.

<br>

#### public override bool ApplyDamage(DamageMessage damageMessage)

> ë°ë¯¸ì§€ ì…ì€ ì²˜ë¦¬(íŒŒí‹°í´ íš¨ê³¼, ì†Œë¦¬ ì¬ìƒ) + UI ê°±ì‹ (ê°±ì‹ ëœ ì²´ë ¥ ë°˜ì˜)

```c#
    public override bool ApplyDamage(DamageMessage damageMessage)
    {
        if (!base.ApplyDamage(damageMessage)) return false;

        EffectManager.Instance.PlayHitEffect(damageMessage.hitPoint, damageMessage.hitNormal, transform, EffectManager.EffectType.Flesh);
        playerAudioPlayer.PlayOneShot(hitClip);

        // LivingEntityì˜ OnDamage() ì‹¤í–‰(ë°ë¯¸ì§€ ì ìš©)
        // ê°±ì‹ ëœ ì²´ë ¥ì„ ì²´ë ¥ ìŠ¬ë¼ì´ë”ì— ë°˜ì˜
        UpdateUI();
        return true;
    }
```

- ë°ë¯¸ì§€ë¥¼ ì…ëŠ”ë° ì„±ê³µí•˜ì§€ ëª»í–ˆë‹¤ë©´ ì‹¤í–‰í•˜ì§€ ì•Šê³  false
  - `base.ApplyDamage(damageMessage)` ì„ ì‹¤í–‰í•˜ë¯€ë¡œ 
    - ë°ë¯¸ì§€ ì…ì€ ë§Œí¼ ì´ í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì²´ë ¥ì´ ê¹ì´ê²Œ ëœë‹¤.
    - ì´ í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì£½ìœ¼ë©´ Die() í•¨ìˆ˜ë„ í˜¸ì¶œí•œë‹¤.
      - virtual - override ê´€ê³„ì´ë‹ˆ ë§Œí¼ ì´ë•Œì˜ Die()ëŠ” ğŸ“œPlayerHelathì˜ ì˜¤ë²„ë¼ì´ë”©ëœ Die()ë¥¼ í˜¸ì¶œ
- ë°ë¯¸ì§€ë¥¼ ì…ëŠ”ë° ì„±ê³µ í–ˆë‹¤ë©´
  - <u>Player ë§Œì˜</u> íŒŒí‹°í´ íš¨ê³¼ ì¬ìƒ
    - Flesh íŒŒí‹°í´ ì¬ìƒ(í”¼íŠ€ëŠ” íš¨ê³¼)
  - <u>Player ë§Œì˜</u> í”¼ê²© ì†Œë¦¬ ì¬ìƒ
- ê¹ì¸ ì²´ë ¥ì„ ë°˜ì˜í•˜ê¸° ìœ„í•œ UI ê°±ì‹ 

<br>

#### public override void Die()

> ì‚¬ë§ì²˜ë¦¬ + UI ê°±ì‹ 

```c#
    public override void Die()
    {
        // LivingEntityì˜ Die() ì‹¤í–‰(ì‚¬ë§ ì ìš©)
        base.Die();

        // ì²´ë ¥ ìŠ¬ë¼ì´ë” ë¹„í™œì„±í™”
        UpdateUI();
        // ì‚¬ë§ìŒ ì¬ìƒ
        playerAudioPlayer.PlayOneShot(deathClip);
        // ì• ë‹ˆë©”ì´í„°ì˜ Die íŠ¸ë¦¬ê±°ë¥¼ ë°œë™ì‹œì¼œ ì‚¬ë§ ì• ë‹ˆë©”ì´ì…˜ ì¬ìƒ
        animator.SetTrigger("Die");
    }
```

- `base.Die();`
  - OnDeath ì•¡ì…˜ ì´ë²¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³ 
  - `dead = true` ë¡œ ìƒíƒœë¥¼ ë³€ê²½í•œë‹¤.
- UpdateUI();
  - `dead = true` ê°€ ë˜ì—ˆìœ¼ë¯€ë¡œ ì²´ë ¥ 0 ìœ¼ë¡œ ë„˜ê²¨ì§ˆ ê²ƒì´ë‹¤.
- ì‚¬ë§ ì†Œë¦¬ ì¬ìƒ
- ì‚¬ë§ ì• ë‹ˆë©”ì´ì…˜ì„ ì¬ìƒì‹œí‚¬ íŠ¸ë¦¬ê±° ì—…ë°ì´íŠ¸ 

<br>

## ì»´í¬ë„ŒíŠ¸ ì„¤ì •

![image](https://user-images.githubusercontent.com/42318591/90351864-89c24c00-e07c-11ea-97f6-4b9a8345a239.png){: width="60%" height="60%"}{: .align-center}

- `deathClip`, `HitClip`ì— ì˜¤ë””ì˜¤ í´ë¦½ì„ ìœ„ì™€ê°™ì´ ì¶”ê°€í•´ì¤€ë‹¤.


***
<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}

<br>