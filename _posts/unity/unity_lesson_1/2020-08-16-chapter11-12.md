---
title:  "Unity Chapter 11-12. ì¢€ë¹„ TPS ê²Œì„ ë§Œë“¤ê¸° : íŒŒí‹°í´ ì‹œìŠ¤í…œ" 

categories:
  -  Unity Lesson 1 
tags:
  - [Game Engine, Unity]

toc: true
toc_sticky: true

date: 2020-08-16
last_modified_at: 2020-08-16
---

ì¸í”„ëŸ°ì— ìˆëŠ” ì´ì œë¯¼ë‹˜ì˜ **ë ˆíŠ¸ë¡œì˜ ìœ ë‹ˆí‹° C# ê²Œì„ í”„ë¡œê·¸ë˜ë° ì—ì„¼ìŠ¤** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤. ğŸ˜€  
[ğŸŒœ [ë ˆíŠ¸ë¡œì˜ ìœ ë‹ˆí‹° C# ê²Œì„ í”„ë¡œê·¸ë˜ë° ì—ì„¼ìŠ¤] ê°•ì˜ ë“¤ìœ¼ëŸ¬ ê°€ê¸°!](https://www.inflearn.com/course/%EC%9C%A0%EB%8B%88%ED%8B%B0-%EA%B2%8C%EC%9E%84-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D-%EC%97%90%EC%84%BC%EC%8A%A4)
{: .notice--warning}

<br>

# Chapter 11. ì¢€ë¹„ TPS ê²Œì„ ë§Œë“¤ê¸° 

## íŒŒí‹°í´ ì‹œìŠ¤í…œ

- íŒŒí‹°í´ ì œì–´ë¥¼ ë‹´ë‹¹í•  ë¹ˆ ê²Œì„ ì˜¤ë¸Œì íŠ¸ `Effect Manager`ë¥¼ ìƒì„±í•œë‹¤. 
  - ìœ„ì¹˜ëŠ” ìƒê´€ ì—†ê¸´ í•˜ì§€ë§Œ ê·¸ë˜ë„ reset í•´ì£¼ì.

<br>

## ğŸ“œEffectManager.cs

> ë¹ˆ ê²Œì„ ì˜¤ë¸Œì íŠ¸ `Effect Manager`ì— ë¶™ì—¬ì¤€ë‹¤.

> **ì‹±ê¸€í†¤**ìœ¼ë¡œì„œ ì¡´ì¬í•œë‹¤.

```c#
using UnityEngine;

public class EffectManager : MonoBehaviour
{
    private static EffectManager m_Instance;
    public static EffectManager Instance
    {
        get
        {
            if (m_Instance == null) m_Instance = FindObjectOfType<EffectManager>();
            return m_Instance;
        }
    }

    public enum EffectType
    {
        Common,
        Flesh
    }

    public ParticleSystem commonHitEffectPrefab;
    public ParticleSystem fleshHitEffectPrefab;

    public void PlayHitEffect(Vector3 pos, Vector3 normal, Transform parent = null, EffectType effectType = EffectType.Common)
    {
        var targetPrefab = commonHitEffectPrefab;

        if (effectType == EffectType.Flesh)
        {
            targetPrefab = fleshHitEffectPrefab;
        }

        var effect = Instantiate(targetPrefab, pos, Quaternion.LookRotation(normal));

        if (parent != null) effect.transform.SetParent(parent);

        effect.Play();
    }
}
```

### ì‹±ê¸€í†¤

> íŒŒí‹°í´ì— ì ‘ê·¼í•˜ëŠ” ì—¬ëŸ¬ ìŠ¤í¬ë¦½íŠ¸ë“¤ì—ì„œ ì§ì ‘ íŒŒí‹°í´ ì˜¤ë¸Œì íŠ¸ë¥¼ ì°¸ì¡°í•  ìˆ˜ë„ ìˆì§€ë§Œ ê·¸ë ‡ê²Œ í•˜ë©´ ì—¬ëŸ¬ê³³ì—ì„œ ë™ì‹œì— ì°¸ì¡°í•  ìˆ˜ ìˆìœ¼ë‹ˆê¹Œ ë„ˆë¬´ í˜¼ì¡ ë‚œì¡! ğŸ‘‰ ì‹±ê¸€í†¤ì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ 

```c#
    private static EffectManager m_Instance;
    public static EffectManager Instance  // ì´í™íŠ¸ ë§¤ë‹ˆì € ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë¦¬í„´ë°›ì„ í”„ë¡œí¼í‹°
    {
        get
        {
            if (m_Instance == null) m_Instance = FindObjectOfType<EffectManager>();
            return m_Instance;
        }
    }
```

- privateí•œ `m_Instance`ë¥¼ ë¦¬í„´í•´ì£¼ëŠ” `Instance` í”„ë¡œí¼í‹°ë¥¼ í†µí•˜ì—¬ ê¸°ì¡´ì˜ ğŸ“œEffectManager ì¸ìŠ¤í„´ìŠ¤ê°€ ì—†ì„ ë•Œë§Œ, ì¦‰ `m_Instace == null`ì¼ë•Œë§Œ ğŸ“œEffectManager ì¸ìŠ¤í„´ìŠ¤ì¸ `m_Instance`ë¥¼ ë¦¬í„´ ë°›ëŠ”ë‹¤.
    - ğŸ“œEffectManager ì¸ìŠ¤í„´ìŠ¤ê°€ ì˜¤ì§ í•˜ë‚˜ë§Œ ì¡´ì¬í•˜ë„ë¡ ê´€ë¦¬í•´ì£¼ëŠ” ê²ƒ!

<br>

### ë©¤ë²„ ë³€ìˆ˜

- íŒŒí‹°í´ ìƒíƒœ `EffectType`
  1. `Common`
    - ëŒ€ë¶€ë¶„ì— ì‚¬ìš©ë  ì¼ë°˜ í”¼íƒ„ ì´í™íŠ¸
  2. `Flesh`
    - í”¼ë¶€ë‚˜ ì‚´ì— ì´ì•Œì´ ë¶€ë”ªí˜”ì„ë•Œ ì‚¬ìš©í•  í”¼ê°€ íŠ€ëŠ” ì´í™íŠ¸
- íŒŒí‹°í´ í”„ë¦¬íŒ¹ ë‘ê°œë¥¼ í• ë‹¹í•œ í›„ ë³µì œí•´ì„œ ê²Œì„ ë„ì¤‘ ìƒì„±í•  ê²ƒì´ë‹¤.
  - `commonHitEffectPrefab`
    - ğŸŸ¦Metal Impact í”„ë¦¬íŒ¹ì„ í• ë‹¹í•´ì¤€ë‹¤.
  - `fleshHitEffectPrefab`
    - ğŸŸ¦Flesh Impact í”„ë¦¬íŒ¹ì„ í• ë‹¹í•´ì¤€ë‹¤.
  - ![image](https://user-images.githubusercontent.com/42318591/90329171-4ebd0b80-dfdd-11ea-882a-7caaa2962872.png){: width="60%" height="60%"}{: .align-center}

<br>

### ë©¤ë²„ í•¨ìˆ˜

#### public void PlayHitEffect

```c#
    public void PlayHitEffect(Vector3 pos, Vector3 normal, Transform parent = null, EffectType effectType = EffectType.Common)
    {
        var targetPrefab = commonHitEffectPrefab;

        if (effectType == EffectType.Flesh)
        {
            targetPrefab = fleshHitEffectPrefab;
        }

        var effect = Instantiate(targetPrefab, pos, Quaternion.LookRotation(normal));

        if (parent != null) effect.transform.SetParent(parent);

        effect.Play();
    }
```

- ì¸ìˆ˜
  - `pos` ì´í™íŠ¸ ìœ„ì¹˜
  - `normal` ì´í™íŠ¸ê°€ ë°”ë¼ë³¼ ë°©í–¥
  - `parent` ì´í™íŠ¸ì—ê²Œ í• ë‹¹í•  ë¶€ëª¨
    - ë””í´íŠ¸ null
    - ì›€ì§ì´ëŠ” ëŒ€ìƒìœ¼ë¡œ ì´í™íŠ¸ê°€ ìƒì„± ë˜ì—ˆì„ ë•Œ ì´í™íŠ¸ê°€ <u>ì›€ì§ì´ëŠ” ë¬¼ì²´ë¥¼ ë”°ë¼ê°€ì•¼ í•˜ëŠ” ê²½ìš°ì—ëŠ” ê·¸ ëŒ€ìƒì„ ì´í™íŠ¸ì˜ ë¶€ëª¨ë¡œ í• ë‹¹í•´ì£¼ì–´ì•¼</u> í•œë‹¤.
  - `effectType` ì´í™íŠ¸ íƒ€ì…
    - ë””í´íŠ¸ `Common`
- ì´í™íŠ¸ í• ë‹¹
  - *var `targetPrefab` = commonHitEffectPrefab;*
    - ì¼ë°˜ì ìœ¼ë¡œ ì“°ì´ëŠ” ì´í™íŠ¸ëŠ” `commonHitEffectPrefab` ë‹ˆê¹Œ ì¼ë‹¨ `targetPrefab`ì„ `commonHitEffectPrefab`ë¡œ ì§€ì •í•œë‹¤.
  - ê·¸ëŸ°ë° ë§Œì•½ì— ì´í™íŠ¸ íƒ€ì…ì´ `Common`ì´ ì•„ë‹Œ `Flesh`ë¼ë©´ ê·¸ë•Œ `targetPrefab`ì„ `fleshHitEffectPrefab`ë¡œ ì§€ì •í•œë‹¤.
- ì´í™íŠ¸ ë³µì œ ìƒì„± (from í”„ë¦¬íŒ¹)
  - *var effect = Instantiate(targetPrefab, pos, Quaternion.<u>LookRotation</u>(normal));*
- ì´í™íŠ¸ì˜ ë¶€ëª¨ê°€ ë  Transformì´ ì¸ìˆ˜ë¡œ ë“¤ì–´ì˜¨ê²Œ ìˆë‹¤ë©´
  - ê·¸ê²ƒì„ ì´í™íŠ¸ì˜ ë¶€ëª¨ë¡œ ì„¤ì •
    - *effect.transform.SetParent(parent);*
- ì´í™íŠ¸ ì¬ìƒ

<br>

## íŒŒí‹°í´ ì„±ëŠ¥ ê´€ë¦¬

> íŒŒí‹°í´ í”„ë¦¬íŒ¹ìœ¼ë¡œ ë¶€í„° ë³µì œ ìƒì„±ëœ íŒŒí‹°í´ ì˜¤ë¸Œì íŠ¸ë“¤ì´ ì´ì„ ë„ˆë¬´ ë§ì´ ì´ì„œ ì”¬ ìƒì— ë„ˆë¬´ ë§ì´ ìƒì„±ë˜ë©´ ì„±ëŠ¥ ì €í•˜ê°€ ì¼ì–´ë‚  ìˆ˜ ìˆë‹¤.

- ì´ì— ëŒ€í•œ ëŒ€ì²˜ ë°©ë²•
  1. ì˜¤ë¸Œì íŠ¸ í’€ë§
    - ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ê°ì²´ë“¤ì„ ë¯¸ë¦¬ ëª‡ê°œ ìƒì„±í•´ë‘ê³  ì´ë¥¼ ëŒì•„ê°€ë©° ê°€ì ¸ë‹¤ ì“´ë‹¤. 
    - ì´ë“¤ì„ *ì‚¬ìš©ì¤‘/ì‚¬ìš©ì•ˆí•¨* ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤.
    - [ë””ìì¸íŒ¨í„´ : ì˜¤ë¸Œì íŠ¸ í’€ íŒ¨í„´ ì°¸ê³ ](https://ansohxxn.github.io/design%20pattern/chapter9/)
  2. <u>ì¬ìƒ ì¢…ë£Œëœ íŒŒí‹°í´ì€ ê·¸ë•Œ ê·¸ë•Œ íŒŒê´´ì‹œì¼œ ë©”ëª¨ë¦¬ í•´ì œì‹œì¼œ ì£¼ê¸°</u>
    - ì´ ìˆ˜ì—…ì—ì„œëŠ” ì´ ë°©ì‹ì„ íƒí•  ê²ƒì´ë‹¤.
    - ì‚¬ìš©í•  ì´í™íŠ¸ í”„ë¦¬íŒ¹ì¸ ğŸŸ¦Flesh Impact ì™€ ğŸŸ¦Metal Impact ì˜ **Stop Action** ë¶€ë¶„ì„ **Destroy**ë¡œ ì„¤ì •í•œë‹¤.

<br>

## íŒŒí‹°í´ ì¬ìƒì„ ëˆ„ê°€ í•  ê²ƒì¸ê°€

- `IDamageable`íƒ€ì…ì´ë¼ì„œ ë°ë¯¸ì§€ë¥¼ ì…ì„ ìˆ˜ ìˆëŠ” ì˜¤ë¸Œì íŠ¸ë¼ë©´
  - ğŸ‘‰ ìŠ¤ìŠ¤ë¡œ ì–´ë–¤ íŒŒí‹°í´ì„ ì¬ìƒ ì‹œì¼œì•¼í• ì§€ ê²°ì •í•œë‹¤.
  - êµ³ì´ ì´ì„ ì˜ëŠ” ì‚¬ëŒ ì…ì¥ì—ì„œ íŒŒí‹°í´ íš¨ê³¼ë¥¼ ê²°ì •í•´ì¤„ í•„ìš”ê°€ ì—†ë‹¤.
    - ê°ê° `IDamageable`ì¸í„°í˜ì´ìŠ¤ë¥¼ ì˜¤ë²„ë¼ì´ë”© í•˜ëŠ” ë°ë¯¸ì§€ ì…ì„ ìˆ˜ ìˆëŠ” ì˜¤ë¸Œì íŠ¸ë“¤(ìŠ¤í¬ë¦½íŠ¸)ì—ì„œ <u>ê°ê°ì—ì„œ ì˜¤ë²„ë¼ì´ë”© í•œ ApplyDamage í•¨ìˆ˜ë‚´ì—ì„œ íŒŒí‹°í´ íš¨ê³¼ë¥¼ ê²°ì •í•  ê²ƒ!</u>
    - **target.ApplyDamage(damageMessage);**
- ë°˜ëŒ€ë¡œ ë°ë¯¸ì§€ë¥¼ ì…ì„ ìˆ˜ ìˆëŠ” ì˜¤ë¸Œì íŠ¸ê°€ ì•„ë‹ˆë¼ë©´
  - <u>ë²”ìš©ì ì¸ íŒŒí‹°í´ íš¨ê³¼ë¡œ!</u> ë¯¸ë¦¬ ì„¤ì •í•´ë‘ .
  - ìŠ¤ìŠ¤ë¡œ ì–´ë–¤ íŒŒí‹°í´ì„ ì¬ìƒì‹œì¼œì•¼ í• ì§€ë¥¼ ê²°ì •í•˜ì§€ ì•ŠìŒ
    - **EffectManager.Instance.PlayHitEffect(hit.point, hit.normal, hit.transform);**
  

### ğŸ“œGun.cs 

#### Shot í•¨ìˆ˜

> âœ¨âœ¨ ë¶€ë¶„ ì¶”ê°€

```c#
 if (target != null)
{
    DamageMessage damageMessage;

    damageMessage.damager = gunHolder.gameObject;
    damageMessage.amount = damage;
    damageMessage.hitPoint = hit.point;
    damageMessage.hitNormal = hit.normal;

    // ìƒëŒ€ë°©ì˜ OnDamage í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œì¼œì„œ ìƒëŒ€ë°©ì—ê²Œ ë°ë¯¸ì§€ ì£¼ê¸°
    target.ApplyDamage(damageMessage); // ğŸ’›
}
else
{
    EffectManager.Instance.PlayHitEffect(hit.point, hit.normal, hit.transform);  // âœ¨âœ¨
}
// ë ˆì´ê°€ ì¶©ëŒí•œ ìœ„ì¹˜ ì €ì¥
hitPosition = hit.point;
```

***
<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}

<br>