---
title:  "Chapter 7-5. AI : Navigation AI " 

categories:
  -  Unity Lesson 3 
tags:
  - [Game Engine, Unity]

toc: true
toc_sticky: true

date: 2020-10-09
last_modified_at: 2020-10-09
---

ì¸í”„ëŸ°ì— ìˆëŠ” ì¼€ì´ë””ë‹˜ì˜ **[ìœ ë‹ˆí‹° 3D] ì‹¤ì „! ìƒì¡´ê²Œì„ ë§Œë“¤ê¸° - Advanced** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤. ğŸ˜€  
[ğŸŒœ ê°•ì˜ ë“¤ìœ¼ëŸ¬ ê°€ê¸° Click](https://www.inflearn.com/course/unity-2#)
{: .notice--warning}

# Chapter 7. ë™ë¬¼ë“¤ì˜ ê³µê²©í˜• AI, ë„ë§í˜• AI êµ¬í˜„

## ğŸš– Nav Mesh Agent ì»´í¬ë„ŒíŠ¸

> ì¥ì• ë¬¼, í˜¹ì€ ê°ˆìˆ˜ ì—†ëŠ” ê³³ì„ ìŠ¤ìŠ¤ë¡œ ì¸ì‹í•˜ê³  í”¼í•´ê°€ê²Œ í•œë‹¤. 

ì´ì „ê¹Œì§€ ì§ì ‘ ìŠ¤í¬ë¦½íŠ¸ì— ì˜í•˜ì—¬ ë¼ì§€ë¥¼ ì›€ì§ì´ê²Œ í–ˆì„ ë•, ë¼ì§€ê°€ ì¥ì• ë¬¼ì´ ìˆë”ë¼ë„ ì¥ì• ë¬¼ì„ ëš«ìœ¼ë ¤ê³  í•˜ê³  ì¥ì• ë¬¼ì„ í”¼í•´ê°€ì§€ ì•Šì•˜ì—ˆë‹¤. ì¥ì• ë¬¼ì„ ì¸ì‹ ì²˜ë¦¬ë¥¼ ëª»í•´ì„œ ê·¸ëƒ¥ ê°€ì•¼í•  ë°©í–¥ìœ¼ë¡œ ê°€ë ¤ê³ ë§Œ í–ˆê¸° ë•Œë¬¸ì´ë‹¤. ğŸ‘‰ <u>Nav Mesh Agent ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¼ì§€ê°€ ì¥ì• ë¬¼ì„ ìŠ¤ìŠ¤ë¡œ ì¸ì‹í•˜ë„ë¡ ë§Œë“¤ê¸°.</u>

- Nav Mesh Agent ì„ í†µí•˜ì—¬ **ìŠ¤ìŠ¤ë¡œ**
  - ì¥ì• ë¬¼ì„ ì¸ì‹í•œë‹¤.
  - ëª» ê°ˆ ê²ƒ ê°™ì€ ê³³ì´ë©´ ê°€ì§€ ì•ŠëŠ”ë‹¤. (ë„ˆë¬´ ì¢ì€ ê³³ì´ë¼ê±°ë‚˜ ë“±ë“±)

> `Pig`ì—ê²Œ **Nav Mesh Agent** ì»´í¬ë„ŒíŠ¸ ì¶”ê°€

![image](https://user-images.githubusercontent.com/42318591/95546570-ea965100-0a3b-11eb-9568-8632804a72c5.png)

ì›ê¸°ë‘¥ ê°™ì€ ì´ ì˜ì—­ì˜ í¬ê¸°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¼ì§€ê°€ í†µê³¼í•  ìˆ˜ ìˆëŠ” ê³³ ì¸ì§€ë¥¼ ì—°ì‚°í•˜ê²Œ ëœë‹¤. ì´ ì›ê¸°ë‘¥ì´ ë¼ì§€ì˜ `Nav Mesh Agent` ì´ë‹¤. `Nav Mesh Agent`ëŠ” ë¼ì§€ì—ê²Œ ë¶™ì–´ ë‹¤ë‹ˆë©° ì´ `Nav Mesh Agent` í¬ê¸°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê°ˆ ìˆ˜ ìˆëŠ” ê³³ì¸ì§€ ì—†ëŠ” ê³³ì¸ì§€ë¥¼ ì²´í¬í•œë‹¤. 

![image](https://user-images.githubusercontent.com/42318591/95546693-3ba64500-0a3c-11eb-90bf-6fc6224ef152.png)

![image](https://user-images.githubusercontent.com/42318591/95546698-3ea13580-0a3c-11eb-9995-11cc7184a57d.png)

ë¼ì§€ ì˜¤ë¸Œì íŠ¸ í¬ê¸°ì— ë§ê²Œ ì„¤ì •í•´ì£¼ì—ˆë‹¤.

- Base Offset 
  - `Nav Mesh Agent`ì´ Y ì¶• ë°©í–¥ ìœ„ì¹˜. 
- Radius
  - `Nav Mesh Agent` ë°˜ì§€ë¦„
- Height
  - `Nav Mesh Agent` ë†’ì´

<br>

## ğŸš– Navigation : ë¼ì§€ê°€ ê°ˆ ìˆ˜ ìˆëŠ” ê³³ ì„¤ì •

> Window - AI - Navigation - Bake

`Bake` êµ¬ì›Œì„œ í˜„ì¬ Terrain ì—ì„œ `Nav Mesh Agent`ê°€ ê°ˆ ìˆ˜ ìˆëŠ” ê³³ ì—°ì‚°.

![image](https://user-images.githubusercontent.com/42318591/95546967-df8ff080-0a3c-11eb-95dd-645084dca46d.png)

êµ¬ìš°ë‹ˆ ì´ëŸ° ê²°ê³¼ê°€ ë‚˜ì™”ë‹¤. íŒŒë€ìƒ‰ ì˜ì—­ë“¤ì€ ë¼ì§€. ì¦‰ `Nav Mesh Agent` ê°€ ê°ˆ ìˆ˜ ìˆëŠ” ì§€ì—­ì´ë‹¤. ë„ˆë¬´ ê°€íŒŒë¥´ê±°ë‚˜ ë„ë‹¬í•  ìˆ˜ ì—†ëŠ” ì§€ì—­ì€ íŒŒë€ìƒ‰ì´ ì ìš©ë˜ì§€ ì•Šì•˜ë‹¤. <u>íŒŒë€ìƒ‰ì´ ì ìš©ë˜ì§€ ì•Šì€ ë¶€ë¶„ì€ ì¥ì• ë¬¼ë¡œ íŒë‹¨í•œë‹¤.</u> `Step Height`ë¡œ ì¥ì• ë¬¼ë¡œ íŒë‹¨í•  ê²½ì‚¬ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤. 

> `Nav Mesh Agent`ê°€ ë¶™ì–´ ìˆëŠ” ì˜¤ë¸Œì íŠ¸ëŠ” Bake ëœ íŒŒë€ ì§€í˜•ë“¤ë§Œ ê°ˆ ìˆ˜ ìˆë‹¤.

<br>

### ì¥ì• ë¬¼ë¡œ íŒë‹¨í•  ì˜¤ë¸Œì íŠ¸ ì„¤ì •

![image](https://user-images.githubusercontent.com/42318591/95547434-f71ba900-0a3d-11eb-9d33-cc8c4dc1de12.png)

ë¼ì§€ê°€ ë‚˜ë¬´ì™€ ëŒ ì˜¤ë¸Œì íŠ¸ë¥¼ ì¥ì• ë¬¼ë¡œ íŒë‹¨í•˜ê³  í”¼í•´ê°ˆ ìˆ˜ ìˆë„ë¡ í•  ê²ƒì´ë‹¤.

- ë‚˜ë¬´ì™€ ëŒ ì˜¤ë¸Œì íŠ¸ë¥¼ `static` ì—ì„œ `Navigation static`ìœ¼ë¡œ ë³€ê²½í•´ì¤€ë‹¤. 
  - ìì‹ë“¤ê¹Œì§€ ì „ë¶€ ì ìš© 
- Navigation - Bake ì—ì„œ ë‹¤ì‹œ êµ¬ì›Œì¤€ë‹¤.

![image](https://user-images.githubusercontent.com/42318591/95547556-3d710800-0a3e-11eb-978e-ce93e1db232b.png)

ë‚˜ë¬´ì™€ ëŒì„ ì¥ì• ë¬¼ë¡œ ì¸ì‹í•˜ê²Œ ë˜ì—ˆê¸° ë•Œë¬¸ì—, ë‚˜ë¬´ì™€ ëŒ ì£¼ë³€ì€ ë” ì´ìƒ íŒŒë€ìƒ‰ì´ ì•„ë‹ˆë‹¤. ì´ ë¶€ë¶„ì€ ì´ì œ `Nav Mesh Agent`ê°€ ê°€ì§€ ëª»í•œë‹¤. Bake êµ¬ìš¸ ë•Œ `Agent Radius` ê°’ì„ í¬ê²Œ í•˜ë©´ ì´ ë‚˜ë¬´ì™€ ëŒ ì£¼ë³€ì— íŒŒë—ì§€ ì•Šì€ ì˜ì—­ì´ ë” ë„“ì–´ì§„ë‹¤.

<br>

## ğŸš– SetDestination : Nav Mesh Agent ì— ì˜í•œ ì´ë™ìœ¼ë¡œ ë°”ê¾¸ê¸°


### ğŸ“œAnimal.cs

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.AI;

public class Animal : MonoBehaviour
{
    protected Vector3 destination;  // ëª©ì ì§€

    // í•„ìš”í•œ ì»´í¬ë„ŒíŠ¸
    protected NavMeshAgent nav;

    protected void Start()
    {
        currentTime = waitTime;   // ëŒ€ê¸° ì‹œì‘
        isAction = true;   // ëŒ€ê¸°ë„ í–‰ë™
        theAudio = GetComponent<AudioSource>();
        nav = GetComponent<NavMeshAgent>();
    }

    protected void Update()
    {
        if (!isDead)
        {
            Move();
            ElapseTime();
        }
    }

    protected void Move()
    {
        if (isWalking || isRunning)
            nav.SetDestination(transform.position + destination * 5f);
            
            //rigid.MovePosition(transform.position + transform.forward * applySpeed * Time.deltaTime);
    }

    protected virtual void ReSet()  // ë‹¤ìŒ í–‰ë™ ì¤€ë¹„
    {
        isAction = true;

        nav.ResetPath();

        isWalking = false;
        anim.SetBool("Walking", isWalking);
        isRunning = false;
        anim.SetBool("Running", isRunning);
        nav.speed = walkSpeed;

        destination.Set(Random.Range(-0.2f, 0.2f), 0f, Random.Range(0.5f, 1f));
    }

    protected void TryWalk()  // ê±·ê¸°
    {
        currentTime = walkTime;
        isWalking = true;
        anim.SetBool("Walking", isWalking);
        nav.speed = walkSpeed;
        Debug.Log("ê±·ê¸°");
    }
}

```

<u>Rigidbody ë³´ë‹¤ Nav Mesh Agent ê°€ ìš°ì„ ì‹œ ë˜ê¸° ë•Œë¬¸ì—</u>,  Nav Mesh Agent ì»´í¬ë„ŒíŠ¸ê°€ ë¶™ê²Œ ë˜ë©´ **ë” ì´ìƒ rigid.MovePosition, rigid.MoveRotation í•¨ìˆ˜ë¡œ ì´ë™, íšŒì „ í•  ìˆ˜ ì—†ê²Œ ëœë‹¤.** â­ì´ Rigidbody í•¨ìˆ˜ë“¤ì´ freeze ë˜ì–´ ë¨¹íˆì§€ ì•ŠëŠ”ë‹¤.â­ <u>ë”°ë¼ì„œ ë¼ì§€ë¥¼ Nav Mesh Agent ì „ìš© ì´ë™ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë™ì‹œì¼œì•¼ í•œë‹¤.</u> ğŸ‘‰ **SetDestination(Vector3)**

- **nav.SetDestination(Vector3)**
  - <u>ì¸ìˆ˜ë¡œ ë“¤ì–´ê°„ Vector3 ë¥¼ ëª©ì ì§€</u>ë¡œ í•˜ì—¬ ê·¸ ìœ„ì¹˜ë¡œ `Nav Mesh Agent`(ë¼ì§€)ê°€ ì´ë™í•˜ê²Œ í•œë‹¤. 
    - í•´ë‹¹ ëª©ì ì§€ë¡œ ì´ë™í•˜ê¸° ìœ„í•´ ìƒˆë¡œìš´ Path ê²½ë¡œë¥¼ ìµœë‹¨ê²½ë¡œë¡œ ì°¾ì•„ ì„¤ì •í•œë‹¤. 
  - <u>ì´ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ íšŒì „ë„ ìë™ìœ¼ë¡œ ì´ë£¨ì–´ì§„ë‹¤.</u> ëª©ì ì§€ë¥¼ ë°”ë¼ë³´ë„ë¡ ìì—°ìŠ¤ëŸ½ê²Œ íšŒì „ë„ ê°™ì´ ì´ë£¨ì–´ì§.
    - ë”°ë¼ì„œ *Rotation()* í•¨ìˆ˜ëŠ” ì´ì œ ì§€ì›Œì£¼ì—ˆë‹¤.
  - í•´ë‹¹ ëª©ì ì§€ë¡œ ê°ˆ ìˆ˜ ìˆëŠ” <u>ìµœë‹¨ ê²½ë¡œë¡œ ì´ë™í•œë‹¤.</u>
    - Bake í•œ ì§€í˜•ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ í•´ë‹¹ ëª©ì ì§€ê¹Œì§€ì˜ ìµœë‹¨ ê²½ë¡œë¥¼ ê³„ì‚° í•¨. 
  - ì´ë™ ì†ë„ ê°’ì€ `Nav Mesh Agent` ì»´í¬ë„ŒíŠ¸ì— ì†ì„±ìœ¼ë¡œ ìˆëŠ” ìµœëŒ€ ì´ë™ ì†ë„ `Speed`, íšŒì „ ì†ë„ `Angular Speed` ê°’ì„ <u>ì†ë„</u>ë¡œ í•˜ì—¬ ëª©ì ì§€ë¡œ ì•Œì•„ì„œ ì´ë™í•œë‹¤.
- **nav.ResetPath()**
  - SetDestination(Vector3) í•¨ìˆ˜ë¡œ ì¸í•˜ì—¬ í˜„ì¬ ì„¤ì •ë˜ì–´ ìˆë˜ ê²½ë¡œë¥¼ ì§€ìš´ë‹¤. 
    - ì´ì— ë”°ë¼, í˜„ì¬ ì´ë™ì¤‘ì´ì—ˆë‹¤ë©´ ì´ë™ì„ ë©ˆì¶”ê²Œ ëœë‹¤.
  - í•´ë‹¹ `Nav Mesh Agent`ëŠ” ìƒˆë¡œìš´ SetDestination(Vector3) í˜¸ì¶œì´ ìˆì„ ë•Œê¹Œì§€ ê²½ë¡œë¥¼ ì°¾ì§€ ì•ŠëŠ”ë‹¤. ì´ë™ë„ í•˜ì§€ ì•ŠëŠ”ë‹¤.


> `Nav Mesh Agent`ëŠ” Bake ëœ ì§€í˜•ì„ ê¸°ë°˜ìœ¼ë¡œ, ì´ë™ì‹œ <u>ìµœë‹¨ ê±°ë¦¬ë¥¼ ì°¾ì•„ ì´ë™í•˜ê²Œ í•œë‹¤.</u> ëª©ì ì§€ë§Œ SetDestination í•¨ìˆ˜ì—ê²Œ ì•Œë ¤ì£¼ë©´, ì•Œì•„ì„œ ê·¸ ëª©ì ì§€ë¡œ íšŒì „í•˜ê³  ì´ë™í•œë‹¤. ê·¸ê²ƒë„ ìµœë‹¨ ê²½ë¡œë¡œ! ì´ë™ íšŒì „ 'ì†ë„'ê°’ì€ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

- *Start*
  - `nac` ì— Nav Mesh Agent ì»´í¬ë„ŒíŠ¸ ë¡œë”©
- *Update*
  - *Rotate* í•¨ìˆ˜ëŠ” ì‚­ì œí•˜ì˜€ë‹¤. ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ.
    - `Nav Mesh Agent`ì˜ SetDestination í•¨ìˆ˜ë¡œ í•´ë‹¹ ëª©ì ì§€ë¡œ ì´ë™ì‹œí‚¬ ë•Œ íšŒì „ë„ ìë™ìœ¼ë¡œ ê°™ì´ í•˜ê¸° ë•Œë¬¸ì´ë‹¤. 
- *Move*
  - ì´ì œ *rigid.MovePosition* ê°€ ì•„ë‹Œ ***nav.SetDestination***ì„ ì‚¬ìš©í•œë‹¤. 
  - `Nav Mesh Agent`ê°€ ì¸ìˆ˜ì— í•´ë‹¹í•˜ëŠ” í•´ë‹¹ ëª©ì ì§€ë¡œ ìµœë‹¨ ê²½ë¡œë¡œ, ì»´í¬ë„ŒíŠ¸ì—ì„œ ì„¤ì •ë˜ìˆëŠ” ì†ë„ ê°’ìœ¼ë¡œ, ì•Œì•„ì„œ íšŒì „í•˜ê³  ì•Œì•„ì„œ ì´ë™í•œë‹¤. ëª©ì ì§€ë¥¼ í–¥í•˜ì—¬.
    - ëª©ì ì§€ ğŸ‘‰ ë¼ì§€ì˜ ìœ„ì¹˜ì—ì„œ `destination * 5f` ë§Œí¼ ë–¨ì–´ì§„ ê³³
      - `destination` ê°’ì€ 
        - ê·¸ëƒ¥ TryWalk ìƒíƒœì¼ ê²½ìš° 
          - ëœë¤í•œ `x`, `z` ìœ„ì¹˜ë¥¼ ê°€ì§„ ë²¡í„°
        - Run ìƒíƒœì¼ ê²½ìš° (í”Œë ˆì´ì–´ë¡œë¶€í„° ë„ë§ê°ˆ ë•Œ)
          - (í”Œë ˆì´ì–´ğŸ‘‰ë¼ì§€) ë°©í–¥ ë²¡í„°ë¡œ ì„¤ì • in ğŸ“œWeakAnimal.cs
- *Reset*
  - í˜„ì¬ `Nav Mesh Agent`ê°€ ëª©ì ì§€ë¡œ ê°€ê¸° ìœ„í•´ ì´ë™ì¤‘ì´ì—ˆì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬ ***nav.ResetPath()*** ë” ì´ìƒ ì´ë™í•˜ì§€ ì•Šë„ë¡ ë¦¬ì…‹.
  - TryWalk ìƒíƒœë¥¼ ëŒ€ë¹„í•˜ì—¬ ì´ì œ ëœë¤í•œ ë°©í–¥ìœ¼ë¡œ ê±¸ì–´ì•¼ í•˜ë¯€ë¡œ `destination`ì„ ìƒˆë¡­ê²Œ ì„¤ì •í•œë‹¤. 
    - ëœë¤í•œ `x`, `z` ìœ„ì¹˜ë¥¼ ê°€ì§„ ë²¡í„°
- *TryWalk()*
  - `Nav Mesh Agent`ì˜ ì´ë™ ì†ë„ë¥¼ `walkTime` ìœ¼ë¡œ
    - nav.speed = walkSpeed
  

<br>

### ğŸ“œWeakAnimal.cs

```c#

public class WeakAnimal : Animal
{
    public void Run(Vector3 _targetPos)
    {
        destination = new Vector3(transform.position.x - _targetPos.x, 0f, transform.position.z - _targetPos.z).normalized;

        currentTime = runTime;
        isWalking = false;
        isRunning = true;
        nav.speed = runSpeed;

        anim.SetBool("Running", isRunning);
    }

}
```
```c#
destination = new Vector3(transform.position.x - _targetPos.x, 0f, transform.position.z - _targetPos.z).normalized;

nav.speed = runSpeed;
```

- ë„ë§ê°€ëŠ”ê±´ ì•½í•œ ë™ë¬¼ë“¤ ë¿
- ë„ë§ê°ˆ ë–„ ëª©ì ì§€
  -  (í”Œë ˆì´ì–´ğŸ‘‰ë¼ì§€) í”Œë ˆì´ì–´ê°€ ë¼ì§€ë¥¼ í–¥í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ ë„ë§ê°€ì•¼ í•œë‹¤.
  - `normalized`ë¥¼ 1 ë¡œ í•˜ì—¬ í¬ê¸°ë¥¼ 1 ë¡œ í•˜ì˜€ê³  ì¶”í›„ *Move* ì—ì„œ ëª©ì ì§€ì— 5 ë¥¼ ê³±í•˜ë‹ˆ, ê±°ë¦¬ 5 ë¡œ ë„ë§ê°€ê²Œ ë  ê²ƒì´ë‹¤.
- ë„ë§ê°ˆ ë•Œ ì´ë™ ì†ë„ëŠ” 
  - nav.speed = runSpeed

***
<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}