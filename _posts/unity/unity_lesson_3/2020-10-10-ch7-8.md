---
title:  "Chapter 7-8. AI : ê³µê²©í•˜ëŠ” ë™ë¬¼" 

categories:
  -  Unity Lesson 3 
tags:
  - [Game Engine, Unity]

toc: true
toc_sticky: true

date: 2020-10-10
last_modified_at: 2020-10-10
---

ì¸í”„ëŸ°ì— ìˆëŠ” ì¼€ì´ë””ë‹˜ì˜ **[ìœ ë‹ˆí‹° 3D] ì‹¤ì „! ìƒì¡´ê²Œì„ ë§Œë“¤ê¸° - Advanced** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤. ğŸ˜€  
[ğŸŒœ ê°•ì˜ ë“¤ìœ¼ëŸ¬ ê°€ê¸° Click](https://www.inflearn.com/course/unity-2#)
{: .notice--warning}

# Chapter 7. ë™ë¬¼ë“¤ì˜ ê³µê²©í˜• AI, ë„ë§í˜• AI êµ¬í˜„

## ğŸš– ê³µê²©í•˜ëŠ” ë™ë¬¼

- ğŸ“œAnimal
  - ì‹œì•¼ê° ë‚´ì—ì„œ í”Œë ˆì´ì–´ë¥¼ ë°œê²¬í–ˆë‹¤ë©´
    - ğŸ“œWeakAnimal ğŸ‘‰ *Run* 
      - í”Œë ˆì´ì–´ì˜ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ë„ë§ê°„ë‹¤.
      - ğŸ“œPig.cs
    - ğŸ“œStrongAnimal ğŸ‘‰ *Chase*
      - í”Œë ˆì´ì–´ ë°©í–¥ìœ¼ë¡œ í”Œë ˆì´ì–´ë¥¼ ë”°ë¼ì™€ ì¶”ê²©í•œë‹¤.
        - í”Œë ˆì´ì–´ë¥¼ ì¶”ê²© ì¤‘ì´ë‹¤ê°€ ê°€ê¹Œì´ ìˆê³  + ì‹œì•¼ ë‚´ì—ë„ ìˆê²Œ ë  ë•Œ <u>ê³µê²©í•œë‹¤.</u>
      - ğŸ“œLion.cs

### ê³µê²© ì• ë‹ˆë©”ì´ì…˜

![image](https://user-images.githubusercontent.com/42318591/95650273-95cb0700-0b1d-11eb-8eb9-0d68806a69ca.png)

![image](https://user-images.githubusercontent.com/42318591/95650291-b1cea880-0b1d-11eb-817a-552e0b2546f2.png)


ì‚¬ìì˜ ê³µê²© ì• ë‹ˆë©”ì´ì…˜ ë§Œë“¬.


### ğŸ“œAnimal.cs

```c#
    protected bool isAttacking; // ê³µê²©ì¤‘ì¸ì§€ íŒë³„

    protected FieldOfViewAngle theFieldOfViewAngle;
    protected StatusController thePlayerStatus;

    protected void Start()
    {
        currentTime = waitTime;   // ëŒ€ê¸° ì‹œì‘
        isAction = true;   // ëŒ€ê¸°ë„ í–‰ë™
        theAudio = GetComponent<AudioSource>();
        nav = GetComponent<NavMeshAgent>();
        theFieldOfViewAngle = GetComponent<FieldOfViewAngle>();
        thePlayerStatus = FindObjectOfType<StatusController>();
    }

    protected void ElapseTime()
    {
        if (isAction)
        {
            currentTime -= Time.deltaTime;
            if (currentTime <= 0 && !isChasing && !isAttacking)  // ëœë¤í•˜ê²Œ ë‹¤ìŒ í–‰ë™ì„ ê°œì‹œ
                ReSet();
        }
    }
```

- ê³µê²© ì¤‘ì¼ ë• ë‹¤ìŒ í–‰ë™ì„ ê°œì‹œí•˜ì§€ ì•Šë„ë¡ í•œë‹¤.
  - ê³µê²©ì´ ê°€ëŠ¥í•œ ìƒí™©ì¼ ë• ê³„ì† ê³µê²©ì„ ì´ì–´ë‚˜ê°€ì•¼ í•˜ë¯€ë¡œ.
- ê³µê²©í•˜ë©´ í”Œë ˆì´ì–´ì˜ HP, DPë¥¼ ê¹ê¸° ìœ„í•´ ğŸ“œStatusController ë¡œë”©

<br>

### ğŸ“œStrongAnimal.cs

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class StrongAnimal : Animal
{
    [SerializeField]
    protected int attackDamage; // ê³µê²© ë°ë¯¸ì§€
    [SerializeField]
    protected float attackDelay; // ê³µê²© ë”œë ˆì´
    [SerializeField]
    protected float attackDistance; // ê³µê²© ê°€ëŠ¥í•œ ì‚¬ì • ê±°ë¦¬. ì´ ì•ˆì— í”Œë ˆì´ì–´ê°€ ë“¤ì–´ì˜¤ë©´ ê°€ê¹Œì´ ìˆë‹¤ê³  íŒë‹¨.
    [SerializeField]
    protected LayerMask targetMask; // í”Œë ˆì´ì–´ ë ˆì´ì–´ê°€ í• ë‹¹ ë  ê²ƒ.

    [SerializeField]
    protected float chaseTime;  // ì´ ì¶”ê²© ì‹œê°„
    protected float currentChaseTime;  
    [SerializeField]
    protected float chaseDelayTime; // ì¶”ê²© ë”œë ˆì´

    public void Chase(Vector3 _targetPos)
    {
        destination = _targetPos;

        isChasing = true;

        isWalking = false;
        isRunning = true;
        nav.speed = runSpeed;

        anim.SetBool("Running", isRunning);

        if(!isDead)
          nav.SetDestination(destination);
    }

    public override void Damage(int _dmg, Vector3 _targetPos)
    {
        base.Damage(_dmg, _targetPos);
        if (!isDead)
            Chase(_targetPos);
    }

    protected IEnumerator ChaseTargetCoroutine()
    {
        currentChaseTime = 0;
        Chase(theFieldOfViewAngle.GetTargetPos());

        while (currentChaseTime < chaseTime)
        {
            Chase(theFieldOfViewAngle.GetTargetPos());
            // í”Œë ˆì´ì–´ì™€ ì¶©ë¶„íˆ ê°€ê¹Œì´ ìˆê³  
            if (Vector3.Distance(transform.position, theFieldOfViewAngle.GetTargetPos()) <= attackDistance)
            {
                if (theFieldOfViewAngle.View())  // ëˆˆ ì•ì— ìˆì„ ê²½ìš°
                {
                    Debug.Log("í”Œë ˆì´ì–´ ê³µê²© ì‹œë„");
                    StartCoroutine(AttackCoroutine());
                }
            }
            yield return new WaitForSeconds(chaseDelayTime);
            currentChaseTime += chaseDelayTime;
        }

        isChasing = false;
        isRunning = false;
        anim.SetBool("Running", isRunning);
        nav.ResetPath();
    }

    protected IEnumerator AttackCoroutine()
    {
        isAttacking = true;

        // ê³µê²©ì€ ì œìë¦¬ì—ì„œ ì´ë£¨ì–´ì ¸ì•¼ í•¨.
        nav.ResetPath();
        currentChaseTime = chaseTime;

        // ê³µê²©ì€ ëŒ€ìƒì„ ë°”ë¼ë³´ê³  í•˜ë„ë¡. (0.5ì´ˆ ëŒ€ê¸°í•œ í›„)
        yield return new WaitForSeconds(0.5f);
        transform.LookAt(theFieldOfViewAngle.GetTargetPos());

        // ê³µê²© ì• ë‹ˆë©”ì´ì…˜ì´ ì–´ëŠì •ë„ ì§„í–‰ëœ í›„ ë°ë¯¸ì§€ë¥¼ ì…íˆë„ë¡ ëŒ€ê¸°
        anim.SetTrigger("Attack");
        yield return new WaitForSeconds(0.5f);

        RaycastHit _hit;
        if (Physics.Raycast(transform.position + Vector3.up, transform.forward, out _hit, attackDistance, targetMask))
        {
            Debug.Log("í”Œë ˆì´ì–´ê°€ ì ì¤‘!!");
            thePlayerStatus.DecreaseHP(attackDamage);
        }
        else
        {
            Debug.Log("í”Œë ˆì´ì–´ ë¹—ë‚˜ê°!!");
        }
        yield return new WaitForSeconds(attackDelay);

        isAttacking = false;
        StartCoroutine(ChaseTargetCoroutine());
    }
}

```

> ì¶”ê²©ê³¼ ê³µê²© ì‹¤ì œ ì²˜ë¦¬ë¥¼ ğŸ“œStrongAnimal ë¡œ ì˜®ê²¼ë‹¤.


- *ChaseTargetCoroutine()* ì¶”ê²© ì½”ë£¨í‹´
  - ì¶”ê²©í•˜ë‹¤ê°€ 1ï¸âƒ£ í”Œë ˆì´ì–´ì™€ ì¶©ë¶„íˆ ê°€ê¹Œì´ ìˆê³  + 2ï¸âƒ£ ëˆˆ ì•ì— ìˆì„ ê²½ìš°
    - í”Œë ˆì´ì–´ë¥¼ ê³µê²©í•œë‹¤.
- *AttackCoroutine()* ê³µê²© ì½”ë£¨í‹´ 
  - `isAttacking` True ğŸ‘‰ ê³µê²© ì¤‘ì¼ë• ë‹¤ìŒ ëœë¤ í–‰ë™ì„ ê°œì‹œí•˜ì§€ ì•Šë„ë¡
  - ê³µê²©ì€ ì œìë¦¬ì—ì„œ ì´ë£¨ì–´ì§€ë„ë¡ í•œë‹¤.
    - ëª©ì ì§€ ì¶”ì  ë¦¬ì…‹
    - `currentChaseTime`ë¥¼ `chaseTime`ë¡œ ë§Œë“¤ì–´ *ChaseTargetCoroutine* ì½”ë£¨í‹´ì˜ ì‹¤ì œ ì¶”ì  ì²˜ë¦¬ê°€ ì´ë£¨ì–´ì§€ì§€ ì•Šë„ë¡ í•œë‹¤. 
      - ì½”ë£¨í‹´ í•¨ìˆ˜ëŠ” ë³‘í–‰í•˜ì—¬ ì‹¤í–‰ë˜ë¯€ë¡œ ë³‘ë ¬ì ìœ¼ë¡œ *ChaseTargetCoroutine*ê°€ ì‹¤í–‰ë  ìˆ˜ ìˆê¸° ë•Œë¬¸. ê³µê²©í•  ë• ì¶”ì ì„ ë©ˆì¶°ì•¼ í•œë‹¤.
  - ê³µê²©ì€ í”Œë ˆì´ì–´ë¥¼ ë°”ë¼ë³´ê³  í•˜ë„ë¡ í•œë‹¤.
  - ê³µê²© ì• ë‹ˆë©”ì´ì…˜ì´ ì–´ëŠì •ë„ ì§„í–‰í•œ í›„ ë°ë¯¸ì§€ë¥¼ ì…í ìˆ˜ ìˆë„ë¡ ê³µê²© ì• ë‹ˆë©”ì´ì…˜ ì¬ìƒì‹œí‚¨ í›„ 0.5ì´ˆ ëŒ€ê¸°
  - ì´ì œ ê³µê²©ì„ ì‹œë„í•œë‹¤.
    - ê³µê²© ì• ë‹ˆë©”ì´ì…˜ ë„ì¤‘ì— í”Œë ˆì´ì–´ì—ê²Œ ë‹¿ì•˜ë‹¤ë©´
      - í”Œë ˆì´ì–´ì˜ HP ë¥¼ ê¹ëŠ”ë‹¤.
    - ê³µê²© ì• ë‹ˆë©”ì´ì…˜ ë„ì¤‘ì— í”Œë ˆì´ì–´ì—ê²Œ ë‹¿ì§€ ì•Šì•˜ë‹¤ë©´
      - ì´ê±´ ê³µê²©ì´ ë¹—ë‚˜ê°€ ì‹¤íŒ¨í•œ ê²ƒ
  - ì´ë ‡ê²Œ ê³µê²© ê³¼ì •ì„ í•œë²ˆ í• ë•Œë§ˆë‹¤ `attackDelay` ë§Œí¼ ëŒ€ê¸° ì‹œê°„ì„ ê°€ì§„ë‹¤. 
  - `isAttacking` False 
  - ë‹¤ì‹œ í”Œë ˆì´ì–´ë¥¼ ì¶”ì  
- *Chase(Vector3 _targetPos)*
  - ì‚¬ìê°€ ì£½ìœ¼ë©´ ë” ì´ìƒ í”Œë ˆì´ì–´ë¥¼ ì¶”ê²©í•˜ì§€ ì•Šë„ë¡.. (ì½”ë£¨í‹´ì— ì˜í•´ì„œ í”Œë ˆì´ì–´ê°€ ì‚¬ë¼ì§€ê±°ë‚˜ í•´ë„ í•œë™ì•ˆ ì¶”ì ì„ ê³„ì† í•˜ê¸° ë•Œë¬¸ì— ì´ ì²˜ë¦¬ë¥¼ ì•ˆí•´ì£¼ë©´ ì‚¬ìê°€ ì£½ì€ ìƒíƒœì—ì„œë„ í”Œë ˆì´ì–´ ë”°ë¼ë‹¤ë…”ë‹¤ ã… ã… )
    ```c#
    if(!isDead)
          nav.SetDestination(destination);
    ```

![image](https://user-images.githubusercontent.com/42318591/95650013-d4f85880-0b1b-11eb-989f-36ad5c9519ce.png)


***
<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}