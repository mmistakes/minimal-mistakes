---
title:  "Chapter 7-4. AI : ë™ë¬¼ì˜ ì´ì¤‘ ìƒì†" 

categories:
  -  Unity Lesson 3 
tags:
  - [Game Engine, Unity]

toc: true
toc_sticky: true

date: 2020-10-09
last_modified_at: 2020-10-09
---

ì¸í”„ëŸ°ì— ìˆëŠ” ì¼€ì´ë””ë‹˜ì˜ **[ìœ ë‹ˆí‹° 3D] ì‹¤ì „! ìƒì¡´ê²Œì„ ë§Œë“¤ê¸° - Advanced** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤. ğŸ˜€  
[ğŸŒœ ê°•ì˜ ë“¤ìœ¼ëŸ¬ ê°€ê¸° Click](https://www.inflearn.com/course/unity-2#)
{: .notice--warning}


# Chapter 7. ë™ë¬¼ë“¤ì˜ ê³µê²©í˜• AI, ë„ë§í˜• AI êµ¬í˜„

## ğŸš– ì´ì¤‘ ìƒì†

> ğŸ“œPig ëŠ” ğŸ“œWeakAnimal ì„ ìƒì† í•œë‹¤. ğŸ“œWeakAnimal ì€ ğŸ“œAnimal ë¥¼ ìƒì† í•˜ë¯€ë¡œ, <u>ğŸ“œPig ëŠ” ğŸ“œWeakAnimal, ğŸ“œWeakAnimal ë‘ ê°€ì§€ ë‚´ìš©ì„ ë™ì‹œì— ê°€ì§„ë‹¤.</u>

- ìƒì† êµ¬ì¡°
  - ğŸ“œAnimal
    - ğŸ“œWeakAnimal
      - ğŸ“œPig
- ğŸ“œAnimal
  - ëª¨ë“  ë™ë¬¼ë“¤ì´ ê°€ì§€ëŠ” ê³µí†µì ì¸ ë¶€ë¶„
    - ì´ë¦„, ì²´ë ¥ ë“±ë“±
    - ì• ë‹ˆë©”ì´ì…˜
    - ê±·ê¸°, ë°ë¯¸ì§€, ì£½ìŒ
- ğŸ“œWeakAnimal
  - ì•½í•œ ë™ë¬¼ë“¤ì´ ê°€ì§€ëŠ” ê³µí†µì ì¸ ë¶€ë¶„
    - ë°ë¯¸ì§€ ì…ìœ¼ë©´ ğŸ‘‰ **ë„ë§ê°**
    - í”Œë ˆì´ì–´ë¥¼ ì ˆëŒ€ ê³µê²©í•˜ì§€ ì•ŠìŒ
  - **ğŸ“œPig**, ì‚¬ìŠ´, í† ë¼ ë“±ë“±..
- ğŸ“œStrongAnimal
  - ê°•í•œ ë™ë¬¼ë“¤ì´ ê°€ì§€ëŠ” ê³µí†µì ì¸ ë¶€ë¶„
    - ë°ë¯¸ì§€ ì…ìœ¼ë©´ ğŸ‘‰ ê³µê²©í•¨
    - í”Œë ˆì´ì–´ë¥¼ ë¨¼ì € ê³µê²©í•¨
  - ì•…ì–´, í˜¸ë‘ì´ ë“±ë“±..

1. ì™„ì „íˆ ë™ì¼í•˜ê²Œ ê³µí†µì ì¸ ë¶€ë¶„ì€ ê·¸ëƒ¥ ìƒì†.
2. ë™ì¼í•˜ê²Œ ê°€ì§€ëŠ” ë¶€ë¶„ì´ë‚˜, ë‚´ìš©ì´ ì¢€ ë‹¤ë¥´ë‹¤ë©´ `virtual`, `override`ë¡œ ì¬ì •ì˜
3. ì™„ì „ ë‹¤ë¥¸, ê·¸ ë™ë¬¼ë§Œì˜ ìƒˆë¡œìš´ íŠ¹ì„±ì´ë¼ë©´ ìƒˆë¡­ê²Œ ì •ì˜í•´ì£¼ë©´ ë¨.

<br>

### ğŸ“œAnimal.cs

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class Animal : MonoBehaviour
{
    [SerializeField] protected string animalName; // ë™ë¬¼ì˜ ì´ë¦„
    [SerializeField] protected int hp;  // ë™ë¬¼ì˜ ì²´ë ¥

    [SerializeField] protected float walkSpeed;  // ê±·ê¸° ì†ë ¥
    [SerializeField] protected float runSpeed;  // ë‹¬ë¦¬ê¸° ì†ë ¥
    [SerializeField] protected float turningSpeed;  // íšŒì „ ì†ë ¥
    protected float applySpeed;

    protected Vector3 direction;  // ë°©í–¥

    // ìƒíƒœ ë³€ìˆ˜
    protected bool isAction;  // í–‰ë™ ì¤‘ì¸ì§€ ì•„ë‹Œì§€ íŒë³„
    protected bool isWalking; // ê±·ëŠ”ì§€, ì•ˆ ê±·ëŠ”ì§€ íŒë³„
    protected bool isRunning; // ë‹¬ë¦¬ëŠ”ì§€ íŒë³„
    protected bool isDead;   // ì£½ì—ˆëŠ”ì§€ íŒë³„

    [SerializeField] protected float walkTime;  // ê±·ê¸° ì‹œê°„
    [SerializeField] protected float waitTime;  // ëŒ€ê¸° ì‹œê°„
    [SerializeField] protected float runTime;  // ë›°ê¸° ì‹œê°„
    protected float currentTime;

    // í•„ìš”í•œ ì»´í¬ë„ŒíŠ¸
    [SerializeField] protected Animator anim;
    [SerializeField] protected Rigidbody rigid;
    [SerializeField] protected BoxCollider boxCol;
    protected AudioSource theAudio;

    [SerializeField] protected AudioClip[] sound_Normal;
    [SerializeField] protected AudioClip sound_Hurt;
    [SerializeField] protected AudioClip sound_Dead;

    protected void Start()
    {
        currentTime = waitTime;   // ëŒ€ê¸° ì‹œì‘
        isAction = true;   // ëŒ€ê¸°ë„ í–‰ë™
        theAudio = GetComponent<AudioSource>();
    }

    protected void Update()
    {
        if (!isDead)
        {
            Move();
            Rotation();
            ElapseTime();
        }
    }

    protected void Move()
    {
        if (isWalking || isRunning)
            rigid.MovePosition(transform.position + transform.forward * applySpeed * Time.deltaTime);
    }

    protected void Rotation()
    {
        if (isWalking || isRunning)
        {
            Vector3 _rotation = Vector3.Lerp(transform.eulerAngles, new Vector3(0f, direction.y, 0f), turningSpeed); // turningSpeed ë§Œí¼ ë³´ê°„ ë¨
            rigid.MoveRotation(Quaternion.Euler(_rotation));
        }
    }

    protected void ElapseTime()
    {
        if (isAction)
        {
            currentTime -= Time.deltaTime;
            if (currentTime <= 0)  // ëœë¤í•˜ê²Œ ë‹¤ìŒ í–‰ë™ì„ ê°œì‹œ
                ReSet();
        }
    }

    protected virtual void ReSet()  // ë‹¤ìŒ í–‰ë™ ì¤€ë¹„
    {
        isAction = true;
        isWalking = false;
        anim.SetBool("Walking", isWalking);
        isRunning = false;
        anim.SetBool("Running", isRunning);
        applySpeed = walkSpeed;

        direction.Set(0f, Random.Range(0f, 360f), 0f);

        // RandomAction();
    }

    protected void TryWalk()  // ê±·ê¸°
    {
        currentTime = walkTime;
        isWalking = true;
        anim.SetBool("Walking", isWalking);
        applySpeed = walkSpeed;
        Debug.Log("ê±·ê¸°");
    }

    public virtual void Damage(int _dmg, Vector3 _targetPos)
    {
        if (!isDead)
        {
            hp -= _dmg;

            if (hp <= 0)
            {
                Dead();
                return;
            }

            PlaySE(sound_Hurt);
            anim.SetTrigger("Hurt");
            // Run(_targetPos);
        }
    }

    protected void Dead()
    {
        PlaySE(sound_Dead);

        isWalking = false;
        isRunning = false;
        isDead = true;

        anim.SetTrigger("Dead");
    }

    protected void RandomSound()
    {
        int _random = Random.Range(0, 3);  // ë¼ì§€ì˜ ì¼ìƒ ì‚¬ìš´ë“œëŠ” 3 ê°œ
        PlaySE(sound_Normal[_random]);
    }

    protected void PlaySE(AudioClip _clip)
    {
        theAudio.clip = _clip;
        theAudio.Play();
    }
}

```

> ìì‹ í´ë˜ìŠ¤ê°€ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ publicì„ ì œì™¸í•œ ëª¨ë“  private ì„ <u>protected ë¡œ ë³´í˜¸ ìˆ˜ì¤€ ì˜¬ë¦¬ê¸°</u>

- ì € ë§ì€ ë³€ìˆ˜ ë“¤ì€ ëª¨ë“  ë™ë¬¼ë“¤ì´ ê³µí†µì ìœ¼ë¡œ ê°€ì§€ëŠ” ë©¤ë²„ ë³€ìˆ˜ì´ë‹¤.
  - ğŸ“œWeakAnimal, ğŸ“œPig ê°€ ê·¸ëŒ€ë¡œ ê°€ì§€ê²Œ ë¨
- **ëª¨ë“  ë™ë¬¼ë“¤ì´ <u>ë‚´ìš© ê·¸ëŒ€ë¡œë¥¼</u> ê³µí†µì ìœ¼ë¡œ ê°€ì§€ëŠ” ê¸°ëŠ¥** 
  - Start
  - Update
  - ì´ë™ Move
  - íšŒì „ Rotation
  - í–‰ë™ íƒ€ì´ë° + ë‹¤ìŒ í–‰ë™ ê°œì‹œ ElapseTime
  - ê±·ê¸° TryWalk
  - ì‚¬ë§ Dead
  - ëœë¤ ì‚¬ìš´ë“œ ì¬ìƒ RandomSound
  - ì‚¬ìš´ë“œ ì¬ìƒ PlaySE
- **ëª¨ë“  ë™ë¬¼ë“¤ì´ ê³µí†µì ìœ¼ë¡œ ê°€ì§€ê³  ìˆê¸°ëŠ” í•˜ë‚˜ <u>ë‚´ìš©ì€ ì¡°ê¸ˆ ë‹¤ë¥´ê²Œ ê°€ì§ˆ ìˆ˜ ìˆëŠ”</u> ê¸°ëŠ¥** ğŸ‘‰ ìì‹ í´ë˜ìŠ¤ì—ì„œ ì¬ì •ì˜ í•´ì•¼í•  ê°€ìƒ í•¨ìˆ˜ `virtual`
  - ë‹¤ìŒ í–‰ë™ ì¤€ë¹„ë¥¼ ìœ„í•œ ì´ˆê¸°í™” Reset()
  - ë°ë¯¸ì§€ ì…ì—ˆì„ ë•Œ ì²˜ë¦¬ Damage

<br>

### ğŸ“œWeakAnimal.cs

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class WeakAnimal : Animal
{
    public void Run(Vector3 _targetPos)
    {
        direction = Quaternion.LookRotation(transform.position - _targetPos).eulerAngles;

        currentTime = runTime;
        isWalking = false;
        isRunning = true;
        applySpeed = runSpeed;

        anim.SetBool("Running", isRunning);
    }

    public override void Damage(int _dmg, Vector3 _targetPos)
    {
        base.Damage(_dmg, _targetPos);
        if (!isDead)
            Run(_targetPos);
    }
}

```

> ìì‹ í´ë˜ìŠ¤ê°€ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ <u>protected ì´ìƒìœ¼ë¡œ ë³´í˜¸ ìˆ˜ì¤€ ì˜¬ë¦¬ê¸°</u>

- **ëª¨ë“  ì•½í•œ ë™ë¬¼ë“¤ë§Œì´ <u>ë‚´ìš© ê·¸ëŒ€ë¡œë¥¼</u> ê³µí†µì ìœ¼ë¡œ ê°€ì§€ëŠ” ê¸°ëŠ¥** 
  - ë„ë§ê°€ê¸° Run
    - ì•½í•œ ë™ë¬¼ë“¤ë§Œ ë„ë§ê°€ê¸° ë•Œë¬¸
- **ëª¨ë“  ë™ë¬¼ë“¤ì´ ê°€ì§€ë‚˜ <u>ì•½í•œ ë™ë¬¼ì¼ ë• ë‚´ìš©ì´ ì¡°ê¸ˆ ë‹¤ë¥¸ ê¸°ëŠ¥</u>** ğŸ‘‰ ì¬ì •ì˜ `override`
  - ë°ë¯¸ì§€ ì…ì—ˆì„ ë•Œ ì²˜ë¦¬ Damage
    - ì•½í•œ ë™ë¬¼ì¼ ê²½ìš°, ë°ë¯¸ì§€ë¥¼ ì…ì„ ë•Œ ëª¨ë“  ë™ë¬¼ë“¤ì´ ë°ë¯¸ì§€ë¥¼ ì…ì„ ë•Œ í•˜ëŠ” í–‰ë™ì—ë‹¤ê°€
      - ì¶”ê°€ë¡œ ë„ë§ê°€ëŠ” ê¸°ëŠ¥ì„ ë§ë¶™ì—¬ í•œë‹¤. 
        ```c#
        base.Damage(_dmg, _targetPos);
        if (!isDead)
            Run(_targetPos);
        ```

<br>

### ğŸ“œPig.cs

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class Pig : WeakAnimal
{
    protected override void ReSet()
    {
        base.ReSet();
        RandomAction();
    }

    private void RandomAction()
    {
        RandomSound();

        int _random = Random.Range(0, 4); // ëŒ€ê¸°, í’€ëœ¯ê¸°, ë‘ë¦¬ë²ˆ, ê±·ê¸°

        if (_random == 0)
            Wait();
        else if (_random == 1)
            Eat();
        else if (_random == 2)
            Peek();
        else if (_random == 3)
            TryWalk();
    }

    private void Wait()  // ëŒ€ê¸°
    {
        currentTime = waitTime;
        Debug.Log("ëŒ€ê¸°");
    }

    private void Eat()  // í’€ ëœ¯ê¸°
    {
        currentTime = waitTime;
        anim.SetTrigger("Eat");
        Debug.Log("í’€ ëœ¯ê¸°");
    }

    private void Peek()  // ë‘ë¦¬ë²ˆ
    {
        currentTime = waitTime;
        anim.SetTrigger("Peek");
        Debug.Log("ë‘ë¦¬ë²ˆ");
    }
}

```

- **ëª¨ë“  ë™ë¬¼ë“¤ì´ ê°€ì§€ë‚˜ <u>ë¼ì§€ì¼ ë• ë‚´ìš©ì´ ì¡°ê¸ˆ ë‹¤ë¥¸ ê¸°ëŠ¥</u>**
  - ë‹¤ìŒ í–‰ë™ ì¤€ë¹„ë¥¼ ìœ„í•œ ì´ˆê¸°í™” Reset()
    - ë¼ì§€ ë§Œì˜ ë‹¤ìŒ í–‰ë™ ê²°ì • í•¨ìˆ˜ì¸ *RandomAction()* ì„ ì¶”ê°€ë¡œ ì‹¤í–‰í•œë‹¤.
- **ì˜¤ë¡œì§€ ë¼ì§€ë“¤ë§Œì´ ê°€ì§€ëŠ” ê¸°ëŠ¥**
  - ë¼ì§€ë§Œì˜ ëœë¤ í–‰ë™ë“¤ ê²°ì •  RandomAction
  - ê±·ê¸°ëŠ” ëª¨ë“  ë™ë¬¼ë“¤ì´ ê°€ì§€ëŠ” ê¸°ëŠ¥ì´ì§€ë§Œ, ëŒ€ê¸°, í’€ ëœ¯ê¸°, ë‘ë¦¬ë²ˆ ê±°ë¦¬ëŠ” ê²ƒì€ ë¼ì§€ë§Œì˜ ê¸°ëŠ¥ì´ë‹¤. Wait(), Eat(), Peek()

<br>

ì´ë¦„ì´ ë°”ë€ ë©¤ë²„ë“¤ì€ ì»´íŒŒì¼ ë˜ë©´ í• ë‹¹ ë˜ì—ˆë˜ê²Œ ì‚¬ë¼ì§€ë¯€ë¡œ ë‹¤ì‹œ ì¸ìŠ¤í™í„°ì—ì„œ í• ë‹¹í•´ ì£¼ì–´ì•¼ í•œë‹¤.

<br>

## ğŸš– ë‹¤í˜•ì„±

### ğŸ“œPickaxeController.cs

```c#
    protected override IEnumerator HitCoroutine()
    {
        while (isSwing)
        {
            if (CheckObject())
            {
                if (hitInfo.transform.tag == "Rock")
                    hitInfo.transform.GetComponent<Rock>().Mining();
                else if (hitInfo.transform.tag == "Twig")
                    hitInfo.transform.GetComponent<Twig>().Damage(this.transform);
                else if (hitInfo.transform.tag == "Weak_Animal")
                {
                    SoundManager.instance.PlaySE("Animal_Hit");
                    hitInfo.transform.GetComponent<WeakAnimal>().Damage(currentCloseWeapon.damage, transform.position);
                }
                isSwing = false;
                Debug.Log(hitInfo.transform.name);
            }
            yield return null;
        }
    }
```
```c#
                else if (hitInfo.transform.tag == "Weak_Animal")
                {
                    SoundManager.instance.PlaySE("Animal_Hit");
                    hitInfo.transform.GetComponent<WeakAnimal>().Damage(currentCloseWeapon.damage, transform.position);
                }
```

ë‹¤í˜•ì„±ì— ì˜í•˜ì—¬ GetComponent<`Pig`>>()... GetComponent<`Rabbit`>()... ì´ë ‡ê²Œ ë‚˜ì—´í•˜ì§€ ì•Šì•„ë„ ëª¨ë“  ì•½í•œ ë™ë¬¼ë“¤ì„ GetComponent<`WeakAnimal`>() í•˜ë‚˜ë¡œ ë‹¤ ë°›ì„ ìˆ˜ ìˆë‹¤. <u>ë‹¤í˜•ì„±ì— ì˜í•˜ì—¬ !</u>

![image](https://user-images.githubusercontent.com/42318591/95546164-dbfb6a00-0a3a-11eb-955c-f89ea07d3bfd.png)

"Weak_Animal" íƒœê·¸ë¥¼ ìƒˆë¡œ ë§Œë“¤ê³  ë¼ì§€ì˜ íƒœê·¸ë¥¼ ì´ê±¸ë¡œ ë°”ê¾¸ì–´ ì£¼ì—ˆë‹¤.

***
<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}