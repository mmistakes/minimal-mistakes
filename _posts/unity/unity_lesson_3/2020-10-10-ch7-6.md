---
title:  "Chapter 7-6. AI : ì¶”ê²©í•˜ëŠ” ë™ë¬¼" 

categories:
  -  Unity Lesson 3 
tags:
  - [Game Engine, Unity]

toc: true
toc_sticky: true

date: 2020-10-10
last_modified_at: 2020-10-10
---

ì¸í”„ëŸ°ì— ìˆëŠ” ì¼€ì´ë””ë‹˜ì˜ **[ìœ ë‹ˆí‹° 3D] ì‹¤ì „! ìƒì¡´ê²Œì„ ë§Œë“¤ê¸° - Advanced** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤. ğŸ˜€  
[ğŸŒœ ê°•ì˜ ë“¤ìœ¼ëŸ¬ ê°€ê¸° Click](https://www.inflearn.com/course/unity-2#)
{: .notice--warning}

# Chapter 7. ë™ë¬¼ë“¤ì˜ ê³µê²©í˜• AI, ë„ë§í˜• AI êµ¬í˜„

## ğŸš– ì‚¬ì

![image](https://user-images.githubusercontent.com/42318591/95647746-cc4c5600-0b0c-11eb-90b8-e71b5a28586e.png)

![image](https://user-images.githubusercontent.com/42318591/95648367-729a5a80-0b11-11eb-91b9-a813c303afd2.png)


ë¼ì§€ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì• ë‹ˆë©”ì´ì…˜, ì»´í¬ë„ŒíŠ¸(ğŸ“œLion.cs, ğŸ“œFieldOfViewAngle.cs, Nav Mesh Agent, Box Collider, Rigidbody)ë“¤ ë‹¤ ì ìš©í•´ì£¼ì—ˆë‹¤. íƒœê·¸ëŠ” `Strong_Animal`. ì• ë‹ˆë©”ì´ì…˜ë„ ìƒˆë¡œ ë§Œë“¤ì—ˆë‹¤! ê·¼ë° ì‚¬ìê°€ ê³„ì† ì§„ë™í•˜ë©´ì„œ ì›€ì§ì—¬ì„œ ã… ã…  ì›ì¸ ì°¾ëŠë¼ ì˜¤ë«ë™ì•ˆ ê³ ìƒí–ˆëŠ”ë° ê°„ë‹¨í•˜ê²Œë„ ì›ì¸ì€ ì½œë¼ì´ë” ìœ„ì¹˜ì— ìˆì—ˆë‹¤.. ì‚¬ìì˜ Box Colliderê°€ ë•…ì— íŒŒë¬»í˜€ìˆëŠ” ë°”ëŒì— ë•…ê³¼ ë§ˆêµ¬ ì¶©ëŒí•˜ëŠ” ì¤‘ì´ë¼ ë°œìƒí–ˆë˜ ì¼.. êµí›ˆ í•˜ë‚˜ ì–»ì—ˆë‹¤ ã…  ì›€ì§ì„ì´ ë²„ë²…ê±°ë¦°ë‹¤ë©´ ì½œë¼ì´ë”ê°€ ë•…ì— ë¬»í˜€ìˆëŠ”ì§€ëŠ” ì•Šì€ì§€ ì‚´í´ë³´ê¸°.. ğŸ˜­

<br>

## ğŸš– ì¶”ê²©í•˜ëŠ” ë™ë¬¼ (String Animal)

- ğŸ“œAnimal
  - ì‹œì•¼ê° ë‚´ì—ì„œ í”Œë ˆì´ì–´ë¥¼ ë°œê²¬í–ˆë‹¤ë©´
    - ğŸ“œWeakAnimal ğŸ‘‰ *Run* 
      - í”Œë ˆì´ì–´ì˜ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ë„ë§ê°„ë‹¤.
      - ğŸ“œPig.cs
    - ğŸ“œStrongAnimal ğŸ‘‰ *Chase*
      - <u>í”Œë ˆì´ì–´ ë°©í–¥ìœ¼ë¡œ í”Œë ˆì´ì–´ë¥¼ ë”°ë¼ì™€ ì¶”ê²©í•œë‹¤.</u>
      - ğŸ“œLion.cs


### ğŸ“œFieldOfViewAngle

```c#
    private PlayerController thePlayer;

    void Start()
    {
        thePlayer = FindObjectOfType<PlayerController>();
    }

    public Vector3 GetTargetPos()
    {
        return thePlayer.transform.position;
    }

    public bool View()
    {
        Collider[] _target = Physics.OverlapSphere(transform.position, viewDistance, targetMask);

        for (int i = 0; i < _target.Length; i++)
        {
            Transform _targetTf = _target[i].transform;
            if (_targetTf.name == "Player")
            {
                Vector3 _direction = (_targetTf.position - transform.position).normalized;
                float _angle = Vector3.Angle(_direction, transform.forward);

                if (_angle < viewAngle * 0.5f)
                {
                    RaycastHit _hit;
                    if(Physics.Raycast(transform.position + transform.up, _direction, out _hit, viewDistance))
                    {
                        if (_hit.transform.name == "Player")
                        {
                            Debug.Log("í”Œë ˆì´ì–´ê°€ ì‹œì•¼ ë‚´ì— ìˆìŠµë‹ˆë‹¤.");
                            Debug.DrawRay(transform.position + transform.up, _direction, Color.blue);

                            return true;
                        }
                    }
                }
            }
        }
        return false;
    }
```

- *GetTargetPos()*
  - í”Œë ˆì´ì–´ì˜ ìœ„ì¹˜ ë¦¬í„´ (ğŸ“œPlayerControllerê°€ ë¶™ì–´ìˆëŠ” `Player` ì—ì„œ ê°€ì ¸ì˜´)
- *View()* ë¥¼ `Bool` ë¦¬í„´ íƒ€ì… í•¨ìˆ˜ë¡œ ê³ ì³£ë‹¤.
  - í”Œë ˆì´ì–´ê°€ ì‹œì•¼ ê°ë„ ë‚´ì— ì–´ë–¤ ì¥ì• ë¬¼ë„ ê°€ë¦¬ì§€ ì•Šì€ ì²´ ì˜ ë³´ì¸ë‹¤ë©´ True ë¥¼ ë¦¬í„´í•˜ê³ 
  - ì‹œì•¼ ê°ë„ ë‚´ì—ì„œ í”Œë ˆì´ì–´ê°€ ì•ˆë³´ì¸ë‹¤ë©´ False ë¥¼ ë¦¬í„´í•œë‹¤.
  - public ìœ¼ë¡œ ê³ ì¹¨.

<br>

### ğŸ“œAnimal.cs

```c#
    protected bool isChasing; // ì¶”ê²©ì¤‘ì¸ì§€ íŒë³„
    protected FieldOfViewAngle theFieldOfViewAngle;

    protected void Start()
    {
        currentTime = waitTime;   // ëŒ€ê¸° ì‹œì‘
        isAction = true;   // ëŒ€ê¸°ë„ í–‰ë™
        theAudio = GetComponent<AudioSource>();
        nav = GetComponent<NavMeshAgent>();
        theFieldOfViewAngle = GetComponent<FieldOfViewAngle>();
    }

    protected virtual void Update()
    {
        if (!isDead)
        {
            Move();
            ElapseTime();
        }
    }

    protected void ElapseTime()
    {
        if (isAction)
        {
            currentTime -= Time.deltaTime;
            if (currentTime <= 0 && !isChasing)  // ëœë¤í•˜ê²Œ ë‹¤ìŒ í–‰ë™ì„ ê°œì‹œ
                ReSet();
        }
    }

    protected void RandomSound()
    {
        int _random = Random.Range(0, sound_Normal.Length);  
        PlaySE(sound_Normal[_random]);
    }
```

- *Start()*
  - `theFieldOfViewAngle` ë¡œë”©
- *Update()*
  - ê°€ìƒ í•¨ìˆ˜ë¡œ ê³ ì³ ìì‹ë“¤ì´ ì˜¤ë²„ë¼ì´ë”© í•˜ê²Œ í•˜ì˜€ë‹¤.
    - ğŸ“œPig ì˜ ê²½ìš° 
      - ë§¤ í”„ë ˆì„ë§ˆë‹¤ ğŸ‘‰ í”Œë ˆì´ì–´ê°€ ì‹œì•¼ ë‚´ì— ìˆë‹¤ë©´ í”Œë ˆì´ì–´ë¡œ ë¶€í„° *Run* ë„ë§ê°€ëŠ” ì²˜ë¦¬ë¥¼ ì¶”ê°€ë¡œ í•´ì¤„ ê²ƒì´ê¸° ë•Œë¬¸ì—
    - ğŸ“œLion ì˜ ê²½ìš° 
      - ë§¤ í”„ë ˆì„ë§ˆë‹¤ ğŸ‘‰ í”Œë ˆì´ì–´ê°€ ì‹œì•¼ ë‚´ì— ìˆë‹¤ë©´ í”Œë ˆì´ì–´ë¥¼ *Chase* ì¶”ê²©í•˜ëŠ” ì²˜ë¦¬ë¥¼ ì¶”ê°€ë¡œ í•´ì¤„ ê²ƒì´ê¸° ë•Œë¬¸ì—
- *ElapseTime()*
  - `isChasing`ì´ Falseì¼ ë•Œ, ì¦‰ í”Œë ˆì´ì–´ë¥¼ ì¶”ê²©í•˜ëŠ” ìƒíƒœê°€ ì•„ë‹ ë•Œë§Œ ë‹¤ìŒ í–‰ë™ì„ ê°œì‹œí•˜ë„ë¡ í•œë‹¤.
    - ğŸ“œStrongAnimal ì´ í”Œë ˆì´ì–´ ì¶”ê²© ì¤‘ì¼ë• ê³„ì† í”Œë ˆì´ì–´ê°€ ì‹œì•¼ ë‚´ì— ìˆëŠ” í•œ ê³„ì† ì«“ë„ë¡ í•˜ê¸° ìœ„í•˜ì—¬ 
- *RandomSound()*
  - 3 ìœ¼ë¡œ í•˜ë“œ ì½”ë”© ë˜ì–´ ìˆë˜ ê²ƒì„ `sound_Normal.Length` ë¡œ ê³ ì³¤ë‹¤. ë‹¤ë¥¸ ë™ë¬¼ë“¤ì˜ ì¼ìƒ ì†Œë¦¬ê°€ ê¼­ 3 ê°œë¼ëŠ” ë³´ì¥ì€ ì—†ìœ¼ë¯€ë¡œ 

<br>

### ğŸ“œStrongAnimal.cs

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class StrongAnimal : Animal
{
    [SerializeField]
    protected float chaseTime;  // ì´ ì¶”ê²© ì‹œê°„
    protected float currentChaseTime;  
    [SerializeField]
    protected float chaseDelayTime; // ì¶”ê²© ë”œë ˆì´

    public void Chase(Vector3 _targetPos)
    {
        isChasing = true;

        destination = _targetPos;

        nav.speed = runSpeed;
        isRunning = true;
        anim.SetBool("Running", isRunning);
        nav.SetDestination(destination);
    }

    public override void Damage(int _dmg, Vector3 _targetPos)
    {
        base.Damage(_dmg, _targetPos);
        if (!isDead)
            Chase(_targetPos);
    }
}
```

> ğŸ“œStrongAnimal ì€ í”Œë ˆì´ì–´ë¥¼ ì¶”ê²©í•œë‹¤.

- í”Œë ˆì´ì–´ê°€ ì‹œì•¼ ë‚´ì—ì„œ ì‚¬ë¼ì ¸ë„ ì¼ì • ì‹œê°„ë™ì•ˆì€ ê³„ì† ì¶”ê²©ì„ ìœ ì§€í•˜ë‹¤ê°€ ì¶”ê²©ì„ ê·¸ë§Œë‘ëŠ”ê²Œ ë” ìì—°ìŠ¤ëŸ½ë‹¤. 
  - í•­ìƒ ì‹œì•¼ë‚´ì— ìˆë‹¤ë©´ *Chase* í•˜ë˜
    - í•œë²ˆ ì¶”ê²©í•  ë•Œë§ˆë‹¤ `currentChaseTime` ì‹œê°„ì´ `chaseTime` ì„ ì´ˆê³¼í•  ë•Œê¹Œì§€ ëŒ€ê¸° ì‹œê°„ ê°„ê²© `chaseDelayTime`ì„ ë‘ë©´ì„œ(ì½”ë£¨í‹´) ìœ ì§€í•˜ë„ë¡ í•˜ë©´, ë§Œì•½ í”Œë ˆì´ì–´ê°€ ì‹œì•¼ ë‚´ì—ì„œ ì‚¬ë¼ì ¸ì„œ ë” ì´ìƒ ì¶”ê²© í•¨ìˆ˜ í˜¸ì¶œì´ ë˜ì§€ ì•Šë”ë¼ë„ í•œ ë™ì•ˆì€ ì¶”ê²©ì„ ìœ ì§€í•˜ê²Œ ëœë‹¤. 
- *Chase(Vector3 _targetPos)*
  - *Run* ê³¼ ë‹¤ë¥´ê²Œ 
    - ëª©ì ì§€ `destination` ëŠ” `_targetPos` í”Œë ˆì´ì–´ ìœ„ì¹˜ì´ë‹¤. 
    - `currentTime`ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  í”Œë ˆì´ì–´ê°€ ì‹œì•¼ ë‚´ì— ìˆëŠ” í•œ ì¶”ì ì„ ìœ ì§€í•´ì•¼ í•˜ë¯€ë¡œ  `currentChaseTime`ë¡œ ë”°ë¡œ ì‚¬ìš©
    - ê·¸ ì™¸ì—” *Run* ê³¼ ê°™ë‹¤.
- *Damage(int _dmg, Vector3 _targetPos)*
  - ë§ìœ¼ë©´ *Chase* ì¶”ê²©

<br>

### ğŸ“œLion.cs

> `Lion` ì— ë¶™ìœ¼ë©°, ğŸ“œStrongAnimal ìƒì†

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class Lion : StrongAnimal
{
    protected override void Update()
    {
        base.Update();
        if (theFieldOfViewAngle.View() && !isDead)
        {
            StopAllCoroutines();
            StartCoroutine(ChaseTargetCoroutine());
        }
    }

    IEnumerator ChaseTargetCoroutine()
    {
        currentChaseTime = 0;
        Chase(theFieldOfViewAngle.GetTargetPos());

        while(currentChaseTime < chaseTime)
        {
            Chase(theFieldOfViewAngle.GetTargetPos());
            yield return new WaitForSeconds(chaseDelayTime);
            currentChaseTime += chaseDelayTime;
        }

        isChasing = false;
        isRunning = false;
        anim.SetBool("Running", isRunning);
        nav.ResetPath();
    }

    protected override void ReSet()
    {
        base.ReSet();
        RandomAction();
    }

    private void RandomAction()
    {
        RandomSound();

        int _random = Random.Range(0, 2); // ëŒ€ê¸°, ê±·ê¸°

        if (_random == 0)
            Wait();
        else if (_random == 1)
            TryWalk();
    }

    private void Wait()  // ëŒ€ê¸°
    {
        currentTime = waitTime;
        Debug.Log("ëŒ€ê¸°");
    }
}

```

> ì‚¬ìì˜ ê¸°ë³¸ ìƒíƒœ 2 ê°€ì§€ (í”Œë ˆì´ì–´ ë°œê²¬í•œ ìƒíƒœê°€ ì•„ë‹ ë•Œì˜ ëœë¤ ìƒíƒœ) ğŸ‘‰ 1ï¸âƒ£ ëŒ€ê¸° 2ï¸âƒ£ ê±·ê¸°

```c#
    protected override void Update()
    {
        base.Update();
        if (theFieldOfViewAngle.View() && !isDead)
        {
            StopAllCoroutines();
            StartCoroutine(ChaseTargetCoroutine());
        }
    }

    IEnumerator ChaseTargetCoroutine()
    {
        currentChaseTime = 0;
        Chase(theFieldOfViewAngle.GetTargetPos());

        while(currentChaseTime < chaseTime)
        {
            Chase(theFieldOfViewAngle.GetTargetPos());
            yield return new WaitForSeconds(chaseDelayTime);
            currentChaseTime += chaseDelayTime;
        }

        isChasing = false;
        nav.ResetPath();
    }
```

- *Update()*
  - `base.Update()`
    - ë§¤í”„ë ˆì„ë§ˆë‹¤ Move(ì›€ì§ì„), ElapseTime(ë‹¤ìŒ í–‰ë™ ê²°ì •)
  - í”Œë ˆì´ì–´ê°€ ì‹œì•¼ ê°ë„ ë‚´ì— ìˆê³  and ì‚¬ìê°€ ì£½ì€ ìƒíƒœê°€ ì•„ë‹ˆë¼ë©´
    - í”Œë ˆì´ì–´ë¥¼ ì¶”ê²©í•´ì•¼ í•œë‹¤.
      - ê¸°ì¡´ì— ì§„í–‰ë˜ë˜ ì½”ë£¨í‹´ì€ ë©ˆì¶”ê³  ìƒˆë¡­ê²Œ *ChaseTargetCoroutine()* ì½”ë£¨í‹´ í•¨ìˆ˜ ì‹¤í–‰
      - í”Œë ˆì´ì–´ê°€ ì‹œì•¼ ê°ë„ë‚´ì— ìˆë‹¤ë©´ ê³„ì† í•´ì„œ ì½”ë£¨í‹´ì´ ë©ˆì·„ë‹¤ê°€ ìƒˆë¡­ê²Œ ë‹¤ì‹œ ì‹œì‘ë˜ë¯€ë¡œ ê³„ì† ì¶”ì  ìƒíƒœë¥¼ ìœ ì§€í•˜ê²Œ ëœë‹¤. 
        - í”Œë ˆì´ì–´ê°€ ì‹œì•¼ ê°ë„ ë‚´ì—ì„œ ì‚¬ë¼ì§„ë‹¤ë©´ ìƒˆë¡­ê²Œ ì½”ë£¨í‹´ì´ ì‹¤í–‰ë˜ì§„ ì•Šê³  ê¸°ì¡´ì˜ ì½”ë£¨í‹´ì´ ì‹œê°„ì´ ë‹¤ ë˜ì–´ ë©ˆì¶”ë©´ ëë‚¨ (ì¦‰, ì‹œì•¼ ê°ë„ ë‚´ì—ì„œ ì‚¬ë¼ì ¸ë„ ì¼ì • ì‹œê°„ë™ì•ˆì€ ì¶”ì ì„ ìœ ì§€)
- *ChaseTargetCoroutine()* ì½”ë£¨í‹´
  - `currentChaseTime`ì„ 0 ë¶€í„° ì—…ëƒ í•˜ê¸° ì‹œì‘
  - *Chase(theFieldOfViewAngle.GetTargetPos());* í”Œë ˆì´ì–´ ì¶”ê²©. 
    - `currentChaseTime`ê°€ `chaseTime`ì— ë„ë‹¬í•  ë•Œê¹Œì§€ ë°˜ë³µ
      - *Chase(theFieldOfViewAngle.GetTargetPos());* í”Œë ˆì´ì–´ ì¶”ê²©. 
      - `chaseDelayTime` ë™ì•ˆ ëŒ€ê¸°
      - `currentChaseTime`ì— `chaseDelayTime` ì„ ë”í•´ì£¼ê¸°
  - ì¶”ì  ì‹œê°„ì´ ëë‚¬ë‹¤ë©´ (ì´ë•Œê¹Œì§€ë„ StopAllCoroutinesì´ ë˜ì§€ ì•Šê³  ì—¬ê¸°ê¹Œì§€ ì™”ë‹¤ëŠ” ì–˜ê¸°ì´ë‹ˆ, ì—¬ê¸°ê¹Œì§€ ì™”ë‹¤ëŠ”ê±´ í”Œë ˆì´ëŸ¬ê°€ ì‹œì•¼ ê°ë„ ë‚´ì—ì„œ ì‚¬ë¼ì¡Œì„ í™•ë¥ ì´ ë†’ë‹¤.)
    - ì´ì œ `isChasing`ì„ Falseë¡œ ì—…ëƒí•˜ê³ 
    - Nav Mesh Agent ì˜ ëª©ì ì§€ ì—†ì• ê¸°
    - ë‹¬ë¦¬ê¸° ì• ë‹ˆë©”ì´ì…˜ ë©ˆì¶”ê¸°

![image](https://user-images.githubusercontent.com/42318591/95647821-6ad8b700-0b0d-11eb-857f-00c728b2863b.png)


<br>

### ğŸ“œPig.cs

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class Pig : WeakAnimal
{
    protected override void Update()
    {
        base.Update();
        if (theFieldOfViewAngle.View() && !isDead)
        {
            Run(theFieldOfViewAngle.GetTargetPos());
        }
    }

    protected override void ReSet()
    {
        base.ReSet();
        RandomAction();
    }

    private void RandomAction()
    {
        RandomSound();

        int _random = Random.Range(0, 4); // ëŒ€ê¸°, í’€ëœ¯ê¸°, ë‘ë¦¬ë²ˆ, ê±·ê¸°

        if (_random == 0)
            Wait();
        else if (_random == 1)
            Eat();
        else if (_random == 2)
            Peek();
        else if (_random == 3)
            TryWalk();
    }

    private void Wait()  // ëŒ€ê¸°
    {
        currentTime = waitTime;
        Debug.Log("ëŒ€ê¸°");
    }

    private void Eat()  // í’€ ëœ¯ê¸°
    {
        currentTime = waitTime;
        anim.SetTrigger("Eat");
        Debug.Log("í’€ ëœ¯ê¸°");
    }

    private void Peek()  // ë‘ë¦¬ë²ˆ
    {
        currentTime = waitTime;
        anim.SetTrigger("Peek");
        Debug.Log("ë‘ë¦¬ë²ˆ");
    }
}

```

```c#
    protected override void Update()
    {
        base.Update();
        if (theFieldOfViewAngle.View() && !isDead)
        {
            Run(theFieldOfViewAngle.GetTargetPos());
        }
    }
```

- *Update()*
  - `base.Update()`
    - ë§¤í”„ë ˆì„ë§ˆë‹¤ Move(ì›€ì§ì„), ElapseTime(ë‹¤ìŒ í–‰ë™ ê²°ì •)
  - í”Œë ˆì´ì–´ê°€ ì‹œì•¼ ê°ë„ ë‚´ì— ìˆê³  and ë¼ì§€ê°€ ì£½ì€ ìƒíƒœê°€ ì•„ë‹ˆë¼ë©´
    - ë¼ì§€ëŠ” í”Œë ˆì´ì–´ë¥¼ í”¼í•´ ë„ë§ê°„ë‹¤. *Run*

<br>

### ğŸ“œPickaxeController.cs

```c#
                else if (hitInfo.transform.tag == "Weak_Animal")
                {
                    SoundManager.instance.PlaySE("Animal_Hit");
                    hitInfo.transform.GetComponent<WeakAnimal>().Damage(currentCloseWeapon.damage, transform.position);
                }
                else if (hitInfo.transform.tag == "Strong_Animal")
                {
                    SoundManager.instance.PlaySE("Animal_Hit");
                    hitInfo.transform.GetComponent<StrongAnimal>().Damage(currentCloseWeapon.damage, transform.position);
                }
```

"Strong_Animal" íƒœê·¸ ë¶™ì€ ê°•í•œ ë™ë¬¼ (ì‚¬ì)ë¥¼ ê³¡ê´­ì´ë¡œ ë•Œë¦´ ë•Œë„ ì²˜ë¦¬.



***
<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}