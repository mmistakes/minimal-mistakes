---
title:  "Chapter 7-5. UI : UI Manager (íŒì—…UIë“¤ ìŠ¤íƒì²˜ëŸ¼ ê´€ë¦¬)" 

categories:
  -  Unity Lesson 2
tags:
  - [Game Engine, Unity]

toc: true
toc_sticky: true

date: 2021-01-02
last_modified_at: 2021-01-02
---

ì¸í”„ëŸ°ì— ìˆëŠ” Rookissë‹˜ì˜ **[C#ê³¼ ìœ ë‹ˆí‹°ë¡œ ë§Œë“œëŠ” MMORPG ê²Œì„ ê°œë°œ ì‹œë¦¬ì¦ˆ] Part3: ìœ ë‹ˆí‹° ì—”ì§„** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤. ğŸ˜€  
[ğŸŒœ ê°•ì˜ ë“¤ìœ¼ëŸ¬ ê°€ê¸° Click](https://www.inflearn.com/course/MMORPG-ìœ ë‹ˆí‹°)
{: .notice--warning}

# Chapter 7. UI

## ğŸš€ UI ìë™í™”ë¥¼ ìœ„í•œ í´ë˜ìŠ¤ êµ¬ì¡°

- ğŸ“œManagers ğŸ‘‰ ğŸ“œUIManager ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬
  ```c#
  UIManager _ui = new UIManager();
  public static UIManager UI { get { return Instance._ui; } }
  ```
- ğŸ“œPlayerController ğŸ‘‰ ğŸ“œUIManagerì˜ UI ìº”ë²„ìŠ¤ í”„ë¦¬íŒ¹ ìƒì„±í•´ì£¼ëŠ” *ShowPopupUI*(íŒì—… UI ê²½ìš°) í•¨ìˆ˜ë¥¼ í˜¸ì¶œì‹œì¼œ UI ë„ìš°ê¸° 
  ```c#
      void Start()
    {
		Managers.Input.MouseAction -= OnMouseClicked;
		Managers.Input.MouseAction += OnMouseClicked;

		// TEMP
		Managers.UI.ShowPopupUI<UI_Button>();
	}
  ```
- ğŸ“œUIManager ëŠ” <u>ê²Œì„ ì”¬ ìƒì—ì„œ ìƒê¸¸ ì—¬ëŸ¬ê°€ì§€ *UI ìº”ë²„ìŠ¤ í”„ë¦¬íŒ¹* ë“¤ì˜ ìƒì„±ê³¼ ì‚­ì œë¥¼ ê´€ë¦¬í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‚¬ìš©í•  ê²ƒì´ë‹¤.</u>
  - íŒì—… UI ìº”ë²„ìŠ¤ë“¤ì€ ë Œë”ë§ ìˆœì„œ ë˜í•œ ê´€ë¦¬ë˜ì–´ì•¼ í•œë‹¤. `sort order`

> ìº”ë²„ìŠ¤ UI ì¢…ë¥˜

ì´ í¬ìŠ¤íŠ¸ ìƒì—ì„  ë‘ê°€ì§€ë¡œ êµ¬ë¶„

- ê³ ì •UI (ì”¬ë‹¨ìœ„ë¡œ í•­ìƒ í™”ë©´ ê³ ì •) 
  - ëŒ€í‘œ ì¡°ìƒ ğŸ“œUI_Scene
    - ğŸ“œUI_Inven
- íŒì—…UI (ì‚¬ìš©ìê°€ í´ë¦­í•´ì•¼ í™œì„±í™”, ê°€ì¥ ë‚˜ì¤‘ì— ë„ìš´ íŒì—…ë¶€í„° ë¹„í™œë˜ë„ë¡ Stack ìœ¼ë¡œ ê´€ë¦¬í•  ê²ƒ)
  - ëŒ€í‘œ ì¡°ìƒ ğŸ“œUI_PopUp
    - ğŸ“œUI_Button

### ğŸ“œUI_Base

```c#
public abstract void Init();
```

<br>

### ğŸ“œUI_PopUp

```c#
public class UI_Popup : UI_Base
{
    public override void Init()
    {
        Managers.UI.SetCanvas(gameObject, true);
    }

    public virtual void ClosePopupUI()  // íŒì—…ì´ë‹ˆê¹Œ ê³ ì • ìº”ë²„ìŠ¤(Scene)ê³¼ ë‹¤ë¥´ê²Œ ë‹«ëŠ”ê²Œ í•„ìš”
    {
        Managers.UI.ClosePopupUI(this);
    }
}
```

- UI ìº”ë²„ìŠ¤ ì„¸íŒ… (ì˜¤ë¸Œì íŠ¸ì— Canvas ì»´í¬ë„ŒíŠ¸ sorting order ì„¸íŒ…) ğŸ‘‰ *Init*
  - ğŸ“œUIManager ì˜ *SetCanvas* í˜¸ì¶œ
    - íŒì—… UIë‹ˆê¹Œ ìº”ë²„ìŠ¤ë“¤ì„ sorting í•´ì•¼ í•˜ë¯€ë¡œ `true` ì „ë‹¬ (ë°‘ì— ğŸ“œUIManager ì°¸ê³ )
- UI ë‹«ê¸° (ìº”ë²„ìŠ¤ í”„ë¦¬íŒ¹ íŒŒê´´) ğŸ‘‰ *ClosePopupUI*
  - íŒì—…ì´ë‹ˆê¹Œ ê³ ì • ìº”ë²„ìŠ¤(Scene)ê³¼ ë‹¤ë¥´ê²Œ ë‹«ëŠ”ê²Œ í•„ìš”
  - ğŸ“œUIManager ì˜ *ClosePopupUI* í˜¸ì¶œ

<br>

### ğŸ“œUI_Scene

```c#
public class UI_Scene : UI_Base
{
	public override void Init()
	{
		Managers.UI.SetCanvas(gameObject, false);
	}
}
```

- UIìº”ë²„ìŠ¤ ì„¸íŒ… (ì˜¤ë¸Œì íŠ¸ì— Canvas ì»´í¬ë„ŒíŠ¸ sorting order ì„¸íŒ…) ğŸ‘‰ *Init*
  - ğŸ“œUIManager ì˜ *SetCanvas* í˜¸ì¶œ
    - ê³ ì • UIë‹ˆê¹Œ sorting í•  í•„ìš”ê°€ ì—†ìœ¼ë¯€ë¡œ `false` ì „ë‹¬ (ë°‘ì— ğŸ“œUIManager ì°¸ê³ ) ê³ ì • UIëŠ” ê·¸ëƒ¥ `sort order` ê°’ì´ ê°€ì¥ ìµœì†Œê°’ì¸ 0 ìœ¼ë¡œ ê³ ì •ì‹œí‚¬ ê²ƒ. (ê°€ì¥ ë¨¼ì € ê·¸ë ¤ì ¸ ë°‘ì—ì„œ ê·¸ë ¤ì§€ê²Œ)

<br>

## ğŸš€ UI Manager

- SetCanvas ğŸ‘‰ `go` ì˜¤ë¸Œì íŠ¸ì˜ ìº”ë²„ìŠ¤ ì»´í¬ë„ŒíŠ¸ ê°€ì ¸ì™€(GetOrAddComponentë¥¼ í†µí•´ ì—†ë‹¤ë©´ ë¶™ì—¬ì„œë¼ë„ ê°€ì ¸ì˜´) `sort order`ê°’ ì„¸íŒ…
- Show~ ğŸ‘‰ ìº”ë²„ìŠ¤ UI í”„ë¦¬íŒ¹ ìƒì„±
- Close~ ğŸ‘‰ ìº”ë²„ìŠ¤ UI ì˜¤ë¸Œì íŠ¸ íŒŒê´´

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class UIManager
{
    int _order = 10; // í˜„ì¬ê¹Œì§€ ìµœê·¼ì— ì‚¬ìš©í•œ ì˜¤ë”

    Stack<UI_Popup> _popupStack = new Stack<UI_Popup>(); // ì˜¤ë¸Œì íŠ¸ ë§ê³  ì»´í¬ë„ŒíŠ¸ë¥¼ ë‹´ìŒ. íŒì—… ìº”ë²„ìŠ¤ UI ë“¤ì„ ë‹´ëŠ”ë‹¤.
    UI_Scene _sceneUI = null; // í˜„ì¬ì˜ ê³ ì • ìº”ë²„ìŠ¤ UI
```
```c#
    public GameObject Root
    {
        get
        {
			      GameObject root = GameObject.Find("@UI_Root");
			      if (root == null)
				        root = new GameObject { name = "@UI_Root" };
                    return root;
		    }
    }
```

- ê³ ì • UI
  - `sort order` ê°’ì´ 0 ìœ¼ë¡œ ê³ ì •. (ê°€ì¥ ë¨¼ì € ê·¸ë ¤ì ¸ ë°‘ì—ì„œ ê·¸ë ¤ì§€ê²Œ)
  - ìŠ¤íƒìœ¼ë¡œ ê´€ë¦¬ë  í•„ìš” ì—†ìŒ. ê°€ì¥ ë°”íƒ•ì´ ë˜ëŠ” UIì´ë¯€ë¡œ í•˜ë‚˜ë§Œ ìˆìœ¼ë‹ˆ!
- íŒì—… UI 
  - `sort order`ì„ í¸ì˜ìƒ ê³ ì • UIì™€ ê²¹ì¹˜ì§€ ì•Šë„ë¡ 10ë¶€í„° ì‹œì‘í•˜ê²Œ í•  ê²ƒì´ë‹¤. íŒì—… ìº”ë²„ìŠ¤ UIë“¤ì€ 10, 11, 12, 13,... ë Œë”ë§ ìˆœì„œë¥¼ ë¶€ì—¬ë°›ìŒ. ëŠ¦ê²Œ ìƒì„±ëœ ê²ƒì¼ ìˆ˜ë¡ ëŠ¦ì€ ìˆœì„œ! (ê°€ì¥ ìœ„ì— ê·¸ë ¤ì§€ë„ë¡)
  - ì—¬ëŸ¬ê°œê°€ ìƒê¸¸ ìˆ˜ ìˆìœ¼ë©°, ê°€ì¥ ë‚˜ì¤‘ì— ìƒì„±ëœ íŒì—…ë¶€í„° ë¨¼ì € ë‹«í˜€ì•¼ í•˜ë¯€ë¡œ ìƒì„±ëœ íŒì—… ìº”ë²„ìŠ¤ UI ì˜¤ë¸Œì íŠ¸ë“¤ì„ ìŠ¤íƒìœ¼ë¡œ ê´€ë¦¬í•  ê²ƒ.
- `@UI_Root`ë¼ëŠ” ì´ë¦„ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ ì—†ë‹¤ë©´ ë§Œë“¤ì–´ì„œë¼ë„ ë¦¬í„´í•´ì£¼ëŠ” í”„ë¡œí¼í‹° `Root`
  - ì´ê²Œ í•„ìš”í•œ ì´ìœ ëŠ”, Hierarchy ìƒì˜ ì˜¤ë¸Œì íŠ¸ë“¤ë„ ë§ˆì¹˜ í´ë” ì•ˆì— ìˆëŠ”ê²ƒì²˜ëŸ¼ ê´€ë ¨ ìˆëŠ” ê²ƒë“¤ë¼ë¦¬ ì¢…ë¥˜ë³„ë¡œ ì´ë¦„ì„ êµ¬ë¶„í•œ ë¹ˆ ì˜¤ë¸Œì íŠ¸ì˜ ìì‹ìœ¼ë¡œ ë„£ì–´ ì •ë¦¬í•  ê²ƒì´ê¸° ë•Œë¬¸ì´ë‹¤. UI ì˜¤ë¸Œì íŠ¸ë“¤ì€ ì´ `@UI_Root` ë¹ˆ ì˜¤ë¸Œì íŠ¸ ì•„ë˜ì— ìƒì„±ë˜ê²Œ ê·¸ë£¹í™”í•  ê²ƒì´ë¼ì„œ í•„ìš”.


```c#
    public void SetCanvas(GameObject go, bool sort = true)
    {
        Canvas canvas = Util.GetOrAddComponent<Canvas>(go);
        canvas.renderMode = RenderMode.ScreenSpaceOverlay;
        canvas.overrideSorting = true; // ìº”ë²„ìŠ¤ ì•ˆì— ìº”ë²„ìŠ¤ ì¤‘ì²© ê²½ìš° (ë¶€ëª¨ ìº”ë²„ìŠ¤ê°€ ì–´ë–¤ ê°’ì„ ê°€ì§€ë˜ ë‚˜ëŠ” ë‚´ ì˜¤ë”ê°’ì„ ê°€ì§€ë ¤ í• ë•Œ)

        if (sort)
        {
            canvas.sortingOrder = _order;
            _order++;
        }
        else // soring ìš”ì²­ X ë¼ëŠ” ì†Œë¦¬ëŠ” íŒì—…ì´ ì•„ë‹Œ ì¼ë°˜ ê³ ì • UI
        {
            canvas.sortingOrder = 0;
        }
    }
```

> ì˜¤ë¸Œì íŠ¸ì˜ ìº”ë²„ìŠ¤ ì„¸íŒ…

- `canvas`ì— Canvas ì»´í¬ë„ŒíŠ¸ ê°€ì ¸ì˜´(ì—†ìœ¼ë©´ ë¶™ì—¬ì„œë¼ë„)
- ìº”ë²„ìŠ¤ì˜ RenderModeë¥¼ ScreenSpaceOverlay ëª¨ë“œë¡œ ì„¸íŒ…
- `overrideSorting`ì„ í†µí•´ í˜¹ì‹œë¼ë„ ì¤‘ì²©ìº”ë²„ìŠ¤ë¼ ìì‹ ìº”ë²„ìŠ¤ê°€ ìˆë”ë¼ë„ ë¶€ëª¨ ìº”ë²„ìŠ¤ê°€ ì–´ë–¤ ê°’ì„ ê°€ì§€ë˜ ë‚˜ëŠ” ë‚´ ì˜¤ë”ê°’ì„ ê°€ì§€ë ¤ í• ë•Œ true
  - *canvas.overrideSorting = true;*
- íŒì—… UIì˜ ê²½ìš° canvas.sortingOrderë¥¼ `_order`ë¡œ ì„¸íŒ…í•˜ê³  `_order` ì¦ê°€ì‹œí‚¤ê¸°
- ê³ ì • UIì˜ ê²½ìš° canvas.sortingOrder ê°’ì„ 0 ìœ¼ë¡œ ì„¸íŒ…

```c#
	  public T ShowSceneUI<T>(string name = null) where T : UI_Scene
	  {
		   if (string.IsNullOrEmpty(name))
		    	name = typeof(T).Name;

	    	GameObject go = Managers.Resource.Instantiate($"UI/Scene/{name}");
		    T sceneUI = Util.GetOrAddComponent<T>(go);
        _sceneUI = sceneUI;

	    	go.transform.SetParent(Root.transform);

	    	return sceneUI;
	  }

	  public T ShowPopupUI<T>(string name = null) where T : UI_Popup
    {
        if (string.IsNullOrEmpty(name)) // ì´ë¦„ì„ ì•ˆë°›ì•˜ë‹¤ë©´ Të¡œ ã„±ã„±
            name = typeof(T).Name;

        GameObject go = Managers.Resource.Instantiate($"UI/Popup/{name}");
        T popup = Util.GetOrAddComponent<T>(go);
        _popupStack.Push(popup);

        go.transform.SetParent(Root.transform);

		return popup;
    }
```

> ìº”ë²„ìŠ¤ í”„ë¦¬íŒ¹ ìƒì„±í•˜ê¸°

- ê³ ì • UI ìº”ë²„ìŠ¤ í”„ë¦¬íŒ¹ ìƒì„± *ShowSceneUI*
  - `T`ëŠ” ğŸ“œUI_Scene ìì‹ë“¤ë§Œ ê°€ëŠ¥
  - í”„ë¦¬íŒ¹ì„ Instantiateìœ¼ë¡œ ìƒì„±í•˜ê³  `_sceneUI`ì— ë°”ì¸ë”© í›„ ì´ë¥¼ ë¦¬í„´
  - `Root`í”„ë¡œí¼í‹°ë¥¼ í†µí•´ `@UI_Root`ì˜ ìì‹ìœ¼ë¡œ ë„£ì–´ì¤Œ
- íŒì—… UI ìº”ë²„ìŠ¤ í”„ë¦¬íŒ¹ ìƒì„± *ShowPopupUI*
  - `T`ëŠ” ğŸ“œUI_PopUp ìì‹ë“¤ë§Œ ê°€ëŠ¥
  - í”„ë¦¬íŒ¹ì„ Instantiateìœ¼ë¡œ ìƒì„±í•˜ê³  `popup`ì— ë°”ì¸ë”© í›„ ìŠ¤íƒì— ì¶”ê°€. ê·¸ë¦¬ê³  ì´ë¥¼ ë¦¬í„´
  - `Root`í”„ë¡œí¼í‹°ë¥¼ í†µí•´ `@UI_Root`ì˜ ìì‹ìœ¼ë¡œ ë„£ì–´ì¤Œ

`_order++`ì²˜ë¦¬ë¥¼ *ShowPopupUI* ì—ì„œ ì•ˆí•˜ê³  *SetCanvas*ì—ì„œ í•´ì¤€ ì´ìœ ëŠ”, ìº”ë²„ìŠ¤ í”„ë¦¬íŒ¹ì„ í†µí•´ ìƒì„±ë˜ëŠ” ê²½ìš°(*ShowPopupUI* ì‚¬ìš©í•´ì„œ) ë§ê³ ! ì´ë¯¸ ê²Œì„ ì‹œì‘ì „ë¶€í„° static í•˜ê²Œ ì¡´ì¬í•˜ê³  ìˆë˜, í”„ë¦¬íŒ¹ìœ¼ë¡œë¶€í„° ìƒì„±ëœê²Œ ì•„ë‹Œ íŒì—… UIì¼ ê²½ìš°ë„ ìˆì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤. ê·¸ëŸ° ê²½ìš°ì—” *ShowPopupUI*ë¥¼ ê±°ì¹˜ì§€ ì•Šê¸° ë•Œë¬¸ì— sort order ê´€ë¦¬ê°€ ì•ˆë  ê²ƒì´ë‹¤. ê·¸ë˜ì„œ *SetCanvas*ì—ì„œ í•´ì¤€ ê²ƒ!

```c#
    public void ClosePopupUI(UI_Popup popup) // ì•ˆì „ ì°¨ì›
    {
		    if (_popupStack.Count == 0) // ë¹„ì–´ìˆëŠ” ìŠ¤íƒì´ë¼ë©´ ì‚­ì œ ë¶ˆê°€
			      return;

        if (_popupStack.Peek() != popup)
        {
            Debug.Log("Close Popup Failed!"); // ìŠ¤íƒì˜ ê°€ì¥ ìœ„ì—ìˆëŠ” Peek() ê²ƒë§Œ ì‚­ì œí•  ìˆ˜ ì‡ê¸° ë•Œë¬¸ì— popupì´ Peek()ê°€ ì•„ë‹ˆë©´ ì‚­ì œ ëª»í•¨
            return;
        }

        ClosePopupUI();
    }

    public void ClosePopupUI()
    {
        if (_popupStack.Count == 0)
            return;

        UI_Popup popup = _popupStack.Pop();
        Managers.Resource.Destroy(popup.gameObject);
        popup = null;
        _order--; // order ì¤„ì´ê¸°
    }

    public void CloseAllPopupUI()
    {
        while (_popupStack.Count > 0)
            ClosePopupUI();
    }
}
```

íŒì—…ì€ Close ì‹œí‚¬ í•¨ìˆ˜ê°€ í•„ìš”í•˜ë‹¤.

***
<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}