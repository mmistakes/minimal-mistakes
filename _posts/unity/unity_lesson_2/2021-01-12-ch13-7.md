---
title:  "Chapter 13-7. ë¯¸ë‹ˆ RPG : ì²´ë ¥ ê²Œì´ì§€" 

categories:
  -  Unity Lesson 2
tags:
  - [Game Engine, Unity]

toc: true
toc_sticky: true

date: 2021-01-12
last_modified_at: 2021-01-12
---

ì¸í”„ëŸ°ì— ìˆëŠ” Rookissë‹˜ì˜ **[C#ê³¼ ìœ ë‹ˆí‹°ë¡œ ë§Œë“œëŠ” MMORPG ê²Œì„ ê°œë°œ ì‹œë¦¬ì¦ˆ] Part3: ìœ ë‹ˆí‹° ì—”ì§„** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤. ğŸ˜€  
[ğŸŒœ ê°•ì˜ ë“¤ìœ¼ëŸ¬ ê°€ê¸° Click](https://www.inflearn.com/course/MMORPG-ìœ ë‹ˆí‹°)
{: .notice--warning}


# Chapter 13. ë¯¸ë‹ˆ RPG ë§Œë“¤ê¸°

## ğŸš€ ì²´ë ¥ ê²Œì´ì§€ UI ë§Œë“¤ê¸°ë„

![image](https://user-images.githubusercontent.com/42318591/104311115-1b44c580-5518-11eb-90b4-60f27f43794e.png)

ì²´ë ¥ ê²Œì´ì§€ëŠ” ëª¬ìŠ¤í„°ì™€ í”Œë ˆì´ì–´ ìœ„ì— ë”°ë¼ë‹¤ë…€ì•¼í•¨. ê·¸ëŸ¬ë‹ˆ ì›ê·¼ë²• ì ìš©ì´ ë˜ì•¼ í•œë‹¤. 3D ì˜¤ë¸Œì íŠ¸ì²˜ëŸ¼! ğŸ‘‰ **ìº”ë²„ìŠ¤ ë Œë”ëŸ¬ ëª¨ë“œë¥¼ World Spaceë¡œ ë°”ê¿”ì¤€ë‹¤.**

![image](https://user-images.githubusercontent.com/42318591/104311249-3f080b80-5518-11eb-82e3-9de12fe3aa56.png)

- `UI_HPBar` ìº”ë²„ìŠ¤ 
  - ğŸ‘‰ RenderModeëŠ” WorldSpace. ì´ë• ì´ ìº”ë²„ìŠ¤ë¥¼ ì°ì„ ì¹´ë©”ë¼ë„ í• ë‹¹í•´ì£¼ì–´ì•¼ í•˜ëŠ”ë°, RenderMode, Camera ë‘˜ ë‹¤ ì½”ë“œë¡œ ë¡œë“œí•´ì¤„ ê²ƒì´ë‹¤.
- `HPBar` ìŠ¬ë¼ì´ë”

ì´ì œ ìº”ë²„ìŠ¤ëŠ” ê²Œì„ ì›”ë“œ ê¸°ì¤€ ì¢Œí‘œë¥¼ ê°€ì§€ë¯€ë¡œ ìº”ë²„ìŠ¤ì™€ ìŠ¬ë¼ì´ë”ì˜ ìœ„ì¹˜ì™€ í¬ê¸°ë¥¼ ì˜ ë§ì¶°ì£¼ê³  ìµœì¢…ì ìœ¼ë¡œ `UI_HPBar` ìº”ë²„ìŠ¤ë¥¼ í”„ë¦¬íŒ¹ìœ¼ë¡œ ë§Œë“¤ì–´ì¤€ë‹¤. ê²Œì„ì´ ì‹œì‘ë˜ë©´ ëª¬ìŠ¤í„°ì™€ í”Œë ˆì´ì–´ì˜ ì‚°í•˜ ìì‹ìœ¼ë¡œ Instantiate ì‹œì¼œì£¼ì–´ ëª¬ìŠ¤í„°ì™€ í”Œë ˆì´ì–´ë¥¼ ë”°ë¼ë‹¤ë‹ˆê²Œ í•  ê²ƒì´ë‹¤.

<br>

## ğŸš€ ê³µê²©ì‹œ ì²´ë ¥ ê¹ê¸°

### âœˆ ë¡œë“œí•˜ê¸° 

#### ğŸ“œUI_HPBar

```c#
public class UI_HPBar : UI_Base
{
    enum GameObjects
    {
        HPBar
    }

    Stat _stat;
    public override void Init()
    {
        Bind<GameObject>(typeof(GameObjects));
        _stat = transform.parent.GetComponent<Stat>();
    }

    void Start()
    {
        Init();
    }
```

- ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ğŸ“œUIMangerì˜ *MakeWorldSpace* í•¨ìˆ˜ë¥¼ í†µí•´ `UP_HPBar` ìº”ë²„ìŠ¤ì— ë¶™ì„ ì˜ˆì •
- *Bind*ë¥¼ í†µí•´ `UP_HPBar`ì˜ ìì‹ì¸ `HPBar` ì˜¤ë¸Œì íŠ¸(ìŠ¬ë¼ì´ë”)ê°€ ìºì‹± ëœë‹¤. 
- í”Œë ˆì´ì–´ì˜ ìŠ¤íƒ¯ì„ ìŠ¬ë¼ì´ë”ì— ì ìš©ì‹œí‚¬ ìˆ˜ ìˆë„ë¡ ğŸ“œStat ë¡œë”©


<br>


#### ğŸ“œUIManager

```c#
    public T MakeWorldSpace<T>(Transform parent = null, string name = null) where T : UI_Base
    {
        if (string.IsNullOrEmpty(name))
            name = typeof(T).Name;

        GameObject go = Managers.Resource.Instantiate($"UI/WorldSpace/{name}");
        if (parent != null)
            go.transform.SetParent(parent);

        Canvas canvas = go.GetComponent<Canvas>();
        canvas.renderMode = RenderMode.WorldSpace;
        canvas.worldCamera = Camera.main;

        return Util.GetOrAddComponent<T>(go);
    }
```

- *MakeWorldSpace*
  - ğŸ“‚UI/WorldSpace ì— ìˆëŠ” ìº”ë²„ìŠ¤ í”„ë¦¬íŒ¹ì„ ë¡œë“œí•˜ì—¬ `parent` ì‚°í•˜ì— ë¶™ì—¬ì£¼ëŠ” í•¨ìˆ˜
  - WorldSpace ëª¨ë“œì˜ ìº”ë²„ìŠ¤ë§Œ ë¶™ì¼ ê²ƒì´ë‹¤.
  - ìº”ë²„ìŠ¤ ì„¤ì •
    - ë¡œë“œí•œ ìº”ë²„ìŠ¤ í”„ë¦¬íŒ¹ì˜ ë Œë”ëŸ¬ ëª¨ë“œëŠ” WorldSpaceë¡œ, ì¹´ë©”ë¼ëŠ” ë©”ì¸ ì¹´ë©”ë¼ë¡œ ì„¤ì •
  - `go`ì—ê²Œ `T`ë¥¼ ë¶™ì¸ë‹¤.
    - ì¦‰, ìº”ë²„ìŠ¤ í”„ë¦¬íŒ¹ì— ì›í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¶™ì¼ ê²ƒ.


<br>

#### ğŸ“œPlayerController

```c#
	void Start()
    {
		//...

		Managers.UI.MakeWorldSpace<UI_HPBar>(transform);
	}
```

`transform`(í”Œë ˆì´ì–´ ë³¸ì¸)ì˜ ìì‹ìœ¼ë¡œ `UI_HPBar` í”„ë¦¬íŒ¹ì„ ë¡œë“œí•œë‹¤. ê·¸ë¦¬ê³  ğŸ“œUI_HPBar ë¥¼ ë¶™ì—¬ì¤€ë‹¤.

![image](https://user-images.githubusercontent.com/42318591/104452663-a7bdb980-55e6-11eb-8c31-71c3cc9f7871.png)

ê²Œì„ì´ ì‹œì‘ë˜ë©´ ìë™ìœ¼ë¡œ ì´ë ‡ê²Œ `unityChan`ì— ìŠ¤í¬ë¦½íŠ¸ê°€ ë¶™ê³  ì €ë ‡ê²Œ ìº”ë²„ìŠ¤ ì„¤ì •ë„ ì™„ë£Œë  ê²ƒì´ë‹¤. 

<br>

### âœˆ ì²´ë ¥ ê²Œì´ì§€ì— ê¹ì¸ ì²´ë ¥ ë°˜ì˜í•œë‹¤ (+ ë¹Œë³´ë“œ)

#### ğŸ“œUI_HPBar

```c#
    void Update()
    {
        Transform parent = transform.parent;  
        transform.position = parent.position + Vector3.up * (parent.GetComponent<Collider>().bounds.size.y);
        transform.rotation = Camera.main.transform.rotation;  // ë¹Œë³´ë“œ

        float ratio = _stat.Hp / (float)_stat.MaxHp;
        SetHpRatio(ratio);  // ìŠ¬ë¼ì´ë” ê°’ ë§¤ í”„ë ˆì„ë§ˆë‹¤ ê°±ì‹ 
    }

    public void SetHpRatio(float ratio)
    {
        GetObject((int)GameObjects.HPBar).GetComponent<Slider>().value = ratio;
    }
```

- `parent`ëŠ” ì´ ğŸ“œUI_HPBarê°€ ë¶™ëŠ” `UI_HPBar`ì˜ ë¶€ëª¨ì¸ í”Œë ˆì´ì–´ê°€ ëœë‹¤. `transform`ì€ `UI_HPBar`
- `UI_HPBar`ì˜ ìœ„ì¹˜ëŠ” ë¶€ëª¨ì¸ í”Œë ˆì´ì–´ì˜ ë¨¸ë¦¬ ìœ„ì— ìˆë„ë¡ í”Œë ˆì´ì–´ì˜ Collider ê²½ê³„ì˜ ìƒë‹¨ì— ìœ„ì‹œì¹˜í‚¤ë„ë¡ í•œë‹¤. 
- `UI_HPBar`ëŠ” íšŒì „í•˜ë©´ ì•ˆëœë‹¤. `UI_HPBar`ë„ WorldSpaceë¡œì„œ 3D ì˜¤ë¸Œì íŠ¸ ì·¨ê¸‰ì„ ë°›ëŠ” ìº”ë²„ìŠ¤ì´ë¯€ë¡œ í”Œë ˆì´ì–´ì˜ ë¨¸ë¦¬ ìœ„ì— ìˆë‹¤ë³´ë©´ í”Œë ˆì´ì–´ ë”°ë¼ ê°™ì´ íšŒì „í•  ìˆ˜ ìˆë‹¤. <u>ë”°ë¼ì„œ ì¹´ë©”ë¼ì˜ íšŒì „ê°’ê³¼ ë™ì¼í•˜ê²Œ í•´ì£¼ì–´ ì˜¤ë¡œì§€ ì¹´ë©”ë¼ë§Œ ê³ ì •ì ìœ¼ë¡œ ë°”ë¼ë³´ë„ë¡ ê³„ì†í•´ì„œ íšŒì „ì‹œì¼œì•¼ í•œë‹¤. ì¦‰, ë¶€ëª¨ì¸ í”Œë ˆì´ì–´ì˜ íšŒì „ê°’ì„ ë”°ë¼ê°€ëŠ”ê²Œ ì•„ë‹ˆë¼, ì¹´ë©”ë¼ë¥¼ ê³ ì •ì ìœ¼ë¡œ ë°”ë¼ë³´ë„ë¡ ê³„ì† íšŒì „ì‹œí‚´.</u> ğŸ‘‰ ì´ê²Œ **ë¹Œë³´ë“œ**ì˜ ê°œë…ì´ë‹¤.
  - `ë¹Œë³´ë“œ`ë€ ì¹´ë©”ë¼ê°€ ì–´ëŠ ë°©í–¥ì„ ë³´ê³  ìˆë˜ê°„ì— ì •ë©´ì´ ëŠ˜ ì¹´ë©”ë¼ë¥¼ í–¥í•˜ë„ë¡ í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤. 
    ```c#
    transform.rotation = Camera.main.transform.rotation;
    ```

<br>

#### ğŸ“œPlayerController

```c#
	void OnHitEvent()
	{
		if (_lockTarget != null)
        {
			Stat targetStat = _lockTarget.GetComponent<Stat>();
			PlayerStat myStat = gameObject.GetComponent<PlayerStat>();
			int damage = Mathf.Max(0, myStat.Attack - targetStat.Defense); // ìŒìˆ˜ë˜ë©´ 0 ì´ ë˜ê²Œë”
			targetStat.Hp -= damage;
		}

		if (_stopSkill)
		{
			State = PlayerState.Idle;
		}
		else
		{
			State = PlayerState.Skill;
		}
	}
```

ê³µê²© ì• ë‹ˆë©”ì´ì…˜ ë•Œë¦¬ëŠ” íƒ€ì´ë°ì— *OnHitEvent* ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ê²Œ í•œë‹¤. ì´ ë•Œ ê³µê²©í•  ëŒ€ìƒì¸ `_lockTarget` ì˜¤ë¸Œì íŠ¸ì—ì„œ ğŸ“œStat ì„ ê°€ì ¸ì™€ ìƒëŒ€ë°©ì˜ ì²´ë ¥ì„ ê³µê²©ë ¥ë§Œí¼ ê¹ëŠ”ë‹¤.


***
<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}