---
title:  "Chapter 13-5. ë¯¸ë‹ˆ RPG : íƒ€ê²ŸíŒ… ë½ì˜¨" 

categories:
  -  Unity Lesson 2
tags:
  - [Game Engine, Unity]

toc: true
toc_sticky: true

date: 2021-01-11
last_modified_at: 2021-01-11
---

ì¸í”„ëŸ°ì— ìˆëŠ” Rookissë‹˜ì˜ **[C#ê³¼ ìœ ë‹ˆí‹°ë¡œ ë§Œë“œëŠ” MMORPG ê²Œì„ ê°œë°œ ì‹œë¦¬ì¦ˆ] Part3: ìœ ë‹ˆí‹° ì—”ì§„** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤. ğŸ˜€  
[ğŸŒœ ê°•ì˜ ë“¤ìœ¼ëŸ¬ ê°€ê¸° Click](https://www.inflearn.com/course/MMORPG-ìœ ë‹ˆí‹°)
{: .notice--warning}


# Chapter 13. ë¯¸ë‹ˆ RPG ë§Œë“¤ê¸°

## ğŸš€ íƒ€ê²ŸíŒ… ë½ì˜¨

`Cursor.Auto`ë¡œ í•˜ë©´ ë…¹í™”ì— ì»¤ì„œê°€ ì•ˆì¡í˜€ì„œ `Cursor.ForceSoftware`ë¡œ ì ì‹œ ë°”ê¾¸ê³  ë…¹í™”í–ˆë”ë‹ˆ ì»¤ì„œê°€ ì§± í¬ë‹¤..

![image](https://camo.githubusercontent.com/5a020b406068fc8d1e63712847622ac6eef8c517f0db33051778d0f5f423530b/68747470733a2f2f706f737466696c65732e707374617469632e6e65742f4d6a41794d5441784d544a664e5459672f4d4441784e6a45774d7a63334f5441314e7a55302e71426e7a79454b395865635946347158786d6b655271517363566f42484b636c623379466c51665f434e45672e6c427179794e57306746444a363032546c4f353975326c4e62546b56524c426b786a4b47446771584a3545672e4749462e736f6879756e655f616e2f637572332e6769663f747970653d77373733)

ëª©ì ì§€ê°€ ë•…ìœ¼ë¡œ ì°í˜€ìˆë˜ ìƒíƒœë¼ë©´ ë§ˆìš°ìŠ¤ë¥¼ ê¾¹ ëˆ„ë¥´ê³  ìˆëŠ” ìƒíƒœì—ì„œ ë§ˆìš°ìŠ¤ë¥¼ ì›€ì§ì´ë©´ í”Œë ˆì´ì–´ê°€ ê·¸ ì»¤ì„œì˜ ë°©í–¥ìœ¼ë¡œ ë”°ë¼ì„œ ê³„ì† ì´ë™í•œë‹¤. 

![image](https://camo.githubusercontent.com/3315780b291ffe9ba244cb2276cdfded3b304f211ee7a4add01c99dc3f2744ce/68747470733a2f2f706f737466696c65732e707374617469632e6e65742f4d6a41794d5441784d544a664d6a6b782f4d4441784e6a45774d7a63334e444d354d6a49792e577869584f3942613046744b443755506a434968547349795f4c4f6336725f69472d6e4165383077674959672e47754b6459416476786633454a754a725647376f6b58725f745f397949326632353633425f366f537a4638672e4749462e736f6879756e655f616e2f637572322e6769663f747970653d77373733)

ê·¸ëŸ¬ë‚˜ ëª©ì ì§€ê°€ ë³´ìŠ¤ë¡œ ì°í˜€ìˆëŠ ìƒíƒœë¼ë©´ ë§ˆìš°ìŠ¤ë¥¼ ëˆ„ë¥´ê³  ë§ˆìš°ìŠ¤ë¥¼ ì›€ì§ì—¬ë„ í”Œë ˆì´ì–´ëŠ” ì´ì— ë°˜ì‘í•˜ì§€ ì•Šê³  ë³´ìŠ¤ë¡œ ë‹¬ë ¤ê°„ë‹¤.

ë§ˆìš°ìŠ¤ë¥¼ ì•ˆ ëˆ„ë¥´ê³  ìˆë˜ ìƒíƒœì—ì„œ ì²˜ìŒ ëˆ„ë¥¸(`PointDown`) ê³³ì´ ëª©ì ì§€ê°€ ëœë‹¤ëŠ” ì‚¬ì‹¤.

<br>

### ğŸ“œDefine

```c#
    public enum MouseEvent
    {
        Press,
        PointerDown,  // ë§ˆìš°ìŠ¤ ë—€ ìƒíƒœì—ì„œ ì²˜ìŒ ëˆŒë €ì„ ë•Œ
        PointerUp,  // ë§ˆìš°ìŠ¤ ëˆ„ë¥´ê³  ìˆë˜ ìƒíƒœì—ì„œ ì²˜ìŒ ë—ì„ ë•Œ
        Click,
    }
```

- `Press` : ëˆ„ë¥´ëŠ” ë™ì•ˆ
- `PointerDown` : ì•ˆ ëˆ„ë¥´ê³  ìˆë˜ ìƒíƒœì—ì„œ ì²˜ìŒìœ¼ë¡œ ëˆŒë €ì„ ë•Œ
- `PointerUp` : 0.2ì´ˆ ì´ìƒ ê¾¹ ëˆ„ë¥´ê³  ìˆë˜ ìƒíƒœì—ì„œ ì²˜ìŒìœ¼ë¡œ ë—ì„ ë•Œ
  - ê½¤ ëˆ„ë¥´ê³  ìˆë‹¤ê°€ ë—ì„ ë•Œ
- `Click` : 0.2ì´ˆ ì´í•˜ë¡œ ëˆ„ë¥´ê³  ìˆë˜ ìƒíƒœì—ì„œ ì²˜ìŒìœ¼ë¡œ ë—ì„ ë•Œ
  - ë§ ê·¸ëŒ€ë¡œ í´ë¦­ ìˆ˜ì¤€. ì°°ë‚˜ë§Œ ëˆ„ë¥´ê³  ë—ì„ ë–„

<br>

### ğŸ“œInputManager

```c#
public class InputManager
{
    public Action KeyAction = null;
    public Action<Define.MouseEvent> MouseAction = null;

    bool _pressed = false;
    float _pressedTime = 0;

    public void OnUpdate()
    {
        if (EventSystem.current.IsPointerOverGameObject())
            return;

        if (Input.anyKey && KeyAction != null)
				KeyAction.Invoke();

        if (MouseAction != null)
        {
            if (Input.GetMouseButton(0)) // PointerDown -> Press
            {
                if (!_pressed) // í•œë²ˆë„ ëˆŒë €ë˜ì ì´ ì—†ì—ˆëŠ”ë° í´ë¦­ ë“¤ì–´ì˜¨ê±°ë©´ 
                {
                    MouseAction.Invoke(Define.MouseEvent.PointerDown);
                    _pressedTime = Time.time; // start ì´í›„ ê²½ê³¼ ì‹œê°„ (êµ¬ë¶„ë§Œ í•  ìˆ˜ ìˆìœ¼ë©´ ë¨)
                }
                MouseAction.Invoke(Define.MouseEvent.Press); // ë¹„íš¨ìœ¨ì ì¼ ìˆ˜ ìˆìŒ(ì´ë²¤íŠ¸ ë°œìƒ)
                _pressed = true;
            }
            else // Click(ê¸ˆë°© ë—ì„ ë•Œ) -> PointerUp(ì¢€ ì˜¤ë˜ ëˆŒë ¤ìˆë‹¤ê°€ ë—ì„ ë•Œ)
            {
                if (_pressed)  // í´ë¦­ ì´ë²¤íŠ¸ëŠ” ì•ˆë“¤ì–´ì™”ëŠ”ë° ëˆŒë¦° ìƒíƒœì˜€ì—ˆë‹¤ë©´
                {
                    if (Time.time < _pressedTime + 0.2f) // 0.2ì´ˆ ë‚´ì— ë—ì„ë•Œ
                        MouseAction.Invoke(Define.MouseEvent.Click);
                    MouseAction.Invoke(Define.MouseEvent.PointerUp);
                }
                _pressed = false;
                _pressedTime = 0;
            }
        }
    }
```

- `MouseAction` : *Define.MouseEvent* ì„ ì¸ìˆ˜ë¡œ ë°›ëŠ” í•¨ìˆ˜ë§Œ ë“±ë¡ ê°€ëŠ¥í•œ ì•¡ì…˜. ğŸ“œPlayerControllerì—ì„œ ì´ ì¸ìˆ˜ê°€ ë¬´ì—‡ì¸ì§€ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë™ì‘í•˜ë„ë¡ í•  ê²ƒ.
- `_pressedTime` : Click ê³¼ PointerUp ì„ êµ¬ë¶„í•˜ê¸° ìœ„í•´ ëˆ„ë¥´ëŠ” ì‹œê°„ì„ ìƒ ê²ƒì´ë‹¤. 0.2 ì´ˆ ì´í•˜ë¡œ ëˆ„ë¥´ë©´ Click, 0.2 ì´ˆ ì´ìƒìœ¼ë¡œ ëˆ„ë¥´ë©´ PointerUp ë¡œ ì¸ì‹ë˜ê²Œë”.
- ë§ˆìš°ìŠ¤ í´ë¦­ ë°œìƒ â­• *if (Input.GetMouseButton(0))*
  - *if (!_pressed)* ğŸ‘‰ í•œë²ˆë„ ëˆŒë €ë˜ì ì´ ì—†ì—ˆëŠ”ë° í´ë¦­ ë“¤ì–´ì˜¨ê±°ë©´ `PointerDown`
    - ì´ì œë¶€í„° ëˆ„ë¥´ëŠ” ë™ì•ˆì˜ ì‹œê°„ì¸ `_pressedTime` íƒ€ì´ë°ì„ ì‹œì‘í•´ì•¼ í•œë‹¤. `Time.time`ì€ Start() í•¨ìˆ˜ ì‹œì‘ í›„ ì‹¤í–‰ ì‹œê°„ì´ë‹¤. í˜„ì¬ í”Œë ˆì´í•œ ì´ˆ ë‹¨ìœ„ì˜ ì‹œê°„ì´ë¼ê³  ìƒê°í•˜ë©´ ë  ê²ƒ ê°™ë‹¤. *Time.time < _pressedTime + 0.2f* ë¡œ 0.2ì´ˆ ì´ìƒ ëˆŒë €ëŠ”ì§€ ì•„ë‹Œì§€ë¥¼ ë¹„êµí•˜ëŠ”ë° ì“¸ê±°ë¼ Time.time ì´ìš©í•œ ê²ƒì´ë‹¤.
- ë§ˆìš°ìŠ¤ í´ë¦­ ë°œìƒ âŒ
  - *if (_pressed)* ğŸ‘‰ ë°©ê¸ˆê¹Œì§€ ëˆ„ë¥´ê³  ìˆë” ìƒíƒœì˜€ë‹¤ë©´
    - ëˆ„ë¥¸ì§€ 0.2ì´ˆ ì´ë‚´ `Click`
    - ëˆ„ë¥¸ì§€ 0.2ì´ˆ ì´ìƒ `PointerUp`
    - `_pressed`ì™€ `_pressedTime` ë¦¬ì…‹

ëˆ„ë¥´ëŠ” ë™ì•ˆì—” *MouseAction.Invoke(Define.MouseEvent.Press);* ë¡œ ì¸í•´ ë§¤ í”„ë ˆì„ë§ˆë‹¤ ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆìœ¼ë‹ˆ ì„±ëŠ¥ìƒ ë¹„íš¨ìœ¨ì ì¼ ìˆ˜ë„ ìˆë‹¤. Updateë¬¸ì—ì„œ *Input.GetMouseButton*

<br>

### ğŸ“œPlayerController

```c#
	void UpdateMoving()
	{
		// ...
			if (Physics.Raycast(transform.position + Vector3.up * 0.5f, dir, 1.0f, LayerMask.GetMask("Block")))
			{
				if (Input.GetMouseButton(0) == false) //
					State = PlayerState.Idle;
				return;
			}
		}
	}
```

ë§ˆìš°ìŠ¤ë¥¼ ê¾¹ ëˆ„ë¥´ê³  ìˆëŠ” ìƒíƒœë©´ (ê·¸ëŸ¬ë‹ˆê¹Œ *Input.GetMouseButton(0)*ê°€ `true` ì´ë©´) ì»¤ì„œê°€ "Block"ì— ìˆë”ë¼ë„ ë‹¬ë¦¬ëŠ” ìƒíƒœë¥¼ ìœ ì§€í•˜ë„ë¡ í•œë‹¤.

```c#

    int _mask = (1 << (int)Define.Layer.Ground) | (1 << (int)Define.Layer.Monster);

    GameObject _lockTarget;

	void OnMouseEvent(Define.MouseEvent evt)
	{
		switch (State)
		{
			case PlayerState.Idle:
				OnMouseEvent_IdleRun(evt);
				break;
			case PlayerState.Moving:
				OnMouseEvent_IdleRun(evt);
				break;
			case PlayerState.Skill:
				{
					if (evt == Define.MouseEvent.PointerUp)
						_stopSkill = true;
				}
				break;
		}
	}

	void OnMouseEvent_IdleRun(Define.MouseEvent evt)
	{
		RaycastHit hit;
		Ray ray = Camera.main.ScreenPointToRay(Input.mousePosition);
		bool raycastHit = Physics.Raycast(ray, out hit, 100.0f, _mask);

		switch (evt)
		{
			case Define.MouseEvent.PointerDown: // ì²˜ìŒìœ¼ë¡œ ëˆ„ë¥¸ ìˆœê°„
				{
					if (raycastHit)
					{
						// ëª¬ìŠ¤í„° í´ë¦­í–ˆë“  ì•„ë‹ˆë“  í´ë¦­í•œ ê³³ìœ¼ë¡œ ì´ë™ì€ í•´ì•¼.
						_destPos = hit.point;
						State = PlayerState.Moving;

						if (hit.collider.gameObject.layer == (int)Define.Layer.Monster) // ëª¬ìŠ¤í„° íƒ€ê²Ÿ
							_lockTarget = hit.collider.gameObject; // ëª¬ìŠ¤í„° ì €ì¥
						else  // ëª¬ìŠ¤í„° íƒ€ê²Ÿì´ ì•„ë‹ ë•Œ
							_lockTarget = null;
					}
				}
				break;
			case Define.MouseEvent.Press:  // ëˆ„ë¥´ëŠ” ë™ì•ˆ
				{
					if (_lockTarget != null)
						_destPos = _lockTarget.transform.position; // ëˆ„ë¥´ëŠ” ë™ì•ˆì—ë„ ëª¬ìŠ¤í„°ë¥¼ ë”°ë¼ê°€ì•¼
                    else if (raycastHit)
                        _destPos = hit.point;  // ëˆ„ë¥´ëŠ” ìª½ìœ¼ë¡œ!
				}
				break;
		}
	}
```

- `PointerDown`ì¼ ë•Œ (ì²˜ìŒ ëˆ„ë¥¸ ìˆœê°„)
  - *if (raycastHit)* ëª¬ìŠ¤í„° í˜¹ì€ ë•…ì— í™”ë©´í´ë¦­ Raycast ê°€ ì¶©ëŒí–ˆì„ ë•Œ
    - í´ë¦­í•œ ê³³ìœ¼ë¡œ ì´ë™í•´ì•¼ í•œë‹¤. `_destPos`, `State` ì—…ë°ì´íŠ¸
      - ëª¬ìŠ¤í„°ë¥¼ í´ë¦­í–ˆì„ ë•Œ
        - `_lockTarget`ì— ëª¬ìŠ¤í„° ì˜¤ë¸Œì íŠ¸ ì €ì¥ 
      - ë•… í´ë¦­í–ˆì„ ë•Œ
        - `_lockTarget` null
- `Press`ì¼ ë•Œ (ëˆ„ë¥´ëŠ” ë™ì•ˆ)
  - ëª¬ìŠ¤í„° íƒ€ê²Ÿì¸ ìƒíƒœë¼ë©´ *if (_lockTarget != null)*
    - ëˆ„ë¥´ê³  ìˆëŠ” ë™ì•ˆì—ë„ ëª¬ìŠ¤í„°ë¥¼ í–¥í•´ ê°€ì•¼í•œë‹¤. (ìœ„ gif ì°¸ê³ )
  - ë•… íƒ€ê²Ÿì¸ ìƒíƒœë¼ë©´
    - ëˆ„ë¥´ê³  ìˆëŠ” ë™ì•ˆì´ë”ë¼ë„ ì»¤ì„œê°€ í–¥í•˜ëŠ” ê³³ìœ¼ë¡œ ê°€ì•¼ í•œë‹¤.



***
<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}