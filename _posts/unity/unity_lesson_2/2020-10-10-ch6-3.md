---
title:  "Chapter 6-3. ì• ë‹ˆë©”ì´ì…˜ : State íŒ¨í„´" 

categories:
  -  Unity Lesson 2
tags:
  - [Game Engine, Unity]

toc: true
toc_sticky: true

date: 2020-10-10
last_modified_at: 2020-10-10
---

ì¸í”„ëŸ°ì— ìˆëŠ” Rookissë‹˜ì˜ **[C#ê³¼ ìœ ë‹ˆí‹°ë¡œ ë§Œë“œëŠ” MMORPG ê²Œì„ ê°œë°œ ì‹œë¦¬ì¦ˆ] Part3: ìœ ë‹ˆí‹° ì—”ì§„** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤. ğŸ˜€  
[ğŸŒœ ê°•ì˜ ë“¤ìœ¼ëŸ¬ ê°€ê¸° Click](https://www.inflearn.com/course/MMORPG-ìœ ë‹ˆí‹°)
{: .notice--warning}

# Chapter 6. ì• ë‹ˆë©”ì´í„°
 
## ğŸš– State ë””ìì¸ íŒ¨í„´


```c#
bool isFalling;
bool isJumping;
bool isSkillCasting;
bool isSkillChanneling;

if(isJumping)
{

}
else
{
    if(isSkillChanneling && isFalling)
    {

    }
    else
    {
        if(isSkillCasting)
        {

        }
    }
}
```

ì´ëŸ°ì‹ìœ¼ë¡œ `bool`íƒ€ì…ì˜ ìƒíƒœ flag ë³€ìˆ˜ë¥¼ ì—¬ëŸ¬ê°œ ì‚¬ìš©í•˜ë©´ ë„ˆë¬´ ë³µì¡í•˜ë‹¤. `if - else`ë¬¸ì´ ë„ˆë¬´ ë§ì•„ì§„ë‹¤. ìƒíƒœ flag ë³€ìˆ˜ê°€ ì ì€ ê°¯ìˆ˜ë¼ë©´ ê´œì°®ì§€ë§Œ ê·œëª¨ê°€ í° ê²Œì„ì¼ ìˆ˜ë¡ ë§ì´ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— ì í•©í•˜ì§€ ì•Šë‹¤. 

> í•´ê²° ë°©ë²• ğŸ‘‰ **State íŒ¨í„´ ì‚¬ìš©í•˜ê¸°!**

<br>

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class PlayerController : MonoBehaviour
{
    float wait_run_ratio = 0;

    [SerializeField]
    float _speed = 10.0f;

    Vector3 _destPos;  // ëª©ì ì§€

    void Start()
    {
        Managers.Input.MouseAction -= OnMouseClicked;
        Managers.Input.MouseAction += OnMouseClicked;
    }

    public enum PlayerState
    {
        Die,
        Moving,
        Idle,
    }

    PlayerState _state = PlayerState.Idle;

    void Update()
    {
        switch (_state)
        {
            case PlayerState.Die:
                UpdateDie();
                break;
            case PlayerState.Moving:
                UpdateMoving();
                break;
            case PlayerState.Idle:
                UpdateIdle();
                break;
        }
    }

    void UpdateDie()
    {
        // ì•„ë¬´ê²ƒë„ ëª»í•¨
    }

    void UpdateMoving()
    {
        Vector3 dir = _destPos - transform.position;
        if (dir.magnitude < 0.0001f)  // ë„ì°©í•¨
        {
            _state = PlayerState.Idle;
        }
        else   // ë„ì°© X 
        {
            float moveDist = Mathf.Clamp(_speed * Time.deltaTime, 0, dir.magnitude);
            transform.position = transform.position + dir.normalized * moveDist;

            transform.rotation = Quaternion.Slerp(transform.rotation, Quaternion.LookRotation(dir), 10 * Time.deltaTime);
            transform.LookAt(_destPos);
        }

        // ì• ë‹ˆë©”ì´ì…˜
        wait_run_ratio = Mathf.Lerp(wait_run_ratio, 1, 10.0f * Time.deltaTime);
        Animator anim = GetComponent<Animator>();
        anim.SetFloat("wait_run_ratio", wait_run_ratio);
        anim.Play("WAIT_RUN");
    }

    void UpdateIdle()
    {
        // ì• ë‹ˆë©”ì´ì…˜
        wait_run_ratio = Mathf.Lerp(wait_run_ratio, 0, 10.0f * Time.deltaTime);
        Animator anim = GetComponent<Animator>();
        anim.SetFloat("wait_run_ratio", wait_run_ratio);
        anim.Play("WAIT_RUN");
    }

    void OnMouseClicked(Define.MouseEvent evt)
    {
        if (_state == PlayerState.Die)
            return;

        if (evt != Define.MouseEvent.Click)
            return;

        Ray ray = Camera.main.ScreenPointToRay(Input.mousePosition); 
        Debug.DrawRay(Camera.main.transform.position, ray.direction * 100.0f, Color.red, 1.0f);

        RaycastHit hit;
        if (Physics.Raycast(ray, out hit, 100.0f, LayerMask.GetMask("Wall")))
        {
            _destPos = hit.point;
            _state = PlayerState.Moving;
        }
    }
}

```
```c#
if (_state == PlayerState.Die)

//...

        switch (_state)
        {
            case PlayerState.Die:
                UpdateDie();
                break;
            case PlayerState.Moving:
                UpdateMoving();
                break;
            case PlayerState.Idle:
                UpdateIdle();
                break;
        }
```

> `enum`ìœ¼ë¡œ ìƒíƒœë“¤ì„ ì •ì˜í•˜ê³ , `if-else`ë¬¸ í˜¹ì€ `switch`ë¬¸ ì‚¬ìš©í•˜ê¸°! 

- ëŒ€ì‹  `bool` ìƒíƒœ í”Œë˜ê·¸ ë³€ìˆ˜ì™€ëŠ” ë‹¤ë¥´ê²Œ <u>ë™ì‹œì— ë‘ê°€ì§€ ìƒíƒœë¥¼ ê°€ì§ˆ ìˆœ ì—†ìŒ.</u> ğŸ‘‰ ì´ì™€ ê°™ì€ íŠ¹ì„± ë•Œë¬¸ì— ì—¬ëŸ¬ ë™ì‘ì´ ê¼¬ì¼ ì¼ì´ ì—†ìŒ. ë™ì‘ ë³„ë¡œ ë¶„ë¦¬í•´ì„œ ë§Œë“¤ ìˆ˜ ìˆë‹¤ëŠ” ì¥ì .
  ```c#
  isJumping && isAttacking  // ğŸ‘‰ ê°€ëŠ¥

  _state == PlayerState.Jump && _state == PlayerState.Attack  // ğŸ‘‰ ë¶ˆê°€ëŠ¥
  ```


***
<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}