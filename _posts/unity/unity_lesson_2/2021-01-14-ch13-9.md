---
title:  "Chapter 13-9. ë¯¸ë‹ˆ RPG : Destroy" 

categories:
  -  Unity Lesson 2
tags:
  - [Game Engine, Unity]

toc: true
toc_sticky: true

date: 2021-01-14
last_modified_at: 2021-01-14
---

ì¸í”„ëŸ°ì— ìˆëŠ” Rookissë‹˜ì˜ **[C#ê³¼ ìœ ë‹ˆí‹°ë¡œ ë§Œë“œëŠ” MMORPG ê²Œì„ ê°œë°œ ì‹œë¦¬ì¦ˆ] Part3: ìœ ë‹ˆí‹° ì—”ì§„** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤. ğŸ˜€  
[ğŸŒœ ê°•ì˜ ë“¤ìœ¼ëŸ¬ ê°€ê¸° Click](https://www.inflearn.com/course/MMORPG-ìœ ë‹ˆí‹°)
{: .notice--warning}


# Chapter 13. ë¯¸ë‹ˆ RPG ë§Œë“¤ê¸°

## ğŸš€ Destroy

- ì˜¤ë¸Œì íŠ¸ê°€ Destroy ë  ë•Œ 
  - ì˜¤ë¸Œì íŠ¸ê°€ ë©”ëª¨ë¦¬ í•´ì œë˜ë©´ ìœ ë‹ˆí‹°ì˜ `Object`ì˜ `==` ì—°ì‚°ì ì˜¤ë²„ë¡œë”©ìœ¼ë¡œ ì¸í•˜ì—¬ í•´ì œëœ ê°ì²´ë¥¼ `== null` ë¹„êµ ì—°ì‚°í•  ë• ê·¸ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ëŠ” ì°¸ì¡° ë³€ìˆ˜ë“¤ì€ ëŒ•ê¸€ë§ í¬ì¸í„°ê°€ ë˜ëŠ” ê²ƒì´ ì•„ë‹Œ "null"ì´ ë˜ë„ë¡ ì²˜ë¦¬ëœë‹¤.
  - í•´ì œëœ ì˜¤ë¸Œì íŠ¸ì˜ ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¸ì¡°í•˜ëŠ” ê²ƒë“¤ì„ ì˜ í™•ì¸í•´ì•¼ í•œë‹¤. í¬ëŸ¬ì‰¬ê°€ ë‚ í…Œë‹ˆê¹Œ! ì˜¤ë¸Œì íŠ¸ê°€ í•´ì œë˜ë©´ ë‹¹ì—°íˆ ê·¸ ì˜¤ë¸Œì íŠ¸ì˜ ì»´í¬ë„ŒíŠ¸ë“¤ì—ë„ ì°¸ì¡°í•  ìˆ˜ ì—†ë‹¤.

<br>

### âœˆ í˜•ë³€í™˜ ì—°ì‚° ë¹„ìš© ì¤„ì´ëŠ” ëŒ€ì•ˆ

ğŸ“œGameManager ì—ì„œ ì˜¤ë¸Œì íŠ¸ë“¤ì„ ìŠ¤í°í•˜ê³  ë””ìŠ¤í°í•˜ëŠ” ì‘ì—…ì„ í•  ê²ƒì´ë‹¤. ê·¼ë° ì–´ë–¤ ì˜¤ë¸Œì íŠ¸ë¥¼ ìŠ¤í°í•´ì•¼í•˜ëŠ”ì§€ë¥¼ ì•Œì•„ì•¼ í•œë‹¤. ê·¸ëŸ¬ë©´ ğŸ“œBaseController íƒ€ì…ìœ¼ë¡œ ì—…ìºìŠ¤íŒ…í•´ì„œ ë°›ëŠ” ë°©ë²•ë„ ìˆì„í…Œê³ (ê·¼ë° ì´ëŸ¬ë©´ ìƒì†ì´ ì•„ë‹Œ ìì‹ ë§Œì˜ ê³ ìœ í•œ ë¶€ë¶„ë“¤ì€ í˜¸ì¶œ ëª»í•˜ê² ì§€..?) *GetComponent*ë¡œ ğŸ“œPlayerController í˜¹ì€ ğŸ“œMonsterController ê°€ì ¸ì˜¤ê³  ì´ëŸ° ë°©ë²•ë„ ìˆì„ ê²ƒì´ë‹¤. ê·¼ë° ì´ëŸ° ë°©ë²•ë“¤ì€ ë¹„ì‹¼ ì—°ì‚°ë“¤ì´ë‹¤ë³´ë‹ˆ ê·¸ëƒ¥ ğŸ“œDefine ì— ìŠ¤í°í•  ì˜¤ë¸Œì íŠ¸ë“¤ì„ ì¢…ë¥˜ë³„ë¡œ ì •ë¦¬í•œ `enum`ì„ ì •ì˜í•˜ê³  ì´ë¥¼ ë°›ì•„ì„œ ì–´ë–¤ ì˜¤ë¸Œì íŠ¸ë¥¼ ìŠ¤í°í•´ì•¼ í•˜ëŠ”ì§€ ì•Œë©´ ì„±ëŠ¥ìƒ ë” ì¢‹ì„ ê²ƒì´ë‹¤. ë˜ `enum`ìœ¼ë¡œ ì •ì˜í•˜ë©´ `switch`ë¥¼ ì‚¬ìš©í•˜ê¸°ì—ë„ ì¢‹ë‹¤.


#### ğŸ“œDefine

```c#
public class Define
{
    public enum WorldObject
    {
        Unknown,
        Player,
        Monster,
    }
```

- Define.WorldObject.Player ì´ë©´ í”Œë ˆì´ì–´ ì˜¤ë¸Œì íŠ¸ ìŠ¤í°í•  ê²ƒ
- Define.WorldObject.Monster ì´ë©´ ëª¬ìŠ¤í„° ì˜¤ë¸Œì íŠ¸ ìŠ¤í°í•  ê²ƒ

<br>

#### ğŸ“œBaseController

```c#
public Define.WorldObject WorldObjectType { get; protected set; } = Define.WorldObject.Unknown;
```

ğŸ“œPlayerController,ğŸ“œMonsterControllerì€ `WorldObjectType`ì„ ê°€ì§.

<br>

#### ğŸ“œMonsterController

```c#
    public override void Init()
    {
        WorldObjectType = Define.WorldObject.Monster;
        _stat = gameObject.GetComponent<Stat>();

        if (gameObject.GetComponentInChildren<UI_HPBar>() == null)
            Managers.UI.MakeWorldSpace<UI_HPBar>(transform);
    }
```

*WorldObjectType = Define.WorldObject.Monster;*

<br>

#### ğŸ“œPlayerController

```c#
	public override void Init()
    {
		WorldObjectType = Define.WorldObject.Player;
		_stat = gameObject.GetComponent<PlayerStat>();
```

*WorldObjectType = Define.WorldObject.Player;*

<br>

### âœˆ ìŠ¤í° ë° ë””ìŠ¤í°

#### ğŸ“œGameManager

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class GameManager
{
    // int(ID) <-> GameObject : ê²Œì„ ì˜¤ë¸Œì íŠ¸ë¥¼ IDë¡œ ë“¤ê³  ìˆê¸° 
    // ë”°ë¼ì„œ Dictionaryê°€ ì ë‹¹. ê·¼ë° ì´ê±´ ì˜¨ë¼ì¸ ê²Œì„ì€ ì•„ë‹ˆë‹ˆê¹Œ ì¼ë‹¨ HashSet ì‚¬ìš©(Keyì—†ëŠ” ìë£Œêµ¬ì¡°)
    GameObject _player;
    HashSet<GameObject> _monsters = new HashSet<GameObject>();

    public GameObject GetPlayer() { return _player; } // í”Œë ˆì´ì–´ ë¦¬í„´ í•¨ìˆ˜
```

ìŠ¤í°ëœ ì˜¤ë¸Œì íŠ¸ë“¤ì€ ID ê°™ì€ ê²ƒìœ¼ë¡œ ê´€ë¦¬ë˜ëŠ”ê²Œ ì¢‹ë‹¤. (ì„œë²„ì—ì„œëŠ” ì´ IDë¡œ í†µì‹ í•œë‹¤ê³  í•œë‹¤.) ì´ ì–˜ê¸°ëŠ” ì¦‰ Keyì™€ Valueë¡œ ê´€ë¦¬ê°€ ë˜ì•¼ í•œë‹¤ëŠ” ì˜ë¯¸ì´ë¯€ë¡œ Dictionaryrê°€ ì ë‹¹!

ê·¼ë° ì˜¨ë¼ì¸ ê²Œì„ ë§Œë“œëŠ”ê±´ ì•„ë‹ˆë‹ˆê¹Œ ì‹±ê¸€ ê²Œì„ì—ì„  ë”±íˆ í•„ìš”ëŠ” ì—†ê³  í•´ì„œ `HashSet` ì‚¬ìš©

- ì‹±ê¸€ ê²Œì„ ì´ë¯€ë¡œ í”Œë ˆì´ì–´ëŠ” 1 ëª…
  - í”Œë ˆì´ì–´ ì˜¤ë¸Œì íŠ¸ ğŸ‘‰ 1 ê°œì´ë¯€ë¡œ ê·¸ëƒ¥ `_player`ì—ì„œ ê´€ë¦¬
  - ëª¬ìŠ¤í„° ì˜¤ë¸Œì íŠ¸ë“¤ ğŸ‘‰ `HashSet`ì—ì„œ ê´€ë¦¬
- ***HashSet***
  - ìˆœì„œëŒ€ë¡œ ì €ì¥ë˜ì§€ ì•ŠëŠ”ë‹¤. 
  - ì¤‘ë³µì´ í—ˆìš©ë˜ì§€ ì•ŠëŠ”ë‹¤.


```c#
    public GameObject Spawn(Define.WorldObject type, string path, Transform parent = null)
    {
        GameObject go = Managers.Resource.Instantiate(path, parent);

        switch(type)
        {
            case Define.WorldObject.Monster:
                _monsters.Add(go);
                break;
            case Define.WorldObject.Player:
                _player = go;
                break;
        }

        return go;
    }
```

> ìŠ¤í°í•˜ê¸°

- ì˜¤ë¸Œì íŠ¸ Instantiate
- ğŸ‘‰ `enum`ì´ì—¬ì„œ ê°€ëŠ¥í•œ ì¼
  - ëª¬ìŠ¤í„°ë©´
    - `_monsters` HashSet ì— ì¶”ê°€ ìºì‹±
  - í”Œë ˆì´ì–´ë©´ 
    - `_player`ì— ìºì‹±

```c# 
    // ì˜¤ë¸Œì íŠ¸ì˜ Define.WorldObject ê°’ì„ ì•Œë ¤ì¤Œ
    public Define.WorldObject GetWorldObjectType(GameObject go)
    {
        BaseController bc = go.GetComponent<BaseController>();
        if (bc == null)
            return Define.WorldObject.Unknown;
        return bc.WorldObjectType;
    }

    // ë””ìŠ¤í°
    public void Despawn(GameObject go)
    {
        Define.WorldObject type = GetWorldObjectType(go);

        switch(type)
        {
            case Define.WorldObject.Monster:
                {
                    if (_monsters.Contains(go))
                        _monsters.Remove(go);
                }
                break;
            case Define.WorldObject.Player:
                {
                    if (_player == go)
                        _player = null;
                }     
                break;
        }

        Managers.Resource.Destroy(go);
    }
}
```

- Destroy ì‹œí‚¤ê¸° ì „ì—, ìºì‹±í•´ë†¨ë˜ê±° ì—†ì• ê¸° `null`ì²˜ë¦¬
  - ê·¸ëƒ¥ *Destroy*ê°€ ì•„ë‹ˆë¼ *Managers.Resource.Destroy(go)* ì´ê¸° ë•Œë¬¸ì—! ì˜ˆì „ì— í’€ë§ ë§¤ë‹ˆì € ë•Œ êµ¬í˜„í•´ë†¨ë˜ ì˜¤ë¸Œì íŠ¸ í’€ë§ ì²˜ë¦¬ê°€ ëœë‹¤.
    - í’€ë§ í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ë©´ ì§„ì§œ Destroy ë˜ëŠ”ê²Œ ì•„ë‹Œ ë¹„í™œì„±í™” ë¨! 

<br>

#### ğŸ“œManagers

```c#
GameManager _game = new GameManager();
public static GameManager Game { get { return Instance._game; } }
    
```

<br>

#### ğŸ“œGameScene

```c#
public class GameScene : BaseScene
{
    protected override void Init()
    {
        //...
        GameObject player = Managers.Game.Spawn(Define.WorldObject.Player, "UnityChan");
        Camera.main.gameObject.GetOrAddComponent<CameraController>().SetPlayer(player);
        Managers.Game.Spawn(Define.WorldObject.Monster, "Knight");
    }
```

í”Œë ˆì´ì–´ ìŠ¤í°í•˜ê¸°, ëª¬ìŠ¤í„° ìŠ¤í°í•˜ê¸°

<br>

#### ğŸ“œMonsterController, ğŸ“œPlayerController

```c#
    void OnHitEvent()
    {
        if (_lockTarget != null)
        {
            // ì²´ë ¥
            Stat targetStat = _lockTarget.GetComponent<Stat>();
            int damage = Mathf.Max(0, _stat.Attack - targetStat.Defense);
            targetStat.Hp -= damage;

            if (targetStat.Hp <= 0) 
            {
                Managers.Game.Despawn(targetStat.gameObject);
            }
```

ì²´ë ¥ì´ 0 ì´í•˜ë©´ ë””ìŠ¤í°

<br>

### âœˆ í’€ë§ìœ¼ë¡œ ì¸í•œ ë¹„í™œì„±í™” ê³ ë ¤

#### ğŸ“œExtension

```c#
public static class Extension
{
	public static bool IsValid(this GameObject go)
    {
		return go != null && go.activeSelf;
    }
```

í’€ë§í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ë“¤ë„ ìˆê¸° ë•Œë¬¸ì— `go != null`ë§Œ ì²´í¬í•´ì£¼ë©´ ì•ˆë˜ê³  í™œì„±í™” ìƒíƒœì¸ì§€ë„ ì²´í¬í•´ì£¼ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì´ëŸ° í™•ì¥ë©”ì„œë“œë¥¼ ë§Œë“¤ì—ˆë‹¤.

<br>

#### ğŸ“œCameraController

```c#
public void SetPlayer(GameObject player) { _player = player; }

    void LateUpdate()
    {
        if (_mode == Define.CameraMode.QuarterView)
        {
            if (_player.IsValid() == false) 
                return;
```

`_player != null`ë§Œ í•´ì£¼ë©´ ì•ˆë˜ê³  í™œì„±í™” ìƒíƒœì¸ì§€ë„ ì²´í¬í•´ì•¼í•œë‹¤. í”Œë ˆì´ì–´ ì˜¤ë¸Œì íŠ¸ëŠ” í’€ë§ìœ¼ë¡œ ê´€ë¦¬ë˜ê¸° ë•Œë¬¸!

<br>

### âœˆ Hp ê¹ê¸°

ê³µê²© í•˜ëŠ” ì£¼ì²´ê°€ ì§ì ‘ í”¼í•´ìê°€ ìì‹ ì˜ HPë¥¼ ê¹ëŠ” í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê²Œ í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤. 

- ëª¬ìŠ¤í„°ê°€ í”Œë ˆì´ì–´ ê³µê²©í•  ë•Œ ğŸ‘‰ ëª¬ìŠ¤í„°ì—ì„œ í”Œë ˆì´ì–´ ê°ì²´ë¡œë¶€í„° í”Œë ˆì´ì–´ ë³¸ì¸ì˜ HP ê¹ëŠ” í•¨ìˆ˜ í˜¸ì¶œ
- í”Œë ˆì´ì–´ê°€ ëª¬ìŠ¤í„° ê³µê²©í•  ë•Œ ğŸ‘‰ í”Œë ˆì´ì–´ì—ì„œ ëª¬ìŠ¤í„° ê°ì²´ë¡œë¶€í„° ëª¬ìŠ¤í„° ë³¸ì¸ì˜ HP ê¹ëŠ” í•¨ìˆ˜ í˜¸ì¶œ


#### ğŸ“œStat

```c#
    public virtual void OnAttacked(Stat _attacker)
    {
        int damage = Mathf.Max(0, _attacker.Attack - Defense);
        Hp -= damage;
        if (Hp <= 0)
        {
            Hp = 0;
            OnDead();
        }
    }

    protected virtual void OnDead()
    {
        Managers.Game.Despawn(gameObject);
    }
```

HP ê¹ëŠ” ì²˜ë¦¬ë¥¼ í”Œë ˆì´ì–´ì™€ ëª¬ìŠ¤í„°ì˜ OnHitEvent ì—ì„œ í•˜ì§€ ì•Šê³  ğŸ“œStatì—ì„œ í•´ì£¼ê¸°ë£¨..

<br>

#### ğŸ“œMonsterController, ğŸ“œPlayerController

```c#
	void OnHitEvent()
	{
		if (_lockTarget != null)
        {
			Stat targetStat = _lockTarget.GetComponent<Stat>();
			targetStat.OnAttacked(_stat);
		}
```

`_lockTarget` ìƒëŒ€ë°©ì˜ ğŸ“œStat ì˜ *OnAttacked* í˜¸ì¶œ. ë‚´ê°€ `_stat` ê³µê²© ì£¼ì²´. `targetStat`ì€ í”¼í•´ì.


***
<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}