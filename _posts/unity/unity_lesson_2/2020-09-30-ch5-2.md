---
title:  "Chapter 5-2. ì¹´ë©”ë¼ : í´ë¦­í•œ ê³³ìœ¼ë¡œ í”Œë ˆì´ì–´ì™€ ì¹´ë©”ë¼ê°€ ë”°ë¼ê°€ê²Œ í•˜ê¸°" 

categories:
  -  Unity Lesson 2
tags:
  - [Game Engine, Unity]

toc: true
toc_sticky: true

date: 2020-09-30
last_modified_at: 2020-09-30
---

ì¸í”„ëŸ°ì— ìˆëŠ” Rookissë‹˜ì˜ **[C#ê³¼ ìœ ë‹ˆí‹°ë¡œ ë§Œë“œëŠ” MMORPG ê²Œì„ ê°œë°œ ì‹œë¦¬ì¦ˆ] Part3: ìœ ë‹ˆí‹° ì—”ì§„** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤. ğŸ˜€  
[ğŸŒœ ê°•ì˜ ë“¤ìœ¼ëŸ¬ ê°€ê¸° Click](https://www.inflearn.com/course/MMORPG-ìœ ë‹ˆí‹°)
{: .notice--warning}

# Chapter 5. ì¹´ë©”ë¼

## ğŸš– ë¡¤ì´ë‚˜ ìŠ¤íƒ€ì²˜ëŸ¼ í´ë¦­í•œ ê³³ìœ¼ë¡œ í”Œë ˆì´ì–´ì™€ ì¹´ë©”ë¼ê°€ ë”°ë¼ê°€ê²Œ í•˜ê¸°

ë°”ë‹¥ì— ë§ˆìš°ìŠ¤ë¥¼ í´ë¦­í•˜ë©´ í´ë¦­í•œ ê³³ìœ¼ë¡œ í”Œë ˆì´ì–´ê°€ ìë™ìœ¼ë¡œ, ìŠ¤ìŠ¤ë¡œ ì´ë™í•˜ê²Œ í•œë‹¤. ë¡¤ì´ë‚˜ ìŠ¤íƒ€í¬ë˜í”„íŠ¸ì²˜ëŸ¼.

### ğŸ“œDefine.cs

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class Define 
{
    public enum MouseEvent
    {
        Press,
        Click,
    }

    public enum CameraMode
    {
        QuaterView,
    }
}

```

- ğŸ“œDefine í´ë˜ìŠ¤ì— **MouseEvent** ë¼ëŠ” enum ì„ ì •ì˜í•˜ì˜€ë‹¤. 
  - `Press` ğŸ‘‰ ë§ˆìš°ìŠ¤ë¥¼ í´ë¦­í•˜ëŠ” ë™ì•ˆ ì‚¬ìš©í• 
  - `Click` ğŸ‘‰ ë§ˆìš°ìŠ¤ë¥¼ í´ë¦­ì—ì„œ ì† ë—ì„ ë•Œ ì‚¬ìš©í• 

<br>

### ğŸ“œInputManager.cs

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

using System;

public class InputManager
{
    public Action KeyAction = null;
    public Action<Define.MouseEvent> MouseAction = null;

    bool _pressed = false;

    public void OnUpdate()
    {
        /* Keyboard ì…ë ¥ */
        if (Input.anyKey && KeyAction != null)
            KeyAction.Invoke();

        /* Mouse ì…ë ¥ */
        if (MouseAction != null)
        {
            if (Input.GetMouseButton(0))  // ëˆ„ë¥´ëŠ” ì¤‘
            {
                MouseAction.Invoke(Define.MouseEvent.Press);  // ë§ˆìš°ìŠ¤ë¥¼ ëˆ„ë¥´ê³  ìˆì„ ë• Define.MouseEvent.Press ì„ ì¸ìˆ˜ë¡œ ë„˜ê²¨ ì•¡ì…˜ì— ë“±ë¡ëœ í•¨ìˆ˜ë“¤ ì‹¤í–‰
                _pressed = true;  // ëˆ„ë¥´ëŠ” ì¤‘ì´ì—ˆìŒì„ í‘œì‹œí•˜ëŠ”
            }
            else // ëˆ„ë¥´ëŠ” ì¤‘ ì•„ë‹˜
            { 
                if (_pressed)    // ëˆ„ë¥´ëŠ” ì¤‘ì´ ì•„ë‹Œë° ëˆŒë €ì—ˆë‹¤ë©´ ë—€ ê²ƒ.
                    MouseAction.Invoke(Define.MouseEvent.Click);  // ë§ˆìš°ìŠ¤ë¥¼ ëˆ„ë¥´ë‹¤ ë—ì„ ë• Define.MouseEvent.Click ì„ ì¸ìˆ˜ë¡œ ë„˜ê²¨ ì•¡ì…˜ì— ë“±ë¡ëœ í•¨ìˆ˜ë“¤ ì‹¤í–‰
                _pressed = false;  // ì´ˆê¸°í™”
            }
        }
    }
}
```

- Define.MouseEvent íƒ€ì…ì˜ ì¸ìˆ˜ë§Œ ë°›ëŠ” í•¨ìˆ˜ë“¤ì„ ë“±ë¡í•  ìˆ˜ ìˆëŠ” `MouseAction` ì•¡ì…˜ ì¶”ê°€.
- ë§ˆìš°ìŠ¤ ì…ë ¥ ì²˜ë¦¬
  - ë§ˆìš°ìŠ¤ë¥¼ ëˆ„ë¥´ê³  ìˆì„ ë• ì•¡ì…˜ì— ë“±ë¡ëœ í•¨ìˆ˜ë“¤ì—ê²Œ Define.MouseEvent.Press ì„ ì¸ìˆ˜ë¡œ ë„˜ê²¨ ì‹¤í–‰ 
    - *ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„  ì•„ì§ ì‚¬ìš© X*
  - ë§ˆìš°ìŠ¤ë¥¼ ëˆ„ë¥´ë‹¤ ë—ì„ ë• ì•¡ì…˜ì— ë“±ë¡ëœ í•¨ìˆ˜ë“¤ì—ê²Œ <u>Define.MouseEvent.Click</u> ì„ ì¸ìˆ˜ë¡œ ë„˜ê²¨ ì‹¤í–‰
    - *í´ë¦­í•œ ê³³ìœ¼ë¡œ ìë™ ì´ë™í•˜ê²Œ í•  ê²ƒì´ë¼ì„œ ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„  ì´ ê²ƒë§Œ ì‚¬ìš©í•  ê²ƒ*
- cf) ë§Œì•½ ë§ˆìš°ìŠ¤ ë“œë˜ê·¸í•˜ëŠ” ìƒíƒœë¥¼ ìºì¹˜í•´ë‚´ê³  ì‹¶ë‹¤ë©´ 0.2ì´ˆ ì´ìƒ ëˆ„ë¥´ê³  ìˆì„ ë•ŒëŠ” ë“œë˜ê·¸ ìƒíƒœë¡œ ì •ì˜í•œë‹¤ë˜ê°€ ë“±ë“± ì´ëŸ° ì¡°ê±´ì„ ì¤„ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

<br>

### ğŸ“œPlayerController.cs

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class PlayerController : MonoBehaviour
{
    [SerializeField]
    float _speed = 10.0f;

    bool _moveToDest = false;  // ë§ˆìš°ìŠ¤ í´ë¦­í•œ ê³³ìœ¼ë¡œ ë¡¤ì²˜ëŸ¼ ìë™ ì´ë™ ë˜ì•¼ í•˜ëŠ” ìƒí™©ì¸ì§€
    Vector3 _destPos;  // ëª©ì ì§€ ìœ„ì¹˜

    void Start()
    {
        Managers.Input.KeyAction -= OnKeyboard;
        Managers.Input.KeyAction += OnKeyboard;

        Managers.Input.MouseAction -= OnMouseClicked;
        Managers.Input.MouseAction += OnMouseClicked;
    }

    void Update()
    {
        if (_moveToDest)
        {
            Vector3 dir = _destPos - transform.position;
            if (dir.magnitude < 0.0001f)  // ë„ì°©í•¨. ë” ì´ìƒ ì´ë™ X 
            {
                _moveToDest = false;
            }
            else   // ì•„ì§ ë„ì°© ì•ˆí•¨
            {
                float moveDist = Mathf.Clamp(_speed * Time.deltaTime, 0, dir.magnitude);
                transform.position = transform.position + dir.normalized * moveDist;

                transform.rotation = Quaternion.Slerp(transform.rotation, Quaternion.LookRotation(dir), 10 * Time.deltaTime);
                transform.LookAt(_destPos);
            }
        }
    }

    void OnKeyboard()
    {
        if (Input.GetKey(KeyCode.W))
        {
            transform.rotation = Quaternion.Slerp(transform.rotation, Quaternion.LookRotation(Vector3.forward), 0.2f);
            transform.position += Vector3.forward * Time.deltaTime * _speed;
        }

        if (Input.GetKey(KeyCode.S))
        {
            transform.rotation = Quaternion.Slerp(transform.rotation, Quaternion.LookRotation(Vector3.back), 0.2f);
            transform.position += Vector3.back * Time.deltaTime * _speed;
        }
        if (Input.GetKey(KeyCode.D))
        {
            transform.rotation = Quaternion.Slerp(transform.rotation, Quaternion.LookRotation(Vector3.right), 0.2f);
            transform.position += Vector3.right * Time.deltaTime * _speed;
        }
        if (Input.GetKey(KeyCode.A))
        {
            transform.rotation = Quaternion.Slerp(transform.rotation, Quaternion.LookRotation(Vector3.left), 0.2f);
            transform.position += Vector3.left * Time.deltaTime * _speed;
        }

        _moveToDest = false;  // í‚¤ë³´ë“œ ì…ë ¥ì€ í”Œë ˆì´ì–´ ì˜ì§€ë¡œ ì›€ì§ì´ëŠ” ê²ƒì´ë‹ˆ ìë™ ì´ë™ ë©ˆì¶¤
    }

    void OnMouseClicked(Define.MouseEvent evt)
    {
        if (evt != Define.MouseEvent.Click)
            return;

        Ray ray = Camera.main.ScreenPointToRay(Input.mousePosition); 
        Debug.DrawRay(Camera.main.transform.position, ray.direction * 100.0f, Color.red, 1.0f);

        RaycastHit hit;
        if (Physics.Raycast(ray, out hit, 100.0f, LayerMask.GetMask("Wall")))
        {
            _destPos = hit.point;
            _moveToDest = true;
        }
    }
}
```

- `_moveToDest` ğŸ‘‰ ë§ˆìš°ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸ë¡œ ì¸í•˜ì—¬ í”Œë ˆì´ì–´ê°€ ê·¸ ê³³ìœ¼ë¡œ ì´ë™ ë˜ì•¼ í•˜ëŠ” ìƒí™©ì¸ì§€ True or False.
- `_destPos` ğŸ‘‰ ëª©ì ì§€ ìœ„ì¹˜. ë°”ë‹¥ì— ë§ˆìš°ìŠ¤ í´ë¦­í•œ ê³³ ì›”ë“œ ì¢Œí‘œê°€ ëª©ì ì§€ê°€ ë  ê²ƒì´ë‹¤.
- *Start()*
  - ğŸ“œManager.cs ì‹±ê¸€í†¤ì— ì ‘ê·¼í•˜ì—¬ ğŸ“œInputManager.cs ì˜ `MouseAction`ì— ğŸ“œPlayerController.csì˜ *OnMouseClicked* í•¨ìˆ˜ë¥¼ ë“±ë¡í•œë‹¤.
- *OnMouseClicked*
  - `Define.MouseEvent` íƒ€ì…ì˜ ì¸ìˆ˜ë¥¼ `evt`ì— ë°›ëŠ”ë‹¤.
  - ì¼ë‹¨ ì‹¤í—˜ì‚¼ì•„ `evt`ê°€ Define.MouseEvent.Click ìƒíƒœì¼ ë•Œë§Œ ì²˜ë¦¬ë  ìˆ˜ ìˆë„ë¡ Define.MouseEvent.Click ê°€ ì•„ë‹ˆë©´ return ì‹œì¼°ë‹¤.
    - ë§ˆìš°ìŠ¤ í´ë¦­í•˜ê³  ë—ì„ ë•Œ
      - ì¹´ë©”ë¼ ìœ„ì¹˜ë¡œë¶€í„°, ê·¸ í´ë¦­í•œ í™”ë©´ìƒì˜ ìœ„ì¹˜ì˜ ì›”ë“œ ì¢Œí‘œë¡œ í–¥í•˜ëŠ” `Ray`ë¥¼ ìƒì„±í•œ í›„
      - "Wall" Layer ë¥¼ ê°€ì§„ ëŒ€ìƒë“¤ì—ê²Œë§Œ ì´ `Ray`ë¥¼ 100 ê¸¸ì´ë¡œ ìœë‹¤. ê·¸ë¦¬ê³  ì¶©ëŒ ì •ë³´ë¥¼ `hit`ì— ì €ì¥.
        - "Wall" Layer ë¥¼ ê°€ì§„ ëŒ€ìƒì— ì¶©ëŒí–ˆë‹¤ë©´
          - `_destPos`ì„ ì¶©ëŒí•œ ìœ„ì¹˜ë¡œ ì—…ë°ì´íŠ¸. ì¦‰, í´ë¦­í•œ ê³³ìœ¼ë¡œ ì—…ë°ì´íŠ¸.
          - `_moveToDest` Trueë¡œ ì—…ë°ì´íŠ¸.
- *OnKeyboard()*
  - ë§ˆìš°ìŠ¤ ì…ë ¥ìœ¼ë¡œ ì¸í•´ ìë™ìœ¼ë¡œ ì´ë™ ì¤‘ì´ë‹¤ê°€ í‚¤ë³´ë“œ ì…ë ¥ì´ ë“¤ì–´ì˜¤ë©´ í‚¤ë³´ë“œ ì…ë ¥ ì²˜ë¦¬ë¥¼ ë‹¤ í•˜ê³ ë‚œ í›„, `_destPos`ë¡œ ë” ì´ìƒ ì´ë™í•˜ì§€ ì•Šê²Œ `_moveToDest`ë¥¼ Falseë¡œ ì—…ë°ì´íŠ¸.
    - ë¡¤ í•˜ë‹¤ë³´ë©´ ë§ˆìš°ìŠ¤ í´ë¦­í•œ ê³³ìœ¼ë¡œ ì´ë™ í•˜ë‹¤ê°€ë„ í”Œë ˆì´ì–´ê°€ WASD ì´ë™í‚¤ ì…ë ¥í•˜ë©´ ë” ì´ìƒ í´ë¦­í•œ ê³³ìœ¼ë¡œ ì´ë™í•˜ì§€ ì•Šë“¯ì´ ê·¸ ì‘ì—…ì„ í•´ì¤€ ê²ƒ.
  - í‚¤ë³´ë“œ ì…ë ¥ ì²˜ë¦¬ë¥¼ ë‹¤ í•˜ê³ ë‚œ í›„ì—” ìë™ìœ¼ë¡œ `_moveToDest`ë¥¼ Falseë¡œ ì—…ë°ì´íŠ¸.
- *Update()* 
  - ë§¤ í”„ë ˆì„ ì‹¤í–‰ 
    - ì´ê²Œ ë‹¤ ì‹¤í–‰ë˜ê³  ë‚˜ì„œ ğŸ“œCameraController.csì˜ *LateUpdate()* ì—ì„œ í”Œë ˆì´ì–´ë¥¼ ë”°ë¼ê°€ë„ë¡ ì¹´ë©”ë¼ ìœ„ì¹˜ê°€ ì—…ë°ì´íŠ¸ ëœë‹¤.
  - í´ë¦­í•œ ê³³ìœ¼ë¡œ í”Œë ˆì´ì–´ê°€ ìë™ìœ¼ë¡œ ì´ë™ ë˜ì•¼ í•˜ëŠ” ìƒí™©ì´ë¼ë©´ *if (_moveToDest)*
    - `dir` ì—…ë°ì´íŠ¸ ğŸ‘‰ í”Œë ˆì´ì–´ë¡œë¶€í„° ëª©ì ì§€ê¹Œì§€ì˜ ë°©í–¥
      - í”Œë ˆì´ì–´ê°€ ê·¸ ê³³ìœ¼ë¡œ ë„ì°©í•´ê°ˆ ìˆ˜ë¡ ì ì  `dir` ë²¡í„°ì˜ í¬ê¸°ê°€ ì‘ì•„ì§
    - ë„ì°©í–ˆë‹¤ê³  íŒë‹¨í•˜ê³  ë” ì´ìƒ ì´ë™ X `_moveToDest`ë¥¼ Falseë¡œ ì—…ë°ì´íŠ¸. *if (dir.magnitude < 0.0001f)*
    - ì•„ì§ ë„ì°©í•˜ì§€ ì•Šì•˜ìœ¼ë‹ˆ í”Œë ˆì´ì–´ì˜ ìœ„ì¹˜ì™€ íšŒì „ê°’ì„ í´ë¦­í•œ ìœ„ì¹˜ë¡œ ì´ë™í•´ì•¼ í•¨
      - ìœ„ì¹˜ ì—…ëƒ
        - í•œ í”„ë ˆì„ ë§ˆë‹¤ `dir` ë°©í–¥ìœ¼ë¡œ `_speed * Time.deltaTime` í¬ê¸°ë§Œí¼ ì´ë™í•˜ë˜, `_speed * Time.deltaTime`ê°€ `dir.magnitude`ë¥¼ ë„˜ì§€ ì•Šê²Œ í•œë‹¤. ì¦‰, ì´ë™í• ë§Œí¼ì˜ ìŠ¤ì¹¼ë¼ í¬ê¸°ê°€ ëª©ì ì§€ í¬ê¸°ë¥¼ ë„˜ì§€ ì•Šê²Œ.
          - ì´ ê³¼ì • ì—†ì´ ê·¸ëƒ¥ ì•„ë˜ì™€ ê°™ì´ í•´ì£¼ë©´ ëª©ì ì§€ë¥¼ ì§€ë‚˜ì³ë²„ë¦´ ìˆ˜ê°€ ìˆë‹¤. ëª©ì ì§€ ì§€ë‚˜ì³¤ë‹¤ê°€ `dir` ìƒˆë¡­ê²Œ ì—…ëƒ í•œê²ƒì— ì˜í•´ ë‹¤ì‹œ ëª©ì ì§€ ìœ„ì¹˜ë¡œ ëŒì•„ì˜¤ê³  ì´ëŸ° ê³¼ì •ì´ ìˆì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— í”Œë ˆì´ì–´ê°€ ë²„ë²…ëŒ€ë©° ì›€ì§ì´ëŠ” ê²ƒì²˜ëŸ¼ ëœë‹¤.
            ```c#
            transform.position = transform.position + dir.normalized * _speed * Time.deltaTime;
            ```
      - íšŒì „ ê°’ ì—…ëƒ
        - `dir` ë°©í–¥ì„ ë°”ë¼ë³´ë„ë¡ ë¨¼ì € ë¶€ë“œëŸ½ê²Œ íšŒì „ì„ í•´ì¤€ë‹¤.
        - `destPos` ìœ„ì¹˜ë¥¼ ë°”ë¼ë³´ë„ë¡ íšŒì „í•œë‹¤.
          ```c#
                transform.rotation = Quaternion.Slerp(transform.rotation, Quaternion.LookRotation(dir), 10 * Time.deltaTime);
                transform.LookAt(_destPos);
          ```


***
<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}