---
title:  "Ch 3. λ…ΈνΈ μ¤λΈμ νΈ ν’€λ§" 

categories:
  -  Unity Lesson 4
tags:
  - [Game Engine, Unity]

toc: true
toc_sticky: true

date: 2020-12-22
last_modified_at: 2020-12-22
---

μΌ€μ΄λ””λ‹μ **[μ λ‹ν‹° κ°•μΆ] λ¦¬λ“¬ κ²μ„** μ νλΈ κ°•μλ¥Ό λ“£κ³  μ •λ¦¬ν• ν•„κΈ°μ…λ‹λ‹¤. π€  
[π κ°•μ λ“¤μΌλ¬ κ°€κΈ° Click](https://www.youtube.com/watch?v=eLdiOCWPfPc&list=PLUZ5gNInsv_MCnum4bOQRI72LdGkIY3tY&index=2&t=231s)
{: .notice--warning}

## π€ μ¤λΈμ νΈ ν’€λ§

- κ°μ²΄ μƒμ„±κ³Ό κ°μ²΄ νκ΄΄λ” λ¨λ°”μΌ ν™κ²½μ—μ„ λ§¤μ° μ†λ¨μ μΈ μΌμ΄λΌμ„ λ²„λ²…μΌ μ μλ‹¤.
- λ”°λΌμ„ μƒμ„±κ³Ό νκ΄΄λ¥Ό μµμ†ν™” ν•κΈ° μ„ν•΄ **λ―Έλ¦¬ μΌμ • κ°―μμ μ¤λΈμ νΈλ“¤μ„ λ―Έλ¦¬ μƒμ„±ν•΄λ‘” λ‹¤μ κ°μ²΄λ¥Ό ν™μ„±ν™”ν•΄μ„ μ¬ν™μ©ν•΄ μ“°κ³  νκ΄΄ ν•λ” λ€μ‹  λ‹¤μ‹ λΉ„ν™μ„±ν™” ν•λ” μ‹μΌλ΅ κ΄€λ¦¬ν•λ” κ²ƒ**μ„ μ¤λΈμ νΈ ν’€λ§μ΄λΌκ³  ν•λ‹¤.

<br>

## π€ λ…ΈνΈλ¥Ό μ¤λΈμ νΈ ν’€λ§μΌλ΅ κ΄€λ¦¬

![image](https://camo.githubusercontent.com/854020df0bb005f1586bf559382ce953eb53c2bb23c824bdd5efd6a7603da371/68747470733a2f2f706f737466696c65732e707374617469632e6e65742f4d6a41794d4445794d6a4a664d5463312f4d4441784e6a41344e6a49794d5455354f4455352e46454358746d7779532d6c30734f564f707779453454497865377467536a6c366b796f58564d476c305541672e2d38313275676e56766935304c5a42516b30794162346d6546426a2d45417262594364446c376b474b4f4d672e4749462e736f6879756e655f616e2f4749465f323032302d31322d32325f2545432539382541342545442539422538345f342d32382d32312e6769663f747970653d77373733)

- λ―Έλ¦¬ λ…ΈνΈλ¥Ό 15 κ° μƒμ„±ν•΄λ†“κ³  λΉ„ν™, ν™μ„±ν™” ν•΄κ°€λ©° μ“΄λ‹¤.  
  - μ¤λΈμ νΈ ν’€μ„ νμ—μ„ κ΄€λ¦¬ν•  κ²ƒμ΄λ‹¤.
    - λ…ΈνΈ κ°μ²΄ 15κ° δΈ­ λ§μΉ μƒμ„±λ κ²ƒμ²λΌ ν™μ„±ν™” λ κ²ƒμ€ νμ—μ„ λΉ μ Έλ‚μ¤κ³  λ§μΉ νκ΄΄λ κ²ƒμ²λΌ λΉ„ν™μ„±ν™” ν• κ²ƒμ€ λ‹¤μ‹ νμ— μ‚½μ…ν•΄ νμ—μ„ λ³΄κ΄€ν•  κ²ƒμ΄λ‹¤.
    - νλ” μ„ μ… μ„ μ¶μ΄λ―€λ΅ νμ— μμ€μ§€ κ°€μ¥ μ¤λλ κ²ƒμ„ μ°μ„ μ μΌλ΅ ν™μ„±ν™”ν•λ‹¤.

### π“ObjectPool

> λΉ μ¤λΈμ νΈ `ObjectPool`μ— λ¶™μ„

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

[System.Serializable]
public class ObjectInfo
{
    public GameObject goPrefab;
    public int count;
    public Transform tfPoolParent;
}

public class ObjectPool : MonoBehaviour
{
    [SerializeField] ObjectInfo[] objectInfo = null;

    public Queue<GameObject> noteQueue = new Queue<GameObject>(); // Pool

    public static ObjectPool instance; // κ³µμ μμ›
```

![image](https://user-images.githubusercontent.com/42318591/102869160-8ef63400-447e-11eb-9f72-7637dcee8244.png)

- ν”„λ¦¬νΉμ€ μ¤λΈμ νΈλ“¤μ„ `count`κ°―μλ§νΌ μƒμ„±ν•λ©° μ΄λ¥Ό μ¤λΈμ νΈ ν’€λ§μΌλ΅ κ΄€λ¦¬ν•  κ²ƒμ΄λ‹¤.
  - λΉ„ν™μ„±ν™”μΈ μƒνƒμ μ¤λΈμ νΈλ“¤μ€ ν μ•μ— λ³΄κ΄€
- κ΄€λ¦¬ν•  μ¤λΈμ νΈμ μ •λ³΄λ” `OjbectInfo`μ— λ‹΄κ²¨ μλ‹¤.
  - μ΄ μ¤λΈμ νΈλ¥Ό μ°μ–΄λ‚Ό ν”„λ¦¬νΉ `goPrefab`
  - μ¤λΈμ νΈ λ‡ κ°λ¥Ό μ‚¬μ©ν•  κ²ƒμΈμ§€ `count`
  - λ„κµ¬μ μμ‹μΌλ΅ λ  κ²ƒμΈμ§€ `tfPoolParent`
- μΌλ‹¨ μ¤λΈμ νΈ ν’€λ§μΌλ΅ κ΄€λ¦¬ν•  κ²ƒμ€ ν„ μ‹μ μ—μ„  λ…ΈνΈλΏμ΄λΌ `objectInfo` λ°°μ—΄μ€ μ›μ† 1 κ° λΏμ΄λ‹¤. λ…ΈνΈλ§! 
  - λ…ΈνΈμΈ `objectInfo[0]`μ„ 15κ° (λ…ΈνΈμ `count`) λ¥Ό λ―Έλ¦¬ μƒμ„±ν•΄λ‘” ν›„ κ΄€λ¦¬λ  κ²ƒ. 
- `noteQueue`
  - ν™μ„±ν™”λμ„ ν™”λ©΄ μ•μ— λ“¤μ–΄κ°€λ” λ…ΈνΈλ” νμ—μ„ λΉ μ§„λ‹¤. 
  - λΉ„ν™μ„±ν™” λμ„ λ‹¤μ‹ ν™μ„±ν™” λκΈ°λ¥Ό κΈ°λ‹¤λ¦¬λ” λ…ΈνΈλ” νμ— λ“¤μ–΄κ°„λ‹¤.
    - νμ— λ“¤μ–΄κ°„μ§€ κ°€μ¥ μ¤λλ λ…ΈνΈκ°€ λ¨Όμ € ν™μ„±ν™” λ¨.
- `instance`
  - μ΄ π“OjbectPool μ΄ λ¶™μ€ μ¤λΈμ νΈκ°€ κ³µμ λκ³  ν•λ‚λ΅ μ μ§€λ  μ μλ„λ΅.

```c#
    void Start()
    {
        instance = this;
        noteQueue = InsertQueue(objectInfo[0]);
    }

    Queue<GameObject> InsertQueue(ObjectInfo p_objectInfo)
    {
        Queue<GameObject> temp_Queue = new Queue<GameObject>();
        for (int i = 0; i < p_objectInfo.count; i++)
        {
            GameObject temp_clone = Instantiate(p_objectInfo.goPrefab, transform.position, Quaternion.identity);
            temp_clone.SetActive(false);
            if (p_objectInfo.tfPoolParent != null)
                temp_clone.transform.SetParent(p_objectInfo.tfPoolParent);
            else
                temp_clone.transform.SetParent(this.transform);

            temp_Queue.Enqueue(temp_clone);
        }

        return temp_Queue;
    }
}

```

κ²μ„μ΄ μ‹μ‘λλ©΄ `objectInfo[0]` μ¦‰ λ…ΈνΈκ°€ `count`κ° μ¦‰ 15κ° μƒμ„±λκ³  λ¨λ‘ λΉ„ν™μ„±ν™” ν• μƒνƒλ΅ νμ— λ„£λ”λ‹¤.

<br>

### π“Note

```c#
    void OnEnable()
    {
        if(noteImage == null)
            noteImage = GetComponent<Image>();

        noteImage.enabled = true;
    }
```

μ¤λΈμ νΈ ν’€λ§μΌλ΅ κ΄€λ¦¬ λ  κ²ƒμ΄λΌμ„ λ―Έλ¦¬ λ§λ“¤μ–΄μ§„ λ…ΈνΈλ“¤μ΄ κ³„μ† μ¬ν™μ© λλ‹¤. λ”°λΌμ„ μ΄λ―Έμ§€ λν• λ‹¤μ‹ μΌμ£Όλ©΄ λλ‹¤.

<br>

### π“NoteManager

```c#
    void Update()
    {
        currentTime += Time.deltaTime;

        if (currentTime >= 60d / bpm) // 60/bpm = ν• λΉ„νΈλ‹Ή μ‹κ°„ (120bpmμ΄λΌλ©΄ ν• λΉ„νΈλ‹Ή μ†μ” μ‹κ°„μ€ 0.5μ΄)
        {
            GameObject t_note = ObjectPool.instance.noteQueue.Dequeue();
            t_note.transform.position = tfNoteAppear.position;
            t_note.transform.localScale = new Vector3(1f, 1f, 0f);
            t_note.SetActive(true);

            theTimingManager.boxNoteList.Add(t_note);
            currentTime -= 60d / bpm;  
        }            
    }

    private void OnTriggerExit2D(Collider2D collision)
    {
        if (collision.CompareTag("Note"))
        {
            if (collision.GetComponent<Note>().GetNoteFlag())
                theEffect.JudgementEffect(4);
            theTimingManager.boxNoteList.Remove(collision.gameObject);
            
            ObjectPool.instance.noteQueue.Enqueue(collision.gameObject);
            collision.gameObject.SetActive(false);
        }
    }
```

λ…ΈνΈκ°€ μƒμ„±λμ•Όν•  λ•λ” μ‹¤μ λ΅ μƒμ„±ν•μ§„ μ•κ³  νμ—μ„ ν•λ‚μ”© κΊΌλ‚΄μ™€μ„ ν™μ„±ν™”λ§ μ‹ν‚¤λ©΄ λκ³  λ…ΈνΈκ°€ νκ΄΄λμ•Ό ν•  λ•λ” μ‹¤μ λ΅ νκ΄΄ν•μ§„ μ•κ³  λΉ„ν™μ„±ν™”ν•΄μ„ λ‹¤μ‹ νμ— λ„£μ–΄μ£Όλ©΄ λλ‹¤.

***
<br>

    π κ°μΈ κ³µλ¶€ κΈ°λ΅μ© λΈ”λ΅κ·Έμ…λ‹λ‹¤. μ¤λ¥λ‚ ν‹€λ¦° λ¶€λ¶„μ΄ μμ„ κ²½μ° 
    μ–Έμ λ“ μ§€ λ“κΈ€ νΉμ€ λ©”μΌλ΅ μ§€μ ν•΄μ£Όμ‹λ©΄ κ°μ‚¬ν•κ² μµλ‹λ‹¤! π„

[λ§¨ μ„λ΅ μ΄λ™ν•κΈ°](#){: .btn .btn--primary }{: .align-right}