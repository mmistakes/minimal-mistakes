---
title:  "Ch 11. ì²´ë ¥ê³¼ ì‰´ë“œ" 

categories:
  -  Unity Lesson 4
tags:
  - [Game Engine, Unity]

toc: true
toc_sticky: true

date: 2021-01-19
last_modified_at: 2020-01-19
---

ì¼€ì´ë””ë‹˜ì˜ **[ìœ ë‹ˆí‹° ê°•ì¢Œ] ë¦¬ë“¬ ê²Œì„** ìœ íŠœë¸Œ ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤. ğŸ˜€  
[ğŸŒœ ê°•ì˜ ë“¤ìœ¼ëŸ¬ ê°€ê¸° Click](https://www.youtube.com/watch?v=eLdiOCWPfPc&list=PLUZ5gNInsv_MCnum4bOQRI72LdGkIY3tY&index=2&t=231s)
{: .notice--warning}

## ğŸš€ ì²´ë ¥ê³¼ ì‰´ë“œ ì‹œìŠ¤í…œ

### âœˆ UI

![image](https://user-images.githubusercontent.com/42318591/105027237-dc23f080-5a92-11eb-9323-032fd4c49f5d.png)

![image](https://user-images.githubusercontent.com/42318591/105027213-d3331f00-5a92-11eb-906f-992590d4a4ce.png)

- HP 
  - í•œë²ˆ ì¶”ë½í•  ë•Œë§ˆë‹¤ HP ê°€ í•˜ë‚˜ì”© ê°ì†Œí•œë‹¤. 
  - HP ê°€ ëª¨ë‘ ì—†ì–´ì§€ë©´ ê²°ê³¼ UI ë„ìš°ê³  ê²Œì„ ì¢…ë£Œ
  - í•œë²ˆ ì¶”ë½í•˜ê³ ë‚˜ì„œ ë¶€í™œí•œ ì§í›„ì—” 5ë²ˆ ì •ë„ ê¹œë¹¡ì´ë©´ì„œ ë¬´ì  ìƒíƒœ. 
- Shield 
  - í‰ì†Œì—” ë¹„í™œì„±í™”
  - ì—°ì†ëœ ì½¤ë³´ë¡œ ì‰´ë“œ ê²Œì´ì§€ê°€ ê°€ë“ì°¨ë©´ ì‰´ë“œê°€ ìƒê¸´ë‹¤.
  - ì‰´ë“œëŠ” ìµœëŒ€ 3ê°œê¹Œì§€ ê°€ëŠ¥í•˜ë‹¤.
  - ì‰´ë“œ í•œë²ˆì€ HP í•œë²ˆì„ ë§ŒíšŒí•  ìˆ˜ ìˆë‹¤.
- Timer ì€ ë‚˜ì¤‘ì— êµ¬í˜„

<br>

### âœˆ ì½”ë“œ

#### ğŸ“œ StatusManager

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class StatusManager : MonoBehaviour
{
    [SerializeField] float blinkSpeed = 0.1f; // ê¹œë¹¡ì´ëŠ” ì†ë„
    [SerializeField] int blinkCount = 10;  // ê¹œë¹¡ê±°ë¦´ íšŸìˆ˜ (í‚¤ê³  ë„ê³  í•©í•´ì„œ 2íšŒ)
    int currentBlinkCount = 0; // ì´ê²Œ blinkCount ì— ë‹¤ë‹¤ë¥´ë©´ ê·¸ë§Œ ê¹œë¹¡ê±°ë¦´ ê²ƒ.
    bool isBlink = false;  // ì§€ê¸ˆ ê¹œë¹¡ì´ëŠ” ì¤‘ì¸ì§€. ê¹œë¹¡ì´ê³  ìˆë‹¤ë©´ ë¬´ì ìƒíƒœì—¬ì•¼.

    bool isDead = false;  // ì£½ì€ ìƒíƒ±ë‹ˆì§€

    int maxHp = 3;  
    int currentHp = 3;

    int maxShield = 3;
    int currentShield = 0;  // ì‰´ë“œëŠ” hp ì™€ ë‹¤ë¥´ê²Œ 0 ì—ì„œ ì‹œì‘í•¨. ê²Œì´ì§€ ë‹¤ ì°°ë•Œë§ˆë‹¤ ì‰´ë“œ í•˜ë‚˜ì”© ì¦ê°€

    [SerializeField] Image[] hpImage = null;
    [SerializeField] Image[] shieldImage = null;

    [SerializeField] int shieldIncreaseCombo = 5; // 5ë²ˆ ì—°ì† ì½¤ë³´ë•Œë§ˆë‹¤ ì‰´ë“œ ê²Œì´ì§€ ê½‰ì°¨ê³  ì‰´ë“œ í•˜ë‚˜ì”© ì¦ê°€í•˜ê²Œ í•  ê²ƒ.
    int currentShieldCombo = 0;  // ì´ê²Œ 5ì— ë‹¤ë‹¤ë¥´ë©´ ì‰´ë“œ í•˜ë‚˜ ì¦ê°€.
    [SerializeField] Image shieldGauge = null;

    Result theResult;
    NoteManager theNote;
    [SerializeField] MeshRenderer playerMesh = null; // ê¹œë¹¡ê±°ë¦¬ëŠ” íš¨ê³¼ë¥¼ ì£¼ê¸° ìœ„í•´ í”Œë ˆì´ì–´ íë¸Œì˜ MeshRendererë¥¼ ë¹„í™œ/í™œì„±í™” ë°˜ë³µí•  ê²ƒ.

    private void Start()
    {
        theResult = FindObjectOfType<Result>();
        theNote = FindObjectOfType<NoteManager>();
    }

    // ì‰´ë“œ ê²Œì´ì§€ ì—…ëƒ
    // 5ì½¤ë³´ ë•Œë§ˆë‹¤ ì‰´ë“œ 1ê°œì”© ì¦ê°€
    public void CheckShield()
    {
        currentShieldCombo++; 

        if (currentShieldCombo >= shieldIncreaseCombo)
        {
            currentShieldCombo = 0;
            IncreaseShield();
        }

        shieldGauge.fillAmount = (float)currentShieldCombo / shieldIncreaseCombo;
    }

    // ì½¤ë³´ ë†“ì³£ì„ ë•Œ ë‹¤ì‹œ ë¦¬ì…‹í•´ì•¼ í•¨. ê²Œì´ì§€ë„ ë‹¤ì‹œ ë¹µìœ¼ë¡œ.
    public void ResetShieldCombo()
    {
        currentShieldCombo = 0;
        shieldGauge.fillAmount = (float)currentShieldCombo / shieldIncreaseCombo;
    }

    // ì‰´ë“œ 1ê°œ ì¦ê°€. ëŒ€ì‹  3ê°œëŠ” ë„˜ìœ¼ë©´ ì•ˆë¨
    public void IncreaseShield()
    {
        currentShield++;

        if (currentShield >= maxShield)
            currentShield = maxShield;

        SettingShieldImage();
    }

    // ë‚­ë– ëŸ¬ì§€ ì¶”ë½í•  ë•Œ ì‰´ë“œ í•˜ë‚˜ì”© ê¹ì•„ì•¼ í•¨
    public void DecreaseShield(int p_num)
    {
        currentShield -= p_num;

        if (currentShield <= 0)
            currentShield = 0;

        SettingShieldImage();
    }

    // ì‰´ë“œ ì´ë¯¸ì§€ í™œì„±í™”/ë¹„í™œì„±í™” (currentShield ê°œìˆ˜ë§Œ í™œì„±í™”)
    void SettingShieldImage()
    {
        for (int i = 0; i < shieldImage.Length; i++)
        {
            if (i < currentShield)
                shieldImage[i].gameObject.SetActive(true);
            else
                shieldImage[i].gameObject.SetActive(false);
        }
    }

    // HP 1 ì¦ê°€
    public void IncreaseHp(int p_num)
    {
        currentHp += p_num;
        if (currentHp >= maxHp)
            currentHp = maxHp;

        SettingHPImage();
    }

    // HP 1 ê¹ê¸° (ë‹¨, ê¹œë¹¡ì¼ ë•Œ ë§ê³ ! ê¹œë¹¡ì¼ ë–ˆ ë¬´ì  íš¨ê³¼ì—¬ì•¼. ê·¸ë¦¬ê³  ì‰´ë“œ ìˆì„ ë• HP ëŒ€ì‹  ì‰´ë“œë¥¼ ê¹ì•„ì•¼ í•¨.)
    public void DecreaseHp(int p_num)
    {
        if (!isBlink)
        {
            if (currentShield > 0)
                DecreaseShield(p_num);
            else
            {
                currentHp -= p_num;

                if (currentHp <= 0)
                {
                    isDead = true;
                    theResult.ShowResult();
                    theNote.RemoveNote();
                }
                else
                {
                    StartCoroutine(BlinkCo());
                }
                SettingHPImage();
            }
        }
    }

    void SettingHPImage()
    {
        for (int i = 0; i < hpImage.Length; i++)
        {
            if (i < currentHp)
                hpImage[i].gameObject.SetActive(true);
            else
                hpImage[i].gameObject.SetActive(false);
        }
    }

    public bool Isdead()
    {
        return isDead;
    }

    // ê¹œë¹¡ì´ê¸° ğŸ‘‰ í”Œë ˆì´ì–´ íë¸Œì˜ Mesh ê»ë‹¤ í‚¤ê¸°
    IEnumerator BlinkCo()
    {
        isBlink = true;
        while(currentBlinkCount <= blinkCount) // ì´ ì§“ì„ 10ë²ˆ í•¨
        {
            playerMesh.enabled = !playerMesh.enabled; // ë„ê±°ë‚˜ í˜¹ì€ í‚¤ê±°ë‚˜ 
            yield return new WaitForSeconds(blinkSpeed); // 1.5ì´ˆë§ˆë‹¤
            currentBlinkCount++;
        }

        playerMesh.enabled = true; // ì œëŒ€ë¡œ ë‹¤ì‹œ ì¼œì£¼ê³ 
        currentBlinkCount = 0;
        isBlink = false;
    }
}

```

![image](https://user-images.githubusercontent.com/42318591/105027747-7d12ab80-5a93-11eb-8465-c92b42710d52.png)


<br>


#### ğŸ“œ PlayerController

```c#
StatusManager theStatus;
theStatus = FindObjectOfType<StatusManager>();

    public void ResetFalling()
    {
        theStatus.DecreaseHp(1);

        if(!theStatus.Isdead())
        {
            isFalling = false;
            myRigid.useGravity = false;
            myRigid.isKinematic = true;

            transform.position = originPos;
            realCube.localPosition = Vector3.zero;
        }
    }
```

í”Œë ˆì´ì–´ê°€ ì£½ì€ ìƒíƒœê°€ ì•„ë‹ ë•Œë§Œ, ì¦‰ HP ê°€ í•˜ë‚˜ë¼ë„ ë‚¨ì•„ìˆì–´ì•¼ ë‹¤ì‹œ ë¶€í™œí•  ìˆ˜ ìˆë‹¤. 

<br>


#### ğŸ“œ TimingManager

```c#
StatusManager theStatus;
theStatus = FindObjectOfType<StatusManager>();


                    if (CheckCanNextPlate())
                    {
                        theScoreManager.IncreaseScore(j);  // ì ìˆ˜ ì¦ê°€
                        theStage.ShowNextPlate(); // ë‹¤ìŒ í”Œë ˆì´íŠ¸ í˜¸ì¶œ
                        theEffect.JudgementEffect(j); // íŒì • ì—°ì¶œ
                        judgementRecord[j]++;  // íŒì • ê¸°ë¡
                        theStatus.CheckShield(); // ì‰´ë“œ ì²´í¬
                    }

    public void MissRecord()
    {
        judgementRecord[4]++;  // íŒì • ê¸°ë¡
        theStatus.ResetShieldCombo();
    }
```

ì‰´ë“œ ë˜í•œ ë§¤ë²ˆ ì²´í¬í•´ì£¼ì–´ì•¼ í•œë‹¤. ê²Œì´ì§€ ì„¸íŒ…ì„ ìœ„í•´. Missì‹œ ì‰´ë“œ ê²Œì´ì§€ ë¦¬ì…‹.

<br>


***
<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}