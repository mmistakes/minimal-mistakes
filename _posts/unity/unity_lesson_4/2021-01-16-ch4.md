---
title:  "Ch 4. ì ìˆ˜ + ì½¤ë³´ ì‹œìŠ¤í…œ" 

categories:
  -  Unity Lesson 4
tags:
  - [Game Engine, Unity]

toc: true
toc_sticky: true

date: 2021-01-16
last_modified_at: 2020-01-16
---

ì¼€ì´ë””ë‹˜ì˜ **[ìœ ë‹ˆí‹° ê°•ì¢Œ] ë¦¬ë“¬ ê²Œì„** ìœ íŠœë¸Œ ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤. ğŸ˜€  
[ğŸŒœ ê°•ì˜ ë“¤ìœ¼ëŸ¬ ê°€ê¸° Click](https://www.youtube.com/watch?v=eLdiOCWPfPc&list=PLUZ5gNInsv_MCnum4bOQRI72LdGkIY3tY&index=2&t=231s)
{: .notice--warning}

## ğŸš€ ì ìˆ˜ + ì½¤ë³´ ì‹œìŠ¤í…œ

### âœˆ UI

![image](https://user-images.githubusercontent.com/42318591/104813751-7d6e3500-584e-11eb-96ec-2e79125e08a8.png)

![image](https://user-images.githubusercontent.com/42318591/104813775-9a0a6d00-584e-11eb-9d9c-cb4be952099c.png)


í…ìŠ¤íŠ¸ëŠ” Outline ì»´í¬ë„ŒíŠ¸ë¥¼ ì´ìš©í•˜ì—¬ ì™¸ê³½ì„  ë„£ìŒ

<br>

### ğŸ“œComboManager

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class ComboManager : MonoBehaviour
{
    [SerializeField] GameObject goComboImage = null;
    [SerializeField] Text txtCombo = null;

    int currentCombo = 0;

    Animator myAnim;
    string animComboUp = "ComboUp";
        
    private void Start()
    {
        myAnim = GetComponent<Animator>();
        txtCombo.gameObject.SetActive(false);
        goComboImage.SetActive(false);
    }

    public void IncreaseCombo(int p_num = 1)
    {
        currentCombo += p_num;
        txtCombo.text = string.Format("{0:#,##0}", currentCombo);

        if (currentCombo > 2)  // 3ì½¤ë³´ ì´ìƒ
        {
            txtCombo.gameObject.SetActive(true);
            goComboImage.SetActive(true);

            myAnim.SetTrigger(animComboUp);
        } 
    }

    public void ResetCombo()
    {
        currentCombo = 0;
        txtCombo.text = "0";
        txtCombo.gameObject.SetActive(false);
        goComboImage.SetActive(false);
    }

    public int GetCurrentCombo()
    {
        return currentCombo;
    }
}
```

- 3ì½¤ë³´ ì´ìƒë¶€í„° ì½¤ë³´ ì´ë¯¸ì§€ì™€ í…ìŠ¤íŠ¸ë¥¼ í™œì„±í™” ì‹œí‚¤ê³  ì½¤ë³´ ì• ë‹ˆë©”ì´ì…˜ ì¬ìƒ
  - ì½¤ë³´ ì• ë‹ˆë©”ì´ì…˜ ë§Œë“¤ì–´ Animator ë¶™ì´ê³  ì»¨íŠ¸ë¡¤ëŸ¬ë„ ì‘ì„±í•´ í• ë‹¹í•´ ì¤€ ìƒíƒœ

![image](https://user-images.githubusercontent.com/42318591/104813792-b908ff00-584e-11eb-976a-efe4edc978cc.png)

<br>

### ğŸ“œScoreManager

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class ScoreManager : MonoBehaviour
{
    [SerializeField] Text txtScore = null;

    [SerializeField] int increaseScore = 10;
    int currentSrore =0;

    [SerializeField] float[] weight = null;
    [SerializeField] int comboBonusScore = 10;

    Animator myAnim;
    string animScoreUp = "ScoreUp";

    ComboManager theCombo;

    private void Start()
    {
        theCombo = FindObjectOfType<ComboManager>();
        myAnim = GetComponent<Animator>();
        currentSrore = 0;
        txtScore.text = "0";
    }

    public void IncreaseScore(int p_JudgementState)
    {
        // ì½¤ë³´ ì¦ê°€
        theCombo.IncreaseCombo();

        // ì½¤ë³´ ë³´ë„ˆìŠ¤ ì ìˆ˜ ê³„ì‚°
        int t_currentCombo = theCombo.GetCurrentCombo();
        int t_bonusComboScore = (t_currentCombo / 10) * comboBonusScore; // ex) 10~19 ì½¤ë³´ëŠ” ì¶”ê°€ì ìˆ˜ 10, 30~39 ì½¤ë³´ëŠ” ì¶”ê°€ì ìˆ˜ 30.

        // íŒì • ê°€ì¤‘ì¹˜ ê³„ì‚°
        int t_increaseScore = increaseScore + t_bonusComboScore;        // ì¶”ê°€í•  ì ìˆ˜ (ê¸°ë³¸ ì¦ê°€ì ìˆ˜ + ì½¤ë³´ ì¶”ê°€ì ìˆ˜)
        t_increaseScore = (int)(t_increaseScore * weight[p_JudgementState]); // íŒì •ì— ë”°ë¥¸ ê°€ì¤‘ì¹˜ ì ìš©. ìµœì¢…ì ìœ¼ë¡œ ì¶”ê°€í•  ì ìˆ˜ ì™„ì„±

        // ì ìˆ˜ ë°˜ì˜
        currentSrore += t_increaseScore;
        txtScore.text = string.Format("{0:#,##0}", currentSrore);

        // ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
        myAnim.SetTrigger(animScoreUp);
    }
}

```

- ì ìˆ˜ í…ìŠ¤íŠ¸ì— ì ìš©í•  ì• ë‹ˆë©”ì´ì…˜ ë§Œë“¤ì–´ Animator ë¶™ì´ê³  ì»¨íŠ¸ë¡¤ëŸ¬ë„ ì‘ì„±í•´ í• ë‹¹í•´ ì¤€ ìƒíƒœ

![image](https://user-images.githubusercontent.com/42318591/104813696-2ec09b00-584e-11eb-8bc1-50e3de319852.png)

<br>

### ğŸ“œTimingManager

```c#
ComboManager theCombo;
theCombo = FindObjectOfType<ComboManager>();

    public void CheckTiming()
    {
        for(int i = 0; i < boxNoteList.Count; i++)
        {
            float t_notePosX = boxNoteList[i].transform.localPosition.x;

            // íŒì • ìˆœì„œ : Perfect -> Cool -> Good -> Bad
            for (int j = 0; j < timingBoxs.Length; j++)
            {
                if (timingBoxs[j].x <= t_notePosX && t_notePosX <= timingBoxs[j].y)
                {
                    // ë…¸íŠ¸ ì œê±°
                    boxNoteList[i].GetComponent<Note>().HideNote();
                    boxNoteList.RemoveAt(i);

                    //  Perfect, Cool, Good ì´í™íŠ¸ ì—°ì¶œ + ì½¤ë³´ ì¦ê°€
                    if (j < timingBoxs.Length - 1)
                        theEffect.NoteHitEffect();

                    // íŒì • 
                    theEffect.JudgementEffect(j);

                    // ì ìˆ˜ ì¦ê°€
                    theScoreManager.IncreaseScore(j);

                    return;
                }
            }
        }

        // ìŠ¤í˜ì´ìŠ¤ë°” ëˆ„ë¥´ê¸´ í–ˆëŠ”ë° ì•„ì˜ˆ íŒì •ì´ ì•ˆëœ Miss
        theCombo.ResetCombo(); // ì½¤ë³´ ì´ˆê¸°í™”
        theEffect.JudgementEffect(timingBoxs.Length); 
    }
```

<br>

### ğŸ“œNoteManager

```c#
ComboManager theCombo;
theCombo = FindObjectOfType<ComboManager>();

    // ìŠ¤í˜ì´ìŠ¤ë°” ì¡°ì°¨ë„ ëˆ„ë¥´ì§€ ì•Šì•„ì„œ í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°„ Missë“¤...
    private void OnTriggerExit2D(Collider2D collision)
    {
        if (collision.CompareTag("Note"))
        {
            if (collision.GetComponent<Note>().GetNoteFlag())
            {
                theEffect.JudgementEffect(4);
                theCombo.ResetCombo();
            }
                
            theTimingManager.boxNoteList.Remove(collision.gameObject);
            
            ObjectPool.instance.noteQueue.Enqueue(collision.gameObject);
            collision.gameObject.SetActive(false);
        }
    }
```

<br>


***
<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}