---
layout: post
title: "ini í¼ ajax ~ DBê¹Œì§€ ì „ì²´ í”„ë¡œì„¸ìŠ¤"
---

# Process
`Ini.html` ì‚¬ìš©ì ë°ì´í„°ë¥¼ ì…ë ¥ ë’¤ submit ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ajaxë¥¼ í†µí•´ ì»¨íŠ¸ë¡¤ëŸ¬ì— ë°ì´í„° ì „ë‹¬
ğŸ‘‡  
`TestController.java` key : value í˜•ì‹ì˜ mapíƒ€ì…ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë°›ê³  service ë ˆì´ì–´ì— ì „ë‹¬  
service ë ˆì´ì–´ì— ì „ë‹¬í•  ë•ŒëŠ” mapì— ìˆëŠ” ê°’ë“¤ì„ ì•Œë§ì€ ë°ì´í„° íƒ€ì… ë³€ìˆ˜ì— ë„£ì–´ì„œ ë³´ë‚´ì¤Œ  
ì™œëƒë©´ mapperì—ì„œ hashmapìœ¼ë¡œ ë°ì´í„° ë°›ì•„ì„œ insert í•˜ë©´ íƒ€ì… ì—ëŸ¬ë‚¨  
ğŸ‘‡  
`IniService.java` insertIni ë©”ì†Œë“œ ìƒì„±  
ğŸ‘‡  
`IniServiceImpl.java` Initiative(DTO)ì— ë°ì´í„°ë¥¼ ë„£ì–´ì¤Œ  
IniMapper.xmlì— ìˆëŠ” insertIniì— ì‚¬ìš©ìì—ê²Œ ë°›ì€ ë°ì´í„°ë¥¼ ê°–ê³  ìˆëŠ” Initiativeë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê²¨ì¤Œ  
ğŸ‘‡  
`IniMapper.xml` SQLë¬¸ ì‹¤í–‰ DBì— ë°ì´í„° ì €ì¥  
<br>

# readForm í•¨ìˆ˜ (common.js)
```
function readForm(formId, url){

      $.ajax({
             url : url,
             type : "post",
             dataType :"text",
             data : $(formId).serialize(),
             success : function(result){
                 console.log(result);
             },
             error : function(err){
                 console.log(err+"ì—ëŸ¬ë°œìƒ");
             }
      });

}
```
ì•ìœ¼ë¡œ ì‘ì„±í•  ëª¨ë“  í¼ ë°ì´í„°ë¥¼ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ë„˜ê²¨ì£¼ëŠ” í•¨ìˆ˜  

<br>

# ini.html
```
        $("click").click(function(){
            console.log("click");
            readForm("iniForm","/readForm");
            console.log("readForm ì¢…ë£Œ");
        })
```
viewì— í•¨ìˆ˜ ì ìš©  

<br>

# ì»¨íŠ¸ë¡¤ëŸ¬ test2
```
    @RequestMapping(value="/readForm", produces="text/html;charset=UTF-8")
    @ResponseBody
    @PostMapping
    public String test2(@RequestParam Map<String, String> param){
        for (String key : param.keySet()) {
            System.out.println(key + " : " + param.get(key));
        }

        return "success";
    }
```
<br>
Mapë„ key : value í˜•íƒœë‹ˆê¹Œ  
sysoë¡œ ì°ì–´ë‚¼ ë•Œ key : valueë¡œ ì°ì–´ë‚´ê¸°  
ì‚¬ì‹¤ .get()ìœ¼ë¡œ í•´ë„ ê°€ëŠ¥ì€í•˜ë‹¤  
í•˜ì§€ë§Œ ìš”ì¼ì˜ ê²½ìš° ì§‘í•© í˜•íƒœë¡œ ë‹¤ìˆ˜ì˜ ìš”ì¼ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ë‹¤  
ê·¸ë˜ì„œ ì§‘í•© í˜•íƒœë¡œ Mapì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” keySetì„ ì‚¬ìš©  

<br>
![image](https://user-images.githubusercontent.com/86642180/151666578-fc773850-10b8-4ffe-bd2c-0dbcdcdeb676.png)

ì´ë ‡ê²Œ viewì—ì„œ ì„ íƒí–ˆë‹¤  
í¼ ì œì¶œ ë’¤ ê²°ê³¼ëŠ” ì´ë ‡ê²Œ ë‚˜ì™”ë‹¤  
![image](https://user-images.githubusercontent.com/86642180/151666587-6087f830-b314-4c45-913f-6c4697107412.png)
ì¼ë‹¨ ë°ì´í„° ë°›ëŠ” ê²ƒì€ ì˜ ë˜ëŠ”ë°  
"ë§¤ì¼"ì„ ì„ íƒí•˜ë©´ ì–´ë–¤ ì£¼ë“  ìƒê´€ ì—†ì–´ì•¼ í•´ì„œ week ë¶€ë¶„ì´ ê³µë€ì´ì–´ì•¼ í•˜ëŠ”ë° ì´ìƒí•˜ë‹¤  

<br><br>
![image](https://user-images.githubusercontent.com/86642180/151704957-a1e04a09-c4e1-45ac-95d4-b50ab980e2b7.png)
ê³µë€ì¸ ì˜µì…˜ì„ ì¶”ê°€í•˜ë‹ˆ ì›í•˜ëŠ”ëŒ€ë¡œ ì‘ë™ëœë‹¤  

<br><br><br>
# TestControllerì— ë‚´ìš© ì¶”ê°€
```
    public String test2(@RequestParam Map<String, String> param) throws ParseException {
        for (String key : param.keySet()) {
            System.out.println(key + " : " + param.get(key));
        }
        // Ob ì½”ë“œ
        String obCodeString = param.get("obCode");
        int obCode = Integer.parseInt(obCodeString);

        //dateListCode??? ì´ê±°ëŠ” ì–´ë–»ê²Œ ì¶”ê°€í• ì§€? ë§¤ì¼ì´ë©´ 0123456

        // ë‹¬ ì£¼ ì¼(iniPeriod)
        String iniPeriodString = param.get("iniDuration");
        int iniPeriod = Integer.parseInt(iniPeriodString);

        // í•œ ì£¼ë§ˆë‹¤ ëª‡ ë²ˆì”© ì§„í–‰í•  ê²ƒì¸ì§€(iniCount)
        int iniCount = 0;
        if(iniPeriod == 2){
            iniCount = 7;
        }

        // iniOrder

        // ini ë‚´ìš©(iniContent)
        String iniContent = param.get("iniContent");

        // iniMonthDate

        // ì‹œì‘ì¼(iniStartDate)
        String iniStartDateString = param.get("iniStartDate");
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-mm-dd");
        Date iniStartDate = sdf.parse(iniStartDateString);

        // ì¢…ë£Œì¼(iniEndDate)
        String iniEndDateString = param.get("iniEndDate");
        Date iniEndDate = sdf.parse(iniEndDateString);

        // ì „ì²´ ê¸°ê°„(iniDuration)
        int iniDuration = 6;

        // ì „ì²´ ê¸°ê°„ ë™ì•ˆ ê°€ëŠ¥í•œ íšŸìˆ˜(iniPossibleCount)
        int iniPossibleCount = 30;

        iniService.insertIni(obCode, iniPeriod, iniCount, iniContent, iniStartDate, iniEndDate);
        return "success";
    }
}
```
ì›ë˜ëŠ” mapìœ¼ë¡œ ë°ì´í„°ë¥¼ ì „ë‹¬í•œ ë’¤ serviceImplì—ì„œ mapì— ìˆëŠ” ë°ì´í„°ë¥¼ ê°ê° êº¼ë‚´ê³   
dtoë¡œ ë°ì´í„°ë¥¼ ë³´ë‚´ë ¤ í–ˆìœ¼ë‚˜ ë°¤ì— serviceImplì— ì¨ì•¼í•  ì½”ë“œë¥¼ ì»¨íŠ¸ë¡¤ëŸ¬ì— ì ì—ˆë‹¤..  
ë‚˜ì¤‘ì— ìˆ˜ì •í•˜ë©´ ë˜ê³  ì–´ì¨Œë“  insertê°€ ë˜ëŠ”ì§€ í™•ì¸í•˜ëŠ”ê²Œ ëª©ì ì´ë‹ˆ ê·¸ëƒ¥ ì§„í–‰  


# IniService
```
package com.project.smallbeginjava11.service;

import java.text.ParseException;
import java.util.Date;
import java.util.List;
import java.util.Map;

import com.project.smallbeginjava11.DTO.Initiative;

public interface IniService {
    void insertIni(int obCode, int iniPeriod, int iniCount, String iniContent, Date iniStartDate, Date iniEndDate) throws ParseException;
}
```
ê°ê° íŒŒë¼ë¯¸í„° ë°ì´í„° íƒ€ì…ì— ë§ê²Œ ì‘ì„±í•´ì¤Œ  
insertë‹ˆê¹Œ ë¦¬í„´í•´ì¤„ í•„ìš” ì—†ìœ¼ë‹ˆ voidë¡œ ì‘ì„±  

<br>

# IniServiceImpl
```
public class IniServiceImpl implements IniService{

    private final IniMapper iniMapper;

    @Override
    public void insertIni(int obCode, int iniPeriod, int iniCount, String iniContent, Date iniStartDate, Date iniEndDate) throws ParseException {

        // DTOì— íŒŒë¼ë¯¸í„° ê°’ë“¤ ë„£ì–´ì£¼ê³  DTOë¥¼ Mapperë¡œ ë„˜ê²¨ì£¼ì–´ insert ì‹¤í–‰
        Initiative initiative = new Initiative(obCode, iniPeriod, iniCount, iniContent, iniStartDate, iniEndDate);
        iniMapper.insertIni(initiative);
    }
}
```

<br>

# IniMapper.java
```
public interface IniMapper {
    void insertIni(Initiative initiative);
}
```

<br>

# IniMapper.xml
```
<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.smallbeginjava11.mapper.IniMapper">

    <insert id="insertIni" parameterType="Initiative">
        INSERT INTO initiative values(
            100, #{obCode}, 100, 100, #{iniPeriod}, #{iniCount}, null, #{iniContent}, null, #{iniStartDate}, #{iniEndDate}, 100);
    </insert>

</mapper>
```
í…ŒìŠ¤íŠ¸ë‹ˆê¹Œ ì‹œí€€ìŠ¤, ë°ì´íŠ¸ ê³„ì‚° ë“±ì€ ë‚˜ì¤‘ì— í•˜ê³   
ì¼ë‹¨ viewì—ì„œ ë°›ì€ ë°ì´í„°ë“¤ì€ `#{}`í˜•íƒœë¡œ í•´ì„œ ì €ì¥  

<br><br>

# ì‹¤í–‰ ê²°ê³¼
![image](https://user-images.githubusercontent.com/86642180/152160497-432fc38c-82b0-4688-b9fb-631baa03cdba.png)
íƒ€ì…ì—ëŸ¬ê°€ ë‚¬ë‹¤  
ìƒê°í•´ë³´ë‹ˆ viewì—ì„œ obCodeë¥¼ ê°€ì ¸ì˜¬ ë•Œ categoryName(String) ê°’ì„ ê°€ì ¸ì˜¨ë‹¤  
obCodeì—ëŠ” intê°€ ë“¤ì–´ê°€ì•¼í•˜ëŠ”ë°  
<br>
view ìˆ˜ì •  
```
                <option th:each="category: ${category}"
                        th:value="${category.categoryCode}" th:utext="${category.categoryName}">
                </option>
```

<br><br>
ë‹¤ì‹œ ì‹¤í–‰  
![image](https://user-images.githubusercontent.com/86642180/152164161-cfcce33d-8a7d-42e9-b804-adc9a8a9cf87.png)
iniDurationì´ ì•„ë‹ˆë¼ iniPeriodë¡œ ë°›ì•„ì•¼í•˜ëŠ”ë° ë³€ìˆ˜ ì´ë¦„ì´ í‹€ë ¸ìŒ  

<br>

ìˆ˜ì • ë’¤ ë‹¤ì‹œ ì‹¤í–‰  
![image](https://user-images.githubusercontent.com/86642180/152165701-925868b0-8e21-4d20-ac46-ffbd9e022e65.png)
viewì—ì„œ ë°›ì€ ë°ì´í„°ë¥¼ mapperì— ê°€ì ¸ì˜¤ì§€ ëª»í•¨  

<br>

ì²´í¬í•  ì‚¬í•­  
1. DTOì— ìƒì„±ìê°€ ì œëŒ€ë¡œ ìƒê²¼ëŠ”ì§€?  Yes  
2. ìƒì„±ì ì½”ë“œ (this) ìˆëŠ”ì§€?

<br>
ì¸í…”ë¦¬ì œì´ì—ì„œ ìƒì„±ì ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì£¼ê³   
this.ini = ~~~ ì•ˆë„£ì–´ì¤Œ  

<br>

```
    public Initiative(int obCode, int iniPeriod, int iniCount, String iniContent, Date iniStartDate, Date iniEndDate) {
        this.obCode = obCode;
        this.iniPeriod = iniPeriod;
        this.iniCount = iniCount;
        this.iniContent = iniContent;
        this.iniStartDate = iniStartDate;
        this.iniEndDate = iniEndDate;
    }
```
Initiative.java (DTO)ì— ì½”ë“œ ì¶”ê°€  

<br><br>

ì‹¤í–‰ ê²°ê³¼  
![image](https://user-images.githubusercontent.com/86642180/152172926-08b2b782-1689-459c-ad7e-a3eb9278247c.png)
insert ì™„ë£Œ
