---
layout: post
title:  "íŒŒì´ì¬ ë°”ì´ë„ˆë¦¬ ë³€í™˜ (Raw Data ë‹¤ë£¨ê¸°)"
subtitle: "Bitstring ì„ ì´ìš©í•œ ê°„í¸í•œ ë°”ì´ë„ˆë¦¬ ë‹¤ë£¨ê¸°"
author: "ì½”ë§ˆ"
date:   2019-08-01 00:00:00 +0900
categories: [ "python", "bitstring", "binary" ]
excerpt_separator: <!--more-->
---

ì•ˆë…•í•˜ì„¸ìš” ì½”ë§ˆì…ë‹ˆë‹¤. ì˜¤ëŠ˜ì€ íŒŒì´ì¬ì„ ì´ìš©í•´ì„œ Binary ê°’ì„ ë‹¤ë£¨ëŠ” ë°©ë²•ì„ ì†Œê°œí•´ ë“œë¦¬ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.ğŸ˜º

<!--more-->

# ê°œìš”

íŒŒì´ì¬ì€ íƒ€ì…ì— ë¯¼ê°í•˜ì§€ ì•Šì€ ì–¸ì–´ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‹¤ë³´ë‹ˆ ì¢…ì¢… Hex, Bin ì„ ë‹¤ë£¨ì–´ì•¼ í•˜ëŠ” ê²½ìš° ë”±íˆ ë°©ë²•ì´ ë– ì˜¤ë¥´ì§€ ì•Šì„ ë•Œê°€ ë§ìŠµë‹ˆë‹¤. ì € ì½”ë§ˆëŠ” ì´ëŸ¬í•œ ì—¬ëŸ¬ë¶„ì˜ ì–´ë ¤ì›€ì„ í•´ì†Œí•˜ê¸° ìœ„í•´ Bitstring ì´ë¼ëŠ” ëª¨ë“ˆì„ ì†Œê°œí•´ ë“œë¦¬ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

- bitstring ì„¤ì¹˜í•˜ê¸° 

```bash
pip install bitstring
```

- hexdump ì„¤ì¹˜í•˜ê¸° 

```bash
pip install hexdump
```

{% include advertisements.html %}

## int ë¥¼ ì´ìš©í•œ ë°ì´í„° ë³€í™˜

python ì—ë„ íƒ€ì…ì´ ìˆìŠµë‹ˆë‹¤. int, float, bytes ë“±ì´ ê·¸ê²ƒì…ë‹ˆë‹¤. ê·¸ ì¤‘ì— int ëŠ” n ì§„ë²•ìœ¼ë¡œ í‘œí˜„ëœ ë¬¸ìì—´ ë°ì´í„°ë¥¼ ì½ì–´ì™€ ì •ìˆ˜ë¡œ í‘œí˜„í•˜ëŠ” ì¢‹ì€ ê¸°ëŠ¥ì´ ìˆìŠµë‹ˆë‹¤. 

ì•„ë˜ëŠ” ìš°ë¦¬ì—ê²Œ ì¹œìˆ™í•œ ì´ì§„ë²•, 16ì§„ë²•, ì‹­ì§„ë²•ì˜ ë°ì´í„°ë¥¼ ì •ìˆ˜ë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤.

```python
# ì´ì§„ ë°ì´í„°ë¥¼ ë³€í™˜ 
[11] : int('00100001',base=2)
33
```

```python
# 16ì§„ìˆ˜ ë°ì´í„°ë¥¼ ë³€í™˜
[12] : int('0xff',base=16)
255
```

```python
# 10ì§„ë²• ë°ì´í„°ë¥¼ ë³€í™˜
[13] : int('255', base=10)
255
```

## ë¬¸ìì—´ ë³€í™˜

ìš°ë¦¬ëŠ” ì—¬ëŸ¬ê°€ì§€ ì§„ë²•ìœ¼ë¡œ í‘œí˜„ëœ ë°ì´í„°ë¥¼ ì •ìˆ˜ë¡œ ë³€ê²½í•˜ì˜€ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì´ì œëŠ” ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ê±°ë‚˜ ë¬¸ìì—´ì—ì„œ ì •ìˆ˜ë¡œ ë³€í™˜í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤. ì´ë•Œ ì‚¬ìš©í•˜ëŠ” íƒ€ì…ì´ chr, ord ì…ë‹ˆë‹¤.

```python
[14] : chr(int('00100001',base=2))
'!'
[15] : ord('!') # ë¬¸ìë§Œ(char) ì •ìˆ˜ë¡œ ë°”ê¾¸ì–´ì¤ë‹ˆë‹¤.
33
```

## Bit Stream ë‹¤ë£¨ê¸°

ì§€ê¸ˆê¹Œì§€ ê¸¸ì´ê°€ ì§§ì€ ë°ì´í„°ë¥¼ ë‹¤ë£¨ì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë§Œì•½, jpg, mp4 ë“±ì˜ íŒŒì¼ íƒ€ì…ì— ëŒ€í•´ì„œ Bit ì¡°ì‘ì„ í•´ì•¼ í•œë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”? ì €ëŠ” `bitstring` ê³¼ `hexdump` ë¥¼ ì´ìš©í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.

```bash
Raw Data <-------------> Bitstring <---------------> Raw Data
```

### bitstring í´ë˜ìŠ¤

bitstring ì€ ì•„ë˜ì˜ í´ë˜ìŠ¤ë“¤ì„ ì œê³µí•´ì¤ë‹ˆë‹¤. ê·¸ë¦¬ê³  ê·¸ ì—­í• ë“¤ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

| No. | class | descr |
|:----:|:----:|:----:|
| 1 | bitstring.Bits (object) | ê°€ì¥ ê¸°ë³¸ í´ë˜ìŠ¤ë¡œ `immutable` í•œ ì†ì„±ì„ ê°€ì§‘ë‹ˆë‹¤. ì¦‰, í•œë²ˆ ìƒì„± ì´í›„ ê°’ì„ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. |
| 2 | bitstring.BitArray (Bits) | Bits ì— ëŒ€í•´ ë³€ê²½(mutation) ì†ì„±ì„ ì¶”ê°€í•œ ê²ƒì…ë‹ˆë‹¤. ì¦‰, ë³€ê²½ ê°€ëŠ¥í•©ë‹ˆë‹¤. |
| 3 | bitstring.ConstBitStream (Bits) | bits ë¥¼ ìŠ¤íŠ¸ë¦¼ì²˜ëŸ¼ ë‹¤ë£¨ë„ë¡ ë©”ì„œë“œì™€ í”„ë¡œí¼í‹°ë¥¼ ì œê³µí•©ë‹ˆë‹¤. position ì— ê¸°ë°˜í•œ ì½ê¸°(read) ì™€ parse ë¥¼ ì œê³µí•©ë‹ˆë‹¤. |
| 4 | bitstring.BitStream (BitArray, ConstBitStream) | ê°€ì¥ ë‹¤ì¬ ë‹¤ëŠ¥í•œ í´ë˜ìŠ¤ì…ë‹ˆë‹¤. bistream ì˜ ê¸°ëŠ¥ê³¼ mutating ê¸°ëŠ¥ì´ í•©ì³ì ¸ ìˆìŠµë‹ˆë‹¤. |

{% include advertisements.html %}

ì´ ì¥ì—ì„œëŠ” BitArray ì™€ ConstBitStream ì„ ë‹¤ë£¨ì–´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

### BitArray

BitArray ëŠ” Hex String (0x0001, 0xff ë“±), Binary String (0b0101010, ... ë“±), int (12, 13, ... ë“±), Raw Byte ë¥¼ ì…ë ¥ë°›ì•„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•œë²ˆ ì˜ˆì‹œë¥¼ ë³¼ê¹Œìš”?

```python
from bitstring import BitArray, ConstBitStream
# Hex String
[15] : BitArray(hex='000001b3').hex
'000001b3'
# Binary String
[16] : BitArray(bin='0011 00').bin
'001100'
# uint (ì •ìˆ˜)
[17] : BitArray(uint=45, length=12).bin
'000000101101'
# Bytes
[18] : BitArray(bytes=b'\x01\x02\x03\x04\x05', length=32, offset=8).bytes
b'\x02\x03\x04\x05'
[18] : BitArray(bytes=b'\x01\x02\x03\x04\x05', length=32, offset=4)
BitArray('0x10203040')
```

{% include advertisements.html %}

ìœ„ì—ì„œ BitArray ì˜ offset ì†ì„±ì€ ì¢Œì¸¡ì—ì„œ offset ë¹„íŠ¸ ìˆ˜ë§Œí¼ ê±´ë„ˆëœ€ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì¦‰ ì²˜ìŒì„ 0 ì´ë¼ê³  í•œë‹¤ë©´ 4 ë¹„íŠ¸ ê±´ë„ˆë›°ì–´ì„œ ë°ì´í„°ë¥¼ ì½ì–´ëƒ…ë‹ˆë‹¤. ê·¸ë¦¬ê³  length ëŠ” ë°ì´í„°ì—ì„œ ì–¼ë§ˆë§Œí¼ ì½ì–´ì˜¬ ê²ƒì¸ê°€ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. 32 ë¼ê³  ê¸°ì…í•œ ê²½ìš° 4 Bytes ë¥¼ ì½ìŠµë‹ˆë‹¤. 

`BitArray(bytes=b'\x01\x02\x03\x04\x05', length=32, offset=4)` ì˜ ê²½ìš° `Bits ì—ì„œ 4 bits ë§Œí¼ ê±´ë„ˆë›´ ìœ„ì¹˜ì—ì„œ 32 bits ë§Œí¼ì„ ì½ì–´ì˜¨ë‹¤.` ë¼ê³  í•´ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ConstBitStream

ConstBitStream ì€ ëŒ€í‘œì ìœ¼ë¡œ ì•„ë˜ì˜ ë©”ì„œë“œì™€ í”„ë¡œí¼í‹°ë¥¼ ì œê³µí•©ë‹ˆë‹¤. 

- pos : Bit Stream ì—ì„œ í¬ì¸í„°ì˜ ìœ„ì¹˜ë¥¼ ê°€ë¦¬í‚µë‹ˆë‹¤.
- peek : í˜„ì¬ì˜ í¬ì¸í„° ìœ„ì¹˜ì—ì„œ í¬ì¸í„°ë¥¼ ë³€ê²½í•˜ì§€ ì•Šê³  ì§€ì •í•œ bit ìˆ˜ ë§Œí¼ ë°ì´í„°ë¥¼ ì½ì–´ì˜µë‹ˆë‹¤.
- read : í˜„ì¬ì˜ í¬ì¸í„° ìœ„ì¹˜ì—ì„œ í¬ì¸í„°ë¥¼ ë³€ê²½í•˜ë©´ì„œ ì§€ì •í•œ bit ìˆ˜ ë§Œí¼ì˜ ë°ì´í„°ë¥¼ ì½ì–´ì˜µë‹ˆë‹¤.

{% include advertisements.html %}

#### read ë©”ì„œë“œ

read ë©”ì„œë“œëŠ” ì•„ë˜ì˜ Return Format ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¦‰, íŠ¹ì • ê¸¸ì´ë§Œí¼ ë°ì´í„°ë¥¼ ì½ì–´ì˜¨ë‹¤ë©´ ì´ë¥¼ ì¶œë ¥í•˜ëŠ” íƒ€ì…ì„ ì§€ì •í•  ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì§€ì›í•˜ëŠ” í¬ë§·ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

- `int:n`
  - n bits as a signed integer.
- `uint:n`
  - n bits as an unsigned integer.
- `hex:n`
  - n bits as a hexadecimal string.
- `bin:n`
  - n bits as a binary string.
- `bits:n`
  - n bits as a new bitstring.
- `bytes:n`
  - n bytes as bytes object.

- ì•„ë˜ëŠ” ìƒ˜í”Œ ì˜ˆì‹œ ì…ë‹ˆë‹¤. 

```python
# read('uint:n') 
[1] : s = ConstBitStream('0x1234')
[2] : s.read('uint:4')
1
[3] : s.read('uint:4')
2
[4] : s.read('uint:4')
3
[5] : s.read('uint:4')
4
```

```python
# read('bin:n') 
[1] : s = ConstBitStream('0x1234')
[2] : s.read('bin:4')
'0001'
[3] : s.read('bin:4')
'0010'
[4] : s.read('bin:4')
'0011'
[5] : s.read('bin:4')
'0100'
```

### ì‘ìš©í•˜ê¸° MP4 íŒŒì¼ ì²˜ë¦¬í•˜ê¸°

ConstBitStream ì„ ì´ìš©í•˜ë©´ Raw ë°ì´í„°ë¥¼ ì‰½ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆì„ ê²ƒì´ë¼ëŠ” í™•ì‹ ì´ ë“¤ê¸° ì‹œì‘í•©ë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ MP4  ë™ì˜ìƒ ë°ì´í„°ë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ì€ ë’¤ì— ì´ë¥¼ Bit Stream ì²˜ëŸ¼ ì²˜ë¦¬í•´ ë³´ê² ìŠµë‹ˆë‹¤.

hexdump ì™€ ê²°í•©í•˜ë‹ˆ ê°€ì‹œì„±ë„ ë‚˜ì•„ì§€ê³  Raw ë°ì´í„°ê°€ ì†ì— ì¡íŒ ë“¯ í•©ë‹ˆë‹¤. Raw Packet ë°ì´í„°ë¥¼ ì½ì–´ì™€ì„œ ë‹¤ë£° ë•Œì—ë„ ë§¤ìš° ì¢‹ì„ ê²ƒìœ¼ë¡œ ìƒê°ë©ë‹ˆë‹¤.

{% include advertisements.html %}

```python
from requests import get
from os import path

def download_file_from_url(url, rename_as=None):
    """ Url ë¡œë¶€í„° íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ ë°›ìŠµë‹ˆë‹¤. """
    if not rename_as:
        rename_as = url.split('/')[-1]
    
    fullpath = path.join(path.abspath(path.curdir), rename_as)
    
    with open(rename_as, 'wb') as wf:
        with get(url, stream=True) as response:
            response.raise_for_status()
            content_length = response.headers.get('content-length')
            for chunk in response.iter_content(8192):
                wf.write(chunk)
    return path.join(path.abspath(path.curdir), rename_as)

MP4_SAMPLE = 'https://www.bogotobogo.com/FFMpeg/images/concat/yosemiteA.mp4'
download_file_from_url(MP4_SAMPLE) # íŒŒì¼ ë‹¤ìš´ë¡œë“œ ë° í˜„ì¬ ë””ë ‰í„°ë¦¬ì— ì €ì¥

with open('./yosemiteA.mp4', 'rb') as rf:
    # 240 bytes ë§Œí¼ì„ mp4 ë°ì´í„°ì—ì„œ ì½ì–´ì˜¤ê³ , BitStream ì€ 120*8*2 bits ë§Œí¼ ì½ì–´ì˜µë‹ˆë‹¤.
    stream = ConstBitStream(bytes = rf.read(120*2), length=120*8*2)
    print("0x%x" % stream.pos)
    hexdump(stream.read(120*8*2).bytes)
    # í¬ì¸í„°(=pos) ê°’ì„ ë³€ê²½í•˜ì—¬ ë‹¤ì‹œ ì½ì–´ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    stream.pos = 0
    print("pos: 0x%x \n bitpos: 0x%x " % (stream.pos, stream.bitpos ))
    
    hexdump(stream.read(120*8).bytes)
```

- ì•„ë˜ëŠ” ì¶œë ¥ ë°ì´í„°ì…ë‹ˆë‹¤.

{% include advertisements.html %}

```bash
0x0
00000000: 00 00 00 18 66 74 79 70  6D 70 34 32 00 00 00 00  ....ftypmp42....
00000010: 69 73 6F 6D 6D 70 34 32  00 01 1D 5B 6D 6F 6F 76  isommp42...[moov
00000020: 00 00 00 6C 6D 76 68 64  00 00 00 00 CF 38 D9 61  ...lmvhd.....8.a
00000030: CF 38 D9 61 00 00 02 58  00 02 2B F9 00 01 00 00  .8.a...X..+.....
00000040: 01 00 00 00 00 00 00 00  00 00 00 00 00 01 00 00  ................
00000050: 00 00 00 00 00 00 00 00  00 00 00 00 00 01 00 00  ................
00000060: 00 00 00 00 00 00 00 00  00 00 00 00 40 00 00 00  ............@...
00000070: 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  ................
00000080: 00 00 00 00 00 00 00 00  00 00 00 03 00 00 00 15  ................
00000090: 69 6F 64 73 00 00 00 00  10 07 00 4F FF FF 29 15  iods.......O..).
000000A0: FF 00 00 64 F9 74 72 61  6B 00 00 00 5C 74 6B 68  ...d.trak...\tkh
000000B0: 64 00 00 00 0F 00 00 00  00 CF 38 D9 69 00 00 00  d.........8.i...
000000C0: 01 00 00 00 00 00 02 2B  ED 00 00 00 00 00 00 00  .......+........
000000D0: 00 00 00 00 00 00 00 00  00 00 01 00 00 00 00 00  ................
000000E0: 00 00 00 00 00 00 00 00  00 00 01 00 00 00 00 00  ................
pos: 0x0 
 bitpos: 0x0 
00000000: 00 00 00 18 66 74 79 70  6D 70 34 32 00 00 00 00  ....ftypmp42....
00000010: 69 73 6F 6D 6D 70 34 32  00 01 1D 5B 6D 6F 6F 76  isommp42...[moov
00000020: 00 00 00 6C 6D 76 68 64  00 00 00 00 CF 38 D9 61  ...lmvhd.....8.a
00000030: CF 38 D9 61 00 00 02 58  00 02 2B F9 00 01 00 00  .8.a...X..+.....
00000040: 01 00 00 00 00 00 00 00  00 00 00 00 00 01 00 00  ................
00000050: 00 00 00 00 00 00 00 00  00 00 00 00 00 01 00 00  ................
00000060: 00 00 00 00 00 00 00 00  00 00 00 00 40 00 00 00  ............@...
00000070: 00 00 00 00 00 00 00 00                           ........
```

{% include advertisements.html %}

## ê²°ë¡ 

ì§€ê¸ˆê¹Œì§€ Raw ë°ì´í„°ë¥¼ bit ìˆ˜ì¤€ìœ¼ë¡œ ë‹¤ë£¨ëŠ” bitstring ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤. BitStream ì´ ì œê³µí•˜ëŠ” ë©”ì„œë“œì™€ í”„ë¡œí¼í‹°ë¥¼ í™•ì¸í•´ë³´ë‹ˆ Raw Packet ë°ì´í„°ë¥¼ ì½ì–´ì™€ Protocol Spec ì— ê¸°ë¡ëœ í•„ë“œì˜ ë°ì´í„°ë¥¼ ì½ì–´ë“¤ì—¬ ì¶œë ¥í•˜ëŠ” Packet Decoder í”„ë¡œê·¸ë¨ë„ ì‰½ê²Œ ì‘ì„±í•  ìˆ˜ ìˆì„ ê²ƒìœ¼ë¡œ ìƒê°ë©ë‹ˆë‹¤. ì§€ê¸ˆê¹Œì§€ **ì½”ë§ˆ** ì˜€ìŠµë‹ˆë‹¤.

êµ¬ë…í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ë”ìš± ì¢‹ì€ ë‚´ìš©ìœ¼ë¡œ ì°¾ì•„ëµ™ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤

# ì°¸ì¡°

ì´ë²ˆ ì‹œê°„ì— ì°¸ì¡°í•œ ë§í¬ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. ì˜ ì •ë¦¬í•˜ì…”ì„œ í•„ìš”í•  ë•Œ ì‚¬ìš©í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤.

- [git-scm : Git On the Server](https://git-scm.com/book/en/v2/Git-on-the-Server-Setting-Up-the-Server)

