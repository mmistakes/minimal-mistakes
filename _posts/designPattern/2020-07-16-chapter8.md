---
title:  "Chapter 8. ê²½ëŸ‰ íŒ¨í„´(Flyweight Pattern)" 

categories:
  -  Design Pattern
tags:
  - [Game Engine, Unity, Design Pattern]

toc: true
toc_sticky: true

date: 2020-07-16
last_modified_at: 2020-07-21
---

ì¸í”„ëŸ°ì— ìˆëŠ” ì´ì¬í™˜ë‹˜ì˜ ê°•ì˜ **ê²Œì„ ë””ìì¸ íŒ¨í„´ with Unity** ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤. ğŸ˜€  
{: .notice--warning}

# Chapter 8. Flyweight Pattern

## ğŸ”” Flyweight Pattern

![image](https://user-images.githubusercontent.com/42318591/87665191-80a23e80-c7a1-11ea-8d87-b713ffece730.png){: width="70%" height="70%"}{: .align-center}

![image](https://user-images.githubusercontent.com/42318591/87665352-c0692600-c7a1-11ea-9833-1b9f6b0ad09e.png){: width="70%" height="70%"}{: .align-center}

> í•œê°œì˜ ê³ ìœ  ìƒíƒœë¥¼ ë‹¤ë¥¸ ê°ì²´ë“¤ì—ì„œ ê³µìœ í•˜ê²Œ ë§Œë“¤ì–´ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì¤„ì¸ë‹¤.

> ë‚´ìš©ì´ ê°™ì€ ê°ì²´ê°€ ì´ë¯¸ ìˆìœ¼ë©´ ìƒˆë¡œ ê°ì²´ë¥¼ ë˜ ë§Œë“¤ì§€ ì•Šê³  ê·¸ ë‚´ìš© ê°™ì€ ê¸°ì¡´ ê°ì²´ë¥¼ ê³µìœ í•œë‹¤.

- ê²Œì„ ë‚´ì—ì„œ ê°™ì€ ë©”ì‹œì™€ í…ìŠ¤ì²˜ë¥¼ ì—¬ëŸ¬ë²ˆ ë©”ëª¨ë¦¬ì— ì˜¬ë¦´ í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— 
- `TreeModel` ê°ì²´ëŠ” í•˜ë‚˜ë§Œ ì¡´ì¬í•˜ë©° ê° ë‚˜ë¬´ ì¸ìŠ¤í„´ìŠ¤ë“¤ì€ ì´ `TreeModel` ê°ì²´ í•˜ë‚˜ë¥¼ <u>ê³µìœ í•˜ë©° ì°¸ì¡°í•  ë¿ì´ë‹¤.</u>
- Tree í´ë˜ìŠ¤ì—ì„œëŠ” ì¸ìŠ¤í„´ìŠ¤ë³„ë¡œ ë‹¤ë¥¸ ìƒíƒœê°’ë§Œ ë‚¨ê²¨ë‘”ë‹¤. 
- **í”Œë¼ì´ì›¨ì´íŠ¸ íŒ¨í„´**ì—ì„œì˜ ê°ì²´ ë°ì´í„° ì¢…ë¥˜
  1. ëª¨ë“  ê°ì²´ì˜ ë°ì´í„° ê°’ì´ ê°™ì€ ë¶€ë¶„ë“¤ë§Œ ëª¨ì•„ë‘” ë°ì´í„°. ì¦‰ ê³µìœ í•  ìˆ˜ ìˆëŠ” ë°ì´í„°.
  2. ë‚˜ë¨¸ì§€ ë°ì´í„°ëŠ” ì¸ìŠ¤í„´ìŠ¤ë³„ë¡œ ê°’ì´ ë‹¤ë¥¸ ì™¸ë¶€ ìƒíƒœì— í•´ë‹¹.
- ìƒì„±ëœ ê°ì²´ë¥¼ ê³µìœ í•˜ëŠ” ê²ƒì´ë¼ì„œ C++ í¬ì¸í„° ê°œë…ê³¼ë„ ê°™ë‹¤.

### êµ¬í˜„

- ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìš”ì²­ ë°›ì•˜ì„ ë•Œ <u>ì´ì „ì— ê°™ì€ê±¸ ë§Œë“¤ì–´ ë†“ì€ê²Œ ìˆëŠ”ì§€ í™•ì¸í•´ë³´ê³  ìˆë‹¤ë©´ ê·¸ê±¸ ë¦¬í„´</u>í•´ì•¼ ê³µìœ  ê¸°ëŠ¥ì´ ìœ ì§€ëœë‹¤.
  - ì´ëŸ¬ë ¤ë©´ ì´ëŸ° ì½”ë“œë¥¼ <u>ì¸í„°í˜ì´ìŠ¤ ë°‘ìœ¼ë¡œ ìˆ¨ê²¨ë‘ì–´ì•¼ í•œë‹¤.</u>
    - `íŒ©í† ë¦¬ ë©”ì„œë“œ íŒ¨í„´`
  - ì´ë¯¸ ìƒì„±í•´ë†“ì€ ê°ì²´ë¥¼ ì°¾ì„ ìˆ˜ ì´ë„ë¡ Poolì„ ê´€ë¦¬í•´ì•¼ í•œë‹¤.
    - [ë‹¤ìŒ í¬ìŠ¤íŠ¸](https://ansohxxn.github.io/design%20pattern/chapter9/)ì—ì„œ ë°°ìš¸ `ì˜¤ë¸Œì íŠ¸ í’€ íŒ¨í„´`ì´ ì—¬ê¸°ì— ì‚¬ìš© ë¨.

<br>

## ğŸ”” ì˜ˆì œ 1

### ğŸ“œUnit.cs

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public interface Unit {   // ì¸í„°í˜ì´ìŠ¤
  
    string getName();
}

public class Marine : Unit   
{
    string name;
    int hp;

    public Marine(string name)
    {
        this.name = name;
    }

    public string getName()   // ì˜¤ë²„ë¼ì´ë”©
    {
        return name;
    }
}
```

<br>

### ğŸ“œUnitFactory.cs

- ìƒì„±ëœ Marine ê°ì²´ë“¤ì„ Dictionary ìë£Œ êµ¬ì¡°ì— ë³´ê´€í•˜ì—¬ ê´€ë¦¬í•œë‹¤.
  - *name* ì´ ê°™ì€ Marineì´ë©´ ìƒˆë¡œ ë§Œë“¤ì§€ ì•Šê³  ê·¸ *name*ì´ ê°™ì€ ê¸°ì¡´ Marine ê°ì²´ë¥¼ ë¦¬í„´í•´ì¤€ë‹¤.
    - ë‚´ìš© ê°™ìœ¼ë©´ ìƒˆë¡œ ë§Œë“¤ì§€ ì•Šê¸° ìœ„í•˜ì—¬. for ë©”ëª¨ë¦¬ ì ˆì•½
  - í˜„ì¬ ìƒì„±ëœ Marine ê°ì²´ë“¤ ì¤‘ ê°™ì€ *name* ì„ ê°€ì§„ ê°ì²´ê°€ ì—†ì„ ê²½ìš°ì—ë§Œ ìƒì„±í•˜ê³  ì´ë¥¼ Dictionaryì— ì¶”ê°€í•´ì¤€ë‹¤.
  - ë§Œì•½ *name* ê°™ì€ Marine ê°ì²´ê°€ ìˆë‹¤ë©´ ê¸°ì¡´ ê·¸ ê°ì²´ë¥¼ ë¦¬í„´í•œë‹¤.

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class UnitFactory : MonoBehaviour {

    static Dictionary<string, Marine> dic = new Dictionary<string, Marine>();  // ì´ë¯¸ ìƒì„±í•´ë†“ì€ Marine ê°ì²´ê°€ ìˆëŠ”ì§€ ê´€ë¦¬í•´ì•¼ í•´ì„œ

    public static Marine getPerson(string name)
    {
        if (!dic.ContainsKey(name))   // í•´ë‹¹ ì´ë¦„ì˜ ìƒì„±í•´ ë†“ì€ ê°ì²´ê°€ ì—†ì„ ë•Œë§Œ ìƒì„±
        {
            Marine tmp = new Marine(name);
            dic.Add(name, tmp);  // Dictionary ì— ì¶”ê°€
        }
        return dic[name];  // ë§Œë“¤ì–´ë‘”ê±° ë¦¬í„´
    }
}

```

<br>

### ğŸ“œFlyweightUse.cs

- `p3`ê°ì²´ê°€ ìƒì„±ë  ë•Œ ì´ë¦„ì´ "í™ê¸¸ë™"ìœ¼ë¡œ ê°™ì€ `p1` ê°ì²´ê°€ ì´ë¯¸ ìˆê¸° ë•Œë¬¸ì— ìƒˆë¡­ê²Œ ìƒì„±í•˜ì§€ ì•ŠëŠ”ë‹¤.
  - `p3`ì€ ê¸°ì¡´ì— ìƒì„± ë˜ì—ˆë˜ `p1`ê°ì²´ë¥¼ ë¦¬í„´ë°›ê²Œ ë˜ë©° 
  - `p1`ê³¼ `p3`ì€ ë™ì¼í•œ ê°ì²´ë¥¼ ê°€ë¦¬í‚¨ë‹¤. 

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class FlyweightUse : MonoBehaviour {

	void Start () {
        Marine p1 = UnitFactory.getPerson("í™ê¸¸ë™");
        Marine p2 = UnitFactory.getPerson("ì „ìš°ì¹˜");
        Marine p3 = UnitFactory.getPerson("í™ê¸¸ë™");

        Debug.Log(p1 == p2);  // ë‘˜ì´ ë‹¤ë¥´ë‹¤.
        Debug.Log(p1 == p3);  // ë‘˜ì´ ë™ì¼í•˜ë‹¤.

        Debug.Log("name : " + p1.getName());
    }

}
```

<br>

## ğŸ”” ì˜ˆì œ 2

> ìœ ë‹ˆí‹° ì˜¤ë¸Œì íŠ¸ì— ì ìš©í•˜ê¸°

- ìœ ë‹ˆí‹° ì˜¤ë¸Œì íŠ¸ë“¤ì€(ì •í™•íˆ ë§í•˜ë©´ ì˜¤ë¸Œì íŠ¸ì— ë¶™ì–´ìˆëŠ” ì»´í¬ë„ŒíŠ¸ë“¤) `MonoBehaviour`ë¥¼ ìƒì† ë°›ëŠ”ë‹¤.
  - `MonoBehaviour`ë¥¼ ìƒì† ë°›ëŠ” ì˜¤ë¸Œì íŠ¸ë“¤ì€ `new`ë¥¼ í†µí•´ ìƒì„±í•˜ë©´ ì•ˆëœë‹¤.

### ğŸ“œUnit.cs

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public interface Unit {   // ì¸í„°í˜ì´ìŠ¤
  
    string getName();
    void setName(string name);
}
```

<br>

### ğŸ“œMarine.cs

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class Marine : MonoBehaviour, Unit
{
    public string name;
    public int hp;

    public void setName(string name)
    {
        this.name = name;
    }

    public string getName()
    {
        return name;
    }

    void Start()
    {

    }
}

```

<br>

### ğŸ“œUnitFactory.cs

- ìƒì„±ëœ Marine ê°ì²´ë“¤ì„ Dictionary ìë£Œ êµ¬ì¡°ì— ë³´ê´€í•˜ì—¬ ê´€ë¦¬í•œë‹¤.
  - *name* ì´ ê°™ì€ Marineì´ë©´ ìƒˆë¡œ ë§Œë“¤ì§€ ì•Šê³  ê·¸ *name*ì´ ê°™ì€ ê¸°ì¡´ Marine ê°ì²´ë¥¼ ë¦¬í„´í•´ì¤€ë‹¤.
    - ë‚´ìš© ê°™ìœ¼ë©´ ìƒˆë¡œ ë§Œë“¤ì§€ ì•Šê¸° ìœ„í•˜ì—¬. for ë©”ëª¨ë¦¬ ì ˆì•½
  - í˜„ì¬ ìƒì„±ëœ Marine ê°ì²´ë“¤ ì¤‘ ê°™ì€ *name* ì„ ê°€ì§„ ê°ì²´ê°€ ì—†ì„ ê²½ìš°ì—ë§Œ ìƒì„±í•˜ê³  ì´ë¥¼ Dictionaryì— ì¶”ê°€í•´ì¤€ë‹¤.
  - ë§Œì•½ *name* ê°™ì€ Marine ê°ì²´ê°€ ìˆë‹¤ë©´ ê¸°ì¡´ ê·¸ ê°ì²´ë¥¼ ë¦¬í„´í•œë‹¤.

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class UnitFactory : MonoBehaviour {

    Dictionary<string, GameObject> dic = new Dictionary<string, GameObject>();
    public GameObject marine;

    public GameObject getMarine(string name)
    {
        if (!dic.ContainsKey(name))
        {
            float x = (float)Random.Range(-10, 11);
            float z = (float)Random.Range(-10, 11);
            Vector3 pos = new Vector3(x, 1.0f, z);

            //Marine obj = new Marine(name);
            GameObject obj = Instantiate(marine, pos, Quaternion.identity);
            obj.GetComponent<Marine>().setName(name);
            dic.Add(name, obj);
        }
        return dic[name];
    }
}


```

<br>

### ğŸ“œFlyweightUse.cs

- `p3`ê°ì²´ê°€ ìƒì„±ë  ë•Œ ì´ë¦„ì´ "í™ê¸¸ë™"ìœ¼ë¡œ ê°™ì€ `p1` ê°ì²´ê°€ <u>ì´ë¯¸ ìˆê¸° ë•Œë¬¸ì— ìƒˆë¡­ê²Œ ìƒì„±í•˜ì§€ ì•ŠëŠ”ë‹¤.</u>
  - `p3`ì€ ê¸°ì¡´ì— ìƒì„± ë˜ì—ˆë˜ `p1`ê°ì²´ë¥¼ ë¦¬í„´ë°›ê²Œ ë˜ë©° 
  - `p1`ê³¼ `p3`ì€ ë™ì¼í•œ ê°ì²´ë¥¼ ê°€ë¦¬í‚¨ë‹¤. 
 
> ì•„ë˜ ì½”ë“œì—ì„œ <u>ì˜¤ë¸Œì íŠ¸ ë°ì´í„°ëŠ” ë‹¨ 2ê°œ</u>ì¼ë¿ì´ë©° ëŒ€ì‹  <u>ë Œë”ë§ì€ 3ê°œê°€ ëœë‹¤.</u> 

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class FlyweightUse : MonoBehaviour {

	void Start () {
        UnitFactory factory = GetComponent<UnitFactory>();

        for (int i=0; i< 10; i++)
        {
            factory.getMarine("í™ê¸¸ë™" + i);
        }

        GameObject p1 = factory.getMarine("í™ê¸¸ë™");
        GameObject p2 = factory.getMarine("ì „ìš°ì¹˜");
        GameObject p3 = factory.getMarine("í™ê¸¸ë™");

        if (p1 == p3)
        {
            Debug.Log("name : " + p1.GetComponent<Marine>().getName());
        }
    }
}

```

***
<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}
