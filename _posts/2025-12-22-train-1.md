---
layout: single
title:  "2025-12-22 Python Training"
---
✅ 문제  
1) 코딩  
아래 규칙으로 결측치를 채워 df_filled를 만들어라. (원본 df는 변경하지 말 것)  
glc, lac 각각에 대해  
같은 batch 내에서 선형 보간(interpolate, 양방향 허용) 으로 결측치를 채운다.  
단, batch의 맨 앞/맨 끝이 결측인 경우도 채워져야 한다.  
df_filled에 아래 컬럼을 추가한 df_feat를 만들어라.  
glc_delta = batch별로 glc의 전날 대비 변화량 (diff)  
lac_delta = batch별로 lac의 전날 대비 변화량 (diff)  
첫 day의 delta는 NaN이어도 된다.  
2) 분석  
batch별로 아래를 계산해 df_summary를 만들어라.  
batch  
glc_min : glc 최솟값  
lac_max : lac 최댓값  
num_days_glc_decrease : glc_delta < 0 인 day 개수 (NaN은 제외)


```python
import pandas as pd

df = pd.DataFrame({
    "batch": ["B1","B1","B1","B2","B2","B2","B3","B3","B3"],
    "day":   [1,2,3,1,2,3,1,2,3],
    "glc":   [5.0, 4.2, None, 5.1, None, 4.0, None, 4.8, 4.4],
    "lac":   [0.8, 1.1, 1.6, 0.7, 1.0, None, 0.9, None, 1.5]
})
```


```python
display(df)
```


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>batch</th>
      <th>day</th>
      <th>glc</th>
      <th>lac</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>B1</td>
      <td>1</td>
      <td>5.0</td>
      <td>0.8</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B1</td>
      <td>2</td>
      <td>4.2</td>
      <td>1.1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>B1</td>
      <td>3</td>
      <td>NaN</td>
      <td>1.6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>B2</td>
      <td>1</td>
      <td>5.1</td>
      <td>0.7</td>
    </tr>
    <tr>
      <th>4</th>
      <td>B2</td>
      <td>2</td>
      <td>NaN</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>B2</td>
      <td>3</td>
      <td>4.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>6</th>
      <td>B3</td>
      <td>1</td>
      <td>NaN</td>
      <td>0.9</td>
    </tr>
    <tr>
      <th>7</th>
      <td>B3</td>
      <td>2</td>
      <td>4.8</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8</th>
      <td>B3</td>
      <td>3</td>
      <td>4.4</td>
      <td>1.5</td>
    </tr>
  </tbody>
</table>
</div>



```python
df_filled = df.copy()
df_filled[['glc','lac']] = df_filled.groupby('batch')[['glc','lac']].transform(
    lambda batch: batch.interpolate(method='linear', limit_direction='both'))
display(df_filled)
```


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>batch</th>
      <th>day</th>
      <th>glc</th>
      <th>lac</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>B1</td>
      <td>1</td>
      <td>5.00</td>
      <td>0.8</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B1</td>
      <td>2</td>
      <td>4.20</td>
      <td>1.1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>B1</td>
      <td>3</td>
      <td>4.20</td>
      <td>1.6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>B2</td>
      <td>1</td>
      <td>5.10</td>
      <td>0.7</td>
    </tr>
    <tr>
      <th>4</th>
      <td>B2</td>
      <td>2</td>
      <td>4.55</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>B2</td>
      <td>3</td>
      <td>4.00</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>B3</td>
      <td>1</td>
      <td>4.80</td>
      <td>0.9</td>
    </tr>
    <tr>
      <th>7</th>
      <td>B3</td>
      <td>2</td>
      <td>4.80</td>
      <td>1.2</td>
    </tr>
    <tr>
      <th>8</th>
      <td>B3</td>
      <td>3</td>
      <td>4.40</td>
      <td>1.5</td>
    </tr>
  </tbody>
</table>
</div>



```python
df_feat = df_filled.copy()
df_feat = df_feat.reset_index().sort_values(by='day', ascending=False)
df_feat['glc_delta'] = df_feat.groupby('batch')['glc'].diff(periods=1)
df_feat['lac_delta'] = df_feat.groupby('batch')['lac'].diff(periods=1)
display(df_feat)
```


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>batch</th>
      <th>day</th>
      <th>glc</th>
      <th>lac</th>
      <th>glc_delta</th>
      <th>lac_delta</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>B1</td>
      <td>1</td>
      <td>5.00</td>
      <td>0.8</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B1</td>
      <td>2</td>
      <td>4.20</td>
      <td>1.1</td>
      <td>-0.80</td>
      <td>0.3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>B1</td>
      <td>3</td>
      <td>4.20</td>
      <td>1.6</td>
      <td>0.00</td>
      <td>0.5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>B2</td>
      <td>1</td>
      <td>5.10</td>
      <td>0.7</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>B2</td>
      <td>2</td>
      <td>4.55</td>
      <td>1.0</td>
      <td>-0.55</td>
      <td>0.3</td>
    </tr>
    <tr>
      <th>5</th>
      <td>B2</td>
      <td>3</td>
      <td>4.00</td>
      <td>1.0</td>
      <td>-0.55</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>B3</td>
      <td>1</td>
      <td>4.80</td>
      <td>0.9</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>7</th>
      <td>B3</td>
      <td>2</td>
      <td>4.80</td>
      <td>1.2</td>
      <td>0.00</td>
      <td>0.3</td>
    </tr>
    <tr>
      <th>8</th>
      <td>B3</td>
      <td>3</td>
      <td>4.40</td>
      <td>1.5</td>
      <td>-0.40</td>
      <td>0.3</td>
    </tr>
  </tbody>
</table>
</div>



```python
def count_neg(x):
    val = x < 0
    result = sum(val)
    return result
df_summary = df_feat.groupby('batch').agg({'glc':[('glc_min', 'min')],'lac':[('lac_max','max')],'glc_delta':[('num_days_glc_decrease', count_neg)]})
df_summary.columns = df_summary.columns.droplevel(level=0)
df_summary = df_summary.reset_index(drop=True)
display(df_summary)
```


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>glc_min</th>
      <th>lac_max</th>
      <th>num_days_glc_decrease</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.2</td>
      <td>1.6</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.0</td>
      <td>1.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4.4</td>
      <td>1.5</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>



```python
# 1) fill (keep original df unchanged)
df_filled = df.copy()
df_filled[["glc", "lac"]] = (
    df_filled.groupby("batch")[["glc", "lac"]]
             .transform(lambda g: g.interpolate(method="linear", limit_direction="both"))
)

# enforce required sort
df_filled = df_filled.sort_values(["batch", "day"]).reset_index(drop=True)

# 2) features
df_feat = df_filled.copy()
df_feat["glc_delta"] = df_feat.groupby("batch")["glc"].diff()
df_feat["lac_delta"] = df_feat.groupby("batch")["lac"].diff()

# 3) summary (exact columns + batch as column)
df_summary = (
    df_feat.groupby("batch", as_index=False)
           .agg(
               glc_min=("glc", "min"),
               lac_max=("lac", "max"),
               num_days_glc_decrease=("glc_delta", lambda s: (s < 0).sum())
           )
           .sort_values("batch")
           .reset_index(drop=True)
)

df_filled, df_summary

```




    (  batch  day   glc  lac
     0    B1    1  5.00  0.8
     1    B1    2  4.20  1.1
     2    B1    3  4.20  1.6
     3    B2    1  5.10  0.7
     4    B2    2  4.55  1.0
     5    B2    3  4.00  1.0
     6    B3    1  4.80  0.9
     7    B3    2  4.80  1.2
     8    B3    3  4.40  1.5,
       batch  glc_min  lac_max  num_days_glc_decrease
     0    B1      4.2      1.6                      1
     1    B2      4.0      1.0                      2
     2    B3      4.4      1.5                      1)


