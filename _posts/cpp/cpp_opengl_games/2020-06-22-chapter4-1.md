---
title:  "[C++] 4.1 ì™¸ë¶€ ì´ë¯¸ì§€ ì‚¬ìš©í•˜ê¸°" 

categories:
  - C++ games
tags:
  - [Programming, Cpp, OpenGL, Graphics]

toc: true
toc_sticky: true

date: 2020-06-22
last_modified_at: 2020-06-22
---

ì¸í”„ëŸ°ì— ìˆëŠ” í™ì •ëª¨ êµìˆ˜ë‹˜ì˜ **í™ì •ëª¨ì˜ ê²Œì„ ë§Œë“¤ê¸° ì—°ìŠµ ë¬¸ì œ íŒ¨í‚¤ì§€** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤.ğŸ˜€   
[ğŸŒœ ê³µë¶€ì— ì‚¬ìš©ëœ í™ì •ëª¨ êµìˆ˜ë‹˜ì˜ ì½”ë“œë“¤ ë³´ëŸ¬ê°€ê¸°](https://github.com/jmhong-simulation/GameDevPracticePackage)   
[ğŸŒœ [í™ì •ëª¨ì˜ ê²Œì„ ë§Œë“¤ê¸° ì—°ìŠµ ë¬¸ì œ íŒ¨í‚¤ì§€] ê°•ì˜ ë“¤ìœ¼ëŸ¬ ê°€ê¸°!](https://www.inflearn.com/course/c-2)
{: .notice--warning}

<br>

# Chapter 4. ì™¸ë¶€ ì´ë¯¸ì§€ ì‚¬ìš©í•˜ê¸°
*ë“œë””ì–´ ë§ˆì§€ë§‰ ì±•í„°!!* ğŸ™†â€â™‚ï¸

## ğŸ”” stb ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜í•˜ê¸°

- ìš°ì„  ì™¸ë¶€ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ `stb ë¼ì´ë¸ŒëŸ¬ë¦¬`ë¥¼ ì„¤ì¹˜í•´ì•¼í•œë‹¤
  - cmdì—ì„œ cdë¥¼ í†µí•´ vcpkg í´ë”ë¡œ ì´ë™í•œ í›„ ***vcpkg - install -stb:x64-windows*** ëª…ë ¹ì–´ë¡œ ì„¤ì¹˜í•˜ê¸°
    - ì„¤ì¹˜ ì¢€ ë§ì´ ì˜¤ë˜ê±¸ë¦°ë‹¤.
- ***ë¹„ì£¼ì–¼ ìŠ¤íŠœë””ì˜¤ - í”„ë¡œì íŠ¸ ì†ì„± - C/C++ - ì¶”ê°€ í¬í•¨ ë””ë ‰í„°ë¦¬*** ì—ì„œ stb í—¤ë” íŒŒì¼ë“¤ì´ ìˆëŠ” í´ë”ë¥¼ í™˜ê²½ë³€ìˆ˜ë¡œ ì§€ì •í•´ì£¼ê¸°

### ì½”ë“œ

![image](https://user-images.githubusercontent.com/42318591/85297054-3f3dac80-b4dd-11ea-8307-477f810e4ea3.png){: width="70%" height="70%"}{: .align-center}

```cpp
#include "Game2D.h"
#include "Examples/PrimitivesGallery.h"
#include "RandomNumberGenerator.h"
#include "ImageObject.h"
#include <vector>
#include <memory>

namespace jm
{
	using namespace std;

	class Example : public Game2D
	{
	public:

		ImageObject house;
		ImageObject background;
		ImageObject sentence;

		Example()
			: Game2D("This is my digital canvas!", 1280, 960, false) // MUST initialize Game2D
		{
			house.init("car.png", 255, 255, 255); // white to transparent
			background.init("Background_image.bmp");
			sentence.init("sentence.png");
		}

		void update() override
		{
			beginTransformation();
			scale(1.5f, 1.5f);
			background.draw();
			endTransformation();
			
			beginTransformation();
			translate(-0.5f, 0.0f);
			drawFilledStar(Colors::gold, 0.2f, 0.1f); // ë³„ê·¸ë¦¬ê¸°
			endTransformation();

			beginTransformation();
			translate(0.0f, 0.5f);
			scale(0.5f, 0.5f);
			sentence.draw();
			endTransformation();

			// moving car
			{
				static float x = -1.0f;

				beginTransformation();
				translate(x, 0.0f);
				scale(0.5f, 0.5f);
				house.draw();
				endTransformation();

				x += 0.01f;

				if (x > 1.0f) x = -1.0f;
			}

			beginTransformation();
			translate(0.5f, 0.0f);
			drawFilledStar(Colors::red, 0.2f, 0.1f); // ë³„ê·¸ë¦¬ê¸°
			endTransformation();

			//background.draw(); //this hides everything ë®ì–´ì”Œì›Œì§€ë‹ˆê¹Œ 
		}
	};
}

int main(void)
{
	jm::Example().run();

	return 0;

```

- #include "ImageObject.h"
  - `ImageObject.h` í´ë˜ìŠ¤ í—¤ë”íŒŒì¼ì„ include í•´ì¤€ë‹¤.
  - ImageObject
    - <u>ì´ë¯¸ì§€ ê°ì²´</u>ì˜ ì—­í• ì„ í•  ê²ƒì´ë‹¤.
      - *ImageObject house*
        - ì°¨ ì´ë¯¸ì§€
      - *ImageObject background*
        - ë°°ê²½ ì´ë¯¸ì§€
      - *ImageObject sentence*
        - ë¬¸êµ¬ ì´ë¯¸ì§€
- *ìƒì„±ì*
  - *init í•¨ìˆ˜*
    - ê° ì´ë¯¸ì§€ ê°ì²´ë¥¼ ì´ˆê¸°í™” í•œë‹¤.
    - ê° ì´ë¯¸ì§€ì˜ `íŒŒì¼ëª…(í•„ìˆ˜)` ì„ ë§¤ê°œë³€ìˆ˜ë¡œ ë„˜ê¸´ë‹¤.
      - *house.init("car.png", 255, 255, 255);*
        - ì›í•˜ëŠ” ìƒ‰ì„ íˆ¬ëª…í•˜ê²Œ ë§Œë“¤ì–´ì£¼ëŠ” ì½”ë“œ
        - 255, 255, 255 ëŠ” í•˜ì–€ìƒ‰ì´ë¯€ë¡œ ì´ë¯¸ì§€ ë‚´ì˜ í•˜ì–€ìƒ‰ ë¶€ë¶„ë“¤ì„ íˆ¬ëª…í•˜ê²Œ ë§Œë“¬
      - *house.init("car.png", 0, 0, 0);*
        - ì´ë©´ ê²€ì •ìƒ‰ ë¶€ë¶„ë“¤ì„ íˆ¬ëª…í•˜ê²Œ ë§Œë“¬
- *void update() override*
  - ë°°ê²½ ê·¸ë¦¬ê¸°
    ```cpp
    			beginTransformation();
    			scale(1.5f, 1.5f);
    			background.draw();
    			endTransformation();
    ```
    - ë¬¸ì¥ ê·¸ë¦¬ê¸°
    ```cpp
    			beginTransformation();
    			translate(0.0f, 0.5f);   ì´ë™
    			scale(0.5f, 0.5f);  í¬ê¸°ë¥¼ í‚¤ìš´ í›„ 
    			sentence.draw();
    			endTransformation();
    ```
    - ì›€ì§ì´ëŠ” ì°¨ ê·¸ë¦¬ê¸°
    ```cpp
    			{
    				static float x = -1.0f;

    				beginTransformation();
    				translate(x, 0.0f);
    				scale(0.5f, 0.5f);
    				house.draw();
    				endTransformation();

    				x += 0.01f;

    				if (x > 1.0f) x = -1.0f;
    			}
    ```

- **ë…¸ë€ë³„ â†’ ì°¨ â†’ ë¹¨ê°„ë³„** ìˆœì„œë¡œ ê·¸ë ¸ê¸° ë•Œë¬¸ì— ë…¸ë€ë³„ì€ ì°¨ ë’¤ì—ìˆê³  ë¹¨ê°„ë³„ì€ ì°¨ ì•ì— ë®ëŠ” ì‹ìœ¼ë¡œ ê·¸ë ¤ì§„ë‹¤.

<br>

## ğŸ“œImageObject.h

```cpp
#pragma once

#include "Game2D.h"
#include <string>

namespace jm
{
	using namespace std;

	class ImageObject
	{
	public:
		unsigned int texture;

		float ratio = 1.0f;

		ImageObject()
		{}

		ImageObject(const string & filename)
		{
			init(filename);
		}

		// Use tr_r, tr_g, tr_b set transparent color
		void init(const string & filename, const int tr_r = -1, const int tr_g = -1, const int tr_b = -1);

		void draw();
	};

}
```
- *unsigned int texture*
- *float ratio = 1.0f;*
- *ìƒì„±ì*
    - íŒŒì¼ ì´ë¦„ì„ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ëŠ”ë‹¤.
    - init í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.

<br>

## ğŸ“œImageObject.cpp

```cpp
#include "ImageObject.h"

// https://learnopengl.com/Getting-started/Textures
// vcpkg install stb:x64-windows
#define STB_IMAGE_IMPLEMENTATION
#include "stb_image.h"

namespace jm
{
	// Use tr_r, tr_g, tr_b set transparent color

	void ImageObject::init(const string & filename, const int tr_r, const int tr_g, const int tr_b)
	{
		glEnable(GL_BLEND);
		glEnable(GL_TEXTURE_2D);
		glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);

		int width, height, n_ch;
		unsigned char *data = stbi_load(filename.c_str(), &width, &height, &n_ch, 0);

		if (data)
		{
			if (n_ch == 4)
			{
				int count = 0;
				for (int j = 0; j < height; ++j)
					for (int i = 0; i < width; ++i)
					{
						unsigned char & r = data[count];
						unsigned char & g = data[count + 1];
						unsigned char & b = data[count + 2];

						if (r == tr_r && g == tr_g && b == tr_b)
						{
							data[count + 3] = 0; // alpha = 0 -> transparent
						}

						count += 4;
					}
			}

			//cout << width << " " << height << " " << n_ch << endl;

			ratio = static_cast<float>(width) / static_cast<float>(height);

			glGenTextures(1, &texture);
			glBindTexture(GL_TEXTURE_2D, texture);

			glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);
			glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT);
			glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
			glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);

			if (n_ch == 4)
				glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, width, height, 0, GL_RGBA, GL_UNSIGNED_BYTE, data);
			else if (n_ch == 3)
				glTexImage2D(GL_TEXTURE_2D, 0, GL_RGB, width, height, 0, GL_RGB, GL_UNSIGNED_BYTE, data);
			else
			{
				printf("Use RGB or RGBA images. Your input image has %d channels.", n_ch);
			}

			glGenerateMipmap(GL_TEXTURE_2D);
		}
		else
		{
			std::cout << "Failed to load texture" << std::endl;
		}

		stbi_image_free(data);
	}
	
	void ImageObject::draw()
	{
		glEnable(GL_TEXTURE_2D);
		glEnable(GL_BLEND);
		glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);

		beginTransformation();

		scale(ratio * 0.5f, 1.0f * 0.5f);

		//glActiveTexture(GL_TEXTURE0);
		glBindTexture(GL_TEXTURE_2D, texture);

		glBegin(GL_QUADS);

		glColor3f(1.0f, 1.0f, 1.0f);

		// upside down texture coordinates
		glTexCoord2d(0.0f, 1.0f);
		glVertex2d(-1.0f, -1.0f);

		glTexCoord2d(1.0f, 1.0f);
		glVertex2d(1.0f, -1.0f);

		glTexCoord2d(1.0f, 0.0f);
		glVertex2d(1.0f, 1.0f);

		glTexCoord2d(0.0f, 0.0f);
		glVertex2d(-1.0f, 1.0f);

		/*glTexCoord2d(0.0f, 0.0f);
		glVertex2d(-1.0f, -1.0f);

		glTexCoord2d(1.0f, 0.0f);
		glVertex2d(1.0f, -1.0f);

		glTexCoord2d(1.0f, 1.0f);
		glVertex2d(1.0f, 1.0f);

		glTexCoord2d(0.0f, 1.0f);
		glVertex2d(-1.0f, 1.0f);*/

		glEnd();

		endTransformation();

		glDisable(GL_TEXTURE_2D);
	}
}
```
- *void init (const string & filename, const int tr_r = -1, const int tr_g = -1, const int tr_b = -1);*
  - (tr_r, tr_g, tr_b) ìƒ‰ìƒì„ íˆ¬ëª…í•˜ê²Œ ë§Œë“ ë‹¤.
  - ë§¤ê°œë³€ìˆ˜ ê¸°ë³¸ ê°’ì´ -1ë¡œ ì„¤ì •ë˜ì–´ ìˆì–´ ìƒ‰ìƒ ë§¤ê°œë³€ìˆ˜ êµ³ì´ ë„˜ê¸°ì§€ ì•Šê³  íŒŒì¼ì´ë¦„ë§Œ ë„˜ê²¨ë„ ëœë‹¤.
    - (-1,-1,-1)ì€ ìˆì„ ìˆ˜ ì—†ëŠ” ìƒ‰ìƒì´ë¼ ê·¸ëƒ¥ ë„˜ì–´ê°€ê²Œ ë¨.
  - *glEnable(GL_BLEND);*
    - alpha blendingì„ í•˜ê² ë‹¤ëŠ” ì–˜ê¸°
      - alpha
        - ë¶ˆíˆ¬ëª…ë„
        - alphaê°€ 1ì— ê°€ê¹Œìš°ë©´ ë¶ˆíˆ¬ëª…, 0ì— ê°€ê¹Œìš°ë©´ íˆ¬ëª…
  - *glEnable(GL_TEXTURE_2D);*
    - ì´ë¯¸ì§€ë¥¼ ì½ì–´ì™€ì„œ í…ìŠ¤ì²˜ë¡œ ì‚¬ìš©í•œë‹¤.
  - *glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);*
    - alpha blendingì„ ì–´ë–»ê²Œ í• ì§€ ì„¤ì •
  - *int width, height, n_ch*
  - *unsigned char *data = stbi_load(filename.c_str(), &width, &height, &n_ch, 0);*
    - dataëŠ” ë™ì í• ë‹¹ arrayì˜ í¬ì¸í„°ê°€ ëœë‹¤
    - stb ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ í•¨ìˆ˜ *stbi_load*
      - ì´ë¯¸ì§€ íŒŒì¼ì„ ì½ì–´ì˜¨ë‹¤
      - width, heightëŠ” í•´ìƒë„
      - n_ch
        - ì±„ë„ì˜ ê°œìˆ˜
        - RGB ì´ë ‡ê²Œ 3ê°œì˜ ì±„ë„ì¸ ê²½ìš°  n_ch = 3
        - RGB + alpha ì´ë ‡ê²Œ 4ê°œì˜ ì±„ë„ì¸ ê²½ìš°   n_ch = 4
  - *if (data)* : ë°ì´í„°ê°€ ì œëŒ€ë¡œ ì½ì–´ ì¡Œë‹¤ë©´
    - *if (n_ch == 4)* 
      - 4ì±„ë„ì¸ ê²½ìš°. ì¦‰, alphaë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°
        - íŠ¹ì •í•œ ìƒ‰ ( tr_r, tr_g, tr_b ) ì˜ alphaë¥¼ 0ìœ¼ë¡œ.  (alphaëŠ” 0ì— ê°€ê¹Œìš¸ìˆ˜ë¡ íˆ¬ëª…)
        - ì´ì¤‘ forë¥¼ ëŒë©´ì„œ dataë°°ì—´ë¡œë¶€í„° ëª¨ë“  í•´ìƒë„ í”½ì…€ì˜ ìƒ‰ìƒì„ ê°€ì ¸ì˜¤ë©° ë¹„êµ
- *ratio = static_cast\<float>(width) / static_cast\<float>(height);*
  - widthì™€ heightì˜ ë¹„ìœ¨ ì €ì¥
    - ì •ì‚¬ê°í˜•ì´ë©´ 1ì¼ ê²ƒ.
    - ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ê³  ë¶ˆëŸ¬ì˜¬ë•Œ ì»´í“¨í„°ëŠ” ì •ì‚¬ê°í˜•ìœ¼ë¡œ ì €ì¥í•¨.
      - ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¬ë•Œ ê·¸ ë¹„ìœ¨ëŒ€ë¡œ ë§ì”Œìš°ê¸° ìœ„í•´.
      - ì •ì‚¬ê°í˜•ìœ¼ë¡œ ê·¸ë¦¬ê³  ì›ë˜ ë¹„ìœ¨ëŒ€ë¡œ ë§ì”Œìš°ëŠ” ë°©ì‹ì´ë‹¤.
- *stbi_image_free(data);*
  - ë§¨ëì—ì„œ ì´ë ‡ê²Œ dataë¥¼ í•´ì œ í•´ì¤€ë‹¤.
  - dataëŠ” ë™ì í• ë‹¹ í¬ì¸í„°
  - stb ë¼ì´ë¸Œë¦¬ëŸ¬ í•¨ìˆ˜ ì´ìš©
- *void ImageObject::draw()*
  - *scale(ratio * 0.5f, 1.0f * 0.5f);*
    - ê¸°ë³¸ì ìœ¼ë¡œ 2x2 ì •ì‚¬ê°í˜•ìœ¼ë¡œ ì €ì¥ë˜ê¸° ë•Œë¬¸ì— 1x1ë¡œ ë§ì¶°ì£¼ê¸° ìœ„í•´ 0.5ë¥¼ ê³±í–ˆê³ 
    - ì›ë˜ ë¹„ìœ¨ì— ë§ê²Œ ratioë¥¼ xë°©í–¥ì— ê³±í•´ì£¼ê³  ìˆë‹¤.
    - ë‚˜ë¨¸ì§€ëŠ” ì´ë¯¸ì§€ë¥¼ ê·¸ë ¤ì£¼ëŠ” ê³¼ì •.

***
<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}