---
title:  "[C++] 2.5 ëª…ë ¹ íŒ¨í„´ Command Pattern" 

categories:
  - C++ games
tags:
  - [Programming, Cpp, OpenGL, Graphics, Design Pattern]

toc: true
toc_sticky: true

date: 2020-06-09
last_modified_at: 2020-06-09
---

ì¸í”„ëŸ°ì— ìˆëŠ” í™ì •ëª¨ êµìˆ˜ë‹˜ì˜ **í™ì •ëª¨ì˜ ê²Œì„ ë§Œë“¤ê¸° ì—°ìŠµ ë¬¸ì œ íŒ¨í‚¤ì§€** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤.ğŸ˜€   
[ğŸŒœ ê³µë¶€ì— ì‚¬ìš©ëœ í™ì •ëª¨ êµìˆ˜ë‹˜ì˜ ì½”ë“œë“¤ ë³´ëŸ¬ê°€ê¸°](https://github.com/jmhong-simulation/GameDevPracticePackage)   
[ğŸŒœ [í™ì •ëª¨ì˜ ê²Œì„ ë§Œë“¤ê¸° ì—°ìŠµ ë¬¸ì œ íŒ¨í‚¤ì§€] ê°•ì˜ ë“¤ìœ¼ëŸ¬ ê°€ê¸°!](https://www.inflearn.com/course/c-2)
{: .notice--warning}

<br>

# Chapter 2. ê°ì²´ ì§€í–¥ìœ¼ë¡œ ê°€ëŠ” ê¸¸ : ëª…ë ¹ íŒ¨í„´
- <u>ëª…ë ¹ê³¼ í–‰ìœ„</u> ìì²´ë¥¼ ê°ì²´ë¡œ ë§Œë“¬
  - <u>ì¶”ìƒí™”</u> í•´ë‚˜ê°€ëŠ” ê³¼ì •
- ìµœëŒ€í•œ ì¶”ìƒí™” í•´ì„œ ë³€ê²½ ì‚¬í•­ì´ ìƒê¸°ë”ë¼ë„ <u>ë©”ì¸ ë¬´í•œë£¨í”„ë¥¼ ê°€ì§€ëŠ” update()ëŠ” ê±´ë“œë¦´ ê³³ì´ ì—†ê²Œë” í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.</u>

<br>

## ğŸ”” ì „ì²´ ì½”ë“œ ë° êµ¬ì¡°
1. class Actor âœ¨
  - class MyTank
2. class Command âœ¨
  - class UpCommand 
  - class LeftCommand
3. class InputHandler âœ¨
4. class TankExample

```cpp
#pragma once

#include "Game2D.h"
#include <map>

namespace jm
{
	class *Actor*
	{
	public:
		virtual void moveUp(float dt) = 0;  
        virtual void moveLeft(float dt) = 0;
	};

	class *Command*
	{
	public:
		virtual ~Command() {}
		virtual void execute(Actor& actor, float dt) = 0;
	};

	class UpCommand : public Command 
	{
	public:
		virtual void execute(Actor& actor, float dt) override
		{
			actor.moveUp(dt);
		}
	};

    class LeftCommand : public Command 
	{
	public:
		virtual void execute(Actor& actor, float dt) override
		{
			actor.moveLeft(dt);
		}
	};

	class MyTank : public Actor
	{
	public:
		vec2 center = vec2(0.0f, 0.0f);
		//vec2 direction = vec2(1.0f, 0.0f, 0.0f);

		void moveUp(float dt) override
		{
			center.y += 0.5f * dt;
		}

        void moveLeft(float dt) override
		{
			center.x -= 0.5f * dt;
		}

		void draw()
		{
			beginTransformation();
			{
				translate(center);
				drawFilledBox(Colors::green, 0.25f, 0.1f); // body
				translate(-0.02f, 0.1f);
				drawFilledBox(Colors::blue, 0.15f, 0.09f); // turret
				translate(0.15f, 0.0f);
				drawFilledBox(Colors::red, 0.15f, 0.03f);  // barrel
			}
			endTransformation();
		}
	};

	class InputHandler
	{
	public:
	    Command * button_up = nullptr;
        Command * button_left = nullptr;

	    //std::map<int, Command *> key_command_map;

	    InputHandler()
	    {
		    button_up = new UpCommand;
            button_left = new LeftCommand;
	    }

	    void handleInput(Game2D & game, Actor & actor, float dt)
	    {
		    if (game.isKeyPressed(GLFW_KEY_UP))  button_up->execute(actor, dt);
            if (game.isKeyPressed(GLFW_KEY_LEFT))  button_left->execute(actor, dt);

			/*for (auto & m : key_command_map)
			{
				if (game.isKeyPressed(m.first)) m.second->execute(actor, dt);
			}*/
		}
	};

	class TankExample : public Game2D
	{
	public:
		MyTank tank;

		InputHandler input_handler;

	public:
		TankExample()
			: Game2D("This is my digital canvas!", 1024, 768, false, 2)
		{
			//key mapping
			//input_handler.key_command_map[GLFW_KEY_UP] = new UpCommand;
		}

		~TankExample()
		{
		}

		void update() override
		{
			// move tank
			/*if (isKeyPressed(GLFW_KEY_LEFT))	tank.center.x -= 0.5f * getTimeStep(); // ì›ë˜ ì´ë ‡ê²Œ êµ¬í˜„í–ˆëŠ”ë° ì´ë ‡ê²Œ í•˜ë©´
			if (isKeyPressed(GLFW_KEY_RIGHT))	tank.center.x += 0.5f * getTimeStep();  // íƒ±í¬ê°€ ì•„ë‹Œ ì „íˆ¬ê¸°ë¡œ ë°”ê¾¸ê³ ì‹¶ë‹¤ë©´
			if (isKeyPressed(GLFW_KEY_UP))		tank.center.y += 0.5f * getTimeStep();  // ì½”ë“œë¥¼ ì „ë¶€ êµì²´í•´ì•¼í•˜ëŠ” ë¶ˆí¸í•¨ æœ‰
			if (isKeyPressed(GLFW_KEY_DOWN))	tank.center.y -= 0.5f * getTimeStep();*/ 

			input_handler.handleInput(*this, tank, getTimeStep());

			// rendering
			tank.draw();
		}
	};
}
```

<br>

## ğŸ”” Actor í´ë˜ìŠ¤

```cpp
class Actor
{
public:
	virtual void moveUp(float dt) = 0;  
    virtual void moveLeft(float dt) = 0;
};
```
- <u>Actor ë“¤ì´ ëª¨ë‘ ê¸°ë³¸ì ìœ¼ë¡œ ê°€ì§€ëŠ” ê¸°ëŠ¥</u> ë“¤ë§Œ ë¬¶ì–´ì„œ `class Actor`ë¡œ ë§Œë“¤ê³  ì´ë¥¼ ê°ê° ìƒì†ë°›ê²Œ í•œë‹¤.
  - `Actor` ğŸ‘‰ *ex) <u>íƒ±í¬</u>, ìì „ê±°, ë¹„í–‰ê¸° ë“±ë“±*
    - íƒ±í¬ í´ë˜ìŠ¤, ìì „ê±° í´ë˜ìŠ¤ ë“±ë“± ëª¨ë‘ Actorë¥¼ ìƒì†í•˜ëŠ” ìì‹í´ë˜ìŠ¤ì´ë‹¤.
  - `Actor`ë“¤ì´ ê¸°ë³¸ì ìœ¼ë¡œ ê°€ì§€ëŠ” ê¸°ëŠ¥
    - *ex)  moveUp(), moveDown(), stop(), moveLeft(), moveRight ë“±ë“±*
    - <u>ìˆœìˆ˜ ê°€ìƒ í•¨ìˆ˜</u>ë¡œ ë§Œë“¤ì–´ ìì‹ í´ë˜ìŠ¤ë“¤ì´ ê°ê° ì˜¤ë²„ë¼ì´ë”© í•˜ë„ë¡ ê°•ì œí•œë‹¤.
      - ê³µí†µì ì¸ ê¸°ëŠ¥ì´ë¼ë„ ê·¸ ë‚´ìš©ì€ ì–´ë–¤ ì¢…ë¥˜ì˜ ì•¡í„°ëƒì— ë”°ë¼ ë‹¤ë¥´ê¸° ë•Œë¬¸
        - ì˜ˆë¥¼ ë“¤ì–´ íƒ±í¬ì™€ ë¹„í–‰ê¸° ë‘˜ ë‹¤ moveUpì´ë¼ëŠ” ê¸°ëŠ¥ì„ ê°€ì§€ì§€ë§Œ ì–¼ë§Œí¼ y ì¢Œí‘œë¡œ ì›€ì§ì¼ì§€ ë“±ë“± ë‚´ìš©ì€ ê°ì ë‹¤ ë‹¤ë¥´ë‹¤. 

<br>

## ğŸ”” MyTank í´ë˜ìŠ¤
```cpp
class MyTank : public Actor
{
public:
	vec2 center = vec2(0.0f, 0.0f);

	void moveUp(float dt) override
	{
		center.y += 0.5f * dt;  
	}

    void moveLeft(float dt) override
	{
		center.x -= 0.5f * dt;  
	}

	void draw() { ..... }
};
```
- Actor ìƒì† 
  - ëª¨ë“  Acotrë“¤ì´ ê°€ì§€ëŠ” ê¸°ë³¸ì ì¸ ê¸°ëŠ¥ì¸ moveUp, moveLeftë¥¼ `Tank`ì˜ ê°œì„±ì„ ì‚´ë ¤ ì˜¤ë²„ë¼ì´ë”© í•œë‹¤.

<br>

## ğŸ”” Command í´ë˜ìŠ¤

```cpp
class Command
{
public:
	virtual ~Command() {}   // ê°€ìƒì†Œë©¸ì
	virtual void execute(Actor& actor, float dt) = 0;
};
```

- <u>ê°€ìƒ ì†Œë©¸ì</u>ë¥¼ ì“´ë‹¤.
  - ìì‹ Command ë“¤ì€ ê°ì ë‚˜ë¦„ì˜ ì†Œë©¸ìë¥¼ í˜¸ì¶œí•˜ë„ë¡
- <u>ë¬´ì–¸ê°€ë¥¼ ìˆ˜í–‰í•˜ëŠ” ì¼</u>ì„ í•œë‹¤.
  - UpCommand, DownCommand ë“±ë“± ìˆ˜í–‰í•˜ëŠ” ì¼ë„ ì¢…ë¥˜ê°€ ë‹¤ì–‘í•˜ë‹¤. 
  - ê°ì ì–´ë–¤ ì¼ì„ ìˆ˜í–‰í• ì§€ëŠ” ***execute í•¨ìˆ˜*** ë¥¼ ì˜¤ë²„ë¼ì´ë”© í•˜ì—¬ ë‚´ìš©ì„ ë‹¤ë¥´ê²Œ í•˜ë©´ ë¨
    - ìˆœìˆ˜ ê°€ìƒí•¨ìˆ˜ì´ë¯€ë¡œ ë°˜ë“œì‹œ ì˜¤ë²„ë¼ì´ë”© í•´ì•¼ í•¨
      - `Actor`íƒ€ì…ì˜ <u>ì°¸ì¡° ë ˆí¼ëŸ°ìŠ¤ë¥¼ ë°›ëŠ”ë‹¤.</u>
  - **ë‹¤í˜•ì„±** ë° **ì¶”ìƒí™”**
    - *virtual void execute(<u>Actor& actor</u>, float dt) = 0;*
      - ì–´ë– í•œ ì¢…ë¥˜ì˜ ìì‹ Actor ë“¤ì´ ë“¤ì–´ì˜¤ë˜ì§€ ë¶€ëª¨ì¸ `Actor` í•˜ë‚˜ë¡œ ë‹¤ ì°¸ì¡°í•  ìˆ˜ ìˆë„ë¡.
      - ì–´ë– í•œ ì¢…ë¥˜ì˜ ìì‹ Actor ë“¤ì´ ë“¤ì–´ì˜¤ë˜ì§€ ì´ Commandë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡.
      - `Actor& actor` ë³€ìˆ˜ í•˜ë‚˜ì— `Tank`, `AirPlane` ê°ì²´ ë‹¤ ì°¸ì¡° ê°€ëŠ¥.
    
<br>

## ğŸ”” UpCommand í´ë˜ìŠ¤

```cpp
class UpCommand : public Command 
{
public:
	virtual void execute(Actor& actor, float dt) override
	{
		actor.moveUp(dt);
	}
};
```
- Command ìƒì†
  - <u>ì–´ë–¤ ì¼ì„ ìˆ˜í–‰í•  ê²ƒì¸ì§€</u> ë¶€ëª¨ì¸ Command í´ë˜ìŠ¤ì˜ ***execute í•¨ìˆ˜*** ë¥¼ ì˜¤ë²„ë¼ì´ë”© í•œë‹¤.
    - UpCommand í´ë˜ìŠ¤ëŠ” Actorì˜ moveUp ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” í´ë˜ìŠ¤.
  - ì–´ë–¤ ì¢…ë¥˜ì˜ Actorì´ëƒì— ë”°ë¼ ë‹¤ë¥¸ moveUpì´ í˜¸ì¶œë  ê²ƒì´ë‹¤.
    - *Actor& actor* ì— íƒ±í¬ê°€ ë“¤ì–´ì˜¤ë©´ íƒ±í¬ë§Œì˜ moveUpì´ ë“¤ì–´ì˜¬ ê²ƒ.
      - íƒ±í¬ë§Œì˜ moveUpì€ Actorë¥¼ ìƒì†ë°›ëŠ” íƒ±í¬ í´ë˜ìŠ¤ì—ì„œ ì˜¤ë²„ë¼ì´ë”©.

<br>

## ğŸ”” LeftCommand í´ë˜ìŠ¤

```cpp
class LeftCommand : public Command 
{
public:
	virtual void execute(Actor& actor, float dt) override
	{
		actor.moveLeft(dt);
	}
};
```
- Command ìƒì†
  - <u>ì–´ë–¤ ì¼ì„ ìˆ˜í–‰í•  ê²ƒì¸ì§€</u> ë¶€ëª¨ì¸ Command í´ë˜ìŠ¤ì˜ ***execute í•¨ìˆ˜*** ë¥¼ ì˜¤ë²„ë¼ì´ë”© í•œë‹¤.
    - LeftCommand í´ë˜ìŠ¤ëŠ” Actorì˜ moveLeft ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” í´ë˜ìŠ¤.
  - ì–´ë–¤ ì¢…ë¥˜ì˜ Actorì´ëƒì— ë”°ë¼ ë‹¤ë¥¸ moveLeftì´ í˜¸ì¶œë  ê²ƒì´ë‹¤.
    - *Actor& actor* ì— íƒ±í¬ê°€ ë“¤ì–´ì˜¤ë©´ íƒ±í¬ë§Œì˜ moveLeftì´ ë“¤ì–´ì˜¬ ê²ƒ.
      - íƒ±í¬ë§Œì˜ moveUpì€ Actorë¥¼ ìƒì†ë°›ëŠ” íƒ±í¬ í´ë˜ìŠ¤ì—ì„œ ì˜¤ë²„ë¼ì´ë”©.

<br>

## ğŸ”” InputHandler í´ë˜ìŠ¤

```cpp
class InputHandler
{
public:
	Command * button_up = nullptr;
    Command * button_left = nullptr;

	//std::map<int, Command *> key_command_map;  intì—” í‚¤ë³´ë“œ ë²ˆí˜¸ê°€ ë“¤ì–´ê°„ë‹¤.

	InputHandler()
	{
		button_up = new UpCommand;
        button_left = new LeftCommand;
	}

	void handleInput(Game2D & game, Actor & actor, float dt)
	{
		if (game.isKeyPressed(GLFW_KEY_UP))  button_up->execute(actor, dt);
        if (game.isKeyPressed(GLFW_KEY_LEFT))  button_left->execute(actor, dt);

		/*

        for (auto & m : key_command_map)
		{
			if (game.isKeyPressed(m.first)) m.second->execute(actor, dt);
		}

        */
	}
};
```

- <u>í‚¤ë³´ë“œ ì…ë ¥</u>ì„ ê°ì§€í•˜ëŠ” í´ë˜ìŠ¤
  - í‚¤ë³´ë“œ ì…ë ¥ ë˜í•œ update()ì—ì„œ ì•ˆë°›ê²Œ ë”°ë¡œ ì¶”ìƒí™”í•˜ì—¬ ëºë‹¤.
  - update()ì—ì„  `InputHandler`ì˜ *void handleInput(Game2D & game, Actor & actor, float dt)* í•¨ìˆ˜ë§Œ ì‹¤í–‰í•œë‹¤.
- *Game2D & game*
  - isKeyPressed í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì—
- *Actor & actor*
  - ì–´ë–¤ ì¢…ë¥˜ì˜ ì•¡í„°ë¥¼ ê¸°ëŠ¥í•˜ê²Œ í• ì§€
- *button_up*
    - Command íƒ€ì…ì¸ ë¶€ëª¨í˜• í¬ì¸í„°.
      - Commandì˜ ìì‹ì¸ UpCommand ê°ì²´ë¥¼ ì°¸ì¡°í•œë‹¤.
    - button_upì— ë¬´ì—‡ì´ ë“¤ì–´ê°ˆì§€ëŠ” ê·¸ë•Œ ê·¸ë•Œ ë°”ë€” ìˆ˜ ìˆë‹¤. ê²Œì„ ì§„í–‰ ì¤‘ì—ë„.
      - ì˜ˆë¥¼ ë“¤ì–´ í”Œë ˆì´ì–´ê°€ ìˆ ì— ì·¨í•´ì„œ ìœ„ ì•„ë˜ê°€ ë’¤ì§‘íˆëŠ” ì—°ì¶œì„ í•˜ê³  ì‹¶ë‹¤ë©´ button_up = new DownCommand,  button_down = new UpCommand  ì´ë ‡ê²Œ ë’¤ì§‘ì„ ìˆ˜ ìˆê² ì§€.
- *button_left*
    - Command íƒ€ì…ì¸ ë¶€ëª¨í˜• í¬ì¸í„°.
      - Commandì˜ ìì‹ì¸ LeftCommand ê°ì²´ë¥¼ ì°¸ì¡°í•œë‹¤.
    - button_leftì— ë¬´ì—‡ì´ ë“¤ì–´ê°ˆì§€ëŠ” ê·¸ë•Œ ê·¸ë•Œ ë°”ë€” ìˆ˜ ìˆë‹¤. ê²Œì„ ì§„í–‰ ì¤‘ì—ë„.
- *void handleInput(Game2D & game, Actor & actor, float dt)*
  - í‚¤ë³´ë“œ ì…ë ¥ì— ë”°ë¼ ì–´ë–¤ Actorë¥¼ ì–´ë–¤ ê¸°ëŠ¥ì„ ì‹œí‚¬ì§€.
  - button_up->execute(actor, dt);
    - executeì€ ê°€ìƒí•¨ìˆ˜ì´ë¯€ë¡œ button_upì´ ì°¸ì¡°í•˜ëŠ” ìì‹ ê°ì²´ì¸ UpCommandì˜ executeê°€ ì‹¤í–‰ëœë‹¤.
    - UpCommandì˜ executeëŠ” moveUpì„ í˜¸ì¶œí•˜ë¯€ë¡œ 
    - í•´ë‹¹ Actorì´ ì˜¤ë²„ë¼ì´ë”© í•œ moveUpì´ í˜¸ì¶œëœë‹¤. 

> ë¯¸ë¦¬ std::mapì— <u>í‚¤ë³´ë“œ ë²ˆí˜¸</u>ì™€ <u>Commandì˜ ìì‹ë“¤ì„ ì¢…ë¥˜ë³„ë¡œ</u> ë§µí•‘ì‹œì¼œë†“ê³  forë¬¸ ëŒë ¤ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ë„ ìˆë‹¤. ifë¬¸ì˜ ë‚˜ì—´ë³´ë‹¨ ë” í¸ë¦¬í• ë“¯.

<br>

## TankExample

- input_handler.handleInput(*this, tank, getTimeStep());
  - ì´ í•¨ìˆ˜ ì•ˆì—ì„œ í‚¤ë³´ë“œ ì…ë ¥ì— ë”°ë¥¸ í•¨ìˆ˜ ì²˜ë¦¬ë¥¼ ë‹¤ í•´ì¤„ ê²ƒ.
  - **this*
    - ë¶€ëª¨ì¸ Game2D íƒ€ì…ìœ¼ë¡œ TankExample ê°ì²´ë¥¼ ì°¸ì¡° 
    - í‚¤ë³´ë“œ ì…ë ¥ì„ ë°›ëŠ” í•¨ìˆ˜ë¥¼ ì“°ê¸° ìœ„í•´.
  - *tank*
    - íƒ±í¬ Actor.

> ì¤‘ìš”í•œ ë©”ì¸ ë£¨í”„ í•¨ìˆ˜ì¸ update()ëŠ” ìˆ˜ì •í• ê²Œ ìƒê¸°ë”ë¼ë„ ê±´ë“œë¦´ ì¼ì´ ì—†ê²Œ í•´ì•¼í•œë‹¤. ë§Œì•½ ìë™ì°¨ë¡œ ë³€ê²½í•˜ê³  ì‹¶ë‹¤ë©´ input_handler.handleInput(*this, **<u>car</u>**, getTimeStep()) ë§Œ ë°”ê¿”ì£¼ë©´ ë¨.

```cpp
class TankExample : public Game2D
	{
	public:
		MyTank tank;

		InputHandler input_handler;

	public:
		TankExample()
			: Game2D("This is my digital canvas!", 1024, 768, false, 2)
		{
			//key mapping
			//input_handler.key_command_map[GLFW_KEY_UP] = new UpCommand;
		}

		~TankExample()
		{
		}

		void update() override
		{
			input_handler.handleInput(*this, tank, getTimeStep());
			// rendering
			tank.draw();
		}
	};
```

<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}