---
title:  "[Python] Pandasë¥¼ í™œìš©í•´ downcastë¡œ ë©”ëª¨ë¦¬ ë¶€ë‹´ ì¤„ì´ê¸°"
layout: single

categories: "Python"
tags: 
    - Python
    - Pandas
    - downcast

toc: true
toc_sticky: true
toc_label : "ëª©ì°¨"
toc_icon: "bars"
---

<small>Pandasì˜ to_numeric í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ë©”ëª¨ë¦¬ ìš©ëŸ‰ ì¤„ì´ê¸°</small>

***

# âœ”ï¸ downcast ë€?
pandas ì˜ ```to_numeric``` í•¨ìˆ˜ì—ì„œ ì„ íƒì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” íŒŒë¼ë¯¸í„°ì´ë‹¤.
<br>ì •í˜• ë°ì´í„°ì— data typeë¥¼ ì§€ì •í•´ ê°€ì¥ ì‘ì€ ë²„ì „ìœ¼ë¡œ ë‚®ì¶° ë©”ëª¨ë¦¬ë¥¼ ì ˆì•½í•  ìˆ˜ ìˆë‹¤.

ë°ì´í„°ëŠ” ì»´í“¨í„° RAM ìš©ëŸ‰ë§Œí¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆëŠ”ë°, ëŒ€ìš©ëŸ‰ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ì„œ ë¶„ì„í•˜ê±°ë‚˜ ëª¨ë¸ì„ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” ë©”ëª¨ë¦¬ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.<br><br>
<mark style="background-color: #DDDDDD">downcastê°€ í•„ìš”í•œ ì´ìœ </mark>ëŠ” ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì ˆì•½í•´ ë” ë§ì€ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ë” ë§ì€ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê¸° ìœ„í•´ì„œì´ë‹¤.

## ğŸ” data type

|    | Data type   | Description |
|---:|:------------|:------------|
|  0 |bool| Boolean (True or False) stored as a byte|
|  1 |int|Platform integer (normally either int32 or int64)|
|  2 |int8|Byte (-128 to 127)|
|  3 |int16|Integer (-32768 to 32767)|
|  4 |int32|Integer (-2147483648 to 2147483647)|
|  5 |int64|Integer (-9223372036854775808 to 9223372036854775807)|
|  6 |uint8|Unsigned integer (0 to 255)|
|  7 |uint16|Unsigned integer (0 to 65535)|
|  8 |uint32|Unsigned integer (0 to 4294967295)|
|  9 |uint64|Unsigned integer (0 to 18446744073709551615)|
| 10 |float|Shorthand for float64.|
| 11 |float16|Half precision float: sign bit, 5 bits exponent, 10 bits mantissa|
| 12 |float32|Single precision float: sign bit, 8 bits exponent, 23 bits mantissa|
| 13 |float64|Double precision float: sign bit, 11 bits exponent, 52 bits mantissa|
| 14 |complex|Shorthand for complex128.|
| 15 |complex64|Complex number, represented by two 32-bit floats|
| 16 |complex128|Complex number, represented by two 64-bit floats|

<br>

# âœ”ï¸ downcast ì ìš©

- ì‹¤ìŠµìœ¼ë¡œ ì´í•´í•˜ê¸°
  - Dataset : Kaggle íƒ€ì´íƒ€ë‹‰ - train.csv
  - [ğŸ‘‰ ë°ì´í„° ë³´ëŸ¬ê°€ê¸°](https://www.kaggle.com/competitions/titanic/data)

## (1) ë°ì´í„° ê¸°ë³¸êµ¬ì¡°
- ```Survived```, ```Pclass```, ```SibSp```, ```Parch``` ì»¬ëŸ¼ì€ ëª¨ë‘ ìµœì†Ÿê°’ì´ 0 ì´ìƒ, ìµœëŒ“ê°’ì´ 10 ì´í•˜ë¡œ êµ¬ì„±ë˜ì–´ìˆë‹¤.
  - í•˜ì§€ë§Œ dtypeì„ ë³´ë©´ ëª¨ë‘ int64
  - ì¦‰, RAMì´ ë¶ˆí•„ìš”í•˜ê²Œ ë§ì´ ì“°ì´ê³  ìˆë‹¤ëŠ” ëœ»
- ```Age```, ```Fare``` ì»¬ëŸ¼ë„ ê¸°ìˆ í†µê³„ê°’ì„ ë³´ë©´ float64ë¡œ ì‚¬ìš©í•˜ê¸°ì—” ì ì ˆí•˜ì§€ ì•Šë‹¤. 

```python
import pandas as pd

df = pd.read_csv("data/titanic/train.csv", index_col="PassengerId")
# downcast ì „ ì´ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ KB ê¸°ì¤€ìœ¼ë¡œ before_dc ë³€ìˆ˜ì— ì €ì¥í•¨
before_dc = df.memory_usage().sum() / 1024
# ë°ì´í„°í”„ë ˆì„ì˜ ìˆ˜ì¹˜í˜• ë³€ìˆ˜ì— ëŒ€í•œ ê¸°ìˆ í†µê³„ê°’ í™•ì¸ 
display(df.describe())
# ë°ì´í„°í”„ë ˆì„ì˜ ê¸°ë³¸ì •ë³´ í™•ì¸
df.info()
```

<div style="text-align : center;">
<img src="https://ifh.cc/g/9cFr0D.png" width="700">
</div>
<center><small>dfì˜ ìˆ˜ì¹˜í˜• ë³€ìˆ˜ì— ëŒ€í•œ ê¸°ìˆ í†µê³„(ì™¼ìª½), dfì˜ ìš”ì•½ ì •ë³´(ì˜¤ë¥¸ìª½)</small></center>

<br>

## (2) ë‹¤ìš´ìºìŠ¤íŒ…(downcasting)
- ë°ì´í„°íƒ€ì…ì˜ ë²„ì „ì„ ë‚®ì¶”ëŠ” ì¼ì€ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì„œ ê° ì»¬ëŸ¼ë³„ë¡œ ì ìš©í•´ë³´ì•˜ë‹¤.
- ì •í˜• ë°ì´í„°ì˜ dtypeì´ int/floatë¡œ êµ¬ì„±ë˜ì–´ ìˆì–´ dtype_downcast í•¨ìˆ˜ì— int/floatì˜ ê²½ìš°ë§Œ ë„£ì—ˆë‹¤.

```python
def dtype_downcast(data):
    
    # ë°ì´í„°í”„ë ˆì„ì˜ ì „ì²´ ì»¬ëŸ¼ì— ëŒ€í•´ downcast ì ìš©
    for col in df.columns:
        # ì»¬ëŸ¼ë³„ ë°ì´í„°íƒ€ì…ì„ dtype_name ë³€ìˆ˜ì— í• ë‹¹
        dtype_name = df[col].dtypes.name
        # dtypeì´ intë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš°
        if dtype_name.startswith("int"):
            # 0ì´ìƒì˜ ê°’ë§Œ ê°€ì§€ëŠ” ì»¬ëŸ¼ì¸ ê²½ìš°
            if df[col].min() >= 0:
                # 0ê³¼ ì–‘ì˜ ì •ìˆ˜ë§Œ í¬í•¨í•˜ëŠ” uintë¡œ ì „í™˜
                df[col] = pd.to_numeric(df[col], downcast="unsigned")
            # 0ì´í•˜ì˜ ê°’ë„ í¬í•¨í•˜ëŠ” ì»¬ëŸ¼ì¸ ê²½ìš°
            else:
                # ìŒì˜ ì •ìˆ˜, 0, ì–‘ì˜ ì •ìˆ˜ë¥¼ í¬í•¨í•˜ëŠ” intë¡œ ì „í™˜
                df[col] = pd.to_numeric(df[col], downcast="integer")
        # dtypeì´ floatë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš°
        elif dtype_name.startswith("float"):
            # ê°€ì¥ ì‘ì€ ë²„ì „ì˜ float íƒ€ì…ìœ¼ë¡œ ì „í™˜
            df[col] = pd.to_numeric(df[col], downcast="float")
            
dtype_downcast(df)

# downcast í›„ ì´ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ KB ê¸°ì¤€ìœ¼ë¡œ after_dc ë³€ìˆ˜ì— ì €ì¥í•¨
after_dc = df.memory_usage().sum() / 1024
```

## (3) ê²°ê³¼ ëª¨ë‹ˆí„°ë§

```python
>>> print(f"downcast ì „ : {before_downcast:.1f}+ KB")
>>> print(f"downcast í›„ : {after_downcast:.1f}KB")
>>> print(f"ì ˆì•½í•œ ì´ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ : {(before_downcast - after_downcast):.1f}KB")

downcast ì „ : 83.5+ KB
downcast í›„ : 52.2+ KB
ì ˆì•½í•œ ì´ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ : 31.3+ KB
```

<div style="text-align : center;">
<img src="https://ifh.cc/g/yby9Qh.png" width="700">
</div>
<center><small>downcast ì „(ì™¼ìª½), í›„(ì˜¤ë¥¸ìª½) ë°ì´í„°í”„ë ˆì„ ìš”ì•½ ì •ë³´</small></center>

<br>

# âœ”ï¸ ë§ˆì¹˜ë©°
Kaggleì˜ train.csv íŒŒì¼ì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ì„ ë•Œ, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ë³´ë©´ <mark style="background-color: #DDDDDD">83.5+KB</mark> ì¸ë° ì •í˜• ë°ì´í„°ë¥¼ pandasì˜ ```to_numeric``` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‚®ì€ ë²„ì „ì˜ dtypeìœ¼ë¡œ ë°”ê¿ˆìœ¼ë¡œì¨ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ <mark style="background-color: #DDDDDD">52.2+KB</mark>ë¡œ ì•½ <mark style="background-color: #DDDDDD">63%</mark> ì¤„ì—¬ë³´ì•˜ë‹¤.<br>
<br>ì •í˜• ë°ì´í„°ì˜ ë²”ìœ„ì— ë¹„í•´ dtypeìœ¼ë¡œ í‘œí˜„í•  ìˆ˜ ìˆëŠ” ìˆ«ì ë²”ìœ„ê°€ í¬ë‹¤ë©´ downcastë¡œ ë°ì´í„° ì‚¬ìš©ëŸ‰ì„ ì ˆì•½í•  ìˆ˜ ìˆë‹¤.

<br>

# âœ”ï¸ Reference
- [ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼ AI SCHOOL] ë°•ì¡°ì€ ê°•ì‚¬ë‹˜ ê°•ì˜ìë£Œ 
- [Github by rougier, numpy-tutorial](https://github.com/rougier/numpy-tutorial#quick-references)
- [pandas ê³µì‹ë¬¸ì„œ, pandas.to_numeric](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_numeric.html?highlight=to_numeric)
- [ë²¨ë¡œê·¸ by JinBaek, ë©”ëª¨ë¦¬ì™€ ë°ì´í„° íƒ€ì…](https://velog.io/@jinmb0602/%EB%A9%94%EB%AA%A8%EB%A6%AC%EC%99%80-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%83%80%EC%9E%85)
- [ë„¤ì´ë²„ë¸”ë¡œê·¸ by apple, [Python][Pandas] Big Data ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¤„ì´ê¸°(MemoryError)](https://m.blog.naver.com/wideeyed/221578747562)
- [í‹°ìŠ¤í† ë¦¬ by Data_Pistachio, íŒë‹¤ìŠ¤ - ìë£Œí˜• ë³€í™˜ : astype, pd.to_numeric](https://steadiness-193.tistory.com/18)
- [í‹°ìŠ¤í† ë¦¬ by ê¾¸ì¤€í¬, [Python] ìë£Œí˜•(type) í™•ì¸ê³¼ numpy ë°ì´í„° í˜•ë³€í™˜](https://eehoeskrap.tistory.com/295)
- [í‹°ìŠ¤í† ë¦¬ by 'ë‚´'ë©‹ëŒ€ë¡œí•´ë¼, ë³€ìˆ˜ì˜ ê¸°ë³¸í˜• ë°ì´í„° íƒ€ì… ì‚¬ìš©ì‹œ (íš¨ìœ¨ì„±, ì„±ëŠ¥ì¤‘ì‹œ)](https://coqoa.tistory.com/30)
- [í‹°ìŠ¤í† ë¦¬ by All I Need Is Data., [Python] ì •í˜•ë°ì´í„° ìš©ëŸ‰ ì¤„ì´ëŠ” í•¨ìˆ˜ ì†Œê°œ (ì—°ì†í˜•, ì´ì‚°í˜•, ë¬¸ìí˜•)](https://data-newbie.tistory.com/472)

<br>

ğŸ‘©ğŸ»â€ğŸ’»ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤
<br>ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ë”°ë”í•˜ê²Œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤.
{: .notice}