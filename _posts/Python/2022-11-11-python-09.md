---
title:  "[Python] Pandasë¥¼ í™œìš©í•´ downcastë¡œ ë©”ëª¨ë¦¬ ë¶€ë‹´ ì¤„ì´ê¸°"
layout: single

categories: "Python"
tags: 
    - Python
    - Pandas
    - Downcast

toc: true
toc_sticky: true
toc_label : "ëª©ì°¨"
toc_icon: "bars"
---

<small>Pandasì˜ ```to_numeric``` í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ë©”ëª¨ë¦¬ ìš©ëŸ‰ ì¤„ì´ê¸° (downcast)</small>

***

# âœ”ï¸ Downcast ë€?
- pandas ì˜ ```to_numeric``` í•¨ìˆ˜ì—ì„œ ì„ íƒì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” íŒŒë¼ë¯¸í„°ì´ë‹¤.
- ì •í˜• ë°ì´í„°ì— dtype(float, integer, signed, unsigned)ë¥¼ ì§€ì •í•´ ê°€ì¥ ì‘ì€ ë²„ì „ìœ¼ë¡œ ë‚®ì¶° ë©”ëª¨ë¦¬ë¥¼ ì ˆì•½í•  ìˆ˜ ìˆë‹¤.

## ğŸ” pandas.to_nemeric
- ì¸ìˆ˜ë¥¼ ìˆ«ìí˜•ìœ¼ë¡œ ì „í™˜í•˜ëŠ” ê¸°ëŠ¥
- ê¸°ë³¸ì ìœ¼ë¡œ ë°˜í™˜ë˜ëŠ” dtypeì€ ë°ì´í„°ì— ë”°ë¼ float64, int64 ì´ë‹¤.
  - ë‹¤ë¥¸ dtypeì„ ì„¤ì •í•˜ë ¤ë©´ downcast ë§¤ê°œë³€ìˆ˜ë¥¼ ì´ìš©í•˜ë©´ ëœë‹¤.

### â° ì£¼ìš” íŒŒë¼ë¯¸í„°
ê¸°ë³¸ êµ¬ì¡° : ```pandas.to_numeric(arg, errors='raise', downcast=None)```

- ```arg``` : scalar, list, tuple, 1-d array, series
  - ì „í™˜í•  ì¸ìˆ˜

- ```errors``` : ignore, raise, coerce (ê¸°ë³¸ê°’ : raise) 
  - raise : ì˜ëª»ëœ êµ¬ë¬¸ ë¶„ì„ì€ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚´
  - coerce : ì˜ëª»ëœ êµ¬ë¬¸ ë¶„ì„ì´ NaNìœ¼ë¡œ ì„¤ì •ë¨
  - ignore : ì˜ëª»ëœ êµ¬ë¬¸ ë¶„ì„ì´ ì…ë ¥ì„ ë°˜í™˜í•¨

- ```downcast``` : str (ê¸°ë³¸ê°’ : None)
  - integer, signed, unsigned, float ì¼ ìˆ˜ ìˆìŒ
  - Noneì´ ì•„ë‹Œ ìˆ«ì dtypeìœ¼ë¡œ ìºìŠ¤íŠ¸ëœ ê²½ìš°, ê²°ê³¼ ë°ì´í„°ë¥¼ ê°€ì¥ ì‘ì€ ìˆ«ì dtypeìœ¼ë¡œ downcast
    - interger, signed : ìµœì†Œ np.int8
    - unsigned : ìµœì†Œ np.uint8
    - float : ìµœì†Œ np.float32

## ğŸ” Data type
- <mark style="background-color: #f6f8fa">int</mark> : ì •ìˆ˜ (ìŒì˜ ì •ìˆ˜, 0, ì–‘ì˜ ì •ìˆ˜)
- <mark style="background-color: #f6f8fa">uint</mark> : ì–‘ìˆ˜ (0, ì–‘ì˜ ì •ìˆ˜)
- <mark style="background-color: #f6f8fa">float</mark> : ì‹¤ìˆ˜ (ë¶€ë™ ì†Œìˆ˜í˜•)
- <mark style="background-color: #f6f8fa">complex</mark> : ë³µì†Œìˆ˜ (ì‹¤ìˆ˜ + í—ˆìˆ˜)
- <mark style="background-color: #f6f8fa">bool</mark> : true, false

|    | Data type   | Description |
|---:|:------------|:------------|
|  0 |bool| Boolean (True or False) stored as a byte|
|  1 |int|Platform integer (normally either int32 or int64)|
|  2 |int8|Byte (-128 to 127)|
|  3 |int16|Integer (-32768 to 32767)|
|  4 |int32|Integer (-2147483648 to 2147483647)|
|  5 |int64|Integer (-9223372036854775808 to 9223372036854775807)|
|  6 |uint8|Unsigned integer (0 to 255)|
|  7 |uint16|Unsigned integer (0 to 65535)|
|  8 |uint32|Unsigned integer (0 to 4294967295)|
|  9 |uint64|Unsigned integer (0 to 18446744073709551615)|
| 10 |float|Shorthand for float64.|
| 11 |float16|Half precision float: sign bit, 5 bits exponent, 10 bits mantissa|
| 12 |float32|Single precision float: sign bit, 8 bits exponent, 23 bits mantissa|
| 13 |float64|Double precision float: sign bit, 11 bits exponent, 52 bits mantissa|
| 14 |complex|Shorthand for complex128.|
| 15 |complex64|Complex number, represented by two 32-bit floats|
| 16 |complex128|Complex number, represented by two 64-bit floats|

<br>

# âœ”ï¸ Downcast í•„ìš”ì„±

ì»´í“¨í„°ê°€ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ëŠ” ê³¼ì •ì„ ê°„ë‹¨íˆ í•´ë³´ë©´ ì•„ë˜ ë„¤ë‹¨ê³„ë¥¼ ê±°ì¹œë‹¤.
1. CPUê°€ ì½”ë“œ ì‹¤í–‰ì— í•„ìš”í•œ ë°ì´í„°ë“¤ì„ í•˜ë“œë””ìŠ¤í¬ì— ê°€ì ¸ì˜¨ë‹¤.
2. ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ RAM ë©”ëª¨ë¦¬ì— ì˜¬ë¦°ë‹¤.
3. CPUê°€ ì—°ì‚°ì‘ì—…ì„ í•˜ì—¬ ê²°ê³¼ë¬¼ì„ ë°›ì•„ì˜¨ë‹¤.
4. ì‚¬ìš©ìì—ê²Œ ê²°ê³¼ë¬¼ì„ ë°˜í™˜í•œë‹¤.

ë°ì´í„°ëŠ” ì»´í“¨í„° RAM ìš©ëŸ‰ë§Œí¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆëŠ”ë°, ëŒ€ìš©ëŸ‰ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ì„œ ë¶„ì„í•˜ê±°ë‚˜ ëª¨ë¸ì„ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” ë©”ëª¨ë¦¬ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. <mark style="background-color: #f6f8fa">downcastê°€ í•„ìš”í•œ ì´ìœ </mark>ëŠ” ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì ˆì•½í•´ ë” ë§ì€ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ë” ë§ì€ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê¸° ìœ„í•´ì„œì´ë‹¤!

<br>

# âœ”ï¸ Downcast ì ìš© ë° ëª¨ë‹ˆí„°ë§
- pandasì—ì„œ ì œê³µí•˜ëŠ” ```to_numeric``` í•¨ìˆ˜ì˜ ```downcast``` íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ë©´ ì •í˜• ë°ì´í„°ì˜ ìš©ëŸ‰ì„ ì¤„ì¼ ìˆ˜ ìˆë‹¤.
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì€ ```info``` í•¨ìˆ˜ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
  - ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê°’ë§Œ ë³´ê³ ì‹¶ì„ ë•, ```memory_usage``` í•¨ìˆ˜ ì‚¬ìš©

## ğŸ” ì‹¤ìŠµìœ¼ë¡œ ì´í•´í•˜ê¸°
- Dataset : Kaggle íƒ€ì´íƒ€ë‹‰ - train.csv
- [ğŸ‘‰ ë°ì´í„° ë³´ëŸ¬ê°€ê¸°](https://www.kaggle.com/competitions/titanic/data)


```python
import pandas as pd

file_names = "data/titanic/train.csv"
df = pd.read_csv(file_names, index_col="PassengerId")
df.head()
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Survived</th>
      <th>Pclass</th>
      <th>Name</th>
      <th>Sex</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Ticket</th>
      <th>Fare</th>
      <th>Cabin</th>
      <th>Embarked</th>
    </tr>
    <tr>
      <th>PassengerId</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>3</td>
      <td>Braund, Mr. Owen Harris</td>
      <td>male</td>
      <td>22.0</td>
      <td>1</td>
      <td>0</td>
      <td>A/5 21171</td>
      <td>7.2500</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>1</td>
      <td>Cumings, Mrs. John Bradley (Florence Briggs Th...</td>
      <td>female</td>
      <td>38.0</td>
      <td>1</td>
      <td>0</td>
      <td>PC 17599</td>
      <td>71.2833</td>
      <td>C85</td>
      <td>C</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>3</td>
      <td>Heikkinen, Miss. Laina</td>
      <td>female</td>
      <td>26.0</td>
      <td>0</td>
      <td>0</td>
      <td>STON/O2. 3101282</td>
      <td>7.9250</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>1</td>
      <td>Futrelle, Mrs. Jacques Heath (Lily May Peel)</td>
      <td>female</td>
      <td>35.0</td>
      <td>1</td>
      <td>0</td>
      <td>113803</td>
      <td>53.1000</td>
      <td>C123</td>
      <td>S</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0</td>
      <td>3</td>
      <td>Allen, Mr. William Henry</td>
      <td>male</td>
      <td>35.0</td>
      <td>0</td>
      <td>0</td>
      <td>373450</td>
      <td>8.0500</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.describe()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Survived</th>
      <th>Pclass</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Fare</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>891.000000</td>
      <td>891.000000</td>
      <td>714.000000</td>
      <td>891.000000</td>
      <td>891.000000</td>
      <td>891.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.383838</td>
      <td>2.308642</td>
      <td>29.699118</td>
      <td>0.523008</td>
      <td>0.381594</td>
      <td>32.204208</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.486592</td>
      <td>0.836071</td>
      <td>14.526497</td>
      <td>1.102743</td>
      <td>0.806057</td>
      <td>49.693429</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.420000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.000000</td>
      <td>2.000000</td>
      <td>20.125000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>7.910400</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.000000</td>
      <td>3.000000</td>
      <td>28.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>14.454200</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1.000000</td>
      <td>3.000000</td>
      <td>38.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>31.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.000000</td>
      <td>3.000000</td>
      <td>80.000000</td>
      <td>8.000000</td>
      <td>6.000000</td>
      <td>512.329200</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.info()
```

    <class 'pandas.core.frame.DataFrame'>
    Int64Index: 891 entries, 1 to 891
    Data columns (total 11 columns):
     #   Column    Non-Null Count  Dtype  
    ---  ------    --------------  -----  
     0   Survived  891 non-null    int64  
     1   Pclass    891 non-null    int64  
     2   Name      891 non-null    object 
     3   Sex       891 non-null    object 
     4   Age       714 non-null    float64
     5   SibSp     891 non-null    int64  
     6   Parch     891 non-null    int64  
     7   Ticket    891 non-null    object 
     8   Fare      891 non-null    float64
     9   Cabin     204 non-null    object 
     10  Embarked  889 non-null    object 
    dtypes: float64(2), int64(4), object(5)
    memory usage: 83.5+ KB



```python
# downcast ì „ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ (KB ë‹¨ìœ„ë¡œ ë³´ê¸° ìœ„í•´ 1024ë¡œ ë‚˜ëˆ”)
before_downcast = df.memory_usage().sum() / 1024
```


```python
def dtype_downcast(data):
    
    # ë°ì´í„°í”„ë ˆì„ì˜ ì „ì²´ ì»¬ëŸ¼ì— ëŒ€í•´ downcast ì ìš©
    for col in df.columns:
        # ì»¬ëŸ¼ë³„ ë°ì´í„°íƒ€ì…ì„ dtype_name ë³€ìˆ˜ì— í• ë‹¹
        dtype_name = df[col].dtypes.name
        # dtypeì´ intë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš°
        if dtype_name.startswith("int"):
            # 0ì´ìƒì˜ ê°’ë§Œ ê°€ì§€ëŠ” ì»¬ëŸ¼ì¸ ê²½ìš°
            if df[col].min() >= 0:
                # 0ê³¼ ì–‘ì˜ ì •ìˆ˜ë§Œ í¬í•¨í•˜ëŠ” uintë¡œ ì „í™˜
                df[col] = pd.to_numeric(df[col], downcast="unsigned")
            # 0ì´í•˜ì˜ ê°’ë„ í¬í•¨í•˜ëŠ” ì»¬ëŸ¼ì¸ ê²½ìš°
            else:
                # ìŒì˜ ì •ìˆ˜, 0, ì–‘ì˜ ì •ìˆ˜ë¥¼ í¬í•¨í•˜ëŠ” intë¡œ ì „í™˜
                df[col] = pd.to_numeric(df[col], downcast="integer")
        # dtypeì´ floatë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš°
        elif dtype_name.startswith("float"):
            # ê°€ì¥ ì‘ì€ ë²„ì „ì˜ float íƒ€ì…ìœ¼ë¡œ ì „í™˜
            df[col] = pd.to_numeric(df[col], downcast="float")
            
dtype_downcast(df)
```


```python
df.info()
```

    <class 'pandas.core.frame.DataFrame'>
    Int64Index: 891 entries, 1 to 891
    Data columns (total 11 columns):
     #   Column    Non-Null Count  Dtype  
    ---  ------    --------------  -----  
     0   Survived  891 non-null    uint8  
     1   Pclass    891 non-null    uint8  
     2   Name      891 non-null    object 
     3   Sex       891 non-null    object 
     4   Age       714 non-null    float32
     5   SibSp     891 non-null    uint8  
     6   Parch     891 non-null    uint8  
     7   Ticket    891 non-null    object 
     8   Fare      891 non-null    float32
     9   Cabin     204 non-null    object 
     10  Embarked  889 non-null    object 
    dtypes: float32(2), object(5), uint8(4)
    memory usage: 52.2+ KB



```python
# downcast í›„ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ (KB ë‹¨ìœ„ë¡œ ë³´ê¸° ìœ„í•´ 1024ë¡œ ë‚˜ëˆ”)
after_downcast = df.memory_usage().sum() / 1024
```

```python
print(f"downcast ì „ : {before_downcast:.1f}KB")
print(f"downcast í›„ : {after_downcast:.1f}KB")
print(f"ì ˆì•½í•œ ì´ ë©”ëª¨ë¦¬ ì–‘ : {(before_downcast - after_downcast):.1f}KB")
```

    downcast ì „ : 83.5KB
    downcast í›„ : 52.2KB
    ì ˆì•½í•œ ì´ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ : 31.3KB

<br>

# âœ”ï¸ ë§ˆì¹˜ë©°
ì •í˜• ë°ì´í„°ë¥¼ pandasì˜ ```to_numeric``` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‚®ì€ ë²„ì „ì˜ dtypeìœ¼ë¡œ ë°”ê¿ˆìœ¼ë¡œì¨ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì¤„ì—¬ë³´ì•˜ë‹¤.
<br>ë‚´ ì»´í“¨í„°ì˜ RAM ì‚¬ì–‘ì„ ê³ ë ¤í•˜ì—¬ downcastë¡œ ë°ì´í„°ë¥¼ ë˜‘ë˜‘í•˜ê²Œ ì‚¬ìš©í•˜ì.

<br>

# âœ”ï¸ Reference
- [ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼ AI SCHOOL] ë°•ì¡°ì€ ê°•ì‚¬ë‹˜ ê°•ì˜ìë£Œ 
- [Github by rougier, numpy-tutorial](https://github.com/rougier/numpy-tutorial#quick-references)
- [pandas ê³µì‹ë¬¸ì„œ, pandas.to_numeric](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_numeric.html?highlight=to_numeric)
- [ë²¨ë¡œê·¸ by JinBaek, ë©”ëª¨ë¦¬ì™€ ë°ì´í„° íƒ€ì…](https://velog.io/@jinmb0602/%EB%A9%94%EB%AA%A8%EB%A6%AC%EC%99%80-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%83%80%EC%9E%85)
- [í‹°ìŠ¤í† ë¦¬ by Kims, [Python] ìë£Œí˜•(type) í™•ì¸ê³¼ numpy ë°ì´í„° í˜•ë³€í™˜](https://eehoeskrap.tistory.com/295)
- [ë„¤ì´ë²„ë¸”ë¡œê·¸ by ê¾¸ì¤€í¬, [Python][Pandas] Big Data ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¤„ì´ê¸°(MemoryError)](https://m.blog.naver.com/wideeyed/221578747562)

<br>

ğŸ‘©ğŸ»â€ğŸ’»ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤
<br>ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ë”°ë”í•˜ê²Œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤.
{: .notice}