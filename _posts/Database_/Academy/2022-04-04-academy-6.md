---
layout: single
title:  " DAY-24. DataBase group by, having"
categories: Database-academy
tag: [Database, group by, having]
toc: true
toc_sticky: true
author_profile: false
sidebar:
  nav: "docs"
---


# ğŸ” 2022-04-04 - 1

## ë°ì´í„°ë² ì´ìŠ¤ 

<!--Quote-->

> â— ê°œì¸ì´ ê³µë¶€í•œ ë‚´ìš©ì„ ì ì€ ê²ƒ ì´ê¸°ì— ì˜¤ë¥˜ê°€ ë§ì„ ìˆ˜ë„ ìˆìŒ 


# 1ï¸âƒ£ group by

- ê·¸ë£¹í•¨ìˆ˜ ë‹¨ í•œê°œì˜ ê²°ê³¼ê°’ì„ ë„ì¶œí•˜ê³  ì‹¶ì„ ë•Œ(ê·¸ë£¹ë³„ ì§‘ê³„)
- ê·¸ë£¹í•¨ìˆ˜ê°€ ì ìš©ë  ê·¸ë£¹ ê¸°ì¤€ìœ¼ë¡œ í•´ì„œ group by ì ˆì— í•´ë‹¹ ê·¸ë£¹ì„(ì»¬ëŸ¼) ê¸°ìˆ í•´ ì‚¬ìš©
- ê·¸ë£¹ìœ¼ë¡œ ë‚˜ëˆ„ì–´ì„œ ê²°ê³¼ ë„ì¶œí•œë‹¤ê³  ìƒê°

```java

ğŸ” 
//ë¶€ì„œë³„ ì¸ì› ì¡°íšŒ
select nvl(dept_code,'ì¸í„´') "ë¶€ì„œì½”ë“œ" , count(*) from employee 
    group by dept_code;

ğŸ” 
// ë¶€ì„œë³„ ì¸ì› ì¡°íšŒ -> ë¶€ì„œì½”ë“œê°€ null ì¸ ê²½ìš°ì—ëŠ” countë¥¼ í•˜ì§€ ì•ŠìŒ 
select dept_code "ë¶€ì„œì½”ë“œ", count(*) from employee
    where dept_code is not null
    group by dept_code;

ğŸ”
//ë¶€ì„œì½”ë“œ, ë¶€ì„œë³„ ì¸ì›, ë¶€ì„œë³„ ì›”ê¸‰ ì´í•©, ë¶€ì„œë³„ ì›”ê¸‰ í‰ê·  ì¡°íšŒ
select nvl(dept_code,'ì¸í„´') "ë¶€ì„œì½”ë“œ" ,
       count(*) "ë¶€ì„œë³„ ì¸ì›", 
       to_char(sum(salary),'L999,999,999') "ë¶€ì„œë³„ ì›”ê¸‰ ì´í•©", 
       to_char(round(avg(salary)),'L999,999,999') "ë¶€ì„œë³„ ì›”ê¸‰ í‰ê· "
from employee
       group by dept_code
       order by 1;

ğŸ”
//ë¶€ì„œì½”ë“œ, ë³´ë„ˆìŠ¤ë¥¼ ì§€ê¸‰ë°›ëŠ” ì‚¬ì›ì˜ ìˆ˜(ë³´ë‹ˆìŠ¤ìœ¨ì´ ìˆëŠ” ì‚¬ì›)ë¥¼ ì¡°íšŒ -> ë¶€ì„œì½”ë“œ ìˆœìœ¼ë¡œ ì •ë ¬

select nvl(dept_code,'ì¸í„´')"ë¶€ì„œì½”ë“œ", 
       count(*) || 'ëª…' "ë³´ë„ˆìŠ¤ ë°›ëŠ” ì‚¬ì›ìˆ˜" 
from employee
    where bonus is not null
    group by dept_code
    order by 1;
```

```java

ğŸ”
// ì„±ë³„, ì„±ë³„ë³„ ê¸‰ì—¬ì˜ í‰ê· (ì •ìˆ˜ì²˜ë¦¬_ì†Œìˆ˜ì  ë²„ë¦¼), ì„±ë³„ë³„ ê¸‰ì—¬ì˜ í•©ê³„, ì„±ë³„ë³„ ì¸ì›ìˆ˜ -> ì¸ì›ìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ 
select 
       decode(substr(emp_no, 8, 1),'1','ë‚¨','ì—¬') "ì„±ë³„", 
       to_char(floor(avg(salary)),'L999,999,999')"ê¸‰ì—¬ í‰ê· ", 
       to_char(sum(salary),'L999,999,999') "ê¸‰ì—¬ í•©ê³„ ",
       count(*) "ì¸ì›" 
from employee
    group by substr(emp_no, 8, 1)
    order by 4 desc;
```

- group byì— extractë¥¼ ì•ˆì“°ê³  hire_dateë¡œ í•˜ë©´ ë…„ë„ëŠ” ê°™ì€ë° ë‚ ì§œê°€ ë‹¤ë¥´ë©´ ë‹¤ë¥¸ ê·¸ë£¹ìœ¼ë¡œ ë°”ë€Œì–´ë²„ë¦°ë‹¤ ê·¸ë˜ì„œ extractì‚¬ìš© í•„ìˆ˜

## group by ì•ˆì— 1ê°œ ì´ìƒì˜ ì¡°ê±´

- ê·¸ë£¹ ì•ˆì˜ ê·¸ë£¹ â‡’ ê·¸ë£¹ì„ ë¨¼ì € í•˜ë‚˜ì˜ ì¡°ê±´ìœ¼ë¡œ ë‚˜ëˆˆë’¤, ê·¸ ì•ˆì—ì„œ ë˜ ë‹¤ë¥¸ ì¡°ê±´ìœ¼ë¡œ ë‚˜ëˆ”

```java
ğŸ”
//ê° ë¶€ì„œì•ˆì˜ ì§ê¸‰ë³„ë¡œ ë¶€ì„œì½”ë“œ, ì§ê¸‰ì½”ë“œ, ì§ê¸‰ë³„ ì‚¬ì›ìˆ˜, í‰ê· ê¸‰ì—¬

select  
    nvl(dept_code,'ì¸í„´') "ë¶€ì„œì½”ë“œ",
    job_code "ì§ê¸‰ì½”ë“œ",
    count(*) "ì‚¬ì›ìˆ˜",
    round(avg(salary)) "í‰ê· ê¸‰ì—¬"
from employee
    group by dept_code,job_code
    order by 1,2;
```

```java
ğŸ”
//ë¬¸ì œ3. ë¶€ì„œì½”ë“œ, ì„±ë³„, ë¶€ì„œë³„ ì„±ë³„ ì‚¬ì›ìˆ˜ë¥¼ êµ¬í•˜ì„¸ìš”. 
 (ë¶€ì„œì½”ë“œ, ì„±ë³„ ê¸°ì¤€ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬)

select nvl(dept_code,'ì¸í„´') "ë¶€ì„œì½”ë“œ",
       decode(substr(emp_no,8,1),'1','ë‚¨','ì—¬') "ì„±ë³„",
       count(*)
from employee
       group by dept_code, substr(emp_no,8,1) -- ë¨¼ì € ë¶€ì„œë¡œ ë‚˜ëˆ„ê³  , ê·¸ ë‹¤ìŒ ì„±ë³„ë¡œ ë‚˜ëˆ” 
       order by dept_code ,2 ;
```

# 2ï¸âƒ£ Having

- whereì ˆì—ì„œ groupí•¨ìˆ˜ë¥¼ ì‚¬ìš© í•  ìˆ˜ ì—†ì„ ë•Œ
- group byë¥¼ ì´ìš©í•´ì„œ ê·¸ë£¹í•¨ìˆ˜ë¡œ ê°’ì„ êµ¬í•´ì˜¬ ë•Œ ê·¸ ê°’ì— ëŒ€í•œ ì¡°ê±´ì„ ê±¸ê³  ì‹¶ë‹¤ë©´ ì‚¬ìš©í•˜ëŠ” ì ˆ
- ì¦‰ havingì€ group byë¥¼ í†µí•´ ë‚˜ì˜¨ ê°’ì— ë‹¤ì‹œ ì¡°ê±´ì„ ì¤„ ë•Œ ì‚¬ìš©

```java
ğŸ”
// ê¸‰ì—¬ í‰ê· ì´ 300ë§Œì› ì´ìƒì¸ ë¶€ì„œì— ëŒ€í•œ ë¶€ì„œì½”ë“œ, í‰ê· ê¸‰ì—¬ ì¡°íšŒ
// ë¶€ì„œë³„ë¡œ ê·¸ë£¹í™” -> ê° ë¶€ì„œë³„ ê¸‰ì—¬ í‰ê·  -> ê·¸ í‰ê· ì´ 300ë§Œì› ì´ìƒ -> ë¶€ì„œì½”ë“œ, í‰ê· ê¸‰ì—¬ ì¡°íšŒ
// ë¶€ì„œì½”ë“œê°€ D6ë¼ë©´ ì œì™¸

select nvl(dept_code,'ì¸í„´') "ë¶€ì„œì½”ë“œ",
	    floor(avg(salary)) "í‰ê· ê¸‰ì—¬"
	
from employee
	where dept_code not in ('D6')
		group by dept_code
	having floor(avg(salary)) >= 3000000;
```

```java
ğŸ”
//ì¸ì›ì´ 3ëª…ì´ ë¯¸ë§Œì¸ ì§ê¸‰ì½”ë“œëŠ” ì¸ì›ì„ ë³´ì¶© 
select nvl(job_code,'ì¸í„´') "ì§ê¸‰ì½”ë“œ", 
    count(*) "ì¸ì›"
from employee
    group by job_code 
    having count(*) < 3; -- group byì˜ ê²°ê³¼ ê°’ì— ì¡°ê±´ì„ ê±°ëŠ”ê±°ë‹¤
```

## ğŸ’¡ where VS having

- whereì€ ê¸°ë³¸ì ì¸ ì¡°ê±´ì ˆë¡œì„œ ìš°ì„ ì ìœ¼ë¡œ ëª¨ë“  í•„ë“œë¥¼ ì¡°ê±´ì— ë‘˜ ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ havingì€ group by ëœ ì´í›„ íŠ¹ì •í•œ í•„ë“œë¡œ ê·¸ë£¹í™” ë˜ì–´ì§„ ìƒˆë¡œìš´ í…Œì´ë¸”ì— ì¡°ê±´ì„ ì¤„ ìˆ˜ ìˆë‹¤.

```java
1) select dept_code, salary, from employee where salary > 4000000 group by dept_code; 
2) select dept_code, avg(salary) from employee where salary group by dept_code having avg(salary)> 4000000;
```

1)ì˜ ê²½ìš°ëŠ” where ì¡°ê±´ì ˆì— ë§ëŠ” ì •ë³´ë¥¼ ìš°ì„ ì ìœ¼ë¡œ ë“¤ê³ ì™€ì„œ group byë¡œ ê·¸ë£¹í™” í•œë‹¤

2)ì˜ ê²½ìš°ëŠ” group byë¡œ ê·¸ë£¹í™” í•œ ìƒíƒœì—ì„œ having ì¡°ê±´ì ˆì— ë§ëŠ” ì •ë³´ë¥¼ ë“¤ê³  ì˜¨ë‹¤