---
layout: single
title:  " DAY-26. DataBase ì¸ë¼ì¸ ë·°, rownum"
categories: Database-academy
tag: [Database, ì¸ë¼ì¸ ë·°, rownum]
toc: true
toc_sticky: true
author_profile: false
sidebar:
  nav: "docs"
---


# ğŸ” 2022-04-06 -1 

## ë°ì´í„°ë² ì´ìŠ¤ 

<!--Quote-->

> â— ê°œì¸ì´ ê³µë¶€í•œ ë‚´ìš©ì„ ì ì€ ê²ƒ ì´ê¸°ì— ì˜¤ë¥˜ê°€ ë§ì„ ìˆ˜ë„ ìˆìŒ 



## ğŸ”” ì¸ë¼ì¸ ë·° (inline - view)

ì„œë¸Œì¿¼ë¦¬ê°€Â **FROM ì ˆì—ì„œ ì•ˆ**ì—ì„œ ì‚¬ìš©ë˜ëŠ” ê²½ìš°,Â **í•´ë‹¹ ì„œë¸Œì¿¼ë¦¬ë¥¼ 'ì¸ë¼ì¸ë·°'**
ê¸°ì¡´ì— ì•Œë˜ ì„œë¸Œì¿¼ë¦¬ëŠ” where ì ˆì— 



- ì¸ë¼ì¸ë·°ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ì¸ë¼ì¸ë·°ì—ì„œ ì¡°íšŒí•´ì˜¨ ë°ì´í„°ì— ëŒ€í•´ì„œë§Œ ë©”ì¸ì¿¼ë¦¬ë¬¸ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ
- from ì ˆì—ì„œ ë¨¼ì € ì‹¤ì‹œí•˜ê³  ê°€ìƒí…Œì´ë¸”(emp_name, salaryë§Œ ìˆëŠ”)ì„ ë§Œë“ ê²ƒì„ select í•œë‹¤ê³  ìƒê°



```java
select  
    emp_no  // ì˜¤ë¥˜ ë°œìƒ 
from (select emp_name, salary from employee);

select 
*         // emp_nameê³¼ salaryë§Œ ë³´ì—¬ì§
from (select emp_name, salary from employee); 
```

> ğŸ’¡ ì‹¤í–‰ìˆœì„œ  : from â†’ where â†’ group by â†’ having â†’ select â†’ order by

---


## ğŸ”” Top N ë¶„ì„ (Top N Query)

- ì»¬ëŸ¼ì—ì„œ ê°€ì¥ í° nê°œì˜ ê°’ì„ í˜¹ì€ ê°€ì¥ ì‘ì€ nê°œì˜ ê°’ì„ ìš”ì²­í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì¿¼ë¦¬
- ìƒìœ„/í•˜ìœ„ nê°œì˜ ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ëŠ” ì¿¼ë¦¬
- íšŒì‚¬ì—ì„œ ê°€ì¥ ë§ì´ íŒ”ë¦° ì œí’ˆ 10ê°œëŠ” ë¬´ì—‡ì¸ê°€? íšŒì‚¬ì—ì„œ ì›”ê¸‰ì„ ì œì¼ ë§ì´ ë°›ëŠ” ì‚¬ëŒ 3ëª…ì€ ëˆ„êµ¬ì¸ê°€?
- ê²Œì‹œíŒ í˜ì´ì§• / ì¡°íšŒìˆ˜ê°€ ë†’ì€ ì¸ê¸°ê¸€

```java
// emplyoee í…Œì´ë¸”ì—ì„œ ê°€ì¥ ë†’ì€ ê¸‰ì—¬ë¥¼ ë°›ëŠ” ì‚¬ëŒ 5ëª… 

select 
    emp_name, salary 
from employee 
    order by 2 desc;
    

```

### 1ï¸âƒ£ rownum

- ì¶œë ¥ë˜ëŠ” select ë¬¸ì˜ í–‰ë§ˆë‹¤ ìë™ì ìœ¼ë¡œ ìˆœìœ„ë¥¼ ë§¤ê²¨ì£¼ëŠ”ê²ƒ
- defaultë¡œëŠ” ì›ë˜ ì¡´ì¬í•˜ëŠ” ë°ì´í„°ì˜ ìˆœì„œëŒ€ë¡œ ìˆœìœ„ë¥¼ ë§¤ê²¨ì¤Œ

â— ì˜¤ë¥˜

```java
// ì›”ê¸‰ì´ í° ì‚¬ëŒë¶€í„° ìˆœìœ„ë¥¼ ë§¤ê²¨ë³´ì -> order by

select 
    rownum,
    emp_name, salary
from employee
    order by 3 desc;
```

- â— rownumì€ order byì ìš© ì´ì „ì— ë§¤ê²¨ì§„ë‹¤. ìˆœì„œê°€ ë¨¼ì € ë§¤ê²¨ì§€ê³  ë‚˜ì„œ ORDER BYë¡œ ì •ë ¬ë˜ë¯€ë¡œ, rownumê³¼ order byì˜ ë™ì‹œì‚¬ìš©ì€ ê²°ê³¼ ìˆœì„œë¥¼ ë’¤ì£½ë°•ì£½ì¸ ê²ƒì²˜ëŸ¼ ë§Œë“ ë‹¤
- select ì ˆì´ order by ì ˆë³´ë‹¤ ë¨¼ì € ì‹¤í–‰ë˜ë©´ì„œ ì´ë¯¸ rownumì´ ë§¤ê²¨ì§„ í›„ì— ë‹¤ì‹œ ì¬ì •ë ¬ë˜ê¸° ë•Œë¬¸ì— ìˆœì„œê°€ ë’¤ì£½ë°•ì£½

ğŸ’¡ í•´ê²°

```java
// ìš°ë¦¬ê°€ ì›í•˜ëŠ” ê¸°ì¤€ì— ë§ì¶° ì´ë¯¸ ì •ë ¬ì´ ëœ ìƒíƒœì˜ ë°ì´í„°ì— ëŒ€í•´ rownum -> ìˆœì„œë¥¼ ë§¤ê²¨ì•¼ í•¨
// ì¸ë¼ì¸ë·° -> ì„œë¸Œì¿¼ë¦¬ ì•ˆì—ì„œ ì›”ê¸‰ì´ ì œì¼ í° ìˆœì„œëŒ€ë¡œ ì¼ë‹¨ ë°ì´í„°ë¥¼ ì •ë ¬ 
// -> ì‹¤ì œ ë©”ì¸ì¿¼ë¦¬ rownum ì‚¬ìš©í•˜ê²Œ ë˜ë©´ ì´ë¯¸ ì •ë ¬ëœ ë°ì´í„°ì— ëŒ€í•´ ìˆœì„œê°€ ë§¤ê²¨ì§ 

select * from employee order by salary desc;

select 
    rownum , emp_name, salary 
from (select * from employee order by salary desc);
// rownumì€ ì›ë˜ ê°€ì§€ê³  ìˆë˜ í…Œì´ë¸”ì„ 1,2,3,4,5 ì‹ìœ¼ë¡œ ìˆœë²ˆì„ ì •í•´ì¤€ë‹¤ 
// ë¨¼ì € salaryë¡œ ìˆœì„œë¥¼ ì •í•´ì£¼ê³  ê·¸ í…Œì´ë¸”ì„ rownumì„ í•´ì¤€ë‹¤

// ìƒìœ„ 5ëª… ì—°ë´‰ ìˆœì„œ 
select rownum, 
       emp_name, 
       salary 
from (select * from employee order by salary desc) 
where rownum <= 5;
```

- selectë³´ë‹¤ from ì ˆì´ ë¨¼ì € ì‹¤í–‰ ëœë‹¤.
- fromì ˆ ë¡œë¶€í„° ë¨¼ì € ê°€ìƒì˜ í…Œì´ë¸”ì´ ìƒì„±ëœí›„ rownumê³¼ emp_name, salaryë¥¼ ë½‘ëŠ”ë‹¤
- from ì‹¤í–‰ â†’ where ì‹¤í–‰ â†’ select ì‹¤í–‰

### 2ï¸âƒ£ row_number() over()

- row_number() over (order by ì»¬ëŸ¼..);
over() ì•ˆìª½ì˜ ì»¬ëŸ¼ ìˆœì„œì— ë”°ë¼ ì¼ë‹¨ ì •ë ¬ì€ í•œ í›„ì— ìˆœìœ„ë¥¼ ë§¤ê²¨ì¤Œ
- row_number()ë¥¼ ì‚¬ìš©í•˜ë©´ ê°™ì€ ê°’(ì¤‘ë³µ ë°ì´í„°)ì´ì—¬ë„ ìˆœìœ„ê°€ ë‚˜ëˆ„ì–´ì§„ë‹¤ â†’ ê°™ì€ 200ì´ì—¬ë„ í•˜ë‚˜ëŠ” 19ìœ„ í•˜ë‚˜ëŠ” 20ìœ„

![1.png](/assets/images/posts/2022-04-06/1.png)

```java
select 
   row_number() over(order by salary desc)"ìˆœìœ„", emp_name, salary
from employee;
```

â— ì˜¤ë¥˜

```java
ğŸ”
// ---- ì›”ê¸‰ì„ ê°€ì¥ ë§ì´ ë°›ëŠ” top5

select 
    row_number() over(order by salary desc) "ìˆœìœ„",
    emp_name,
    salary
from employee
   where rownum <= 5 // ì´ë ‡ê²Œ í•˜ë©´ employee í…Œì´ë¸”ì•ˆì—ì„œ ê·¸ëƒ¥ 5ëª…ì„ ìë¥¸ê±°ì„
```

- where ì ˆ ì•ˆì—ì„œ rownum <=5 ë¥¼ í•´ë²„ë¦¬ë©´ employee í…Œì´ë¸”ì•ˆì—ì„œ ê·¸ëƒ¥ 5ëª…ì„ ìë¥´ê³  â†’ ê·¸ ë‹¤ìŒ ê·¸ ì•ˆì—ì„œ salary ìˆœìœ„ë¥¼ ì •í•œê±°ì„ â†’ ì˜ëª»ëœ ì¿¼ë¦¬ë¬¸
- 5ëª… ì•ˆì—ì„œ ìˆœì„œë¥¼ ë‚˜ëˆ„ëŠ”ê²Œ ì•„ë‹Œ â†’ ì „ì²´ ì¸ì›ì¤‘ ì›”ê¸‰ top5ë¥¼ ì°¾ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì—

ğŸ’¡ í•´ê²°

```java
ğŸ” // 1ë²ˆ 
select 
    ìˆœìœ„, emp_name, salary  // ì—¬ê¸°ì„œ ìˆœìœ„(rownum)ëŠ” row_numberì—ì„œ ê°€ì ¸ì˜¨ê²ƒ, emp_name,salaryëŠ” employee *ì—ì„œ ì˜¨ ë°ì´í„°
from (select row_number() over(order by salary desc)"ìˆœìœ„" , employee.* from employee)
	where "ìˆœìœ„" <= 5;
// employee.* : ë‹¤ë¥¸ ë°ì´í„°ë‚˜ ì»¬ëŸ¼ê³¼ í•¨ê»˜ *ì„ ì¨ì£¼ê³  ì‹¶ìœ¼ë©´ í…Œì´ë¸”ëª…. *ì˜ í˜•ì‹
// salaryë¥¼ descë¡œ í•˜ê³  rownumì„ ë§¤ê²¨ì£¼ê³  , employeeë¡œ ë¶€í„° ëª¨ë“ ê±¸ ì–»ì–´ ì˜¨ í…Œì´ë¸”ë¡œë¶€í„° 
// ìˆœìœ„, emp_name, salaryë¥¼ ì¶œë ¥ í•˜ëŠ”ê²ƒ

ğŸ” // 2ë²ˆ 
select 
    * 
from (select row_number() over(order by salary desc)"ìˆœìœ„" , 
           emp_name "ì‚¬ì›ëª…", salary "ì›”ê¸‰" from employee);

// 1ë²ˆê³¼ 2ë²ˆì€ ê°™ì€ ì½”ë“œ
```

```java
ğŸ”
// -- 5ìœ„ ë¶€í„° 10ìœ„ ì¶œë ¥
select 
    * 
from (select row_number() over(order by salary desc)"ìˆœìœ„" , 
        emp_name "ì‚¬ì›ëª…", salary "ì›”ê¸‰" from employee)
    where "ìˆœìœ„" between 5 and 10;
```

```java
ğŸ”
// ì—°ë´‰ (ë³´ë„ˆìŠ¤ í¬í•¨ -> (salary + (salary * bonus)) * 12 )ì´ ê°€ì¥ ë†’ì€ ìˆœì„œëŒ€ë¡œ ìˆœìœ„ ë§¤ê¹€ 
//10 ~ 15ìœ„ ì‚¬ì´ì¸ ì§ì›ë“¤ì˜ ìˆœìœ„, ì‚¬ì›ëª…, ì—°ë´‰, ì§ê¸‰ì½”ë“œ, ë¶€ì„œì½”ë“œ

select 
    *
from (select row_number() over(order by (salary + (salary * nvl(bonus,0))) * 12 desc) "ìˆœìœ„",
    emp_name "ì‚¬ì›ëª…",
    (salary + (salary * nvl(bonus,0))) * 12  "ì—°ë´‰", 
    job_code "ì§ê¸‰ì½”ë“œ",
    nvl(dept_code,'ì¸í„´') "ë¶€ì„œì½”ë“œ" from employee)
    where "ìˆœìœ„" between 10 and 15;
```

### 3ï¸âƒ£ rank() over()

- ìˆœìœ„ë¥¼ ë§¤ê¸¸ ë•Œ ì¤‘ë³µë°ì´í„°ê°€ ìˆë‹¤ë©´ ê°™ì€ ìˆœìœ„ë¥¼ ë§¤ê¸°ê³ , ê°™ì€ ìˆœìœ„ë¥¼ ë§¤ê¸´ ë°ì´í„°ë§Œí¼ ê±´ë„ˆë›°ì–´ ë‹¤ìŒ ìˆœìœ„ë¥¼ ë§¤ê¹€

![2.png](/assets/images/posts/2022-04-06/2.png)

### 4ï¸âƒ£ dense_rank() over()

- ì¤‘ë³µ ë°ì´í„°ì— ëŒ€í•´ ê°™ì€ ìˆœìœ„ë¥¼ ë§¤ê¸°ê³  ê·¸ ë‹¤ìŒ ìˆœìœ„ë¶€í„°ëŠ” ê±´ë„ˆëœ€ ì—†ì´ ìˆœì°¨ì ìœ¼ë¡œ ìˆœìœ„ë¥¼ ë§¤ê¹€ â†’ ì´ ë°ì´í„°ì˜ ê°œìˆ˜ì™€ ëìˆœìœ„ ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ

![3.png](/assets/images/posts/2022-04-06/3.png)

```java
ğŸ” // 1ë²ˆ 
select 
    ìˆœìœ„, emp_name, salary  // ì—¬ê¸°ì„œ ìˆœìœ„(rownum)ëŠ” row_numberì—ì„œ ê°€ì ¸ì˜¨ê²ƒ, emp_name,salaryëŠ” employee *ì—ì„œ ì˜¨ ë°ì´í„°
from (select row_number() over(order by salary desc)"ìˆœìœ„" , employee.* from employee)
	where "ìˆœìœ„" <= 5;
// employee.* : ë‹¤ë¥¸ ë°ì´í„°ë‚˜ ì»¬ëŸ¼ê³¼ í•¨ê»˜ *ì„ ì¨ì£¼ê³  ì‹¶ìœ¼ë©´ í…Œì´ë¸”ëª…. *ì˜ í˜•ì‹
// salaryë¥¼ descë¡œ í•˜ê³  rownumì„ ë§¤ê²¨ì£¼ê³  , employeeë¡œ ë¶€í„° ëª¨ë“ ê±¸ ì–»ì–´ ì˜¨ í…Œì´ë¸”ë¡œë¶€í„° 
// ìˆœìœ„, emp_name, salaryë¥¼ ì¶œë ¥ í•˜ëŠ”ê²ƒ

ğŸ” // 2ë²ˆ 
select 
    * 
from (select row_number() over(order by salary desc)"ìˆœìœ„" , 
           emp_name "ì‚¬ì›ëª…", salary "ì›”ê¸‰" from employee);

// 1ë²ˆê³¼ 2ë²ˆì€ ê°™ì€ ì½”ë“œ
```

### ğŸš€ ì‹¤ìŠµ

ë¬¸ì œ)

1. ê°€ì¥ ë³´ë„ˆìŠ¤ë¥¼ ë§ì´ ë°›ëŠ” ìˆœìœ¼ë¡œ ìˆœìœ„ë¥¼ ë§¤ê¹€
2. 4~8ìœ„ ì‚¬ì›ë“¤ì˜ ìˆœìœ„,ì´ë¦„, ê¸‰ì—¬, ë³´ë„ˆìŠ¤ë¥¼ ì¶œë ¥

1) row_number

```java
select 
    * 
from(select 
        row_number() over(order by nvl(bonus,0) desc)"ìˆœìœ„", 
        emp_name "ì´ë¦„",
        salary "ê¸‰ì—¬", 
        nvl(bonus,0)"ë³´ë„ˆìŠ¤" from employee)
    where "ìˆœìœ„" between 4 and 8;
```

- order byì—ì„œ nullì´ ê°€ì¥ í° ê°’ìœ¼ë¡œ ì¸ì‹

2) rank() over()

```java
select 
    * 
from(select 
        rank() over(order by nvl(bonus,0) desc)"ìˆœìœ„", 
        emp_name "ì´ë¦„",
        salary "ê¸‰ì—¬", 
        nvl(bonus,0)"ë³´ë„ˆìŠ¤" from employee)
    where "ìˆœìœ„" between 4 and 8;
```

3) dense_rank() over()

```java
select 
    * 
from(select 
        dense_rank() over(order by nvl(bonus,0) desc)"ìˆœìœ„", 
        emp_name "ì´ë¦„",
        salary "ê¸‰ì—¬", 
        nvl(bonus,0)"ë³´ë„ˆìŠ¤" from employee)
    where "ìˆœìœ„" between 4 and 8;
```