---
layout: single
title:  " DAY-29. JDBC PreparedStatment ì‚¬ìš©, Dateíƒ€ì…"
categories: Database-jdbc
tag: [Database, PreparedStatment ì‚¬ìš©, Dateíƒ€ì…]
toc: true
toc_sticky: true
author_profile: false
sidebar:
  nav: "docs"
---


# ğŸ” 2022-04-12

## ë°ì´í„°ë² ì´ìŠ¤ - JDBC

<!--Quote-->

> â— ìˆ˜ì—…ì„ ë“£ê³ , ê°œì¸ì´ ê³µë¶€í•œ ë‚´ìš©ì„ ì ì€ ê²ƒ ì´ê¸°ì— ì˜¤ë¥˜ê°€ ë§ì„ ìˆ˜ë„ ìˆìŒ


# 2022-04-12

# 1ï¸âƒ£ Statement í™œìš©ì‹œ ë¬¸ì œì 

## ğŸ§¨ SQLInjection ìœ„í—˜ ë°œìƒ

```java
public class SQLInjection {

	public static void main(String[] args) {
		select("abc123","5555' or '1' = '1'"); // ì˜¤ë¥˜ê°€ ë‚˜ì•¼í•˜ëŠ”ë° abc123 : 1234ê°€ ì¶œë ¥
	}

	public static void select(String id, String pw) {
		String url = "jdbc:oracle:thin:@localhost:1521:xe";
		String username = "kh";
		String password = "kh";

		try(Connection con = DriverManager.getConnection(url,username,password);
			Statement stmt = con.createStatement()){
			// statementë¥¼ ì‚¬ìš©í•˜ë©´ SQLInjection ê³µê²©ì´ ê°€ëŠ¥í•´ì§„ë‹¤

			String sql = "select * from tbl_member where id = '" + id +"' and pw = '" + pw +"'";
			ResultSet rs = stmt.executeQuery(sql);

			if(rs.next())
				System.out.println(rs.getString(1));
				System.out.println(rs.getString(2));
		}catch(Exception e) {
			e.printStackTrace();
		}
	}

}
```

## ğŸ’¡ SQLInjection ë°©ì§€ë¥¼ ìœ„í•´ PreparedStatementë¥¼ í™œìš©

```java
// PreparedStatement -> ê°ì²´ë¥¼ ìƒì„±í•  ë•Œ ì¸ìê°’ìœ¼ë¡œ ë„˜ê²¨ì£¼ëŠ” sqlë¬¸(ì¿¼ë¦¬ë¬¸)ì„ ë¯¸ë¦¬ DBMSì— ì»´íŒŒì¼ì— ì˜¬ë ¤ë‘ 
// ì¶”í›„ì— ? ìë¦¬ì— setë˜ëŠ” ê°’ì„ ë§ê·¸ëŒ€ë¡œ ê°’ ê·¸ ìì²´ë¡œ ë“¤ì–´ê° (ë¬¸ìì—´ ì¸ì‹) -> orì—°ì‚°ìê°€ ì•ˆë¨¹í˜
public static void select2(String id, String pw) {
	String url = "jdbc:oracle:thin:@localhost:1521:xe";
	String username = "kh";
	String password = "kh";

	String sql = "select * from tbl_memeber where id =? and pw =?";

	try(Connection con = DriverManager.getConnection(url,username,pw);
		PreparedStatement pstmt = con.prepareStatement(sql);){

		pstmt.setString(1, id);
		pstmt.setString(2, pw);

		ResultSet rs = pstmt.executeQuery();

		if(rs.next())
				System.out.println(rs.getString(1) + " : " + rs.getString(2));
		}catch(Exception e) {
		e.printStackTrace();
	}
}
```

---

# 2ï¸âƒ£ Statement vs PreparedStatement ë¹„êµ

## 1. cafe.DAO(Statement) - insert

```java
public int insert(CafeDTO dto) throws Exception {

	try(Connection con = DriverManager.getConnection(url,username,password);
		Statement stmt = con.createStatement()) {

		String sql = "insert into cafe values(seq_cafe.nextval,'" + dto.getProduct_name() + "'," + dto.getPrice() +",sysdate)";
		int rs = stmt.executeUpdate(sql);
		return rs;
	}
}
```

## 2. cafe.DAO(PreparedStatement) - insert

```java
// ì˜ˆì™¸ ì „ë‹¬í•˜ê¸°
public int insert(CafeDTO dto) throws Exception {

// ì¿¼ë¦¬ë¬¸ì•ˆì— ì‚½ì…í•  ë¬¸ìë“¤ì„ ?ë¡œ í•´ë‘ê³  ë‚˜ì¤‘ì— setStringì„ ì´ìš©í•´ ì„¤ì •
String sql = "insert into cafe values (seq_cafe.nextval,?,?, sysdate)";

try(Connection con = DriverManager.getConnection(url,username,password);
	PreparedStatement pstmt = con.prepareStatement(sql);) {

 // ?ì— í•´ë‹¹í•˜ëŠ” ì¸ìê°’ ì„¸íŒ… -> ì»¬ëŸ¼ì˜ ìë£Œí˜•ì— ë”°ë¼ ì„¸íŒ…
	pstmt.setString(1, dto.getProduct_name()); // ì¿¼ë¦¬ë¬¸ì˜ ì²« ë²ˆì§¸ ?ì˜ ì¸ìê°’ -> 1 -> ì»¬ëŸ¼ì˜ ì¸ë±ìŠ¤ê°€ ì•„ë‹˜
	pstmt.setInt(2, dto.getPrice()); // ì¿¼ë¦¬ë¬¸ì˜ ë‘ ë²ˆì§¸ ?ì˜ ì¸ìê°’ -> 2 -> ì»¬ëŸ¼ì˜ ì¸ë±ìŠ¤ê°€ ì•„ë‹˜

	// ì¿¼ë¦¬ë¬¸ì„ ì‹¤í–‰
	int rs = pstmt.executeUpdate(); // ì¸ìê°’ì„ sqlë¡œ ë„˜ê²¨ì£¼ì§€ ì•ŠëŠ”ë‹¤
	return rs;
	}
}

```

### ğŸ“– ì •ë¦¬

<span style="color: #2D3748; background-color:#fff5b1;"> Statement</span>


1. try() ë¬¸ì•ˆì—ì„œ createStatement() í™œìš©ì‹œ ì¸ìê°’ì„ ë„£ì–´ì£¼ì§€ ì•ŠëŠ”ë‹¤
2. tryë¬¸ ì•ˆì—ì„œ sqlë¬¸ì„ ë§Œë“¤ì–´ì¤€ë‹¤
3. ì¿¼ë¦¬ë¬¸ ì‹¤í–‰ì„ ìœ„í•´ **executeUpdate()** / **executeQuery()**ì— sqlë¬¸ì„ ë„£ì–´ì¤€ë‹¤ â†’ **executeUpdate(sql)** / **executeQuery(sql)**
4. setì„ í•´ì£¼ë ¤ë©´ ì»¬ëŸ¼ì˜ ìë£Œí˜•ì„ ì•Œì•„ì•¼í•œë‹¤

<span style="color: #2D3748; background-color:#fff5b1;"> PreparedStatement</span>


1. PreparedStatementëŠ” ë¨¼ì € tryë¬¸ ìœ„ì— sql ì¿¼ë¦¬ë¬¸ì— ì…ë ¥í•  ê°’ìœ¼ë¡œ ? ë¥¼ í•´ì¤€ë‹¤
2. try() ë¬¸ì•ˆì—ì„œ con.preparedStatement() ì‚¬ìš©ì‹œ ìœ„ì—ì„œ ì‘ì„±í•œ sqlë¬¸ì„ ë„£ì–´ì¤˜ì•¼ í•œë‹¤â†’ con.prepareStatement(sql);
3. tryë¬¸ ì•ˆì—ì„œ pstmtë¡œ ê°’ì„ setí•´ì¤€ë‹¤ ì´ë•Œ ?ì˜ ì¸ë±ìŠ¤ë¥¼ ì´ìš©í•œë‹¤ â†’ ex) pstmt.setString(1, dto.getProduct_name();
4. Statementì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì¿¼ë¦¬ë¬¸ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•´ **executeUpdate()** / **executeQuery()ë¥¼ í•˜ì§€ë§Œ,**ì¸ìê°’ìœ¼ë¡œ ****sqlì„ ë„£ì–´ì£¼ì§€ ì•ŠëŠ”ë‹¤

### ğŸ”” ê²°ë¡ 

ë³´ì•ˆê³¼ í¸ì˜ë¥¼ ìœ„í•´ì„œ PreparedStatementë¥¼ ì‚¬ìš©í•˜ëŠ”ê²Œ ë‚«ë‹¤!



# 3ï¸âƒ£ Date í™œìš©

ğŸ’¡ ì˜¤ë¼í´ì˜ Date íƒ€ì…ì„ ë‚´ê°€ ì›í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì¶œë ¥í•˜ë ¤ë©´?

**1) MemberDAOì— í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©**

<span style="color: #2D3748; background-color:#fff5b1;"> MemberDTO</span>


```java

import java.sql.Date;
public class MemberDTO {

	private String id;
	private String pw;
	private String birth_date; // ê¸°ì¡´ì˜ í…Œì´ë¸”ì—ì„œëŠ” Dateì´ì§€ë§Œ Stringìœ¼ë¡œ ë³€í™˜

	public MemberDTO() {}d
	public MemberDTO(String id, String pw, String birth_date) {
		this.id = id;
		this.pw = pw;
		this.birth_date = birth_date;
	}

	public String getId() {
		return id;
	}
	public void setId(String id) {
		this.id = id;
	}
	public String getPw() {
		return pw;
	}
	public void setPw(String pw) {
		this.pw = pw;
	}
	public String getBirth_date() {
		return birth_date;
	}
	public void setBirth_date(String birth_date) {
		this.birth_date = birth_date;
	}
}
```

<span style="color: #2D3748; background-color:#fff5b1;"> MemberDAO</span>


```java
public ArrayList<MemberDTO> selectAll() throws Exception {
	String sql = "select * from tbl_member";

		try(Connection con = DriverManager.getConnection(url,username,password);
			PreparedStatement pstmt = con.prepareStatement(sql);) {

			ResultSet rs =  pstmt.executeQuery();
			ArrayList<MemberDTO> list = new ArrayList<>();

			while(rs.next()) {
				String id = rs.getString(1);
				String pw = rs.getString(2);
				// ì˜¤ë¼í´ì—ì„œ ë„˜ì–´ì˜¨ dateíƒ€ì…ì„ ìë°”ì˜ Stringíƒ€ì…ìœ¼ë¡œ ë³€í™˜í•œ ê°’ì„ birth_dateì— ì €ì¥
				String birth_date = toJavaString(rs.getDate(3));
				list.add(new MemberDTO(id, pw, birth_date));
			}
			return list;
		}
	}

	// ì˜¤ë¼í´ì—ì„œ ë„˜ì–´ì˜¨ dateíƒ€ì…ì„ ìë°”ì˜ Stringíƒ€ì…ìœ¼ë¡œ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜
	public String toJavaString(Date date) {
		// oracle date íƒ€ì…ì˜ ë°ì´í„°ë¥¼ javaì˜ Stringìœ¼ë¡œ ë³€í™˜ -> SimpleDateFormat
		// ìƒì„±ìì˜ ì¸ìê°’ì„ String ìœ¼ë¡œ ë³€í™˜í• ë•Œ ì–´ë–¤ í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•  ê²ƒì¸ì§€ format
		// oracle ì›”(mm/MM) ë¶„(mi)
		// java ì›”()

    // yyyyë…„ MMì›” ddì¼ ì´ëŸ°ì‹ìœ¼ë¡œ ì¶œë ¥í•˜ê² ë‹¤
		SimpleDateFormat sdf = new SimpleDateFormat("yyyyë…„ MMì›” ddì¼");
		return sdf.format(date);
	}
```

1. ë°˜í™˜ê°’ì´ toJavaStringì¸ í•¨ìˆ˜ë¥¼ ë§Œë“ ë‹¤
2. ì´ë•Œ ì¸ìê°’ì€ oracleì—ì„œ ë„˜ì–´ì˜¤ëŠ” date íƒ€ì…ì˜ ê°’ì´ë‹¤
3. ê·¸ ê°’ì„ SimpleDateFormatì˜ formatì„ ì´ìš©í•´ Stringìœ¼ë¡œ ë³€í™˜í•œë‹¤
4. Stringìœ¼ë¡œ ë³€í™˜í•œ ê°’ì„ birth_dateì— ë„£ì–´ì¤€ë‹¤
5. list.addë¡œ birth_date ê°’ì„ ë„£ëŠ”ë‹¤

> **String â†’ Date : parse ì‚¬ìš©, Date â†’ String : format ì‚¬ìš©**
>



<span style="color: #2D3748; background-color:#fff5b1;"> Run</span>
```java
ArrayList<MemberDTO> list= dao.selectAll();
	if(list != null) {
		for(MemberDTO dto2 : list) {
			System.out.println(dto2.getId() + " " + dto2.getPw() + " " + dto2.getBirth_date());
	}
}
```

ì¶œë ¥

![1.png](/assets/images/posts/2022-04-12/1.png)

**2) Date.valueOf(String) ìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ í•´ê²°**

- Date birth_date = Date.valueOf(sc.nextLine()); ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë„£ì„ ë•Œ ë¶€í„° ë³€í™˜ì„ í•´ì¤˜ì„œ ë„£ëŠ”ë‹¤

# 4ï¸âƒ£ ë‚ ì§œ(Date) í™œìš©

String â†’ Date : parse ì‚¬ìš©

Date â†’ String : format ì‚¬ìš©


<span style="color: #2D3748; background-color:#fff5b1;"> CafeDTO</span>


```java
// register_date ë§´ë²„í•„ë“œë¥¼ ì´ìš©í•´ì„œ í˜„ì¬ì‹œê°„ê³¼ ë“±ë¡ì‹œê°„ì˜ ì°¨ì´ë¥¼ ê³„ì‚°í•´ Stringê°’ìœ¼ë¡œ ë°˜í™˜í•´ì£¼ëŠ” ë©”ì„œë“œ
public String getTimestamp() {
	// System.currentTimeMillis() -> í˜„ì¬ ì‹œê°„ì„ longí˜•ìœ¼ë¡œ ë°˜í™˜
	// String ë°ì´íŠ¸ ê°’ì„ ê°€ì§€ê³  ìˆëŠ” register_dateë¥¼ ì¼ë‹¨ longí˜•ìœ¼ë¡œ ë°˜í™˜

	// register_dateë¥¼ ë¨¼ì € ìë°”ì˜ Date íƒ€ì…ìœ¼ë¡œ ë³€í™˜
	SimpleDateFormat sdf = new SimpleDateFormat("yy-MM-dd HH:mm:ss");

	try {
		//1. sdfì˜ í˜•ì‹ì²˜ëŸ¼ ìƒê¸´ register_date String ê°’ì„ ìë°”ì˜ Date í˜•ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ì‘ì—… -> parse
		// ("yy-MM-dd HH:mm:ss")í˜•íƒœë¡œ ë°”ê¾¸ê¸° ìœ„í•´ ì‘ì—…
		java.util.Date date = sdf.parse(this.register_date);

		//2. getTime : ìë°”ì˜ date íƒ€ì… ë°ì´í„°ë¥¼ longí˜•ìœ¼ë¡œ ë³€í™˜í•´ì„œ ë°˜í™˜í•´ì£¼ëŠ” ë©”ì„œë“œ
		long origin_date = date.getTime(); // ë“±ë¡ì¼ì„ long í˜• ë³€í™˜

		//3. í˜„ì¬ì‹œê°„
		long cur_date = System.currentTimeMillis();

		// ë‘ ì‹œê°„ê°„ì˜ ê°­ -> ì´ˆ ë‹¨ìœ„ë¡œ ê³„ì‚°
		long gap_time = (cur_date - origin_date) / 1000;

		int sec = 60;
		int min = 60;
		int hour = 24;
		int day = 30;
		int month = 12;


		if(gap_time < sec) {
			return gap_time + "ì´ˆ ì „";
		}
		else if((gap_time/=sec) < sec) {  // 1ì‹œê°„ ë¯¸ë§Œì´ë¼ë©´ ~ë¶„ì „ // ë‚˜ëˆ„ë©´ì„œ ë‚˜ëˆˆì–´ì„œ ë‚˜ì˜¨ê°’ì„ ë‹¤ì‹œ ë„£ëŠ”ë‹¤
			return gap_time + "ë¶„ ì „";
		}
		else if((gap_time/=sec)< hour) {  // 1ì¼ -> 24ì‹œê°„ // gap_timeì€ 60ì´ìƒì˜ ê°’ì„ ê°€ì§€ê³  ìˆì„ ê±°ë‹¤
			// 60ë¶„ ê¸°ì¤€ìœ¼ë¡œ ë¶„ ë‹¨ìœ„
			// 1ì¼ -> 24ì‹œê°„
			return gap_time + "ì‹œ ì „";
		}
		else if((gap_time/=hour) < day) { // 30ì¼ ë¯¸ë§Œì´ë©´ ~ì¼ ì „
			return gap_time + "ì¼ ì „";
		}
		else if((gap_time/=day) < month) {
			return gap_time + "ê°œì›” ì „";
		}
	}catch(Exception e) {
		e.printStackTrace();
	}
	return null;
}
```

1. Stringì¸ register_dateë¥¼ dateì˜ í˜•íƒœë¡œ ë°”ê¾¼ë‹¤
2. dateë¡œ ë°”ë€ register_dateë¥¼ longí˜•ìœ¼ë¡œ ë‹´ëŠ”ë‹¤
3. longí˜•ìœ¼ë¡œ ë°˜í™˜ë˜ëŠ” System.currentTimeMillis()ì™€ regiser_dateë¥¼ ë¹„êµí•´ë³¸ë‹¤

<span style="color: #2D3748; background-color:#fff5b1;"> ì¶œë ¥</span>


```java
public String toString() {
		return product_id +" : " +product_name + " : " +price + " : " +register_date ;
}
```