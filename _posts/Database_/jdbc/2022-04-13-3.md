---
layout: single
title:  " DAY-30. JDBC DBCP, ì»¤ë„¥ì…˜ í’€ ì´ìš©"
categories: Database-jdbc
tag: [Database, DBCP, ì»¤ë„¥ì…˜ í’€, ì•„ì´ë”” ì¤‘ë³µ]
toc: true
toc_sticky: true
author_profile: false
sidebar:
  nav: "docs"
---


# ğŸ” 2022-04-13

## ë°ì´í„°ë² ì´ìŠ¤ - JDBC

<!--Quote-->

> â— ìˆ˜ì—…ì„ ë“£ê³ , ê°œì¸ì´ ê³µë¶€í•œ ë‚´ìš©ì„ ì ì€ ê²ƒ ì´ê¸°ì— ì˜¤ë¥˜ê°€ ë§ì„ ìˆ˜ë„ ìˆìŒ




## ğŸ”” DBCPì´ìš©

logging,pool,dbcp ë¼ì´ë¸ŒëŸ¬ë¦¬(apache) ì‚¬ìš©

### ê¸°ì¡´ ì½”ë“œ

```java
private String url = "jdbc:oracle:thin:@localhost:1521:xe";
private String username = "kh";
private String password = "kh";

// ì˜ˆì™¸ ì „ë‹¬í•˜ê¸°
public int insert(CafeDTO dto) throws Exception {

	// ì¿¼ë¦¬ë¬¸ì•ˆì— ì‚½ì…í•  ë¬¸ìë“¤ì„ ?ë¡œ í•´ë‘ê³  ë‚˜ì¤‘ì— setStringì„ ì´ìš©í•´ ì„¤ì •
	String sql = "insert into cafe values (seq_cafe.nextval,?,?, sysdate)";

	try(Connection con = DriverManager.getConnection(url,username,password);
		PreparedStatement pstmt = con.prepareStatement(sql);) {

		// ?ì— í•´ë‹¹í•˜ëŠ” ì¸ìê°’ ì„¸íŒ… -> ì»¬ëŸ¼ì˜ ìë£Œí˜•ì— ë”°ë¼ ì„¸íŒ…
		pstmt.setString(1, dto.getProduct_name()); // ì¿¼ë¦¬ë¬¸ì˜ ì²« ë²ˆì§¸ ?ì˜ ì¸ìê°’ -> 1 -> ì»¬ëŸ¼ì˜ ì¸ë±ìŠ¤ê°€ ì•„ë‹˜
		pstmt.setInt(2, dto.getPrice()); // ì¿¼ë¦¬ë¬¸ì˜ ë‘ ë²ˆì§¸ ?ì˜ ì¸ìê°’ -> 2 -> ì»¬ëŸ¼ì˜ ì¸ë±ìŠ¤ê°€ ì•„ë‹˜

		// ì¿¼ë¦¬ë¬¸ì„ ì‹¤í–‰
		int rs = pstmt.executeUpdate(); // ì¸ìê°’ì„ sqlë¡œ ë„˜ê²¨ì£¼ì§€ ì•ŠëŠ”ë‹¤
		return rs;
	}
}
```

### DBCP, ì»¤ë„¥ì…˜ ì ìš©

```java
//BasicDataSource í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
  private BasicDataSource bds = new BasicDataSource();

// DBCPë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ì„¤ì •ê°’ ì…‹íŒ…
// ìƒì„±ìë¥¼ ë§Œë“¤ì–´ ì´ˆê¸°ê°’ ì…‹íŒ…
public CafeDAO() {
	// CafeDAO ìƒì„±ìê°€ í˜¸ì¶œë˜ë©´ ìë™ìœ¼ë¡œ bdsì— ì´ˆê¸° ì„¤ì •ê°’ ì…‹íŒ…
	bds.setUrl("jdbc:oracle:thin:@localhost:1521:xe");
	bds.setUsername("kh");
	bds.setPassword("kh");
	// ì»¤ë„¥ì…˜ ê°œìˆ˜ ì…‹íŒ…
	bds.setInitialSize(10);
}

// ì»¤ë„¥ì…˜ í’€ì— ìˆëŠ” ì»¤ë„¥ì…˜ì„ êº¼ë‚´ì„œ ë°˜í™˜í•´ì£¼ëŠ” ë©”ì„œë“œ
public Connection getConnection() throws Exception{
	return bds.getConnection(); // ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
}

public int insert(CafeDTO dto) throws Exception{ // ì˜ˆì™¸ì „ê°€
	String sql = "insert into cafe values(seq_cafe.nextval, ?, ?, sysdate)";

	try(Connection con = this.getConnection();
		PreparedStatement pstmt = con.prepareStatement(sql)){

		pstmt.setString(1, dto.getProduct_name());
		pstmt.setInt(2, dto.getPrice());

		int rs = pstmt.executeUpdate();
		return rs;
	}
}

```

- ë§¤ë²ˆ Connection con = DriverManager.getConnection(url,username,password); í•˜ê¸°ê°€ ê·€ì°®ë‹¤ (ëª¨ë“  ë©”ì„œë“œ ë§ˆë‹¤ í•´ì¤˜ì•¼ í•˜ê¸° ë•Œë¬¸ì—)
- ê·¸ë˜ì„œ ê°ì²´ë¥¼ í•„ìš”í•  ë•Œ ë§ˆë‹¤ êº¼ë‚´ì„œ ì“¸ìˆ˜ ìˆê²Œ â€œPoolâ€ì„ ìƒì„±í•˜ê³  ê·¸ Poolì— ê°ì²´ë¥¼ ë‹´ì•„ì¤€ë‹¤ â†’ ê³µêµ¬í†µì— ê³µêµ¬ ë‹´ì•„ë‘ê³  í•„ìš”í•œ ë„êµ¬ë¥¼ ì°¾ì•„ì„œ ì“°ëŠ” ëŠë‚Œ?
- ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ apacheë¥¼ ì‚¬ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì— , BasicDataSourceë¥¼ ì‚¬ìš©í•œë‹¤
- ìƒì„±ìë¥¼ ë§Œë“¤ì–´ í•´ë‹¹ í´ë˜ìŠ¤ê°€ í˜¸ì¶œ ë  ë•Œ ë°ì´í„° ê°ì²´ì˜ ì´ˆê¸°ê°’ ì„¤ì •ì„ í•´ë‘ëŠ” ì½”ë“œë¥¼ ë„£ì–´ë‘”ë‹¤ (url , username, password, InitialSize) ì…‹íŒ…
- ì‚¬ìš©í•˜ê³  ì‹¶ì€ ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œë¥¼ ë§Œë“ ë‹¤. ì—¬ê¸°ì„  ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²° í•  ìˆ˜ ìˆëŠ” getConnection ìƒì„±

**<span style="color: #2D3748; background-color:#fff5b1;">Connection Pool</span>**


- ê°„ë‹¨íˆ ì •ì˜í•˜ë©´,ë¯¸ë¦¬ ì»¤ë„¥ì…˜ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  í•´ë‹¹ ì»¤ë„¥ì…˜ ê°ì²´ë¥¼ ê´€ë¦¬í•˜ëŠ” ê²ƒì„ì˜ë¯¸
- ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²°ëœ ì»¤ë„¥ì…˜ì„ ë¯¸ë¦¬ ë§Œë“¤ì–´ì„œ í’€(pool)ì†ì— ì €ì¥í•´ ë‘ê³  ìˆë‹¤ê°€ í•„ìš”í•  ë•Œ ì»¤ë„¥ì…˜ì„ í’€ì—ì„œ ì“°ê³  ë‹¤ì‹œ í’€ì— ë°˜í™˜í•˜ëŠ” ê¸°ë²•

[https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=ssang8417&logNo=221858327113](https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=ssang8417&logNo=221858327113)

**<span style="color: #2D3748; background-color:#fff5b1;">DBCP(Database Connection Pool)</span>**

Connection Poolì„ ì´ìš©í•´ì„œ ì§€ì •í•œ ê°œìˆ˜ë§Œí¼ Connection ê°ì²´ë¥¼ ìƒì„± í•´ë†“ê³ , ì„ ì°©ìˆœìœ¼ë¡œ ì ‘ì†í•œ í´ë¼ì´ì–¸íŠ¸í•œí…Œ ê°€ì§€ê³  ìˆëŠ” connection ë¶„ë°°í•´ì£¼ê³  ê·¸ ë’¤ë¡œ ë“¤ì–´ì˜¤ëŠ” í´ë¼ì´ì–¸íŠ¸ë“¤ì€ ì•ì— ì ‘ì†í–ˆë˜ í´ë¼ì´ì–¸íŠ¸ë“¤ì´ connectionì„ ë°˜ë‚©í•  ë•Œ ê¹Œì§€ ëŒ€ê¸° â†’ ex) ìˆ˜ê°•ì‹ ì²­ , ì‹ë‹¹ (ì›¨ì´íŒ…ì‹œ)

 [https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=jujinho218&logNo=220632451200](https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=jujinho218&logNo=220632451200)

## â— ì˜¤ë¥˜ : **ORA-12519, TNS:no appropriate service handler found**

```java
cmd>sqlplus / as sysdba
sqlplus>alter system set processes=300 scope=spfile;
sqlplus>shut immediate;
sqlplus>startup
```

ì˜¤ë¼í´ í”„ë¡œì„¸ìŠ¤ë¥¼ ì´ˆê³¼í•´ì„œ ë°œìƒí•˜ëŠ” ì¼

[https://aricode.tistory.com/10](https://aricode.tistory.com/10)

## ğŸ”” MemberServcie
ì°¸ê³ ìë£Œ
[https://riucc.tistory.com/350](https://riucc.tistory.com/350)

## ğŸ”” Singleton ì‹±ê¸€í†¤ ì ìš©

CafeDAO - ê¸°ì¡´

```java
//BasicDataSource í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
private BasicDataSource bds = new BasicDataSource();

// DBCPë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ì„¤ì •ê°’ ì…‹íŒ…
// ìƒì„±ìë¥¼ ë§Œë“¤ì–´ ì´ˆê¸°ê°’ ì…‹íŒ…
public CafeDAO() {
	// CafeDAO ìƒì„±ìê°€ í˜¸ì¶œë˜ë©´ ìë™ìœ¼ë¡œ bdsì— ì´ˆê¸° ì„¤ì •ê°’ ì…‹íŒ…
	bds.setUrl("jdbc:oracle:thin:@localhost:1521:xe");
	bds.setUsername("kh");
	bds.setPassword("kh");
	// ì»¤ë„¥ì…˜ ê°œìˆ˜ ì…‹íŒ…
	bds.setInitialSize(10);
}

// ì»¤ë„¥ì…˜ í’€ì— ìˆëŠ” ì»¤ë„¥ì…˜ì„ êº¼ë‚´ì„œ ë°˜í™˜í•´ì£¼ëŠ” ë©”ì„œë“œ
public Connection getConnection() throws Exception{
	return bds.getConnection(); // ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
}
```

Run ê¸°ì¡´

```java
CafeDAO dao = new CafeDAO();
```

CafeDAO - ì‹±ê¸€í†¤ ì ìš©

```java
//BasicDataSource í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
private BasicDataSource bds = new BasicDataSource();
private static CafeDAO instance = null; // ì»¤ë„¥ì…˜ í’€ì„ í•˜ë‚˜ë§Œ ë§Œë“¤ì–´ì„œ ê·¸ í•˜ë‚˜ë¡œë§Œ ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œ

// DBCPë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ì„¤ì •ê°’ ì…‹íŒ…
// ìƒì„±ìë¥¼ ë§Œë“¤ì–´ ì´ˆê¸°ê°’ ì…‹íŒ…
private CafeDAO() {  // ìƒì„±ì private ë³€í™˜
	// CafeDAO ìƒì„±ìê°€ í˜¸ì¶œë˜ë©´ ìë™ìœ¼ë¡œ bdsì— ì´ˆê¸° ì„¤ì •ê°’ ì…‹íŒ…
	bds.setUrl("jdbc:oracle:thin:@localhost:1521:xe");
	bds.setUsername("kh");
	bds.setPassword("kh");
	// ì»¤ë„¥ì…˜ ê°œìˆ˜ ì…‹íŒ…
	bds.setInitialSize(10);
}

// ì»¤ë„¥ì…˜ í’€ì„ í•œë²ˆë§Œ ë§Œë“¤ê³  runì—ì„œ ì‹¤í–‰í•˜ë©´ new CafeDAO()ê°€ ë©”ëª¨ë¦¬ì— ë‹´ê¸°ê³  ê·¸ ë’¤ë¡œëŠ” nullì´ ì•„ë‹ˆê¸°ì—
// ifë¬¸ ì‹¤í–‰ì•ˆí•˜ê³  return instance ì‹¤í–‰
public static CafeDAO getInstance() {  // CafeDAO ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ new í•˜ê³  ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œ
	if(instance == null) { // CafeDAO ì¸ìŠ¤í„´ìŠ¤ê°€ ë§Œë“¤ì–´ì§„ ì ì´ ì—†ë‹¤ë©´ NEWë¥¼ í•˜ê² ë‹¤
						// == DBCP -> Connection Poolì„ í•˜ë‚˜ ë§Œë“¤ê² ë‹¤
		instance = new CafeDAO();
	}
	// ë§Œì¼ CafeDAO ì¸ìŠ¤í„´ìŠ¤ê°€ ì´ë¯¸ ì¡´ì¬í•œë‹¤ë©´ == ì´ë¯¸ ë§Œë“¤ì–´ì§„ Connection poolì´ ì¡´ì¬
	// ê·¸ëŸ° ê²½ìš°ë¼ë©´ ì´ë¯¸ ìˆëŠ” ì»¤ë„¥ì…˜ í’€ì„ í†µí•´ì„œ ì ‘ì†ì„ ì œê³µ
	return instance;
}

// ì»¤ë„¥ì…˜ í’€ì— ìˆëŠ” ì»¤ë„¥ì…˜ì„ êº¼ë‚´ì„œ ë°˜í™˜í•´ì£¼ëŠ” ë©”ì„œë“œ
public Connection getConnection() throws Exception{
	return bds.getConnection(); // ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
}
```

Run - ì‹±ê¸€í†¤ ì ìš©

```java
// CafeDAO()ì˜ ìƒì„±ìë¥¼ privateìœ¼ë¡œ ë°”ê¾¼ë’¤ -> CafeDAO dao = new CafeDAO()ëŠ” ì‚¬ìš©ë¶ˆê°€
CafeDAO dao = CafeDAO.getInstance(); // instanceê°€ null ì´ë¼ë©´ ì¦‰ ì²˜ìŒ ì‹¤í–‰í–ˆì„ë•Œ
//CafeDAO.getInstanceì˜ return ê°’ì€ new CafeDAO()ê°€ ë  ê²ƒì´ë‹¤.
// ê·¸ë˜ì„œ ì½”ë“œëŠ” CafeDAO dao = new CafeDAO() ì™€ ê°™ì€ ì½”ë“œ
```

- ì‹±ê¸€í†¤ ì ìš©ì„ ì•ˆí•˜ë©´ ì‚¬ìš©ìê°€ CafeDAO ì¸ìŠ¤í„´ìŠ¤ë¥¼ í™œìš© í•  ë•Œ ë§¤ë²ˆ ê°™ì€ ì»¤ë„¥ì…˜ í’€ì„ ì‚¬ìš©í•˜ê²Œ ëœë‹¤
- ë”°ë¼ì„œ í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë¡œ ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ì‚¬ìš©í•˜ê²Œ ë” ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì‹±ê¸€í†¤ì„ ì ìš©í•œë‹¤
- ê¸°ì¡´ CafeDAO()ì˜ ìƒì„±ìì˜ ì ‘ê·¼ë²”ìœ„ë¥¼ privateìœ¼ë¡œ í•œë‹¤
- static ë³€ìˆ˜ë¥¼ ë‘”  private static CafeDAO instance = null; ìƒì„±
- ê°€ì¥ ì²˜ìŒì— ì‹¤í–‰ë  ë•Œ ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆê²Œ  instanceì˜ ê°’ì„ new CafeDAO()ë¡œ í•´ì£¼ëŠ” ì¡°ê±´ë¬¸ì„ ë§Œë“¤ì–´ì£¼ê³  return ê°’ìœ¼ë¡œ ëŒë ¤ì¤€ë‹¤, ë§Œì•½ ë¨¼ì € ì¸ìŠ¤í„´ìŠ¤ê°€ ë©”ëª¨ë¦¬ì— ìƒì„±ì´ ë˜ìˆë‹¤ë¼ë©´ â†’ instanceì˜ ê°’ì„ nullë¡œ ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œ ìƒì„±
- CafeDAO dao = CafeDAO.getInstance(); ì—ì„œ CafeDAO.getInstance() ê°’ì´ ì²˜ìŒ ì‹¤í–‰í•œë‹¤ë©´ ì¦‰, ë©”ëª¨ë¦¬ì— ì²˜ìŒ ì˜¬ë¼ê°„ë‹¤ë©´ new CafeDAO() ê°€ ë˜ê³ , ì´ë¯¸ ë©”ëª¨ë¦¬ì— ì˜¬ë¼ê°€ìˆìœ¼ë©´, null ì´ëœë‹¤