---
layout: single
title:  "02 - Servlet ë°ì´í„° ë°°ì—´ë¡œ ë°›ê¸°, ì €ì¥"
categories: Servlet 
tag: [Servlet, application, session, cookie]
toc: true
toc_sticky: true
author_profile: false
sidebar:
  nav: "docs"
---


# 2022-04-09 

<!--Quote-->
> ğŸ’¡ ìœ íŠœë¸Œ **"ë‰´ë ‰ì²˜"** ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±.

> â— ê°œì¸ì´ ê³µë¶€í•œ ë‚´ìš©ì„ ì ì€ ê²ƒ ì´ê¸°ì— ì˜¤ë¥˜ê°€ ë§ì„ ìˆ˜ë„ ìˆìŒ 


# 2022-04-09

## ğŸ’¡ submitì„ êµ¬ë¶„ í•˜ê¸°

**calc.html**

```java
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<form action="calc" method = "post">
		<div>
			<label>x : </label>
			<input type ="text" name ="x"/>
		</div>
		<div>
			<label>y :</label>
			<input type ="text" name ="y"/>
		</div>
		<div>
			<input type="submit" name="operator" value="ë§ì…ˆ"/>
			<input type="submit" name="operator" value="ëº„ì…ˆ"/>
		</div>
		<div>
			ê²°ê³¼ 0
		</div>
	</form>
</body>
</html>
```

1. submitì„ ëˆ„ë¥´ë©´ calcë¡œ ë°ì´í„°ê°€ ë„˜ì–´ê°„ë‹¤ 
2. ê·¸ëŸ¼ ëˆ„ë¥¸ submitì˜ valueê°€ ë§ì…ˆì¸ì§€ ëº„ì…ˆì¸ì§€ ì–´ë–»ê²Œ ì•Œê¹Œ? 
3. calc.java íŒŒì¼ì—ì„œ nameìœ¼ë¡œ ë“¤ì–´ì˜¨ operatorë¥¼ ì¡°ê±´ì„ ì¤˜ ë§ì…ˆì¼ë•Œ, ëº„ì…ˆì¼ë•Œ ì¡°ê±´ì„ ì¤€ë‹¤ 

**calc.java**

```java

		String x_ = request.getParameter("x");
		String y_ = request.getParameter("y");
		String op = request.getParameter("operator");
		
		int x = 0;
		int y = 0;
		
		if(!x_.equals("")) x = Integer.parseInt(x_);
		if(!y_.equals("")) y = Integer.parseInt(y_);
		
		int result = 0;
		
		// ë„˜ì–´ì˜¨ operatorê°’ì´ ë§ì…ˆì¸ì§€ ëº„ì…ˆì¸ì§€ í™•ì¸ -> ê·¸ì— ë”°ë¼ ì¡°ê±´ë„ ë‹¤ë¥´ê²Œ ì¤€ë‹¤
		if(op.equals("ë§ì…ˆ"))
			result = x + y;
		else
			result = x - y;
		
		// í™”ë©´ì— ë³´ì—¬ì§€ëŠ” ì¶œë ¥
		response.getWriter().printf("result is %d\n", result);
	}
}
```

---

## ğŸ’¡ ê°’ì„ ë°›ì„ ë•Œ ë°°ì—´ë¡œ ë°›ê¸°

### í•˜ë‚˜ì”© ë°›ê¸°
ê¸°ì¡´ì—ëŠ” ê°’ì„ ë°›ì„ ë•Œ name ì„ ë‹¤ë¥´ê²Œ í•´ì„œ í•˜ë‚˜ì”© ê°’ì„ ë°›ì•„ì¤¬ë‹¤


add.html

```html
<div>
	<label>x : </label>
	<input type ="text" name ="x"/>
</div>
<div>
	<label>y :</label>
	<input type ="text" name ="y"/>
</div>
```

add..java

```java

	String x_ = request.getParameter("x");
	String y_ = request.getParameter("y");
		
	int x = 0;
	int y = 0;
		
	if(!x_.equals("")) x = Integer.parseInt(x_);
	if(!y_.equals("")) y = Integer.parseInt(y_);
		
	int result = x + y;
		
	// í™”ë©´ì— ë³´ì—¬ì§€ëŠ” ì¶œë ¥
	response.getWriter().printf("result is %d\n", result);

```

### ê°’ì„ ë°°ì—´ë¡œ ë°›ëŠ”ë²•

add2.html

```html
<div>
	<input type ="text" name ="num"/> <!-- nameì„ í•˜ë‚˜ë¡œ í†µì¼ì‹œì¼œì„œ ë°°ì—´ë¡œ ë³´ë‚´ì£¼ê¸° -->
	<input type ="text" name ="num"/>
	<input type ="text" name ="num"/>
	<input type ="text" name ="num"/>
</div>
```

- ê°™ì€ nameìœ¼ë¡œ ì „ë‹¬

add2.java

```java

	// ë„˜ì–´ì˜¤ëŠ” ê°’ì„ ë°°ì—´ë¡œ ë°›ê¸° 
	String[] num_ = request.getParameterValues("num");
		
	int result = 0; // ê¸°ë³¸ê°’ 
		
	for(int i = 0; i < num_.length; i++) {
		int num = Integer.parseInt(num_[i]); // í˜•ë³€í™˜
		result += num;
	}
```

---

## ğŸ”” Application í™œìš©

calc2.html

```html
<form action="calc2" method = "post">
	<div>
		<label>ì…ë ¥ : </label>
		<input type ="text" name ="v"/>
	</div>
	<div>
		<input type="submit" name="operator" value="ë§ì…ˆ"/>
		<input type="submit" name="operator" value="ëº„ì…ˆ"/>
		<input type="submit" name="operator" value="="/>
	</div>
	<div>
		ê²°ê³¼ 0
	</div>
	</form>
```

calc2.java

```java
		response.setCharacterEncoding("UTF-8");
		response.setContentType("text/html; charset=UTF-8");
		ServletContext application = request.getServletContext();
		
		String v_ = request.getParameter("v"); // valueê°’
		String op = request.getParameter("operator"); //operator ê°’
		
		int v = 0;
		if(!v_.equals("")) v = Integer.parseInt(v_);
		
		
		// opê°€ = ì´ë©´
		if(op.equals("=")) {
			
			// applicationì— ì €ì¥í•œ ê°’ì„ ë°›ì•„ì˜¨ë‹¤ (ì²«ë²ˆì§¸ë¡œ ì…ë ¥í•œê°’)
			int x = (Integer)application.getAttribute("value"); // objectë¡œ ê²°ê³¼ê°’ ë°›ì•„ì™€ì„œ í˜•ë³€í™˜ í•„ìš”
			int y = v; //(ë‘ë²ˆì§¸ë¡œ ì…ë ¥í•œ ê°’)
			String operator = (String)application.getAttribute("op"); // ë§ì…ˆì¸ì§€ ëº„ì…ˆì¸ì§€ ì €ì¥í•œ ê°’ì„ ë°›ì•„ì˜¨ë‹¤
			
			int result = 0;
			
			// ë„˜ì–´ì˜¨ operatorê°’ì´ ë§ì…ˆì¸ì§€ ëº„ì…ˆì¸ì§€ í™•ì¸ -> ê·¸ì— ë”°ë¼ ì¡°ê±´ë„ ë‹¤ë¥´ê²Œ ì¤€ë‹¤
			if(operator.equals("ë§ì…ˆ")) 
				result = x + y;
			else
				result = x - y;
			
			// í™”ë©´ì— ë³´ì—¬ì§€ëŠ” ì¶œë ¥
			response.getWriter().printf("result is %d\n", result);
		}
		else { // opê°€ = ì´ ì•„ë‹ˆë©´ ê°’ì„ ì €ì¥
			// application ë°©ë²•ìœ¼ë¡œ ê°’ì„ ë‹´ëŠ”ë‹¤
			application.setAttribute("value", v); // ì²˜ìŒ ì…ë ¥í•œ ìˆ˜
			application.setAttribute("op", op); // ì²˜ìŒ ìˆ«ìê°€ ì…ë ¥í• ë•Œ ë§ì…ˆì¸ì§€ ëº„ì…ˆì¸ì§€ ì €ì¥
		}
```

## ğŸ”” Session í™œìš©

```java
		response.setCharacterEncoding("UTF-8");
		response.setContentType("text/html; charset=UTF-8");
		ServletContext application = request.getServletContext();
		HttpSession session = request.getSession();

		String v_ = request.getParameter("v");
		String op = request.getParameter("operator"); 
		
		int v = 0;
		if(!v_.equals("")) v = Integer.parseInt(v_);
		

		if(op.equals("=")) {
			
			int x = (Integer)sessin.getAttribute("value"); 
			int y = v; 
			String operator = (String)session.getAttribute("op");
			
			int result = 0;
			
			if(operator.equals("ë§ì…ˆ")) 
				result = x + y;
			else
				result = x - y;
			
			response.getWriter().printf("result is %d\n", result);
		}
		else {
			session.setAttribute("value", v);
			session.setAttribute("op", op);
		}
```

- ê¸°ì¡´ì˜ applicationì„ sessionìœ¼ë¡œ ë°”ê¿”ì¤€ë‹¤
- HttpSession session = request.getSession(); ì¶”

## ğŸ”” Cookie í™œìš©

```java

@WebServlet("/calc2")
public class Calc2 extends HttpServlet {
	private static final long serialVersionUID = 1L;

	protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		response.setCharacterEncoding("UTF-8");
		response.setContentType("text/html; charset=UTF-8");
		
		Cookie[] cookies = request.getCookies(); // 3. ì¿ í‚¤ëŠ” ë°°ì—´ë¡œ ë°›ì•„ì˜¨ë‹¤ 
		
		String v_ = request.getParameter("v"); // valueê°’
		String op = request.getParameter("operator"); //operator ê°’
		
		int v = 0;
		if(!v_.equals("")) v = Integer.parseInt(v_);
		
		if(op.equals("=")) {
			
			// 4. ì¿ í‚¤ ì°¾ê¸°
			int x = 0;
			for(Cookie c : cookies) {
				if(c.getName().equals("value")) {
					x = Integer.parseInt(c.getValue()); // Stringìœ¼ë¡œ ì™€ì„œ í˜•ë³€í™˜
					break;
				}
			}
			Cookie c = cookies[0];
			
			int y = v;
	
			// 5. ì¿ í‚¤ ì°¾ê¸°
			String operator ="";
			for(Cookie c2 : cookies) {
				if(c2.getName().equals("op")) {
					operator = c2.getValue();
					break;
				}
			}

			int result = 0;
			
			if(operator.equals("ë§ì…ˆ")) 
				result = x + y;
			else
				result = x - y;
			
			response.getWriter().printf("result is %d\n", result);
		}
		else {

			// 1. ì¿ í‚¤ ë§Œë“¤ê¸°
			Cookie valueCookie = new Cookie("value",String.valueOf(v)); // ì¿ í‚¤ëŠ” ë¬¸ìì—´ 
			Cookie opCookie = new Cookie("op", op);
			
			// ì¿ í‚¤ ìš”ì²­ ì£¼ì†Œ ì„¤ì •
			valueCookie.setPath("/calc2"); 
			opCookie.setPath("/calc2"); 
			
			// ì¿ í‚¤ ì‹œê°„ ì„¤ì • 
			valueCookie.setMaxAge(24 * 60 * 60); 
			opCookie.setMaxAge(24 * 60 * 60);

			// 2. í´ë¼ì´ì–¸íŠ¸í•œí…Œ ì¿ í‚¤ ë³´ë‚´ê¸°
			response.addCookie(valueCookie);
			response.addCookie(opCookie);
		}
				
	}

}
```

1. ì¿ í‚¤ë¥¼ ë¨¼ì € ë§Œë“¤ê³  í´ë¼ì´ì–¸íŠ¸í•œí…Œ ì¿ í‚¤ë¥¼ ë³´ë‚´ì¤€ë‹¤
2. ì¿ í‚¤ë¥¼ ë°°ì—´ë¡œ ë°›ì•„ì¤€ë‹¤
3. ì¿ í‚¤ë¥¼ ì°¾ëŠ”ë‹¤

- ì„œë²„ì˜ íŠ¹ì •ê²½ë¡œ ìš”ì²­ì—ì„œë§ŒÂ **ì¿ í‚¤**ë¥¼ ì „ì†¡í•˜ê³ ì í• ë•ŒÂ **setPath**( ) ë©”ì†Œë“œë¥¼ ì‚¬ìš©
- ì¿ í‚¤ì˜ ì‚¬ìš© ì‹œê°„ì„ ì„¤ì • í•  ë•ŒëŠ” setMaxAge() ì‚¬ìš©

ğŸ‘ [https://opentutorials.org/module/3569/21213](https://opentutorials.org/module/3569/21213)

## ğŸš€application / session / cookie ì •ë¦¬

### application

ì‚¬ìš©ë²”ìœ„ : ì „ì—­ë²”ìœ„ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì €ì¥ê³µê°„

ìƒëª…ì£¼ê¸° : WASê°€ ì‹œì‘í•´ì„œ ì¢…ë£Œí•  ë•Œ ê¹Œì§€

ì €ì¥ìœ„ì¹˜ : WAS ì„œë²„ì˜ ë©”ëª¨ë¦¬

### session

ì‚¬ìš©ë²”ìœ„ : ì„¸ì…˜ë²”ìœ„ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì €ì¥ ê³µê°„

ìƒëª…ì£¼ê¸° : ì„¸ì…˜ì´ ì‹œì‘í•´ì„œ ì¢…ë£Œí•  ë•Œ ê¹Œì§€

ì €ì¥ìœ„ì¹˜ : WAS ì„œë²„ì˜ ë©”ëª¨ë¦¬

### cookie

ì‚¬ìš©ë²”ìœ„ : Web Browser ë³„ ì§€ì •í•œ path ë²”ì£¼ ê³µê°„

ìƒëª…ì£¼ê¸° : Browserì— ì „ë‹¬í•œ ì‹œê°„ë¶€í„° ë§Œë£Œì‹œê°„ê¹Œì§€

ì €ì¥ìœ„ì¹˜ : Web Browserì˜ ë©”ëª¨ë¦¬ ë˜ëŠ” íŒŒì¼