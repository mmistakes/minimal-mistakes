---
layout: single
title:  "[DL/CV] ë”¥ëŸ¬ë‹ ì•„í‚¤í…ì²˜ : ì§ê´€ ê¸°ë¥´ê¸° ğŸ—ï¸"

---


## 5. ì»¨ë¸Œë„· ì•„í‚¤í…ì²˜ íŒ¨í„´





### 5.1 ìµœì‹  ì»¨ë¸Œë„· ì•„í‚¤í…ì²˜



#### 5.1.0 ë“¤ì–´ê°€ë©°

ëª¨ë¸ì˜ 'ì•„í‚¤í…ì²˜'ëŠ” ëª¨ë¸ì„ ë§Œë“œëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì¼ë ¨ì˜ ì„ íƒì´ë‹¤. ì‚¬ìš©í•  ì¸µ, ì¸µì˜ ì„¤ì •, ì¸µì„ ì—°ê²°í•˜ëŠ” ë°©ë²•ë“±ì„ ì„ íƒí•˜ëŠ” ê²ƒì´ ëª¨ë¸ì˜ 'ì•„í‚¤í…ì²˜'ì¸ ê²ƒì´ë‹¤. ëª¨ë¸ ì•„í‚¤í…ì²˜ê°€ ëª¨ë¸ì˜ ì„±ê³µê³¼ ì‹¤íŒ¨ë¥¼ ê°€ë¦„í•˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤. ì¢‹ì€ ëª¨ë¸ ì•„í‚¤í…ì²˜ëŠ” íƒìƒ‰ ê³µê°„ì˜ í¬ê¸°ë¥¼ ì¤„ì´ê±°ë‚˜ íƒìƒ‰ ê³µê°„ì˜ ì¢‹ì€ ìœ„ì¹˜ì— ì‰½ê²Œ ìˆ˜ë ´í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ë‹¤. ì‚¬ì‹¤ ëª¨ë¸ ì•„í‚¤í…ì²˜ëŠ” ê³¼í•™ë³´ë‹¤ëŠ” ì˜ˆìˆ ì— ê°€ê¹ë‹¤ê³ ë“¤ ë§í•œë‹¤. ê·¸ë§Œí¼ ë§ì€ ê²½í—˜ì´ í•„ìš”í•˜ê³  , ì „ë¬¸ê°€ë“¤ì˜ ì§ê´€ì´ ë§ì´ í•„ìš”í•˜ê¸° ë•Œë¬¸ì´ë‹¤. ì „ë¬¸ê°€ëŠ” ë‹¤ì–‘í•œ ì‹¤ì „ ê²½í—˜ì„ í†µí•´ ì–»ì€ ëŠ¥ë ¥ì¸ **íŒ¨í„´ ë§¤ì¹­**ì— ì˜ì¡´í•œë‹¤. 



ì´ë²ˆ ì ˆì—ì„œëŠ” ë‹¤ìŒì˜ í•µì‹¬ì ì¸ ì»¨ë¸Œë„· ì•„í‚¤í…ì²˜ì˜ ëª¨ë²” ì‚¬ë¡€ë“¤ì„ ì•Œì•„ë³¸ë‹¤. 



*   **ì”ì°¨ ì—°ê²°** (residual connection) 

*   **ë°°ì¹˜ ì •ê·œí™”** (batch normalization)

*   **ë¶„ë¦¬ í•©ì„±ê³±** (seperable convolution)

 

ì´ëŸ° ì¸µë“¤ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ë“¤ì„ ìµíˆë©´ íš¨ìœ¨ì ì¸ ì´ë¯¸ì§€ ëª¨ë¸ì„ êµ¬ì¶•í•˜ëŠ”ë° í° ë„ì›€ì´ ëœë‹¤. ì´ë²ˆ ê¸€ì—ì„œëŠ” ì´ëŸ° ê¸°ìˆ ë“¤ì„ *ê°•ì•„ì§€ vs ê³ ì–‘ì´* ë¶„ë¥˜ ë¬¸ì œì— ì ìš©í•´ë³¸ë‹¤.



#### 5.1.1 ëª¨ë“ˆí™”,ê³„ì¸µí™” ê·¸ë¦¬ê³  ì¬ì‚¬ìš©

ë³µì¡í•œ ì‹œìŠ¤í…œì„ ë‹¨ìˆœí•˜ê²Œ ë§Œë“œëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆë‹¤. ë³µì¡í•œ êµ¬ì¡°ë¥¼ **ëª¨ë“ˆí™”**í•˜ê³ , ëª¨ë“ˆë“¤ì„ **ê³„ì¸µí™”**í•˜ê³ , ê°™ì€ ëª¨ë“ˆì„ ì—¬ëŸ¬ê³³ì— **ì¬ì‚¬ìš©**í•˜ëŠ” ê²ƒì´ë‹¤. ì´ëŠ” 'ì•„í‚¤í…ì²˜'ë¼ëŠ” ìš©ì–´ê°€ ì‚¬ìš©ë˜ëŠ” ê±°ì˜ ëª¨ë“  ì˜ì—­ì— ìˆëŠ” ì‹œìŠ¤í…œ êµ¬ì¡°ì˜ ê¸°ì´ˆê°€ ëœë‹¤. ì´ë¥¼ ë”¥ëŸ¬ë‹ì— ì ìš©í•˜ë©´, ë”¥ëŸ¬ë‹ ëª¨ë¸ ì•„í‚¤í…ì²˜ëŠ” ëª¨ë“ˆí™”, ê³„ì¸µí™”, ì¬ì‚¬ìš©ì„ ì˜ë¦¬í•˜ê²Œ í™œìš©í•˜ëŠ” ê²ƒì´ë‹¤. ì¸ê¸°ìˆëŠ” ëª¨ë“  ì»¨ë¸Œë„· ì•„í‚¤í…ì²˜ëŠ” ì¸µìœ¼ë¡œë§Œ êµ¬ì„±ë˜ì–´ ìˆì§€ ì•Šê³  ë°˜ë³µë˜ëŠ” ì¸µì˜ ê·¸ë£¹(ë¸”ë¡ or ëª¨ë“ˆ)ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤. ë˜í•œ, ëŒ€ë¶€ë¶„ì˜ ì»¨ë¸Œë„·ì€ í”¼ë¼ë¯¸ë“œì™€ ê°™ì€ ê³„ì¸µ êµ¬ì¡°ë¥¼ ê°€ì§€ëŠ” ê²½ìš°ê°€ ë§ë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì´ì „ ê¸€ì—ì„œ ë§Œë“  ì²«ë²ˆì§¸ ì»¨ë¸Œë„·ì—ì„œ ì‚¬ìš©í•œ í•©ì„±ê³± í•„í„° ê°œìˆ˜ëŠ” 32,64,128ê°œë¡œ ì¸µì´ ê¹Šì–´ì§ˆìˆ˜ë¡ ëŠ˜ì–´ë‚œë‹¤.(ë°˜ë©´ íŠ¹ì„± ë§µì˜ í¬ê¸°ëŠ” ì¤„ì–´ë“ ë‹¤.) ì•„ë˜ ì´ë¯¸ì§€ì²˜ëŸ¼ VGG16 ëª¨ë¸ì˜ ë¸”ë¡ì—ì„œë„ ë™ì¼í•œ íŒ¨í„´ì„ ë³¼ ìˆ˜ ìˆë‹¤.



![convarch](https://user-images.githubusercontent.com/77332628/197730869-1bcf21de-dbc9-42e9-8b4f-22d93a5a9550.png)



ëª¨ë¸ì˜ ê³„ì¸µ êµ¬ì¡°ê°€ ê¹Šìœ¼ë©´ íŠ¹ì„± ì¬ì‚¬ìš©ê³¼ ì´ë¡œ ì¸í•œ ì¶”ìƒí™”ë¥¼ ì¥ë ¤í•˜ê¸° ë•Œë¬¸ì— ë³¸ì§ˆì ìœ¼ë¡œ ì¢‹ë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì‘ì€ ì¸µì„ ê¹Šê²Œ ìŒ“ì€ ëª¨ë¸ì´ í° ì¸µì„ ì–‡ê²Œ ìŒ“ì€ ëª¨ë¸ë³´ë‹¤ ì„±ëŠ¥ì´ ì¢‹ë‹¤. í•˜ì§€ë§Œ **ê·¸ë ˆë””ì–¸íŠ¸ ì†Œì‹¤** ë¬¸ì œ ë•Œë¬¸ì— ì¸µì„ ê¹Šê²Œ ìŒ“ì„ ìˆ˜ ìˆëŠ”ë°ì— í•œê³„ê°€ ìˆë‹¤. ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì²«ë²ˆì§¸ í•µì‹¬ ì•„í‚¤í…ì²˜ íŒ¨í„´ì¸ ì”ì°¨ ì—°ê²°ì´ íƒ„ìƒí–ˆë‹¤.



### 5.2 ì”ì°¨ ì—°ê²°



#### 5.2.1 ê·¸ë ˆë””ì–¸íŠ¸ ì†ì‹¤

ë‹¤ìŒê³¼ ê°™ì´ ì—°ê²°ëœ í•¨ìˆ˜ê°€ ìˆë‹¤ê³  í•˜ì.





*   y = f4(f3(f2(f1(x))))

f4ì˜ ì¶œë ¥ì— ê¸°ë¡ëœ ì˜¤ì°¨(ëª¨ë¸ì˜ ì†ì‹¤)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì—°ê²°ëœ ê° í•¨ìˆ˜ì˜ íŒŒë¼ë¯¸í„°ë¥¼ ì¡°ì •í•œë‹¤ê³  í•˜ì. f1ë¥¼ ì¡°ì •í•˜ë ¤ë©´ f2,f3,f4ì— ì˜¤ì°¨ ì •ë³´ë¥¼ í†µê³¼ì‹œì¼œì•¼í•œë‹¤. í•˜ì§€ë§Œ ì—°ì†ì ìœ¼ë¡œ ë†“ì€ ê° í•¨ìˆ˜ì—ëŠ” ì¼ì •ëŸ‰ì˜ ì¡ìŒì´ ìˆë‹¤. í•¨ìˆ˜ ì—°ê²°ì´ ë„ˆë¬´ ê¹Šì–´ì§€ë©´ ê° í•¨ìˆ˜ì˜ ì¡ìŒë“¤ì´ ê·¸ë ˆë””ì–¸íŠ¸ ì •ë³´ë¥¼ ì••ë„í•˜ê¸° ì‹œì‘í•˜ê³  ì—­ì „íŒŒê°€ ë™ì‘í•˜ì§€ ì•Šê²Œ ëœë‹¤. ì¦‰, ëª¨ë¸ì´ ì „í˜€ í›ˆë ¨ë˜ì§€ ì•Šê²Œ ëœë‹¤. ì´ë¥¼ ê·¸ë ˆë””ì–´íŠ¸ **ì†ì‹¤(vanishing gradient)**ì´ë¼ê³  í•œë‹¤.



#### 5.2.2 ì”ì°¨ì—°ê²°



ê·¸ë ˆë””ì–¸íŠ¸ ì†ì‹¤ì˜ í•´ê²° ë°©ë²•ì€ ê°„ë‹¨í•˜ë‹¤. ì—°ê²°ëœ ê° í•¨ìˆ˜ë“¤ì„ ì´ì „ ì…ë ¥ì— ë‹´ê¸´ ì¡ìŒ ì—†ëŠ” ì •ë³´ë¥¼ ìœ ì§€ì‹œí‚¤ê²Œ ë§Œë“¤ë©´ ëœë‹¤. ì´ë¥¼ êµ¬í˜„í•˜ëŠ” ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ì´ **ì”ì°¨ ì—°ê²°(residual connection)**ì´ë‹¤. ì•„ë˜ ì´ë¯¸ì§€ì²˜ëŸ¼ ì”ì°¨ ì—°ê²°ì€ ì¸µì´ë‚˜ ë¸”ë¡ì˜ ì…ë ¥ì„ ì¶œë ¥ì— ë”í•˜ê¸°ë§Œ í•˜ë©´ ëœë‹¤.



![conarch2](https://user-images.githubusercontent.com/77332628/197730865-d433dfe1-e469-41e1-8a13-8076ae99fe11.png)



ì”ì°¨ ì—°ê²°ì€ ì¡ìŒì´ ìˆëŠ” ë¸”ë¡(ì˜ˆë¥¼ ë“¤ì–´ relu í™œì„±í™” í•¨ìˆ˜ë‚˜ ë“œë¡­ì•„ì›ƒ ì¸µì„ ê°€ì§„ ë¸”ë¡)ì„ ëŒì•„ê°€ëŠ” ì •ë³´ì˜ ì§€ë¦„ê¸¸ê³¼ ê°™ë‹¤. ì´ì „ ì¸µì˜ ì˜¤ì°¨ ê·¸ë ˆë””ì–¸íŠ¸ ì •ë³´ê°€ ì¡ìŒì—†ì´ ë„¤íŠ¸ì›Œí¬ ê¹Šìˆ™íˆ ì „íŒŒë˜ê²Œ ë§Œë“ ë‹¤. ì´ ê¸°ë²•ì€ **ResNet ëª¨ë¸**ê³¼ í•¨ê»˜ ì†Œê°œë˜ì—ˆë‹¤.



ì”ì°¨ ì—°ê²°ì€ ë‹¤ìŒ ì½”ë“œì™€ ê°™ì´ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.



```python
x = ...        # ì…ë ¥ í…ì„œ
residual = x   # ì›ë³¸ ì…ë ¥ì„ ë³„ë„ë¡œ ì €ì¥í•œë‹¤. ì´ë¥¼ ì”ì°¨ë¼ê³  ë¶€ë¥¸ë‹¤.
x = block(x)   # ì´ ê³„ì‚°ì€ íŒŒê´´ì (ì¡ìŒì´ ìˆë‹¤)ì¼ ìˆ˜ë„ ìˆë‹¤.
x = add([x,residual]) # ì›ë³¸ ì…ë ¥ì„ ì¸µì˜ ì¶œë ¥ì— ë”í•œë‹¤. ë”°ë¼ì„œ ìµœì¢… ì¶œë ¥ì€ í•­ìƒ ì›ë³¸ ì…ë ¥ì˜ ì „ì²´ ì •ë³´ë¥¼ ë³´ì¡´í•œë‹¤.
```

ì…ë ¥ì„ ë¸”ë¡ì˜ ì¶œë ¥ì— ë‹¤ì‹œ ë”í•˜ëŠ” ê²ƒì€ ì¶œë ¥í¬ê¸°ê°€ ì…ë ¥ê³¼ ê°™ì•„í– í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ì§€ë§Œ, ë¸”ë¡ì— í•„í„° ê°œìˆ˜ê°€ ëŠ˜ì–´ë‚œ í•©ì„±ê³± ì¸µì´ë‚˜ ìµœëŒ€ í’€ë§ ì¸µì´ ë“¤ì–´ìˆëŠ” ê²½ìš°ì—ëŠ” ê·¸ë ‡ì§€ ì•Šë‹¤. ì´ëŸ° ê²½ìš°ì—ëŠ” ë‹¤ìŒ ì½”ë“œì™€ ê°™ì´ í™œì„±í™” í•¨ìˆ˜ê°€ ì—†ëŠ”**1x1 í¬ê¸°ì˜ Conv2D ì¸µ**ì„ ì‚¬ìš©í•´ì„œ ì”ì°¨ë¥¼ ì›í•˜ëŠ” ì¶œë ¥ í¬ê¸°ë¡œ ì„ í˜•ì ìœ¼ë¡œ íˆ¬ì˜í•  ìˆ˜ ìˆë‹¤. ë¸”ë¡ì— ìˆëŠ” í•©ì„±ê³± ì¸µì€ íŒ¨ë”© ë•Œë¬¸ì— ê³µê°„ ë°©í–¥ìœ¼ë¡œ ë‹¤ìš´ìƒ˜í”Œë§ë˜ì§€ ì•Šë„ë¡ ì¼ë°˜ì ìœ¼ë¡œ padding='same'ì„ ì‚¬ìš©í•œë‹¤. 



```python
from tensorflow import keras
from tensorflow.keras import layers

inputs = keras.Input(shape=(32,32,3))
x = layers.Conv2D(32,3,activation='relu')(inputs)
residual = x  # ì”ì°¨ ë³„ë„ ì €ì¥
x = layers.Conv2D(64,3,activation='relu',padding='same')(x)  
# ì”ì°¨ ë¸”ë¡ì— í•´ë‹¹í•˜ëŠ” ì¸µ , ì´ ì¸µì€ ì¶œë ¥ í•„í„°ë¥¼ 32ê°œì—ì„œ 64ê°œë¡œ ì¦ê°€ì‹œí‚¤ê³  , íŒ¨ë”©ìœ¼ë¡œ ì¸í•œ ë‹¤ìš´ìƒ˜í”Œë§ í”¼í•˜ê¸° ìœ„í•´ padding='same'ìœ¼ë¡œ í•œë‹¤.
residual = layers.Conv2D(64,1)(residual)  # ì”ì°¨ëŠ” 32ê°œì˜ í•„í„°ë§Œ ìˆìœ¼ë¯€ë¡œ 1x1 Conv2Dë¥¼ ì‚¬ìš©í•´ì„œ ì ì ˆí•œ í¬ê¸°ë¡œ ë³€í™˜
x = layers.add([x,residual]) # ë¸”ë¡ ì¶œë ¤ê³¼ ì”ì°¨ì˜ í¬ê¸°ê°€ ê°™ìœ¼ë¯€ë¡œ ë”í•  ìˆ˜ ìˆë‹¤.
```

ë˜ëŠ” ë‹¤ìŒ ì½”ë“œì²˜ëŸ¼ ìµœëŒ€ í’€ë§ì¸µìœ¼ë¡œ ì¸í•œ ë‹¤ìš´ìƒ˜í”Œë§ì— ë§ì¶”ê¸° ìœ„í•´ ì”ì°¨ íˆ¬ì˜ì— **ìŠ¤íŠ¸ë¼ì´ë“œ**ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.



```python
inputs = keras.Input(shape=(32,32,3))
x = layers.Conv2D(32,3,activation='relu')(inputs)
residual = x  # ì”ì°¨ ë³„ë„ ì €ì¥
x = layers.Conv2D(64,3,activation='relu',padding='same')(x)  
x = layers.MaxPooling2D(2,padding='same')(x) # ì´ ì”ì°¨ ë¸”ë¡ì€ ìµœëŒ€í’€ë§ì¸µì„ í¬í•¨í•´ì„œ 2ê°œì˜ ì¸µìœ¼ë¡œ êµ¬ì„±
residual = layers.Conv2D(64,1,strides=2)(residual) # ìµœëŒ€ í’€ë§ì¸µìœ¼ë¡œ ì¸í•œ ë‹¤ìš´ìƒ˜í”Œë§ì— ë§ì¶”ê¸° ìœ„í•´ ì”ì°¨ íˆ¬ì˜ì— strides=2 ì‚¬ìš©
x = layers.add([x,residual]) # ë¸”ë¡ ì¶œë ¤ê³¼ ì”ì°¨ì˜ í¬ê¸°ê°€ ê°™ìœ¼ë¯€ë¡œ ë”í•  ìˆ˜ ìˆë‹¤.
```

ë‹¤ìŒ ì½”ë“œëŠ” ì¢€ ë” êµ¬ì²´ì ìœ¼ë¡œ ì—¬ëŸ¬ê°œì˜ ë¸”ë¡ìœ¼ë¡œ êµ¬ì„±ëœ ê°„ë‹¨í•œ ì»¨ë¸Œë„·ì˜ ì˜ˆì‹œì´ë‹¤. ê° ë¸”ë¡ì€ 2ê°œì˜ í•©ì„±ê³± ì¸µê³¼ í•˜ë‚˜ì˜ ì„ íƒì ì¸ ìµœëŒ€ í’€ë§ì¸µìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆê³ , ê° ë¸”ë¡ë§ˆë‹¤ ì”ì°¨ì—°ê²°ì„ ê°€ì§„ë‹¤. 



```python
from tensorflow import keras
from tensorflow.keras import layers

inputs = keras.Input(shape=(32, 32, 3))
x = layers.Rescaling(1./255)(inputs)

def residual_block(x, filters, pooling=False):  # ì”ì°¨ì—°ê²°ì„ ê°€ì§„ í•©ì„±ê³± ë¸”ë¡ì„ ì ìš©í•˜ëŠ” ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜, ì„ íƒì €ìœ¼ë¡œ ìµœëŒ€ í’€ë§ì¸µ ì¶”ê°€
    residual = x
    x = layers.Conv2D(filters, 3, activation="relu", padding="same")(x)
    x = layers.Conv2D(filters, 3, activation="relu", padding="same")(x)
    if pooling:
        x = layers.MaxPooling2D(2, padding="same")(x)
        residual = layers.Conv2D(filters, 1, strides=2)(residual)  # ìµœëŒ€ í’€ë§ì„ ì‚¬ìš©í•˜ë©´ ì”ì°¨ë¥¼ ì›í•˜ëŠ” í¬ê¸°ë¡œ íˆ¬ì˜ìœ„í•´ ìŠ¤íŠ¸ë¼ì´ë“œ ì¶”ê°€
    elif filters != residual.shape[-1]:
        residual = layers.Conv2D(filters, 1)(residual) # ìµœëŒ€ í’€ë§ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ ì±„ë„ ìˆ˜ê°€ ë°”ë€ ê²½ìš°ì—ë§Œ íˆ¬ì˜
    x = layers.add([x, residual])
    return x

x = residual_block(x, filters=32, pooling=True) # ì²«ë²ˆì§¸ ë¸”ë¡
x = residual_block(x, filters=64, pooling=True) # ë‘ë²ˆì§¸ ë¸”ë¡, ë¸”ë¡ë§ˆë‹¤ í•„í„° ê°œìˆ˜ ì¦ê°€
x = residual_block(x, filters=128, pooling=False) # ë§ˆì§€ë§‰ ë¸”ë¡ì€ ë‹¤ìŒì— ì „ì—­ í‰ê·  í’€ë§ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— í’€ë§ í•„ìš”X

x = layers.GlobalAveragePooling2D()(x)
outputs = layers.Dense(1, activation="sigmoid")(x)
model = keras.Model(inputs=inputs, outputs=outputs)
model.summary()
```

<pre>
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 input_1 (InputLayer)           [(None, 32, 32, 3)]  0           []                               
                                                                                                  
 rescaling (Rescaling)          (None, 32, 32, 3)    0           ['input_1[0][0]']                
                                                                                                  
 conv2d (Conv2D)                (None, 32, 32, 32)   896         ['rescaling[0][0]']              
                                                                                                  
 conv2d_1 (Conv2D)              (None, 32, 32, 32)   9248        ['conv2d[0][0]']                 
                                                                                                  
 max_pooling2d (MaxPooling2D)   (None, 16, 16, 32)   0           ['conv2d_1[0][0]']               
                                                                                                  
 conv2d_2 (Conv2D)              (None, 16, 16, 32)   128         ['rescaling[0][0]']              
                                                                                                  
 add (Add)                      (None, 16, 16, 32)   0           ['max_pooling2d[0][0]',          
                                                                  'conv2d_2[0][0]']               
                                                                                                  
 conv2d_3 (Conv2D)              (None, 16, 16, 64)   18496       ['add[0][0]']                    
                                                                                                  
 conv2d_4 (Conv2D)              (None, 16, 16, 64)   36928       ['conv2d_3[0][0]']               
                                                                                                  
 max_pooling2d_1 (MaxPooling2D)  (None, 8, 8, 64)    0           ['conv2d_4[0][0]']               
                                                                                                  
 conv2d_5 (Conv2D)              (None, 8, 8, 64)     2112        ['add[0][0]']                    
                                                                                                  
 add_1 (Add)                    (None, 8, 8, 64)     0           ['max_pooling2d_1[0][0]',        
                                                                  'conv2d_5[0][0]']               
                                                                                                  
 conv2d_6 (Conv2D)              (None, 8, 8, 128)    73856       ['add_1[0][0]']                  
                                                                                                  
 conv2d_7 (Conv2D)              (None, 8, 8, 128)    147584      ['conv2d_6[0][0]']               
                                                                                                  
 conv2d_8 (Conv2D)              (None, 8, 8, 128)    8320        ['add_1[0][0]']                  
                                                                                                  
 add_2 (Add)                    (None, 8, 8, 128)    0           ['conv2d_7[0][0]',               
                                                                  'conv2d_8[0][0]']               
                                                                                                  
 global_average_pooling2d (Glob  (None, 128)         0           ['add_2[0][0]']                  
 alAveragePooling2D)                                                                              
                                                                                                  
 dense (Dense)                  (None, 1)            129         ['global_average_pooling2d[0][0]'
                                                                 ]                                
                                                                                                  
==================================================================================================
Total params: 297,697
Trainable params: 297,697
Non-trainable params: 0
__________________________________________________________________________________________________
</pre>
ìœ„ì˜ summaryë¥¼ ë³´ë©´ ì”ì°¨ ì—°ê²°ì„ ì‚¬ìš©í•˜ë©´ ê·¸ë ˆë””ì–¸íŠ¸ ì†Œì‹¤ì— ëŒ€í•´ ê±±ì •í•˜ì§€ ì•Šê³  ì›Œí•˜ëŠ” ê¹Šì´ì˜ ë„¤íŠ¸ì›Œí¬ë¥¼ ë§Œë“¤ìˆ˜ ìˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œ ìˆ˜ ìˆë‹¤.



### 5.3 ë°°ì¹˜ ì •ê·œí™”

**ì •ê·œí™”**ëŠ” ë¨¸ì‹  ëŸ¬ë‹ ëª¨ë¸ì— ì£¼ì…ë˜ëŠ” ìƒ˜í”Œë“¤ì„ ê· ì¼í•˜ê²Œ ë§Œë“œëŠ” ê´‘ë²”ìœ„í•œ ê°œë…ì˜ ë°©ë²•ì´ë‹¤. ì •ê·œí™”ëŠ” ëª¨ë¸ì´ í•™ìŠµí•˜ê³  ìƒˆë¡œìš´ ë°ì´í„°ì— ì˜ ì¼ë°˜í™”ë˜ë„ë¡ ë„ì›€ì„ ì¤€ë‹¤. ì´ì „ ê¸€ë“¤ì—ì„œëŠ” ë°ì´í„°ê°€ ì •ê·œë¶„í¬ (ê°€ìš°ìŠ¤ ë¶„í¬)ë¥¼ ë”°ë¥¸ë‹¤ê³  ê°€ì •í•˜ê³  ì•„ ë¶„í¬ë¥¼ ì›Œì ì— ë§ì¶”ê³  ë¶„ì‚°ì´ 1ì´ ë˜ë„ë¡ ì¡°ì •í–ˆì—ˆë‹¤. (ë‹¤ìŒ ì½”ë“œ ì°¸ê³ )



```python
normalized_data = (data - np.mean(data, axis=)) / np.std(data,axis=1)
```

ì´ì „ ê¸€ë“¤ì˜ ì˜ˆì œë“¤ì—ì„œëŠ” ëª¨ë¸ì— ë°ì´í„°ë¥¼ ì£¼ì…í•˜ê¸° ì „ì— ì •ê·œí™”í–ˆì—ˆë‹¤. í•˜ì§€ë§Œ ë°ì´í„° ì •ê·œí™”ëŠ” ë„¤íŠ¸ì›Œí¬ì—ì„œ ì¼ì–´ë‚˜ëŠ” ëª¨ë“  ë³€í™˜ ì´í›„ì— í•„ìš”í•  ìˆ˜ë„ ìˆë‹¤. Denseë‚˜ Conv2D ì¸µì— ë“¤ì–´ê°€ëŠ” ë°ì´í„°ì˜ í‰ê· ì´ 0ì´ê³  ë¶„ì‚°ì´ 1ì´ë”ë¼ë„ ì¶œë ¥ë˜ëŠ” ë°ì´í„°ê°€ ë™ì¼í•œ ë¶„í¬ë¥¼ ê°€ì§ˆ ê²ƒì´ë¼ê³  ê¸°ëŒ€í•˜ê¸°ëŠ” ì–´ë µë‹¤. ë”°ë¼ì„œ **ë°°ì¹˜ ì •ê·œí™”(Batch Normalization)**ì„ ì‚¬ìš©í•´ì„œ í™œì„±í™” í•¨ìˆ˜ì˜ ì¶œë ¥ì„ ì •ê·œí™”í•˜ëŠ” ë°©ë²•ì´ ê°œë°œë˜ì—ˆë‹¤. ë°°ì¹˜ ì •ê·œí™”ëŠ” í›ˆë ¨í•˜ëŠ” ë™ì•ˆ í‰ê· ê³¼ ë¶„ì‚°ì´ ë°”ë€Œë”ë¼ë„ ì´ì— ì ì‘í•´ì„œ ë°ì´í„°ë¥¼ ì •ê·œí™”í•œë‹¤. 



ë°°ì¹˜ ì •ê·œí™”ì˜ ì£¼ìš” íš¨ê³¼ëŠ” ì”ì°¨ ì—°ê²°ê³¼ ë¹„ìŠ·í•˜ê²Œ ê·¸ë ˆë””ì–¸íŠ¸ì˜ ì „íŒŒë¥¼ ë„ì™€ì£¼ëŠ” ê²ƒì´ë‹¤. ê²°êµ­ ë” ê¹Šì€ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±ì— ë„ì›€ì„ ì¤€ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ResNet50, EfficientNet, Xception ë“±ì˜ ì¼€ë¼ìŠ¤ì— í¬í•¨ëœ ê³ ê¸‰ ì»¨ë¸Œë„· êµ¬ì¡°ëŠ” ë°°ì¹˜ ì •ê·œí™”ë¥¼ ë§ì´ ì‚¬ìš©í•œë‹¤. BatchNormalization ì¸µì€ Dense,Conv2D ë“±ì„ í¬í•¨í•´ì„œ ì–´ë–¤ ì¸µ ë‹¤ìŒì—ë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ì¤‘ìš”í•œ ì ì€ ì¼ë°˜ì ìœ¼ë¡œ í™œì„±í™” ì¸µ ì´ì „ì— ë°°ì¹˜ ì •ê·œí™” ì¸µì„ ë†“ëŠ” ê²ƒì´ ì¢‹ë‹¤. ë”°ë¼ì„œ ë‹¤ìŒ ì½”ë“œì™€ ê°™ì´ í•˜ëŠ” ê²ƒ ë³´ë‹¤ëŠ”,



```python
x = layers.Conv2D(32,3,activation='relu')(x)
x = layers.BatchNormalization(x)
```

ë‹¤ìŒê³¼ ê°™ì´ ì¸µì„ ìŒ“ëŠ” ê²ƒì´ íš¨ê³¼ì ì´ë‹¤.



```python
x = layers.Con2D(32,3,use_bias = False) #í™œì„±í™” í•¨ìˆ˜ ì§€ì • X
x = layers.BatchNormalization()(x)
x = layers.Activation('relu')(x) # ë°°ì¹˜ ì •ê·œí™” ì¸µ ë‹¤ìŒì— í™œì„±í™” ì¸µì„ ë†“ëŠ”ë‹¤.
```

ì§ê´€ì ìœ¼ë¡œ ë´¤ì„ ë•Œ ì´ë ‡ê²Œ í•˜ëŠ” ì´ìœ ëŠ” ë°°ì¹˜ ì •ê·œí™”ê°€ ì…ë ¥ í‰ê· ì„ 0ìœ¼ë¡œ ë§Œë“¤ì§€ë§Œ, relu í™œì„±í™” í•¨ìˆ˜ëŠ” 0ì„ ê¸°ì¤€ìœ¼ë¡œ ê°’ì„ í†µê³¼ì‹œí‚¤ê±°ë‚˜ ì‚­ì œ ì‹œí‚¤ê¸° ë•Œë¬¸ì´ë‹¤. í™œì„±í™” í•¨ìˆ˜ ì´ì „ì— ì •ê·œí™”ë¥¼ ìˆ˜í–‰í•˜ë©´ relu í•¨ìˆ˜ì˜ í™œìš©ë„ê°€ ê·¹ëŒ€í™” ëœë‹¤. 


### 5.4 ê¹Šì´ë³„ ë¶„ë¦¬ í•©ì„±ê³±

Conv2Dë¥¼ ëŒ€ì²´í•˜ë©´ì„œ ë” ì‘ê³ (=í›ˆë ¨í•  ëª¨ë¸ íŒŒë¼ë¯¸í„°ê°€ ë” ì ê³ ) , ë” ê°€ë³ê³ (= ì—°ì‚°ì´ ë” ì ê³ ) ëª¨ë¸ì˜ ì„±ëŠ¥ì„ ì¡°ê¸ˆì´ë¼ë„ ë†’ì¼ ìˆ˜ ìˆëŠ” ì¸µì´ ìˆë‹¤. ì´ëŠ” **ê¹Šì´ë³„ ë¶„ë¦¬ í•©ì„±ê³±**ì¸µì´ í•˜ëŠ” ì¼ì´ë‹¤. ì´ ì¸µì€ ì…ë ¥ ì±„ë„ë³„ë¡œ ë”°ë¡œë”°ë¡œ ê³µê°„ ë°©í–¥ì˜ í•©ì„±ê³±ì„ ìˆ˜í–‰í•œ í›„, ì•„ë˜ ì´ë¯¸ì§€ì™€ ê°™ì´ ì ë³„ í•©ì„±ê³±(1x1) í•©ì„±ê³±ì„ í†µí•´ ì¶œë ¥ ì±„ë„ì„ í•©ì¹˜ëŠ” ì—­í• ì„ í•œë‹¤. (ì¼€ë¼ìŠ¤ì—ì„œëŠ” SeparableConv2Dì— êµ¬í˜„ë˜ì–´ ìˆë‹¤.)



![convarch3](https://user-images.githubusercontent.com/77332628/197730875-4c5873f3-5ce5-47c0-9ebb-2a157d136369.png)



ì´ëŠ” ê³µê°„ íŠ¹ì„±ì˜ í•™ìŠµê³¼ ì±„ë„ ë°©í–¥ íŠ¹ì„±ì˜ í•™ìŠµì„ ë¶„ë¦¬í•˜ëŠ” íš¨ê³¼ë¥¼ ë‚¸ë‹¤. ê¹Šì´ë³„ ë¶„ë¦¬ í•©ì„±ê³±ì€ ì¼ë°˜ í•©ì„±ê³±ë³´ë‹¤ í›¨ì”© ì ì€ ê°œìˆ˜ì˜ íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ê³  ë” ì ì€ ìˆ˜ì˜ ì—°ì‚°ì„ ìˆ˜í–‰í•˜ë©´ì„œ ìœ ì‚¬í•œ í‘œí˜„ ëŠ¥ë ¥ì„ ê°€ì§€ê³  ìˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ìˆ˜ë ´ì´ ë” ë¹ ë¥´ê³  ì‰½ê²Œ ê³¼ëŒ€ì í•©ë˜ì§€ ì•ŠëŠ” ì‘ì€ ëª¨ë¸ì„ ë§Œë“ ë‹¤. ì´ëŸ° ì¥ì ì€ ì œí•œëœ ë°ì´í„°ë¡œ ë°‘ë°”ë‹¥ë¶€í„° ì‘ì€ ëª¨ë¸ì„ í›ˆë ¨í•  ë•Œ íŠ¹íˆ ì¤‘ìš”í•˜ë‹¤. 



### 5.5 Xception ìœ ì‚¬ ëª¨ë¸ì— ëª¨ë‘ ì ìš©í•˜ê¸°

ì´ ê¸€ì—ì„œ ë°°ìš´ ì»¨ë¸Œë„· ì•„í‚¤í…ì²˜ ì›ì¹™ë“¤ì„ ë‹¤ìŒê³¼ ê°™ì´ ì •ë¦¬í•  ìˆ˜ ìˆë‹¤.





* ëª¨ë¸ì€ ë°˜ë³µë˜ëŠ” ì¸µ **ë¸”ë¡**ìœ¼ë¡œ ì¡°ì§ë˜ì–´ì•¼ í•œë‹¤. ë¸”ë¡ì€ ì¼ë°˜ì ìœ¼ë¡œ ì—¬ëŸ¬ê°œì˜ í•©ì„±ê³± ì¸µê³¼ ìµœëŒ€ í’€ë§ ì¸µìœ¼ë¡œ êµ¬ì„±ëœë‹¤.

* íŠ¹ì„± ë§µì˜ ê³µê°„ ë°©í–¥ í¬ê¸°ê°€ ì¤„ì–´ë“¦ì— ë”°ë¼ ì¸µì˜ í•„í„° ê°œìˆ˜ëŠ” ì¦ê°€í•´ì•¼í•œë‹¤.

* ê¹Šê³  ì¢ì€ ì•„í‚¤í…ì²˜ê°€ ë„“ê³  ì–‡ì€ ê²ƒë³´ë‹¤ ë‚«ë‹¤.

* ì¸µ ë¸”ë¡ì— **ì”ì°¨ ì—°ê²°**ì„ ì¶”ê°€í•˜ë©´ ê¹Šì€ ë„¤íŠ¸ì›Œí¬ë¥¼ í›ˆë ¨í•˜ëŠ”ë° íš¨ê³¼ì ì´ë‹¤.

* í•©ì„±ê³± ì¸µ ë‹¤ìŒì— **ë°°ì¹˜ ì •ê·œí™” ì¸µ**ì„ ì¶”ê°€í•˜ë©´ ë„ì›€ì´ ë  ìˆ˜ ìˆë‹¤.

* Conv2D ì¸µì„ ë” ê°€ë²¼ìš´ **SeparableConv2Dì¸µ**ìœ¼ë¡œ ë°”ê¾¸ë©´ ë„ì›€ì´ ë  ìˆ˜ ìˆë‹¤.



ì´ëŸ° ì•„ì´ë””ì–´ë“¤ì„ í•˜ë‚˜ì˜ ëª¨ë¸ì— ì ìš©í•´ ë³´ê² ë‹¤. ë°‘ì— ë§Œë“¤ ëª¨ë¸ì€ ì‘ì€ ë²„ì „ì˜ Xception ëª¨ë¸ê³¼ ë¹„ìŠ·í•œë°, ì´ ëª¨ë¸ì„ *ê°•ì•„ì§€vsê³ ì–‘ì´* ë°ì´í„°ì…‹ì— ì ìš©í•œë‹¤.




```python
import gdown
gdown.download(id='18uC7WTuEXKJDDxbj-Jq6EjzpFrgE7IAd', output='dogs-vs-cats.zip')  # ë°ì´í„° ë‚´ë ¤ë°›ëŠ” ì½”ë“œ
!unzip -qq dogs-vs-cats.zip
!unzip -qq train.zip
```

<pre>
Downloading...
From: https://drive.google.com/uc?id=18uC7WTuEXKJDDxbj-Jq6EjzpFrgE7IAd
To: /content/dogs-vs-cats.zip
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 852M/852M [00:13<00:00, 63.2MB/s]
</pre>

```python
from tensorflow import keras
from tensorflow.keras import layers
import os, shutil, pathlib
from tensorflow.keras.utils import image_dataset_from_directory

# ë‚´ë ¤ë°›ì€ ë°ì´í„° íŒŒì¼ ë§Œë“¤ê¸°
original_dir = pathlib.Path("train")
new_base_dir = pathlib.Path("cats_vs_dogs_small")

def make_subset(subset_name, start_index, end_index):
    for category in ("cat", "dog"):
        dir = new_base_dir / subset_name / category
        os.makedirs(dir)
        fnames = [f"{category}.{i}.jpg" for i in range(start_index, end_index)]
        for fname in fnames:
            shutil.copyfile(src=original_dir / fname,
                            dst=dir / fname)

make_subset("train", start_index=0, end_index=1000)
make_subset("validation", start_index=1000, end_index=1500)
make_subset("test", start_index=1500, end_index=2500)

train_dataset = image_dataset_from_directory(
    new_base_dir / "train",
    image_size=(180, 180),
    batch_size=32)
validation_dataset = image_dataset_from_directory(
    new_base_dir / "validation",
    image_size=(180, 180),
    batch_size=32)
test_dataset = image_dataset_from_directory(
    new_base_dir / "test",
    image_size=(180, 180),
    batch_size=32)
```

<pre>
Found 2000 files belonging to 2 classes.
Found 1000 files belonging to 2 classes.
Found 2000 files belonging to 2 classes.
</pre>

```python
data_augmentation = keras.Sequential(    # ë°ì´í„° ì¦ì‹
    [
        layers.RandomFlip("horizontal"),
        layers.RandomRotation(0.1),
        layers.RandomZoom(0.2),])
```


```python
inputs = keras.Input(shape=(180,180,3))
x = data_augmentation(inputs)
x = layers.Rescaling(1./255)(x)
x = layers.Conv2D(filters=32,kernel_size=5,use_bias=False)(x)

for size in [32,64,128,256,512]: 
 ''' íŠ¹ì„± ë§µ ê¹Šì´ë¥¼ ì¦ê°€ì‹œí‚¤ë©´ì„œ í•©ì„±ê³± ë¸”ë¡ì„ ì—°ì†ì ìœ¼ë¡œ ì ìš©í•œë‹¤.
 ê° ë¸”ë¡ì€ ë°°ì¹˜ì •ê·œí™”ë¥¼ ì ìš©í•œ 2ê°œì˜ ê¹Šì´ë³„ ë¶„ë¦¬ í•©ì„±ê³± ì¸µê³¼ í•˜ë‚˜ì˜ ìµœëŒ€ í’€ë§ì¸µìœ¼ë¡œ êµ¬ì„±ë˜ê³ ,
 ë¸”ë¡ë§ˆë‹¤ ì”ì°¨ ì—°ê²°ì´ ì¶”ê°€ëœë‹¤.''' 
 residual = x # ì”ì°¨ëŠ” ë³„ë„ë¡œ ì €ì¥ 
 
 x = layers.BatchNormalization()(x) # ë°°ì¹˜ ì •ê·œí™”
 x = layers.Activation('relu')(x)
 x = layers.SeparableConv2D(size,3,padding='same',use_bias=False)(x) # ê¹Šì´ë³„ ë¶„ë¦¬ í•©ì„±ê³±
  
 x = layers.BatchNormalization()(x) 
 x = layers.Activation('relu')(x)
 x = layers.SeparableConv2D(size,3,padding='same',use_bias=False)(x)

 x = layers.MaxPooling2D(3,strides=2,padding='same')(x)

 residual = layers.Conv2D(
     size,1,strides=2,padding='same',use_bias=False)(residual) 
 x = layers.add([x,residual]) # ì”ì°¨ ì—°ê²°

x = layers.GlobalAveragePooling2D()(x) # Dense ì¸µ ì´ì „ì— Flatten ëŒ€ì‹  GlobalAveragePooling2D ì‚¬ìš©
x = layers.Dropout(0.5)(x) # ê·œì œë¥¼ ìœ„í•´ ë“œë¡­ì•„ì›ƒ ì¸µ ì‚¬ìš©
outputs = layers.Dense(1,activation='sigmoid')(x)
model = keras.Model(inputs=inputs,outputs= outputs)

model.summary()
```

<pre>
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 input_1 (InputLayer)           [(None, 180, 180, 3  0           []                               
                                )]                                                                
                                                                                                  
 sequential (Sequential)        (None, 180, 180, 3)  0           ['input_1[0][0]']                
                                                                                                  
 rescaling (Rescaling)          (None, 180, 180, 3)  0           ['sequential[0][0]']             
                                                                                                  
 conv2d (Conv2D)                (None, 176, 176, 32  2400        ['rescaling[0][0]']              
                                )                                                                 
                                                                                                  
 batch_normalization (BatchNorm  (None, 176, 176, 32  128        ['conv2d[0][0]']                 
 alization)                     )                                                                 
                                                                                                  
 activation (Activation)        (None, 176, 176, 32  0           ['batch_normalization[0][0]']    
                                )                                                                 
                                                                                                  
 separable_conv2d (SeparableCon  (None, 176, 176, 32  1312       ['activation[0][0]']             
 v2D)                           )                                                                 
                                                                                                  
 batch_normalization_1 (BatchNo  (None, 176, 176, 32  128        ['separable_conv2d[0][0]']       
 rmalization)                   )                                                                 
                                                                                                  
 activation_1 (Activation)      (None, 176, 176, 32  0           ['batch_normalization_1[0][0]']  
                                )                                                                 
                                                                                                  
 separable_conv2d_1 (SeparableC  (None, 176, 176, 32  1312       ['activation_1[0][0]']           
 onv2D)                         )                                                                 
                                                                                                  
 max_pooling2d (MaxPooling2D)   (None, 88, 88, 32)   0           ['separable_conv2d_1[0][0]']     
                                                                                                  
 conv2d_1 (Conv2D)              (None, 88, 88, 32)   1024        ['conv2d[0][0]']                 
                                                                                                  
 add (Add)                      (None, 88, 88, 32)   0           ['max_pooling2d[0][0]',          
                                                                  'conv2d_1[0][0]']               
                                                                                                  
 batch_normalization_2 (BatchNo  (None, 88, 88, 32)  128         ['add[0][0]']                    
 rmalization)                                                                                     
                                                                                                  
 activation_2 (Activation)      (None, 88, 88, 32)   0           ['batch_normalization_2[0][0]']  
                                                                                                  
 separable_conv2d_2 (SeparableC  (None, 88, 88, 64)  2336        ['activation_2[0][0]']           
 onv2D)                                                                                           
                                                                                                  
 batch_normalization_3 (BatchNo  (None, 88, 88, 64)  256         ['separable_conv2d_2[0][0]']     
 rmalization)                                                                                     
                                                                                                  
 activation_3 (Activation)      (None, 88, 88, 64)   0           ['batch_normalization_3[0][0]']  
                                                                                                  
 separable_conv2d_3 (SeparableC  (None, 88, 88, 64)  4672        ['activation_3[0][0]']           
 onv2D)                                                                                           
                                                                                                  
 max_pooling2d_1 (MaxPooling2D)  (None, 44, 44, 64)  0           ['separable_conv2d_3[0][0]']     
                                                                                                  
 conv2d_2 (Conv2D)              (None, 44, 44, 64)   2048        ['add[0][0]']                    
                                                                                                  
 add_1 (Add)                    (None, 44, 44, 64)   0           ['max_pooling2d_1[0][0]',        
                                                                  'conv2d_2[0][0]']               
                                                                                                  
 batch_normalization_4 (BatchNo  (None, 44, 44, 64)  256         ['add_1[0][0]']                  
 rmalization)                                                                                     
                                                                                                  
 activation_4 (Activation)      (None, 44, 44, 64)   0           ['batch_normalization_4[0][0]']  
                                                                                                  
 separable_conv2d_4 (SeparableC  (None, 44, 44, 128)  8768       ['activation_4[0][0]']           
 onv2D)                                                                                           
                                                                                                  
 batch_normalization_5 (BatchNo  (None, 44, 44, 128)  512        ['separable_conv2d_4[0][0]']     
 rmalization)                                                                                     
                                                                                                  
 activation_5 (Activation)      (None, 44, 44, 128)  0           ['batch_normalization_5[0][0]']  
                                                                                                  
 separable_conv2d_5 (SeparableC  (None, 44, 44, 128)  17536      ['activation_5[0][0]']           
 onv2D)                                                                                           
                                                                                                  
 max_pooling2d_2 (MaxPooling2D)  (None, 22, 22, 128)  0          ['separable_conv2d_5[0][0]']     
                                                                                                  
 conv2d_3 (Conv2D)              (None, 22, 22, 128)  8192        ['add_1[0][0]']                  
                                                                                                  
 add_2 (Add)                    (None, 22, 22, 128)  0           ['max_pooling2d_2[0][0]',        
                                                                  'conv2d_3[0][0]']               
                                                                                                  
 batch_normalization_6 (BatchNo  (None, 22, 22, 128)  512        ['add_2[0][0]']                  
 rmalization)                                                                                     
                                                                                                  
 activation_6 (Activation)      (None, 22, 22, 128)  0           ['batch_normalization_6[0][0]']  
                                                                                                  
 separable_conv2d_6 (SeparableC  (None, 22, 22, 256)  33920      ['activation_6[0][0]']           
 onv2D)                                                                                           
                                                                                                  
 batch_normalization_7 (BatchNo  (None, 22, 22, 256)  1024       ['separable_conv2d_6[0][0]']     
 rmalization)                                                                                     
                                                                                                  
 activation_7 (Activation)      (None, 22, 22, 256)  0           ['batch_normalization_7[0][0]']  
                                                                                                  
 separable_conv2d_7 (SeparableC  (None, 22, 22, 256)  67840      ['activation_7[0][0]']           
 onv2D)                                                                                           
                                                                                                  
 max_pooling2d_3 (MaxPooling2D)  (None, 11, 11, 256)  0          ['separable_conv2d_7[0][0]']     
                                                                                                  
 conv2d_4 (Conv2D)              (None, 11, 11, 256)  32768       ['add_2[0][0]']                  
                                                                                                  
 add_3 (Add)                    (None, 11, 11, 256)  0           ['max_pooling2d_3[0][0]',        
                                                                  'conv2d_4[0][0]']               
                                                                                                  
 batch_normalization_8 (BatchNo  (None, 11, 11, 256)  1024       ['add_3[0][0]']                  
 rmalization)                                                                                     
                                                                                                  
 activation_8 (Activation)      (None, 11, 11, 256)  0           ['batch_normalization_8[0][0]']  
                                                                                                  
 separable_conv2d_8 (SeparableC  (None, 11, 11, 512)  133376     ['activation_8[0][0]']           
 onv2D)                                                                                           
                                                                                                  
 batch_normalization_9 (BatchNo  (None, 11, 11, 512)  2048       ['separable_conv2d_8[0][0]']     
 rmalization)                                                                                     
                                                                                                  
 activation_9 (Activation)      (None, 11, 11, 512)  0           ['batch_normalization_9[0][0]']  
                                                                                                  
 separable_conv2d_9 (SeparableC  (None, 11, 11, 512)  266752     ['activation_9[0][0]']           
 onv2D)                                                                                           
                                                                                                  
 max_pooling2d_4 (MaxPooling2D)  (None, 6, 6, 512)   0           ['separable_conv2d_9[0][0]']     
                                                                                                  
 conv2d_5 (Conv2D)              (None, 6, 6, 512)    131072      ['add_3[0][0]']                  
                                                                                                  
 add_4 (Add)                    (None, 6, 6, 512)    0           ['max_pooling2d_4[0][0]',        
                                                                  'conv2d_5[0][0]']               
                                                                                                  
 global_average_pooling2d (Glob  (None, 512)         0           ['add_4[0][0]']                  
 alAveragePooling2D)                                                                              
                                                                                                  
 dropout (Dropout)              (None, 512)          0           ['global_average_pooling2d[0][0]'
                                                                 ]                                
                                                                                                  
 dense (Dense)                  (None, 1)            513         ['dropout[0][0]']                
                                                                                                  
==================================================================================================
Total params: 721,857
Trainable params: 718,849
Non-trainable params: 3,008
__________________________________________________________________________________________________
</pre>
ìœ„ì˜ ëª¨ë¸ì˜ í›ˆë ¨ ê°€ëŠ¥í•œ íŒŒë¼ë¯¸í„° ê°œìˆ˜ëŠ” 721,857ê°œë¡œ ì›ë³¸ ëª¨ë¸ì˜ íŒŒë¼ë¯¸í„° ê°œìˆ˜ì¸ 99ë§Œì—¬ê°œ ë³´ë‹¤ ì¡°ê¸ˆ ì ë‹¤. í›ˆë ¨ ê²°ê³¼ëŠ” ì–´ë–»ê²Œ ë‹¤ë¥¸ì§€ ì•Œì•„ë³´ì.



```python
callbacks = [ 
    keras.callbacks.ModelCheckpoint(           # ì½œë°± ì‚¬ìš©
        filepath="convnet_best_architecture.keras", # ëª¨ë¸ ì €ì¥ ê²½ë¡œ
        save_best_only=True,                   # val_loss ê°’ì´ ì´ì „ë³´ë‹¤ ë‚®ì„ ë•Œë§Œ ì €ì¥
        monitor="val_loss")
]
model.compile(loss="binary_crossentropy",
              optimizer="rmsprop",
              metrics=["accuracy"])
history = model.fit(
    train_dataset,
    epochs=100,
    validation_data=validation_dataset,
    callbacks=callbacks)
```

<pre>
Epoch 1/100
63/63 [==============================] - 44s 476ms/step - loss: 0.0994 - accuracy: 0.9640 - val_loss: 0.5640 - val_accuracy: 0.8870
Epoch 2/100
63/63 [==============================] - 30s 467ms/step - loss: 0.0808 - accuracy: 0.9705 - val_loss: 0.3714 - val_accuracy: 0.9010
.
.
.
Epoch 99/100
63/63 [==============================] - 30s 470ms/step - loss: 0.0439 - accuracy: 0.9865 - val_loss: 0.7075 - val_accuracy: 0.8810
Epoch 100/100
63/63 [==============================] - 29s 451ms/step - loss: 0.0532 - accuracy: 0.9805 - val_loss: 0.4746 - val_accuracy: 0.8960
</pre>

```python
import matplotlib.pyplot as plt
accuracy = history.history["accuracy"]
val_accuracy = history.history["val_accuracy"]
loss = history.history["loss"]
val_loss = history.history["val_loss"]
epochs = range(1, len(accuracy) + 1)
plt.plot(epochs, accuracy, "bo", label="Training accuracy")
plt.plot(epochs, val_accuracy, "b", label="Validation accuracy")
plt.title("Training and validation accuracy")
plt.legend()
plt.figure()
plt.plot(epochs, loss, "bo", label="Training loss")
plt.plot(epochs, val_loss, "b", label="Validation loss")
plt.title("Training and validation loss")
plt.legend()
plt.show()
```

![convarch4](https://user-images.githubusercontent.com/77332628/197730876-d0b07b9a-50b5-4c12-ace5-636832c9da69.png)
![convarch5](https://user-images.githubusercontent.com/77332628/197730878-236bd7d0-1870-4e72-afc9-8e71b4fd8675.png)

```python
test_model = keras.models.load_model("convnet_best_architecture.keras")
test_loss, test_acc = test_model.evaluate(test_dataset)
print(f"í…ŒìŠ¤íŠ¸ ì •í™•ë„: {test_acc:.3f}")
```

<pre>
63/63 [==============================] - 3s 42ms/step - loss: 0.3586 - accuracy: 0.8835
í…ŒìŠ¤íŠ¸ ì •í™•ë„: 0.883
</pre>
ìœ„ì˜ ê·¸ë˜í”„ë¥¼ ë³´ë©´ [ì´ì „ ê¸€](https://hamin-chang.github.io/small/) ì—ì„œ êµ¬ì¶•í•œ 

ë‹¨ìˆœí•œ ëª¨ë¸ë³´ë‹¤ íŒŒë¼ë¯¸í„° ìˆ˜ê°€ ì ì§€ë§Œ ì›ë³¸ ëª¨ë¸ê³¼ ì—¬ì „íˆ ë™ì¼í•œ ì„±ëŠ¥ ë²”ìœ„ ì•ˆì— ìˆë‹¤. ì´ë²ˆ ê¸€ì—ì„œ ë§Œë“  ìƒˆë¡œìš´ ëª¨ë¸ì€ 88.3%ì˜ í…ŒìŠ¤íŠ¸ ì •í™•ë„ë¥¼ ë³´ì´ì§€ë§Œ ì´ì „ ê¸€ì˜ ë‹¨ìˆœí•œ ëª¨ë¸ì€ 69% ì •ë„ì˜ í…ŒìŠ¤íŠ¸ ì •í™•ë„ë¥¼ ë‹¬ì„±í–ˆì—ˆë‹¤. í…ŒìŠ¤íŠ¸ ì •í™•ë„ë¥¼ ë¹„êµí•˜ë©´ ì•Œ ìˆ˜ ìˆë“¯ì´ ì•„í‚¤í…ì²˜ ëª¨ë²” ì‚¬ë¡€ë¥¼ ë”°ë¥´ë©´ ëª¨ë¸ ì„±ëŠ¥ì— ì¦‰ê°ì ì´ê³  ê´„ëª©í•  ë§Œí•œ ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆë‹¤. 



(ì´ ì‹œì ì—ì„œ ì„±ëŠ¥ì„ ë” í–¥ìƒì‹œí‚¤ë ¤ë©´ ëª¨ë¸ì˜ íŒŒë¼ë¯¸í„°ë¥¼ ì²´ê³„ì ìœ¼ë¡œ íŠœë‹í•´ì•¼í•œë‹¤. ì´ ì£¼ì œëŠ” ë‹¤ë¥¸ ê¸€ì—ì„œ ë‹¤ë£¨ê² ë‹¤.)



ì´ê²ƒìœ¼ë¡œ í•µì‹¬ì ì¸ ì»¨ë¸Œë„· ì•„í‚¤í…ì²˜ ëª¨ë²” ì‚¬ë¡€ì— ëŒ€í•œ ê¸€ì„ ë§ˆì¹˜ê² ë‹¤.

[<ì¼€ë¼ìŠ¤ ì°½ì‹œìì—ê²Œ ë°°ìš°ëŠ” ë”¥ëŸ¬ë‹ ê°œì • 2íŒ>(ê¸¸ë²—, 2022)ì„ í•™ìŠµí•˜ê³  ê°œì¸ í•™ìŠµìš©ìœ¼ë¡œ ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤.] ì¶œì²˜: í”„ë‘ì†Œì™€ ìˆ„ë ˆ ì§€ìŒ, âŒœì¼€ë¼ìŠ¤ ì°½ì‹œìì—ê²Œ ë°°ìš°ëŠ” ë”¥ëŸ¬ë‹ ê°œì •2íŒâŒŸ, ë°•í•´ì„  ì˜®ê¹€, ê¸¸ë²—, 2022 ë„ì„œë³´ê¸°: https://www.gilbut.co.kr/book/view?bookcode=BN003496

